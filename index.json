[{"content":"ğŸ‘‹ æ­¡è¿ä¾†åˆ° Bill.Lin\u0026rsquo;s Notes é€™è£¡æ˜¯æˆ‘çš„æŠ€è¡“å­¸ç¿’ç­†è¨˜å’Œå¿ƒå¾—åˆ†äº«ç©ºé–“ã€‚ä¸»è¦è¨˜éŒ„ç¨‹å¼é–‹ç™¼éç¨‹ä¸­é‡åˆ°çš„å•é¡Œã€è§£æ±ºæ–¹æ¡ˆï¼Œä»¥åŠå°å„ç¨®æŠ€è¡“çš„ç†è§£å’Œå¯¦è¸ç¶“é©—ã€‚\nğŸ“š ä¸»è¦å…§å®¹ ğŸ§® æ¼”ç®—æ³•èˆ‡è³‡æ–™çµæ§‹ ç¶“å…¸æ¼”ç®—æ³•å¯¦ä½œèˆ‡åˆ†æ LeetCode è§£é¡Œæ€è·¯èˆ‡æŠ€å·§ è³‡æ–™çµæ§‹çš„æ‡‰ç”¨å ´æ™¯ ğŸ’» å¾Œç«¯é–‹ç™¼ Java: èªè¨€ç‰¹æ€§ã€é›†åˆæ¡†æ¶ã€ä¸¦ç™¼ç¨‹å¼è¨­è¨ˆ Kotlin: èªæ³•ç³–ã€å”ç¨‹ã€èˆ‡ Java äº’æ“ä½œ Spring: IoC/DIã€AOPã€MVCã€Securityã€Boot ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ è¨­è¨ˆæ¨¡å¼: GoF 23 ç¨®è¨­è¨ˆæ¨¡å¼çš„ç†è«–èˆ‡å¯¦è¸ SOLID åŸå‰‡: ç‰©ä»¶å°å‘è¨­è¨ˆçš„äº”å¤§åŸå‰‡ åˆ†æ•£å¼ç³»çµ±: å¾®æœå‹™ã€è¨Šæ¯ä½‡åˆ—ã€åˆ†æ•£å¼é– ğŸ³ DevOps Docker: å®¹å™¨åŒ–éƒ¨ç½²èˆ‡æœ€ä½³å¯¦è¸ CI/CD: è‡ªå‹•åŒ–å»ºæ§‹èˆ‡éƒ¨ç½²æµç¨‹ ç›£æ§: æ‡‰ç”¨æ•ˆèƒ½ç›£æ§èˆ‡æ—¥èªŒç®¡ç† ğŸ› ï¸ é–‹ç™¼å·¥å…· Linux: å¸¸ç”¨æŒ‡ä»¤èˆ‡è…³æœ¬ç·¨å¯« Git: ç‰ˆæœ¬æ§åˆ¶èˆ‡å”ä½œå·¥ä½œæµ Hugo: éœæ…‹ç¶²ç«™ç”Ÿæˆå™¨çš„ä½¿ç”¨å¿ƒå¾— ğŸ¯ å¯«ä½œç›®æ¨™ è¨˜éŒ„å­¸ç¿’éç¨‹: å°‡å­¸ç¿’åˆ°çš„çŸ¥è­˜é»æ•´ç†æˆç­†è¨˜ï¼ŒåŠ æ·±ç†è§£ åˆ†äº«å¯¦è¸ç¶“é©—: åˆ†äº«åœ¨å¯¦éš›å°ˆæ¡ˆä¸­é‡åˆ°çš„å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆ å»ºç«‹çŸ¥è­˜é«”ç³»: é€éæŒçºŒå¯«ä½œï¼Œå»ºç«‹å®Œæ•´çš„æŠ€è¡“çŸ¥è­˜æ¶æ§‹ å¹«åŠ©ä»–äººå­¸ç¿’: å¸Œæœ›é€™äº›ç­†è¨˜èƒ½å°å…¶ä»–é–‹ç™¼è€…æœ‰æ‰€å¹«åŠ© ğŸ“– æ–‡ç« ç‰¹è‰² ç†è«–èˆ‡å¯¦è¸ä¸¦é‡: ä¸åƒ…èªªæ˜åŸç†ï¼Œæ›´è‘—é‡å¯¦éš›æ‡‰ç”¨ ç¨‹å¼ç¢¼ç¯„ä¾‹è±å¯Œ: æä¾›å®Œæ•´å¯åŸ·è¡Œçš„ç¨‹å¼ç¢¼ç¤ºä¾‹ å¾ªåºæ¼¸é€²: å¾åŸºç¤æ¦‚å¿µåˆ°é€²éšæ‡‰ç”¨ï¼Œé€æ­¥æ·±å…¥ æŒçºŒæ›´æ–°: æ ¹æ“šæ–°çš„å­¸ç¿’å¿ƒå¾—å’ŒæŠ€è¡“ç™¼å±•æŒçºŒæ›´æ–°å…§å®¹ ğŸ¤ è¯çµ¡æ–¹å¼ å¦‚æœæ‚¨å°æ–‡ç« å…§å®¹æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œæ­¡è¿é€éä»¥ä¸‹æ–¹å¼è¯çµ¡ï¼š\nGitHub: xinqilin Email: è«‹é€é GitHub è¯çµ¡ ğŸ™ è‡´è¬ æ„Ÿè¬æ‰€æœ‰åœ¨æŠ€è¡“å­¸ç¿’è·¯ä¸Šçµ¦äºˆå¹«åŠ©çš„åŒäº‹ã€æœ‹å‹å’Œé–‹æºç¤¾ç¾¤ã€‚ç‰¹åˆ¥æ„Ÿè¬é‚£äº›ç„¡ç§åˆ†äº«æŠ€è¡“çŸ¥è­˜çš„éƒ¨è½æ ¼ä½œè€…å’Œæ•™ç¨‹å‰µä½œè€…ï¼Œæ‚¨å€‘çš„åˆ†äº«è®“æˆ‘å—ç›Šè‰¯å¤šã€‚\nã€Œå­¸è€Œæ™‚ç¿’ä¹‹ï¼Œä¸äº¦èªªä¹ã€- è«–èª\nå¸Œæœ›é€™å€‹å°å°çš„æŠ€è¡“ç­†è¨˜ç©ºé–“ï¼Œèƒ½æˆç‚ºçŸ¥è­˜åˆ†äº«å’Œäº¤æµçš„å¹³å°ã€‚è®“æˆ‘å€‘ä¸€èµ·åœ¨æŠ€è¡“çš„æµ·æ´‹ä¸­æ¢ç´¢å’Œæˆé•·ï¼\n","permalink":"https://xinqilin.github.io/about/","tags":null,"title":"é—œæ–¼ Bill.Lin's Notes"},{"content":"æ¦‚è¿° FTPï¼ˆFile Transfer Protocolï¼‰æ˜¯ä¼æ¥­ç’°å¢ƒä¸­å¸¸ç”¨çš„æª”æ¡ˆå‚³è¼¸å”å®šã€‚æœ¬æ–‡æä¾›ä¸€å€‹å®Œæ•´ã€å®‰å…¨ä¸”å¯é çš„ FTP å·¥å…·é¡å¯¦ä½œï¼Œé©ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒçš„æª”æ¡ˆä¸Šå‚³ã€ä¸‹è¼‰å’Œç®¡ç†éœ€æ±‚ã€‚\næ ¸å¿ƒç‰¹æ€§ âœ… é…ç½®å¤–éƒ¨åŒ–ï¼šæ‰€æœ‰é€£ç·šè³‡è¨Šé€éé…ç½®æª”æ¡ˆç®¡ç† âœ… é€£ç·šæ± ç®¡ç†ï¼šæ”¯æ´é€£ç·šè¤‡ç”¨ï¼Œæå‡æ•ˆèƒ½ âœ… å®Œæ•´éŒ¯èª¤è™•ç†ï¼šè©³ç´°çš„ç•°å¸¸è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶ âœ… æª”æ¡ˆæ“ä½œï¼šä¸Šå‚³ã€ä¸‹è¼‰ã€åˆªé™¤ã€åˆ—è¡¨ç­‰å®Œæ•´åŠŸèƒ½ âœ… å®‰å…¨è€ƒé‡ï¼šå¯†ç¢¼åŠ å¯†ã€é€£ç·šè¶…æ™‚ã€è³‡æºé‡‹æ”¾ âœ… æ—¥èªŒè¨˜éŒ„ï¼šå®Œæ•´çš„æ“ä½œæ—¥èªŒå’Œç›£æ§ ä¾è³´é…ç½® Maven ä¾è³´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;dependencies\u0026gt; \u0026lt;!-- Apache Commons Net --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;commons-net\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;commons-net\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.9.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- Spring Boot Starter --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- é…ç½®è™•ç† --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-configuration-processor\u0026lt;/artifactId\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; Gradle ä¾è³´ 1 2 3 4 5 dependencies { implementation \u0026#39;commons-net:commons-net:3.9.0\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter\u0026#39; annotationProcessor \u0026#39;org.springframework.boot:spring-boot-configuration-processor\u0026#39; } é…ç½®é¡è¨­è¨ˆ FTP é…ç½®å±¬æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 package com.example.config; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.stereotype.Component; @Component @ConfigurationProperties(prefix = \u0026#34;ftp\u0026#34;) public class FtpProperties { private String host; private int port = 21; private String username; private String password; private String basePath = \u0026#34;/\u0026#34;; private int connectTimeout = 30000; // 30 ç§’ private int dataTimeout = 60000; // 60 ç§’ private int bufferSize = 8192; // 8KB private String encoding = \u0026#34;UTF-8\u0026#34;; private boolean passiveMode = true; private int maxConnections = 10; // Getters and Setters public String getHost() { return host; } public void setHost(String host) { this.host = host; } public int getPort() { return port; } public void setPort(int port) { this.port = port; } public String getUsername() { return username; } public void setUsername(String username) { this.username = username; } public String getPassword() { return password; } public void setPassword(String password) { this.password = password; } public String getBasePath() { return basePath; } public void setBasePath(String basePath) { this.basePath = basePath; } public int getConnectTimeout() { return connectTimeout; } public void setConnectTimeout(int connectTimeout) { this.connectTimeout = connectTimeout; } public int getDataTimeout() { return dataTimeout; } public void setDataTimeout(int dataTimeout) { this.dataTimeout = dataTimeout; } public int getBufferSize() { return bufferSize; } public void setBufferSize(int bufferSize) { this.bufferSize = bufferSize; } public String getEncoding() { return encoding; } public void setEncoding(String encoding) { this.encoding = encoding; } public boolean isPassiveMode() { return passiveMode; } public void setPassiveMode(boolean passiveMode) { this.passiveMode = passiveMode; } public int getMaxConnections() { return maxConnections; } public void setMaxConnections(int maxConnections) { this.maxConnections = maxConnections; } } æ‡‰ç”¨é…ç½®æª”æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # application.yml ftp: host: ${FTP_HOST:ftp.example.com} port: ${FTP_PORT:21} username: ${FTP_USERNAME:} password: ${FTP_PASSWORD:} base-path: ${FTP_BASE_PATH:/uploads} connect-timeout: 30000 data-timeout: 60000 buffer-size: 8192 encoding: UTF-8 passive-mode: true max-connections: 10 # ç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ # export FTP_HOST=your-ftp-server.com # export FTP_USERNAME=your-username # export FTP_PASSWORD=your-secure-password æ ¸å¿ƒå·¥å…·é¡å¯¦ä½œ FTP é€£ç·šå·¥å»  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 package com.example.util; import org.apache.commons.net.ftp.FTPClient; import org.apache.commons.net.ftp.FTPReply; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Component; import com.example.config.FtpProperties; import java.io.IOException; import java.util.concurrent.BlockingQueue; import java.util.concurrent.LinkedBlockingQueue; @Component public class FtpConnectionFactory { private static final Logger logger = LoggerFactory.getLogger(FtpConnectionFactory.class); @Autowired private FtpProperties ftpProperties; private final BlockingQueue\u0026lt;FTPClient\u0026gt; connectionPool = new LinkedBlockingQueue\u0026lt;\u0026gt;(); /** * å»ºç«‹ FTP é€£ç·š */ public FTPClient createConnection() throws IOException { FTPClient ftpClient = new FTPClient(); try { // è¨­å®šé€£ç·šåƒæ•¸ ftpClient.setConnectTimeout(ftpProperties.getConnectTimeout()); ftpClient.setDataTimeout(ftpProperties.getDataTimeout()); ftpClient.setControlEncoding(ftpProperties.getEncoding()); ftpClient.setBufferSize(ftpProperties.getBufferSize()); // å»ºç«‹é€£ç·š ftpClient.connect(ftpProperties.getHost(), ftpProperties.getPort()); // æª¢æŸ¥é€£ç·šå›æ‡‰ int replyCode = ftpClient.getReplyCode(); if (!FTPReply.isPositiveCompletion(replyCode)) { ftpClient.disconnect(); throw new IOException(\u0026#34;FTP ä¼ºæœå™¨æ‹’çµ•é€£ç·šï¼Œå›æ‡‰ç¢¼ï¼š\u0026#34; + replyCode); } // ç™»å…¥ boolean loginSuccess = ftpClient.login(ftpProperties.getUsername(), ftpProperties.getPassword()); if (!loginSuccess) { ftpClient.disconnect(); throw new IOException(\u0026#34;FTP ç™»å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ä½¿ç”¨è€…åç¨±å’Œå¯†ç¢¼\u0026#34;); } // è¨­å®šæª”æ¡ˆå‚³è¼¸æ¨¡å¼ ftpClient.setFileType(FTPClient.BINARY_FILE_TYPE); // è¨­å®šè¢«å‹•/ä¸»å‹•æ¨¡å¼ if (ftpProperties.isPassiveMode()) { ftpClient.enterLocalPassiveMode(); } else { ftpClient.enterLocalActiveMode(); } logger.info(\u0026#34;FTP é€£ç·šå»ºç«‹æˆåŠŸï¼š{}:{}\u0026#34;, ftpProperties.getHost(), ftpProperties.getPort()); return ftpClient; } catch (IOException e) { logger.error(\u0026#34;å»ºç«‹ FTP é€£ç·šå¤±æ•—ï¼š{}\u0026#34;, e.getMessage()); if (ftpClient.isConnected()) { try { ftpClient.disconnect(); } catch (IOException ex) { logger.warn(\u0026#34;é—œé–‰å¤±æ•—çš„ FTP é€£ç·šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{}\u0026#34;, ex.getMessage()); } } throw e; } } /** * æ­¸é‚„é€£ç·šåˆ°é€£ç·šæ±  */ public void returnConnection(FTPClient ftpClient) { if (ftpClient != null \u0026amp;\u0026amp; ftpClient.isConnected()) { if (connectionPool.size() \u0026lt; ftpProperties.getMaxConnections()) { connectionPool.offer(ftpClient); } else { closeConnection(ftpClient); } } } /** * å¾é€£ç·šæ± ç²å–é€£ç·š */ public FTPClient getConnection() throws IOException { FTPClient ftpClient = connectionPool.poll(); if (ftpClient == null || !ftpClient.isConnected()) { return createConnection(); } return ftpClient; } /** * é—œé–‰é€£ç·š */ public void closeConnection(FTPClient ftpClient) { if (ftpClient != null) { try { if (ftpClient.isConnected()) { ftpClient.logout(); ftpClient.disconnect(); } } catch (IOException e) { logger.warn(\u0026#34;é—œé–‰ FTP é€£ç·šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{}\u0026#34;, e.getMessage()); } } } } ä¸»è¦ FTP å·¥å…·é¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 package com.example.util; import org.apache.commons.net.ftp.FTPClient; import org.apache.commons.net.ftp.FTPFile; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Component; import org.springframework.util.StringUtils; import com.example.config.FtpProperties; import java.io.*; import java.time.LocalDateTime; import java.time.format.DateTimeFormatter; import java.util.ArrayList; import java.util.List; @Component public class FtpUtil { private static final Logger logger = LoggerFactory.getLogger(FtpUtil.class); @Autowired private FtpConnectionFactory connectionFactory; @Autowired private FtpProperties ftpProperties; /** * ä¸Šå‚³æª”æ¡ˆ * * @param localFile æœ¬åœ°æª”æ¡ˆ * @param remotePath é ç«¯è·¯å¾‘ï¼ˆç›¸å°æ–¼ basePathï¼‰ * @return ä¸Šå‚³æ˜¯å¦æˆåŠŸ */ public boolean uploadFile(File localFile, String remotePath) { if (!localFile.exists() || !localFile.isFile()) { logger.error(\u0026#34;æœ¬åœ°æª”æ¡ˆä¸å­˜åœ¨æˆ–ä¸æ˜¯æª”æ¡ˆï¼š{}\u0026#34;, localFile.getAbsolutePath()); return false; } try (FileInputStream fis = new FileInputStream(localFile)) { return uploadFile(fis, remotePath, localFile.getName()); } catch (IOException e) { logger.error(\u0026#34;è®€å–æœ¬åœ°æª”æ¡ˆå¤±æ•—ï¼š{}\u0026#34;, e.getMessage()); return false; } } /** * ä¸Šå‚³æª”æ¡ˆæµ * * @param inputStream è¼¸å…¥æµ * @param remotePath é ç«¯è·¯å¾‘ * @param fileName æª”æ¡ˆåç¨± * @return ä¸Šå‚³æ˜¯å¦æˆåŠŸ */ public boolean uploadFile(InputStream inputStream, String remotePath, String fileName) { FTPClient ftpClient = null; try { ftpClient = connectionFactory.getConnection(); // ç¢ºä¿é ç«¯ç›®éŒ„å­˜åœ¨ String fullPath = buildFullPath(remotePath); createDirectoryIfNotExists(ftpClient, fullPath); // åˆ‡æ›åˆ°ç›®æ¨™ç›®éŒ„ if (!ftpClient.changeWorkingDirectory(fullPath)) { logger.error(\u0026#34;ç„¡æ³•åˆ‡æ›åˆ°ç›®éŒ„ï¼š{}\u0026#34;, fullPath); return false; } // ä¸Šå‚³æª”æ¡ˆ boolean result = ftpClient.storeFile(fileName, inputStream); if (result) { logger.info(\u0026#34;æª”æ¡ˆä¸Šå‚³æˆåŠŸï¼š{}/{}\u0026#34;, fullPath, fileName); } else { logger.error(\u0026#34;æª”æ¡ˆä¸Šå‚³å¤±æ•—ï¼š{}/{}\u0026#34;, fullPath, fileName); } return result; } catch (IOException e) { logger.error(\u0026#34;ä¸Šå‚³æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{}\u0026#34;, e.getMessage()); return false; } finally { connectionFactory.returnConnection(ftpClient); closeQuietly(inputStream); } } /** * ä¸‹è¼‰æª”æ¡ˆ * * @param remotePath é ç«¯è·¯å¾‘ * @param fileName æª”æ¡ˆåç¨± * @param localFile æœ¬åœ°æª”æ¡ˆ * @return ä¸‹è¼‰æ˜¯å¦æˆåŠŸ */ public boolean downloadFile(String remotePath, String fileName, File localFile) { FTPClient ftpClient = null; try { ftpClient = connectionFactory.getConnection(); String fullPath = buildFullPath(remotePath); if (!ftpClient.changeWorkingDirectory(fullPath)) { logger.error(\u0026#34;é ç«¯ç›®éŒ„ä¸å­˜åœ¨ï¼š{}\u0026#34;, fullPath); return false; } // ç¢ºä¿æœ¬åœ°ç›®éŒ„å­˜åœ¨ File parentDir = localFile.getParentFile(); if (!parentDir.exists()) { parentDir.mkdirs(); } try (FileOutputStream fos = new FileOutputStream(localFile)) { boolean result = ftpClient.retrieveFile(fileName, fos); if (result) { logger.info(\u0026#34;æª”æ¡ˆä¸‹è¼‰æˆåŠŸï¼š{}/{} -\u0026gt; {}\u0026#34;, fullPath, fileName, localFile.getAbsolutePath()); } else { logger.error(\u0026#34;æª”æ¡ˆä¸‹è¼‰å¤±æ•—ï¼š{}/{}\u0026#34;, fullPath, fileName); } return result; } } catch (IOException e) { logger.error(\u0026#34;ä¸‹è¼‰æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{}\u0026#34;, e.getMessage()); return false; } finally { connectionFactory.returnConnection(ftpClient); } } /** * åˆªé™¤æª”æ¡ˆ * * @param remotePath é ç«¯è·¯å¾‘ * @param fileName æª”æ¡ˆåç¨± * @return åˆªé™¤æ˜¯å¦æˆåŠŸ */ public boolean deleteFile(String remotePath, String fileName) { FTPClient ftpClient = null; try { ftpClient = connectionFactory.getConnection(); String fullPath = buildFullPath(remotePath); if (!ftpClient.changeWorkingDirectory(fullPath)) { logger.error(\u0026#34;é ç«¯ç›®éŒ„ä¸å­˜åœ¨ï¼š{}\u0026#34;, fullPath); return false; } boolean result = ftpClient.deleteFile(fileName); if (result) { logger.info(\u0026#34;æª”æ¡ˆåˆªé™¤æˆåŠŸï¼š{}/{}\u0026#34;, fullPath, fileName); } else { logger.error(\u0026#34;æª”æ¡ˆåˆªé™¤å¤±æ•—ï¼š{}/{}\u0026#34;, fullPath, fileName); } return result; } catch (IOException e) { logger.error(\u0026#34;åˆªé™¤æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{}\u0026#34;, e.getMessage()); return false; } finally { connectionFactory.returnConnection(ftpClient); } } /** * åˆ—å‡ºç›®éŒ„ä¸­çš„æª”æ¡ˆ * * @param remotePath é ç«¯è·¯å¾‘ * @return æª”æ¡ˆåˆ—è¡¨ */ public List\u0026lt;FtpFileInfo\u0026gt; listFiles(String remotePath) { FTPClient ftpClient = null; List\u0026lt;FtpFileInfo\u0026gt; fileList = new ArrayList\u0026lt;\u0026gt;(); try { ftpClient = connectionFactory.getConnection(); String fullPath = buildFullPath(remotePath); if (!ftpClient.changeWorkingDirectory(fullPath)) { logger.error(\u0026#34;é ç«¯ç›®éŒ„ä¸å­˜åœ¨ï¼š{}\u0026#34;, fullPath); return fileList; } FTPFile[] ftpFiles = ftpClient.listFiles(); for (FTPFile ftpFile : ftpFiles) { FtpFileInfo fileInfo = new FtpFileInfo(); fileInfo.setName(ftpFile.getName()); fileInfo.setSize(ftpFile.getSize()); fileInfo.setDirectory(ftpFile.isDirectory()); fileInfo.setModifyTime(ftpFile.getTimestamp()); fileList.add(fileInfo); } logger.info(\u0026#34;æˆåŠŸåˆ—å‡ºç›®éŒ„ {} ä¸­çš„ {} å€‹æª”æ¡ˆ\u0026#34;, fullPath, fileList.size()); } catch (IOException e) { logger.error(\u0026#34;åˆ—å‡ºæª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{}\u0026#34;, e.getMessage()); } finally { connectionFactory.returnConnection(ftpClient); } return fileList; } /** * æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ * * @param remotePath é ç«¯è·¯å¾‘ * @param fileName æª”æ¡ˆåç¨± * @return æª”æ¡ˆæ˜¯å¦å­˜åœ¨ */ public boolean fileExists(String remotePath, String fileName) { FTPClient ftpClient = null; try { ftpClient = connectionFactory.getConnection(); String fullPath = buildFullPath(remotePath); if (!ftpClient.changeWorkingDirectory(fullPath)) { return false; } FTPFile[] files = ftpClient.listFiles(fileName); return files != null \u0026amp;\u0026amp; files.length \u0026gt; 0; } catch (IOException e) { logger.error(\u0026#34;æª¢æŸ¥æª”æ¡ˆå­˜åœ¨æ€§æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{}\u0026#34;, e.getMessage()); return false; } finally { connectionFactory.returnConnection(ftpClient); } } /** * å»ºç«‹å®Œæ•´è·¯å¾‘ */ private String buildFullPath(String remotePath) { String basePath = ftpProperties.getBasePath(); if (!StringUtils.hasText(remotePath)) { return basePath; } // è¦ç¯„åŒ–è·¯å¾‘ String normalizedBasePath = basePath.endsWith(\u0026#34;/\u0026#34;) ? basePath : basePath + \u0026#34;/\u0026#34;; String normalizedRemotePath = remotePath.startsWith(\u0026#34;/\u0026#34;) ? remotePath.substring(1) : remotePath; return normalizedBasePath + normalizedRemotePath; } /** * éè¿´å»ºç«‹ç›®éŒ„ */ private void createDirectoryIfNotExists(FTPClient ftpClient, String path) throws IOException { String[] pathElements = path.split(\u0026#34;/\u0026#34;); StringBuilder currentPath = new StringBuilder(); for (String element : pathElements) { if (StringUtils.hasText(element)) { currentPath.append(\u0026#34;/\u0026#34;).append(element); if (!ftpClient.changeWorkingDirectory(currentPath.toString())) { if (ftpClient.makeDirectory(currentPath.toString())) { logger.debug(\u0026#34;å»ºç«‹ç›®éŒ„ï¼š{}\u0026#34;, currentPath.toString()); } else { throw new IOException(\u0026#34;ç„¡æ³•å»ºç«‹ç›®éŒ„ï¼š\u0026#34; + currentPath.toString()); } } } } } /** * å®‰éœåœ°é—œé–‰è³‡æº */ private void closeQuietly(Closeable closeable) { if (closeable != null) { try { closeable.close(); } catch (IOException e) { // å¿½ç•¥é—œé–‰æ™‚çš„éŒ¯èª¤ } } } } æª”æ¡ˆè³‡è¨Šå¯¦é«”é¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package com.example.util; import java.util.Calendar; public class FtpFileInfo { private String name; private long size; private boolean isDirectory; private Calendar modifyTime; // Getters and Setters public String getName() { return name; } public void setName(String name) { this.name = name; } public long getSize() { return size; } public void setSize(long size) { this.size = size; } public boolean isDirectory() { return isDirectory; } public void setDirectory(boolean directory) { isDirectory = directory; } public Calendar getModifyTime() { return modifyTime; } public void setModifyTime(Calendar modifyTime) { this.modifyTime = modifyTime; } @Override public String toString() { return String.format(\u0026#34;FtpFileInfo{name=\u0026#39;%s\u0026#39;, size=%d, isDirectory=%s}\u0026#34;, name, size, isDirectory); } } ä½¿ç”¨ç¯„ä¾‹ åŸºæœ¬ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 @Service public class FileService { @Autowired private FtpUtil ftpUtil; /** * ä¸Šå‚³ä½¿ç”¨è€…é ­åƒ */ public boolean uploadAvatar(MultipartFile file, String userId) { try { String remotePath = \u0026#34;avatars/\u0026#34; + userId; String fileName = generateFileName(file.getOriginalFilename()); return ftpUtil.uploadFile(file.getInputStream(), remotePath, fileName); } catch (IOException e) { logger.error(\u0026#34;ä¸Šå‚³é ­åƒå¤±æ•—ï¼š{}\u0026#34;, e.getMessage()); return false; } } /** * æ‰¹é‡ä¸Šå‚³æª”æ¡ˆ */ public List\u0026lt;String\u0026gt; batchUpload(List\u0026lt;MultipartFile\u0026gt; files, String category) { List\u0026lt;String\u0026gt; successFiles = new ArrayList\u0026lt;\u0026gt;(); String remotePath = \u0026#34;uploads/\u0026#34; + category + \u0026#34;/\u0026#34; + getCurrentDate(); for (MultipartFile file : files) { try { String fileName = generateFileName(file.getOriginalFilename()); if (ftpUtil.uploadFile(file.getInputStream(), remotePath, fileName)) { successFiles.add(fileName); } } catch (IOException e) { logger.error(\u0026#34;æ‰¹é‡ä¸Šå‚³æª”æ¡ˆå¤±æ•—ï¼š{}\u0026#34;, file.getOriginalFilename()); } } return successFiles; } private String generateFileName(String originalName) { String timestamp = LocalDateTime.now().format(DateTimeFormatter.ofPattern(\u0026#34;yyyyMMddHHmmss\u0026#34;)); String extension = originalName.substring(originalName.lastIndexOf(\u0026#34;.\u0026#34;)); return timestamp + \u0026#34;_\u0026#34; + UUID.randomUUID().toString().substring(0, 8) + extension; } private String getCurrentDate() { return LocalDateTime.now().format(DateTimeFormatter.ofPattern(\u0026#34;yyyy/MM/dd\u0026#34;)); } } é€²éšåŠŸèƒ½ï¼šæª”æ¡ˆåŒæ­¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 @Component public class FtpSyncService { @Autowired private FtpUtil ftpUtil; /** * åŒæ­¥æœ¬åœ°ç›®éŒ„åˆ° FTP */ public void syncDirectoryToFtp(String localDirPath, String remotePath) { File localDir = new File(localDirPath); if (!localDir.exists() || !localDir.isDirectory()) { logger.error(\u0026#34;æœ¬åœ°ç›®éŒ„ä¸å­˜åœ¨ï¼š{}\u0026#34;, localDirPath); return; } syncDirectoryRecursive(localDir, remotePath); } private void syncDirectoryRecursive(File localDir, String remotePath) { File[] files = localDir.listFiles(); if (files == null) return; for (File file : files) { if (file.isDirectory()) { // éè¿´è™•ç†å­ç›®éŒ„ String subRemotePath = remotePath + \u0026#34;/\u0026#34; + file.getName(); syncDirectoryRecursive(file, subRemotePath); } else { // ä¸Šå‚³æª”æ¡ˆ if (!ftpUtil.fileExists(remotePath, file.getName())) { ftpUtil.uploadFile(file, remotePath); logger.info(\u0026#34;åŒæ­¥æª”æ¡ˆï¼š{} -\u0026gt; {}/{}\u0026#34;, file.getAbsolutePath(), remotePath, file.getName()); } } } } } å®‰å…¨æœ€ä½³å¯¦è¸ 1. é…ç½®å®‰å…¨ 1 2 3 4 5 # ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ–åŠ å¯†é…ç½® ftp: host: ${FTP_HOST} username: ${FTP_USERNAME} password: ${FTP_PASSWORD:#{null}} # å¯ä»¥ç‚ºç©ºï¼Œä½¿ç”¨ SSH Key 2. æª”æ¡ˆé©—è­‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Component public class FileValidator { private static final List\u0026lt;String\u0026gt; ALLOWED_EXTENSIONS = Arrays.asList(\u0026#34;.jpg\u0026#34;, \u0026#34;.png\u0026#34;, \u0026#34;.pdf\u0026#34;, \u0026#34;.doc\u0026#34;, \u0026#34;.docx\u0026#34;, \u0026#34;.xls\u0026#34;, \u0026#34;.xlsx\u0026#34;); private static final long MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB public boolean isValidFile(MultipartFile file) { // æª¢æŸ¥æª”æ¡ˆå¤§å° if (file.getSize() \u0026gt; MAX_FILE_SIZE) { return false; } // æª¢æŸ¥æª”æ¡ˆå‰¯æª”å String fileName = file.getOriginalFilename(); if (fileName == null) return false; String extension = fileName.substring(fileName.lastIndexOf(\u0026#34;.\u0026#34;)).toLowerCase(); return ALLOWED_EXTENSIONS.contains(extension); } } 3. å­˜å–æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 @Component public class FtpAccessControl { /** * æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦æœ‰æ¬Šé™å­˜å–æŒ‡å®šè·¯å¾‘ */ public boolean hasAccess(String userId, String remotePath) { // å¯¦ä½œå­˜å–æ§åˆ¶é‚è¼¯ // ä¾‹å¦‚ï¼šä½¿ç”¨è€…åªèƒ½å­˜å–è‡ªå·±çš„ç›®éŒ„ return remotePath.startsWith(\u0026#34;users/\u0026#34; + userId + \u0026#34;/\u0026#34;); } } ç›£æ§èˆ‡ç¶­è­· å¥åº·æª¢æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Component public class FtpHealthIndicator implements HealthIndicator { @Autowired private FtpConnectionFactory connectionFactory; @Override public Health health() { try { FTPClient ftpClient = connectionFactory.getConnection(); boolean isConnected = ftpClient.isConnected(); connectionFactory.returnConnection(ftpClient); return isConnected ? Health.up().withDetail(\u0026#34;status\u0026#34;, \u0026#34;FTP connection available\u0026#34;).build() : Health.down().withDetail(\u0026#34;status\u0026#34;, \u0026#34;FTP connection failed\u0026#34;).build(); } catch (Exception e) { return Health.down().withDetail(\u0026#34;error\u0026#34;, e.getMessage()).build(); } } } æ•ˆèƒ½ç›£æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Aspect @Component public class FtpPerformanceAspect { private static final Logger logger = LoggerFactory.getLogger(FtpPerformanceAspect.class); @Around(\u0026#34;execution(* com.example.util.FtpUtil.*(..))\u0026#34;) public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable { long startTime = System.currentTimeMillis(); try { Object result = joinPoint.proceed(); long endTime = System.currentTimeMillis(); logger.info(\u0026#34;FTP æ“ä½œ {} åŸ·è¡Œæ™‚é–“ï¼š{}ms\u0026#34;, joinPoint.getSignature().getName(), endTime - startTime); return result; } catch (Exception e) { long endTime = System.currentTimeMillis(); logger.error(\u0026#34;FTP æ“ä½œ {} å¤±æ•—ï¼ŒåŸ·è¡Œæ™‚é–“ï¼š{}msï¼ŒéŒ¯èª¤ï¼š{}\u0026#34;, joinPoint.getSignature().getName(), endTime - startTime, e.getMessage()); throw e; } } } å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ 1. é€£ç·šé€¾æ™‚å•é¡Œ 1 2 3 4 5 // å¢åŠ é‡è©¦æ©Ÿåˆ¶ @Retryable(value = {IOException.class}, maxAttempts = 3, backoff = @Backoff(delay = 1000)) public boolean uploadFileWithRetry(InputStream inputStream, String remotePath, String fileName) { return uploadFile(inputStream, remotePath, fileName); } 2. ä¸­æ–‡æª”åå•é¡Œ 1 2 3 4 5 // åœ¨ FTP é…ç½®ä¸­è¨­å®šæ­£ç¢ºçš„ç·¨ç¢¼ ftpClient.setControlEncoding(\u0026#34;UTF-8\u0026#34;); // æˆ–è€…å°æª”åé€²è¡Œç·¨ç¢¼è™•ç† String encodedFileName = new String(fileName.getBytes(\u0026#34;UTF-8\u0026#34;), \u0026#34;ISO-8859-1\u0026#34;); 3. é˜²ç«ç‰†å•é¡Œ 1 2 3 # ä½¿ç”¨è¢«å‹•æ¨¡å¼é¿å…é˜²ç«ç‰†å•é¡Œ ftp: passive-mode: true æ¸¬è©¦ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @SpringBootTest class FtpUtilTest { @Autowired private FtpUtil ftpUtil; @Test void testUploadFile() { // å»ºç«‹æ¸¬è©¦æª”æ¡ˆ File testFile = createTestFile(); // åŸ·è¡Œä¸Šå‚³ boolean result = ftpUtil.uploadFile(testFile, \u0026#34;test\u0026#34;, \u0026#34;test.txt\u0026#34;); // é©—è­‰çµæœ assertTrue(result); assertTrue(ftpUtil.fileExists(\u0026#34;test\u0026#34;, \u0026#34;test.txt\u0026#34;)); // æ¸…ç† ftpUtil.deleteFile(\u0026#34;test\u0026#34;, \u0026#34;test.txt\u0026#34;); } private File createTestFile() { try { File tempFile = File.createTempFile(\u0026#34;test\u0026#34;, \u0026#34;.txt\u0026#34;); Files.write(tempFile.toPath(), \u0026#34;æ¸¬è©¦å…§å®¹\u0026#34;.getBytes()); return tempFile; } catch (IOException e) { throw new RuntimeException(e); } } } ç¸½çµ æœ¬æ–‡æä¾›çš„ FTP å·¥å…·é¡å…·å‚™ä»¥ä¸‹å„ªå‹¢ï¼š\nå®‰å…¨æ€§ï¼šé…ç½®å¤–éƒ¨åŒ–ï¼Œé¿å…ç¡¬ç·¨ç¢¼æ•æ„Ÿè³‡è¨Š å¯é æ€§ï¼šå®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶ æ•ˆèƒ½ï¼šé€£ç·šæ± ç®¡ç†ï¼Œæ”¯æ´ä½µç™¼æ“ä½œ å¯ç¶­è­·æ€§ï¼šæ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ˜“æ–¼æ“´å±•å’Œç¶­è­· ç”Ÿç”¢å°±ç·’ï¼šåŒ…å«ç›£æ§ã€æ—¥èªŒå’Œå¥åº·æª¢æŸ¥ åœ¨å¯¦éš›ä½¿ç”¨æ™‚ï¼Œè«‹æ ¹æ“šå…·é«”éœ€æ±‚èª¿æ•´é…ç½®åƒæ•¸å’Œå®‰å…¨è¨­å®šï¼Œç¢ºä¿ç¬¦åˆæ‚¨çš„æ¥­å‹™å ´æ™¯å’Œå®‰å…¨è¦æ±‚ã€‚\nåƒè€ƒè³‡æ–™ Apache Commons Net å®˜æ–¹æ–‡æª” Spring Boot Configuration Properties FTP RFC 959 å”å®šè¦ç¯„ Java FTP æœ€ä½³å¯¦è¸ ","permalink":"https://xinqilin.github.io/post/backend/ftputil/","tags":["Java","FTP","FileTransfer","Spring","Commons-Net","Security"],"title":"FTP å·¥å…·é¡å¯¦ä½œæŒ‡å—ï¼šå®‰å…¨ã€å¯é çš„æª”æ¡ˆå‚³è¼¸è§£æ±ºæ–¹æ¡ˆ"},{"content":"æ¦‚è¿° åœ¨ä¼æ¥­ç´šæ‡‰ç”¨ç¨‹å¼é–‹ç™¼ä¸­ï¼ŒEnumï¼ˆåˆ—èˆ‰ï¼‰æ˜¯è¡¨ç¤ºæœ‰é™ç‹€æ…‹é›†åˆçš„ç†æƒ³é¸æ“‡ï¼Œå¦‚è¨‚å–®ç‹€æ…‹ã€ä½¿ç”¨è€…è§’è‰²ã€å¯©æ ¸ç‹€æ…‹ç­‰ã€‚æœ¬æ–‡æ·±å…¥æ¢è¨å¦‚ä½•åœ¨ JPA/Hibernate ä¸­æœ‰æ•ˆè™•ç† Enum å‹åˆ¥ï¼ŒåŒ…å«å„ç¨®æ˜ å°„ç­–ç•¥ã€æ•ˆèƒ½è€ƒé‡å’Œå¯¦éš›æ‡‰ç”¨å ´æ™¯ã€‚\nåŸºæœ¬ Enum æ˜ å°„ 1. @Enumerated è¨»è§£ JPA æä¾› @Enumerated è¨»è§£ä¾†è™•ç† Enum æ˜ å°„ï¼Œæ”¯æ´å…©ç¨®ç­–ç•¥ï¼š\nEnumType.ORDINALï¼ˆæ•¸å­—æ˜ å°„ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // å®šç¾©ç‹€æ…‹åˆ—èˆ‰ public enum OrderStatus { PENDING, // 0 CONFIRMED, // 1 SHIPPED, // 2 DELIVERED, // 3 CANCELLED // 4 } // å¯¦é«”é¡ä½¿ç”¨ @Entity @Table(name = \u0026#34;orders\u0026#34;) public class Order { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; @Enumerated(EnumType.ORDINAL) @Column(name = \u0026#34;status\u0026#34;, nullable = false) private OrderStatus status = OrderStatus.PENDING; // å…¶ä»–å±¬æ€§... } è³‡æ–™åº«å„²å­˜ï¼š\n1 2 3 4 5 6 7 CREATE TABLE orders ( id BIGINT PRIMARY KEY AUTO_INCREMENT, status TINYINT NOT NULL DEFAULT 0, -- å…¶ä»–æ¬„ä½ ); -- å„²å­˜çš„å€¼ï¼š0=PENDING, 1=CONFIRMED, 2=SHIPPED, 3=DELIVERED, 4=CANCELLED EnumType.STRINGï¼ˆå­—ä¸²æ˜ å°„ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Entity @Table(name = \u0026#34;orders\u0026#34;) public class Order { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; @Enumerated(EnumType.STRING) @Column(name = \u0026#34;status\u0026#34;, length = 20, nullable = false) private OrderStatus status = OrderStatus.PENDING; // å…¶ä»–å±¬æ€§... } è³‡æ–™åº«å„²å­˜ï¼š\n1 2 3 4 5 6 7 CREATE TABLE orders ( id BIGINT PRIMARY KEY AUTO_INCREMENT, status VARCHAR(20) NOT NULL DEFAULT \u0026#39;PENDING\u0026#39;, -- å…¶ä»–æ¬„ä½ ); -- å„²å­˜çš„å€¼ï¼š\u0026#39;PENDING\u0026#39;, \u0026#39;CONFIRMED\u0026#39;, \u0026#39;SHIPPED\u0026#39;, \u0026#39;DELIVERED\u0026#39;, \u0026#39;CANCELLED\u0026#39; 2. æ˜ å°„ç­–ç•¥æ¯”è¼ƒ ç‰¹æ€§ ORDINAL STRING å„²å­˜ç©ºé–“ å°ï¼ˆ1-4 bytesï¼‰ å¤§ï¼ˆå­—ä¸²é•·åº¦ï¼‰ å¯è®€æ€§ å·®ï¼ˆæ•¸å­—ï¼‰ å¥½ï¼ˆæ–‡å­—ï¼‰ é †åºè®Šæ›´é¢¨éšª é«˜ï¼ˆç ´å£æ€§ï¼‰ ç„¡ æ–°å¢é …ç›® åªèƒ½è¿½åŠ  ä»»æ„ä½ç½® è³‡æ–™åº«æŸ¥è©¢ å¿«é€Ÿ è¼ƒæ…¢ é™¤éŒ¯å‹å–„ å›°é›£ å®¹æ˜“ å»ºè­°ï¼šç”Ÿç”¢ç’°å¢ƒé€šå¸¸ä½¿ç”¨ EnumType.STRINGï¼Œå› ç‚ºå…¶å…·å‚™æ›´å¥½çš„å¯ç¶­è­·æ€§å’Œå¯è®€æ€§ã€‚\né€²éš Enum è™•ç† 1. è‡ªè¨‚ Enum å€¼ ç•¶éœ€è¦æ›´å…·èªæ„çš„è³‡æ–™åº«å€¼æ™‚ï¼Œå¯ä»¥ç‚º Enum æ·»åŠ è‡ªè¨‚å±¬æ€§ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 public enum OrderStatus { PENDING(\u0026#34;PND\u0026#34;, \u0026#34;è¨‚å–®å¾…è™•ç†\u0026#34;), CONFIRMED(\u0026#34;CNF\u0026#34;, \u0026#34;è¨‚å–®å·²ç¢ºèª\u0026#34;), SHIPPED(\u0026#34;SHP\u0026#34;, \u0026#34;å•†å“å·²å‡ºè²¨\u0026#34;), DELIVERED(\u0026#34;DLV\u0026#34;, \u0026#34;å•†å“å·²é€é”\u0026#34;), CANCELLED(\u0026#34;CXL\u0026#34;, \u0026#34;è¨‚å–®å·²å–æ¶ˆ\u0026#34;); private final String code; private final String description; OrderStatus(String code, String description) { this.code = code; this.description = description; } public String getCode() { return code; } public String getDescription() { return description; } // å¾ä»£ç¢¼æŸ¥æ‰¾ Enum public static OrderStatus fromCode(String code) { return Arrays.stream(values()) .filter(status -\u0026gt; status.code.equals(code)) .findFirst() .orElseThrow(() -\u0026gt; new IllegalArgumentException(\u0026#34;æœªçŸ¥çš„è¨‚å–®ç‹€æ…‹ä»£ç¢¼: \u0026#34; + code)); } // å–å¾—æ‰€æœ‰ä»£ç¢¼ public static List\u0026lt;String\u0026gt; getAllCodes() { return Arrays.stream(values()) .map(OrderStatus::getCode) .collect(Collectors.toList()); } } 2. è‡ªè¨‚ AttributeConverter ä½¿ç”¨ JPA 2.1 çš„ @Converter è¨»è§£ä¾†å¯¦ç¾è‡ªè¨‚è½‰æ›ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @Converter(autoApply = true) public class OrderStatusConverter implements AttributeConverter\u0026lt;OrderStatus, String\u0026gt; { @Override public String convertToDatabaseColumn(OrderStatus orderStatus) { if (orderStatus == null) { return null; } return orderStatus.getCode(); } @Override public OrderStatus convertToEntityAttribute(String code) { if (code == null || code.isEmpty()) { return null; } return OrderStatus.fromCode(code); } } å¯¦é«”é¡ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Entity @Table(name = \u0026#34;orders\u0026#34;) public class Order { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; @Convert(converter = OrderStatusConverter.class) @Column(name = \u0026#34;status\u0026#34;, length = 3, nullable = false) private OrderStatus status = OrderStatus.PENDING; // å…¶ä»–å±¬æ€§... } è³‡æ–™åº«å„²å­˜çµæœï¼š\n1 2 -- å„²å­˜çš„å€¼ï¼š\u0026#39;PND\u0026#39;, \u0026#39;CNF\u0026#39;, \u0026#39;SHP\u0026#39;, \u0026#39;DLV\u0026#39;, \u0026#39;CXL\u0026#39; INSERT INTO orders (status) VALUES (\u0026#39;PND\u0026#39;); 3. é€šç”¨ Enum è½‰æ›å™¨ å»ºç«‹é€šç”¨çš„ Enum è½‰æ›å™¨åŸºé¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 public interface CodedEnum { String getCode(); static \u0026lt;T extends Enum\u0026lt;T\u0026gt; \u0026amp; CodedEnum\u0026gt; T fromCode(Class\u0026lt;T\u0026gt; enumClass, String code) { return Arrays.stream(enumClass.getEnumConstants()) .filter(e -\u0026gt; e.getCode().equals(code)) .findFirst() .orElseThrow(() -\u0026gt; new IllegalArgumentException( \u0026#34;æœªçŸ¥çš„ \u0026#34; + enumClass.getSimpleName() + \u0026#34; ä»£ç¢¼: \u0026#34; + code)); } } // é€šç”¨è½‰æ›å™¨åŸºé¡ public abstract class CodedEnumConverter\u0026lt;T extends Enum\u0026lt;T\u0026gt; \u0026amp; CodedEnum\u0026gt; implements AttributeConverter\u0026lt;T, String\u0026gt; { private final Class\u0026lt;T\u0026gt; enumClass; protected CodedEnumConverter(Class\u0026lt;T\u0026gt; enumClass) { this.enumClass = enumClass; } @Override public String convertToDatabaseColumn(T attribute) { return attribute != null ? attribute.getCode() : null; } @Override public T convertToEntityAttribute(String dbData) { return dbData != null ? CodedEnum.fromCode(enumClass, dbData) : null; } } å…·é«”å¯¦ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // å¯¦ä½œ CodedEnum ä»‹é¢ public enum Priority implements CodedEnum { LOW(\u0026#34;L\u0026#34;), MEDIUM(\u0026#34;M\u0026#34;), HIGH(\u0026#34;H\u0026#34;), URGENT(\u0026#34;U\u0026#34;); private final String code; Priority(String code) { this.code = code; } @Override public String getCode() { return code; } } // å…·é«”è½‰æ›å™¨ @Converter(autoApply = true) public class PriorityConverter extends CodedEnumConverter\u0026lt;Priority\u0026gt; { public PriorityConverter() { super(Priority.class); } } è¤‡é›œæ‡‰ç”¨å ´æ™¯ 1. å¤šç‹€æ…‹ Enum è¨­è¨ˆ è¨­è¨ˆåŒ…å«ç‹€æ…‹è½‰æ›é‚è¼¯çš„ Enumï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 public enum OrderStatus implements CodedEnum { DRAFT(\u0026#34;DFT\u0026#34;, \u0026#34;è‰ç¨¿\u0026#34;, Set.of()), PENDING(\u0026#34;PND\u0026#34;, \u0026#34;å¾…è™•ç†\u0026#34;, Set.of(DRAFT)), CONFIRMED(\u0026#34;CNF\u0026#34;, \u0026#34;å·²ç¢ºèª\u0026#34;, Set.of(PENDING)), PAID(\u0026#34;PAD\u0026#34;, \u0026#34;å·²ä»˜æ¬¾\u0026#34;, Set.of(CONFIRMED)), SHIPPED(\u0026#34;SHP\u0026#34;, \u0026#34;å·²å‡ºè²¨\u0026#34;, Set.of(PAID)), DELIVERED(\u0026#34;DLV\u0026#34;, \u0026#34;å·²é€é”\u0026#34;, Set.of(SHIPPED)), CANCELLED(\u0026#34;CXL\u0026#34;, \u0026#34;å·²å–æ¶ˆ\u0026#34;, Set.of(DRAFT, PENDING, CONFIRMED, PAID)), REFUNDED(\u0026#34;RFD\u0026#34;, \u0026#34;å·²é€€æ¬¾\u0026#34;, Set.of(PAID, SHIPPED, DELIVERED)); private final String code; private final String description; private final Set\u0026lt;OrderStatus\u0026gt; allowedPreviousStatuses; OrderStatus(String code, String description, Set\u0026lt;OrderStatus\u0026gt; allowedPreviousStatuses) { this.code = code; this.description = description; this.allowedPreviousStatuses = allowedPreviousStatuses; } @Override public String getCode() { return code; } public String getDescription() { return description; } // æª¢æŸ¥ç‹€æ…‹è½‰æ›æ˜¯å¦åˆæ³• public boolean canTransitionFrom(OrderStatus currentStatus) { return allowedPreviousStatuses.contains(currentStatus); } // å–å¾—å¯è½‰æ›åˆ°çš„ç‹€æ…‹ public Set\u0026lt;OrderStatus\u0026gt; getNextPossibleStatuses() { return Arrays.stream(values()) .filter(status -\u0026gt; status.canTransitionFrom(this)) .collect(Collectors.toSet()); } // æª¢æŸ¥æ˜¯å¦ç‚ºçµ‚çµç‹€æ…‹ public boolean isFinalStatus() { return this == DELIVERED || this == CANCELLED || this == REFUNDED; } // æª¢æŸ¥æ˜¯å¦å¯å–æ¶ˆ public boolean isCancellable() { return CANCELLED.canTransitionFrom(this); } } 2. æ¥­å‹™é‚è¼¯æ•´åˆ åœ¨ Service å±¤ä¸­æ•´åˆç‹€æ…‹è½‰æ›é‚è¼¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 @Service @Transactional public class OrderService { @Autowired private OrderRepository orderRepository; @Autowired private OrderStatusHistoryService statusHistoryService; public void updateOrderStatus(Long orderId, OrderStatus newStatus, String reason) { Order order = orderRepository.findById(orderId) .orElseThrow(() -\u0026gt; new EntityNotFoundException(\u0026#34;è¨‚å–®ä¸å­˜åœ¨: \u0026#34; + orderId)); OrderStatus currentStatus = order.getStatus(); // é©—è­‰ç‹€æ…‹è½‰æ› if (!newStatus.canTransitionFrom(currentStatus)) { throw new IllegalStateException(String.format( \u0026#34;ç„¡æ³•å¾ %s è½‰æ›åˆ° %s\u0026#34;, currentStatus.getDescription(), newStatus.getDescription() )); } // æ›´æ–°ç‹€æ…‹ order.setStatus(newStatus); order.setLastModified(LocalDateTime.now()); // è¨˜éŒ„ç‹€æ…‹è®Šæ›´æ­·å² statusHistoryService.recordStatusChange(orderId, currentStatus, newStatus, reason); // è§¸ç™¼ç›¸é—œæ¥­å‹™é‚è¼¯ handleStatusChange(order, currentStatus, newStatus); orderRepository.save(order); } private void handleStatusChange(Order order, OrderStatus from, OrderStatus to) { switch (to) { case CONFIRMED: // ç™¼é€ç¢ºèªéƒµä»¶ emailService.sendOrderConfirmation(order); break; case SHIPPED: // ç™¼é€å‡ºè²¨é€šçŸ¥ emailService.sendShippingNotification(order); // æ¸›å°‘åº«å­˜ inventoryService.decreaseStock(order.getItems()); break; case DELIVERED: // ç™¼é€é€é”é€šçŸ¥ emailService.sendDeliveryNotification(order); break; case CANCELLED: // æ¢å¾©åº«å­˜ inventoryService.restoreStock(order.getItems()); // è™•ç†é€€æ¬¾ if (from == OrderStatus.PAID) { paymentService.processRefund(order); } break; } } // æ‰¹é‡ç‹€æ…‹æŸ¥è©¢ public List\u0026lt;Order\u0026gt; findOrdersByStatuses(Set\u0026lt;OrderStatus\u0026gt; statuses) { return orderRepository.findByStatusIn(statuses); } // å–å¾—å¯æ“ä½œçš„è¨‚å–® public List\u0026lt;Order\u0026gt; findOrdersReadyForShipping() { return orderRepository.findByStatus(OrderStatus.PAID); } } 3. ç‹€æ…‹æ­·å²è¿½è¹¤ å»ºç«‹ç‹€æ…‹è®Šæ›´æ­·å²è¡¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 @Entity @Table(name = \u0026#34;order_status_history\u0026#34;) public class OrderStatusHistory { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; @Column(name = \u0026#34;order_id\u0026#34;, nullable = false) private Long orderId; @Convert(converter = OrderStatusConverter.class) @Column(name = \u0026#34;from_status\u0026#34;, length = 3) private OrderStatus fromStatus; @Convert(converter = OrderStatusConverter.class) @Column(name = \u0026#34;to_status\u0026#34;, length = 3, nullable = false) private OrderStatus toStatus; @Column(name = \u0026#34;reason\u0026#34;, length = 500) private String reason; @Column(name = \u0026#34;changed_by\u0026#34;) private String changedBy; @Column(name = \u0026#34;changed_at\u0026#34;, nullable = false) private LocalDateTime changedAt; // å»ºæ§‹å­ã€Getterã€Setter... } 4. Repository æŸ¥è©¢æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Repository public interface OrderRepository extends JpaRepository\u0026lt;Order, Long\u0026gt; { // åŸºæœ¬ç‹€æ…‹æŸ¥è©¢ List\u0026lt;Order\u0026gt; findByStatus(OrderStatus status); List\u0026lt;Order\u0026gt; findByStatusIn(Collection\u0026lt;OrderStatus\u0026gt; statuses); List\u0026lt;Order\u0026gt; findByStatusNot(OrderStatus status); // è¤‡åˆæŸ¥è©¢ List\u0026lt;Order\u0026gt; findByStatusAndCreatedAtBetween( OrderStatus status, LocalDateTime start, LocalDateTime end ); // çµ±è¨ˆæŸ¥è©¢ @Query(\u0026#34;SELECT o.status, COUNT(o) FROM Order o GROUP BY o.status\u0026#34;) List\u0026lt;Object[]\u0026gt; countOrdersByStatus(); // è‡ªè¨‚æŸ¥è©¢ @Query(\u0026#34;SELECT o FROM Order o WHERE o.status IN :statuses AND o.totalAmount \u0026gt; :minAmount\u0026#34;) List\u0026lt;Order\u0026gt; findHighValueOrdersByStatuses( @Param(\u0026#34;statuses\u0026#34;) Collection\u0026lt;OrderStatus\u0026gt; statuses, @Param(\u0026#34;minAmount\u0026#34;) BigDecimal minAmount ); // åŸç”Ÿ SQL æŸ¥è©¢ @Query(value = \u0026#34;SELECT * FROM orders WHERE status IN :statusCodes AND DATE(created_at) = CURDATE()\u0026#34;, nativeQuery = true) List\u0026lt;Order\u0026gt; findTodayOrdersByStatusCodes(@Param(\u0026#34;statusCodes\u0026#34;) Collection\u0026lt;String\u0026gt; statusCodes); } æ•ˆèƒ½å„ªåŒ– 1. ç´¢å¼•è¨­è¨ˆ 1 2 3 4 5 6 7 8 9 -- ç‹€æ…‹æ¬„ä½ç´¢å¼• CREATE INDEX idx_orders_status ON orders(status); -- è¤‡åˆç´¢å¼• CREATE INDEX idx_orders_status_created ON orders(status, created_at); -- éƒ¨åˆ†ç´¢å¼•ï¼ˆé‡å°ç‰¹å®šç‹€æ…‹ï¼‰ CREATE INDEX idx_orders_active_status ON orders(status) WHERE status IN (\u0026#39;PND\u0026#39;, \u0026#39;CNF\u0026#39;, \u0026#39;PAD\u0026#39;, \u0026#39;SHP\u0026#39;); 2. æŸ¥è©¢å„ªåŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 @Service public class OrderQueryService { // ä½¿ç”¨ Specification é€²è¡Œå‹•æ…‹æŸ¥è©¢ public Page\u0026lt;Order\u0026gt; findOrdersWithCriteria(OrderSearchCriteria criteria, Pageable pageable) { return orderRepository.findAll(Specification .where(hasStatus(criteria.getStatuses())) .and(createdBetween(criteria.getStartDate(), criteria.getEndDate())) .and(hasCustomer(criteria.getCustomerId())), pageable); } private static Specification\u0026lt;Order\u0026gt; hasStatus(Set\u0026lt;OrderStatus\u0026gt; statuses) { return (root, query, cb) -\u0026gt; statuses == null || statuses.isEmpty() ? cb.conjunction() : root.get(\u0026#34;status\u0026#34;).in(statuses); } // å¿«å–å¸¸ç”¨çµ±è¨ˆ @Cacheable(\u0026#34;orderStatusStats\u0026#34;) public Map\u0026lt;OrderStatus, Long\u0026gt; getOrderStatusStatistics() { List\u0026lt;Object[]\u0026gt; results = orderRepository.countOrdersByStatus(); return results.stream() .collect(Collectors.toMap( row -\u0026gt; (OrderStatus) row[0], row -\u0026gt; (Long) row[1] )); } } 3. å¿«å–ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @Service public class OrderStatusCacheService { private final Cache\u0026lt;String, List\u0026lt;Order\u0026gt;\u0026gt; orderCache; public OrderStatusCacheService() { this.orderCache = Caffeine.newBuilder() .maximumSize(1000) .expireAfterWrite(Duration.ofMinutes(5)) .build(); } public List\u0026lt;Order\u0026gt; getCachedOrdersByStatus(OrderStatus status) { return orderCache.get(status.getCode(), code -\u0026gt; orderRepository.findByStatus(status)); } @EventListener public void handleOrderStatusChanged(OrderStatusChangedEvent event) { // æ¸…é™¤ç›¸é—œå¿«å– orderCache.invalidate(event.getOldStatus().getCode()); orderCache.invalidate(event.getNewStatus().getCode()); } } æ¸¬è©¦ç­–ç•¥ 1. å–®å…ƒæ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 @ExtendWith(MockitoExtension.class) class OrderServiceTest { @Mock private OrderRepository orderRepository; @Mock private OrderStatusHistoryService statusHistoryService; @InjectMocks private OrderService orderService; @Test void testValidStatusTransition() { // Given Order order = createOrderWithStatus(OrderStatus.PENDING); when(orderRepository.findById(1L)).thenReturn(Optional.of(order)); // When orderService.updateOrderStatus(1L, OrderStatus.CONFIRMED, \u0026#34;å®¢æˆ¶ç¢ºèª\u0026#34;); // Then assertEquals(OrderStatus.CONFIRMED, order.getStatus()); verify(statusHistoryService).recordStatusChange( eq(1L), eq(OrderStatus.PENDING), eq(OrderStatus.CONFIRMED), eq(\u0026#34;å®¢æˆ¶ç¢ºèª\u0026#34;)); } @Test void testInvalidStatusTransition() { // Given Order order = createOrderWithStatus(OrderStatus.DELIVERED); when(orderRepository.findById(1L)).thenReturn(Optional.of(order)); // When \u0026amp; Then assertThatThrownBy(() -\u0026gt; orderService.updateOrderStatus(1L, OrderStatus.PENDING, \u0026#34;ç„¡æ•ˆè½‰æ›\u0026#34;)) .isInstanceOf(IllegalStateException.class) .hasMessageContaining(\u0026#34;ç„¡æ³•å¾\u0026#34;); } @Test void testOrderStatusEnumProperties() { // æ¸¬è©¦ç‹€æ…‹è½‰æ›é‚è¼¯ assertTrue(OrderStatus.CONFIRMED.canTransitionFrom(OrderStatus.PENDING)); assertFalse(OrderStatus.PENDING.canTransitionFrom(OrderStatus.DELIVERED)); // æ¸¬è©¦çµ‚çµç‹€æ…‹ assertTrue(OrderStatus.DELIVERED.isFinalStatus()); assertFalse(OrderStatus.PENDING.isFinalStatus()); // æ¸¬è©¦å¯å–æ¶ˆç‹€æ…‹ assertTrue(OrderStatus.PENDING.isCancellable()); assertFalse(OrderStatus.DELIVERED.isCancellable()); } } 2. æ•´åˆæ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 @SpringBootTest @TestPropertySource(properties = \u0026#34;spring.jpa.hibernate.ddl-auto=create-drop\u0026#34;) class OrderStatusIntegrationTest { @Autowired private OrderService orderService; @Autowired private OrderRepository orderRepository; @Test @Transactional void testCompleteOrderWorkflow() { // å»ºç«‹è¨‚å–® Order order = createTestOrder(); order = orderRepository.save(order); // ç¢ºèªè¨‚å–® orderService.updateOrderStatus(order.getId(), OrderStatus.CONFIRMED, \u0026#34;è‡ªå‹•ç¢ºèª\u0026#34;); // ä»˜æ¬¾ orderService.updateOrderStatus(order.getId(), OrderStatus.PAID, \u0026#34;ä¿¡ç”¨å¡ä»˜æ¬¾\u0026#34;); // å‡ºè²¨ orderService.updateOrderStatus(order.getId(), OrderStatus.SHIPPED, \u0026#34;ç‰©æµå‡ºè²¨\u0026#34;); // é€é” orderService.updateOrderStatus(order.getId(), OrderStatus.DELIVERED, \u0026#34;å®¢æˆ¶ç°½æ”¶\u0026#34;); // é©—è­‰æœ€çµ‚ç‹€æ…‹ Order finalOrder = orderRepository.findById(order.getId()).orElseThrow(); assertEquals(OrderStatus.DELIVERED, finalOrder.getStatus()); } @Test void testDatabaseEnumPersistence() { // æ¸¬è©¦ Enum å€¼æ­£ç¢ºå„²å­˜å’Œè®€å– Order order = createTestOrder(); order.setStatus(OrderStatus.CONFIRMED); order = orderRepository.save(order); // æ¸…é™¤ JPA å¿«å– orderRepository.flush(); entityManager.clear(); // é‡æ–°è®€å– Order reloadedOrder = orderRepository.findById(order.getId()).orElseThrow(); assertEquals(OrderStatus.CONFIRMED, reloadedOrder.getStatus()); } } æœ€ä½³å¯¦è¸èˆ‡å»ºè­° 1. è¨­è¨ˆåŸå‰‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // âœ… å¥½çš„å¯¦è¸ï¼šä½¿ç”¨æœ‰æ„ç¾©çš„åç¨±å’Œæè¿° public enum UserRole implements CodedEnum { ADMIN(\u0026#34;ADM\u0026#34;, \u0026#34;ç³»çµ±ç®¡ç†å“¡\u0026#34;, Set.of(\u0026#34;*\u0026#34;)), MANAGER(\u0026#34;MGR\u0026#34;, \u0026#34;éƒ¨é–€ä¸»ç®¡\u0026#34;, Set.of(\u0026#34;USER_MANAGE\u0026#34;, \u0026#34;REPORT_VIEW\u0026#34;)), USER(\u0026#34;USR\u0026#34;, \u0026#34;ä¸€èˆ¬ä½¿ç”¨è€…\u0026#34;, Set.of(\u0026#34;PROFILE_EDIT\u0026#34;)); private final String code; private final String description; private final Set\u0026lt;String\u0026gt; permissions; // å»ºæ§‹å­å’Œæ–¹æ³•... } // âŒ é¿å…ï¼šéæ–¼ç°¡å–®æˆ–ä¸æ¸…æ¥šçš„åˆ—èˆ‰ public enum Status { A, B, C, D // ä¸æ¸…æ¥šçš„å«ç¾© } 2. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // æ”¯æ´å‘å¾Œç›¸å®¹çš„ Enum è¨­è¨ˆ public enum OrderStatus implements CodedEnum { // æ–°ç‰ˆæœ¬å¯ä»¥å®‰å…¨æ·»åŠ æ–°ç‹€æ…‹ PENDING(\u0026#34;PND\u0026#34;, \u0026#34;å¾…è™•ç†\u0026#34;), CONFIRMED(\u0026#34;CNF\u0026#34;, \u0026#34;å·²ç¢ºèª\u0026#34;), SHIPPED(\u0026#34;SHP\u0026#34;, \u0026#34;å·²å‡ºè²¨\u0026#34;), DELIVERED(\u0026#34;DLV\u0026#34;, \u0026#34;å·²é€é”\u0026#34;), CANCELLED(\u0026#34;CXL\u0026#34;, \u0026#34;å·²å–æ¶ˆ\u0026#34;), // æ–°å¢ç‹€æ…‹ï¼ˆå‘å¾Œç›¸å®¹ï¼‰ PARTIAL_SHIPPED(\u0026#34;PSH\u0026#34;, \u0026#34;éƒ¨åˆ†å‡ºè²¨\u0026#34;), // v2.0 æ–°å¢ RETURNED(\u0026#34;RET\u0026#34;, \u0026#34;å·²é€€è²¨\u0026#34;); // v2.1 æ–°å¢ // è™•ç†æœªçŸ¥ç‹€æ…‹çš„å®‰å…¨æ©Ÿåˆ¶ public static OrderStatus fromCodeSafely(String code, OrderStatus defaultValue) { try { return fromCode(code); } catch (IllegalArgumentException e) { logger.warn(\u0026#34;é‡åˆ°æœªçŸ¥çš„è¨‚å–®ç‹€æ…‹ä»£ç¢¼: {}, ä½¿ç”¨é è¨­å€¼: {}\u0026#34;, code, defaultValue); return defaultValue; } } } 3. åœ‹éš›åŒ–æ”¯æ´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @Component public class OrderStatusI18nService { @Autowired private MessageSource messageSource; public String getLocalizedDescription(OrderStatus status, Locale locale) { String key = \u0026#34;order.status.\u0026#34; + status.name().toLowerCase(); return messageSource.getMessage(key, null, status.getDescription(), locale); } public Map\u0026lt;OrderStatus, String\u0026gt; getAllLocalizedStatuses(Locale locale) { return Arrays.stream(OrderStatus.values()) .collect(Collectors.toMap( status -\u0026gt; status, status -\u0026gt; getLocalizedDescription(status, locale) )); } } ç›£æ§èˆ‡ç¶­è­· 1. ç‹€æ…‹åˆ†ä½ˆç›£æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @Component public class OrderStatusMetrics { private final MeterRegistry meterRegistry; private final OrderRepository orderRepository; public OrderStatusMetrics(MeterRegistry meterRegistry, OrderRepository orderRepository) { this.meterRegistry = meterRegistry; this.orderRepository = orderRepository; // è¨»å†Šåº¦é‡ Gauge.builder(\u0026#34;orders.by.status\u0026#34;) .description(\u0026#34;è¨‚å–®ç‹€æ…‹åˆ†ä½ˆ\u0026#34;) .tag(\u0026#34;status\u0026#34;, \u0026#34;all\u0026#34;) .register(meterRegistry, this, OrderStatusMetrics::getTotalOrderCount); } @EventListener public void handleOrderStatusChanged(OrderStatusChangedEvent event) { // è¨˜éŒ„ç‹€æ…‹è½‰æ›æ¬¡æ•¸ Counter.builder(\u0026#34;order.status.transitions\u0026#34;) .description(\u0026#34;è¨‚å–®ç‹€æ…‹è½‰æ›æ¬¡æ•¸\u0026#34;) .tag(\u0026#34;from\u0026#34;, event.getOldStatus().getCode()) .tag(\u0026#34;to\u0026#34;, event.getNewStatus().getCode()) .register(meterRegistry) .increment(); } private double getTotalOrderCount() { return orderRepository.count(); } } 2. æ•ˆèƒ½ç›£æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Aspect @Component public class OrderStatusPerformanceAspect { @Around(\u0026#34;execution(* com.example.service.OrderService.updateOrderStatus(..))\u0026#34;) public Object measureStatusUpdate(ProceedingJoinPoint joinPoint) throws Throwable { Timer.Sample sample = Timer.start(meterRegistry); try { return joinPoint.proceed(); } finally { sample.stop(Timer.builder(\u0026#34;order.status.update.duration\u0026#34;) .description(\u0026#34;è¨‚å–®ç‹€æ…‹æ›´æ–°è€—æ™‚\u0026#34;) .register(meterRegistry)); } } } ç¸½çµ JPA ä¸­çš„ Enum è™•ç†æ˜¯ä¼æ¥­ç´šæ‡‰ç”¨ç¨‹å¼é–‹ç™¼çš„é‡è¦æŠ€èƒ½ã€‚é€éæœ¬æ–‡çš„æ·±å…¥æ¢è¨ï¼Œæˆ‘å€‘äº†è§£åˆ°ï¼š\næ ¸å¿ƒè¦é» é¸æ“‡é©ç•¶çš„æ˜ å°„ç­–ç•¥ï¼šç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ EnumType.STRING æˆ–è‡ªè¨‚è½‰æ›å™¨ è¨­è¨ˆå¯æ“´å±•çš„ Enumï¼šè€ƒæ…®æœªä¾†éœ€æ±‚ï¼Œæ”¯æ´ç‹€æ…‹è½‰æ›é‚è¼¯ æ•ˆèƒ½å„ªåŒ–ï¼šåˆç†ä½¿ç”¨ç´¢å¼•ã€å¿«å–å’ŒæŸ¥è©¢å„ªåŒ– æ¸¬è©¦å®Œæ•´æ€§ï¼šæ¶µè“‹ç‹€æ…‹è½‰æ›é‚è¼¯å’ŒæŒä¹…åŒ–æ¸¬è©¦ ç›£æ§ç¶­è­·ï¼šå»ºç«‹é©ç•¶çš„ç›£æ§æ©Ÿåˆ¶ å¯¦éš›æ‡‰ç”¨å»ºè­° å°æ–¼ç°¡å–®ç‹€æ…‹ï¼Œä½¿ç”¨åŸºæœ¬çš„ @Enumerated(EnumType.STRING) å°æ–¼è¤‡é›œæ¥­å‹™é‚è¼¯ï¼Œå¯¦ä½œ CodedEnum ä»‹é¢å’Œè‡ªè¨‚è½‰æ›å™¨ å»ºç«‹ç‹€æ…‹è½‰æ›è¦å‰‡å’Œæ­·å²è¿½è¹¤æ©Ÿåˆ¶ è€ƒæ…®åœ‹éš›åŒ–å’Œå‘å¾Œç›¸å®¹æ€§ å¯¦æ–½é©ç•¶çš„ç›£æ§å’Œæ•ˆèƒ½å„ªåŒ–ç­–ç•¥ æ­£ç¢ºè™•ç† Enum å‹åˆ¥ä¸åƒ…èƒ½æå‡ç¨‹å¼ç¢¼çš„å¯è®€æ€§å’Œç¶­è­·æ€§ï¼Œé‚„èƒ½ç¢ºä¿è³‡æ–™çš„ä¸€è‡´æ€§å’Œæ¥­å‹™é‚è¼¯çš„æ­£ç¢ºåŸ·è¡Œã€‚\nåƒè€ƒè³‡æ–™ JPA 2.2 Specification Hibernate ORM Documentation Spring Data JPA Reference Java Enum Best Practices Database Design Patterns ","permalink":"https://xinqilin.github.io/post/backend/ormenumtype/","tags":["Java","JPA","Hibernate","Enum","ORM","Database","Spring","MySQL"],"title":"JPA Enum å‹åˆ¥è™•ç†å®Œæ•´æŒ‡å—ï¼šæ˜ å°„ç­–ç•¥èˆ‡æœ€ä½³å¯¦è¸"},{"content":"æ¦‚è¿° xargsï¼ˆeXtended ARGumentsï¼‰æ˜¯ Unix/Linux ç³»çµ±ä¸­çš„å¼·å¤§å·¥å…·ï¼Œç”¨æ–¼å¾æ¨™æº–è¼¸å…¥è®€å–è³‡æ–™ä¸¦å°‡å…¶ä½œç‚ºåƒæ•¸å‚³éçµ¦å…¶ä»–å‘½ä»¤ã€‚å®ƒè§£æ±ºäº†å‘½ä»¤è¡Œåƒæ•¸é•·åº¦é™åˆ¶çš„å•é¡Œï¼Œä¸¦æä¾›äº†ä¸¦è¡Œè™•ç†èƒ½åŠ›ï¼Œæ˜¯ç®¡é“æ“ä½œå’Œæ‰¹æ¬¡è™•ç†çš„é‡è¦å·¥å…·ã€‚\næ ¸å¿ƒç‰¹å¾µ åƒæ•¸è½‰æ›ï¼šå°‡è¼¸å…¥æµè½‰æ›ç‚ºå‘½ä»¤åƒæ•¸ æ‰¹æ¬¡è™•ç†ï¼šæ”¯æ´åˆ†æ‰¹åŸ·è¡Œå¤§é‡æ“ä½œ ä¸¦è¡ŒåŸ·è¡Œï¼šå¯åŒæ™‚åŸ·è¡Œå¤šå€‹ç¨‹åºæå‡æ•ˆç‡ å®‰å…¨è™•ç†ï¼šæ­£ç¢ºè™•ç†åŒ…å«ç©ºæ ¼çš„æª”æ¡ˆåç¨± éˆæ´»æ§åˆ¶ï¼šè±å¯Œçš„é¸é …æ§åˆ¶åŸ·è¡Œè¡Œç‚º åŸºæœ¬èªæ³• 1 xargs [é¸é …] [å‘½ä»¤ [åˆå§‹åƒæ•¸]] å·¥ä½œåŸç† 1 2 3 4 5 # åŸºæœ¬æ¦‚å¿µ command1 | xargs command2 # ç­‰åŒæ–¼ command2 arg1 arg2 arg3 ... ç°¡å–®ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # é è¨­è¡Œç‚ºï¼ˆä½¿ç”¨ echoï¼‰ echo \u0026#34;a b c d\u0026#34; | xargs # è¼¸å‡º: a b c d # æŒ‡å®šå‘½ä»¤ echo \u0026#34;file1 file2 file3\u0026#34; | xargs ls -l # å¾æª”æ¡ˆè®€å– cat filelist.txt | xargs rm -f # èˆ‡ find çµ„åˆ find . -name \u0026#34;*.tmp\u0026#34; | xargs rm -f æ ¸å¿ƒé¸é …è©³è§£ åŸºæœ¬æ§åˆ¶é¸é … 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # -t (--verbose) - é¡¯ç¤ºåŸ·è¡Œçš„å‘½ä»¤ echo \u0026#34;a b c\u0026#34; | xargs -t rm # è¼¸å‡º: rm a b c # ç„¶å¾ŒåŸ·è¡Œ rm a b c # -p (--interactive) - äº¤äº’å¼ç¢ºèª echo \u0026#34;file1 file2\u0026#34; | xargs -p rm # è¼¸å‡º: rm file1 file2?... # ç­‰å¾…ä½¿ç”¨è€…è¼¸å…¥ y/n # -r (--no-run-if-empty) - ç©ºè¼¸å…¥æ™‚ä¸åŸ·è¡Œ echo \u0026#34;\u0026#34; | xargs -r echo \u0026#34;åŸ·è¡Œäº†\u0026#34; # ä¸æœƒåŸ·è¡Œ echo \u0026#34;\u0026#34; | xargs echo \u0026#34;åŸ·è¡Œäº†\u0026#34; # æœƒåŸ·è¡Œ # --help - é¡¯ç¤ºå¹«åŠ©è³‡è¨Š xargs --help åƒæ•¸åˆ†çµ„é¸é … 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # -n max-args - é™åˆ¶æ¯æ¬¡åŸ·è¡Œçš„åƒæ•¸æ•¸é‡ echo \u0026#34;1 2 3 4 5 6\u0026#34; | xargs -n 2 echo # è¼¸å‡º: # 1 2 # 3 4 # 5 6 # -L max-lines - é™åˆ¶æ¯æ¬¡è™•ç†çš„è¡Œæ•¸ printf \u0026#34;a\\nb\\nc\\nd\\n\u0026#34; | xargs -L 2 echo # è¼¸å‡º: # a b # c d # -s max-chars - é™åˆ¶å‘½ä»¤è¡Œé•·åº¦ echo \u0026#34;very long arguments here\u0026#34; | xargs -s 20 echo åˆ†éš”ç¬¦è™•ç† 1 2 3 4 5 6 7 8 9 # -d delimiter - è‡ªè¨‚åˆ†éš”ç¬¦ echo \u0026#34;a,b,c,d\u0026#34; | xargs -d, echo # è¼¸å‡º: a b c d # -0 (--null) - ä½¿ç”¨ null å­—å…ƒä½œåˆ†éš”ç¬¦ find . -name \u0026#34;*.txt\u0026#34; -print0 | xargs -0 ls -l # è™•ç†åŒ…å«ç©ºæ ¼çš„æª”æ¡ˆå echo -e \u0026#34;file 1.txt\\nfile 2.txt\u0026#34; | xargs -d\u0026#39;\\n\u0026#39; ls -l æ›¿æ›å­—ä¸²é¸é … 1 2 3 4 5 6 7 8 # -I replace-str - æŒ‡å®šæ›¿æ›å­—ä¸² echo \u0026#34;file1 file2 file3\u0026#34; | xargs -I {} cp {} {}.backup # -i æˆ– -I{} - ä½¿ç”¨ {} ä½œç‚ºæ›¿æ›å­—ä¸² ls *.txt | xargs -I{} cp {} backup/{} # è¤‡é›œæ›¿æ›ç¯„ä¾‹ find . -name \u0026#34;*.log\u0026#34; | xargs -I{} sh -c \u0026#39;echo \u0026#34;Processing: {}\u0026#34;; gzip {}\u0026#39; ä¸¦è¡Œè™•ç†é¸é … 1 2 3 4 5 6 7 8 9 # -P max-procs - ä¸¦è¡ŒåŸ·è¡Œ echo \u0026#34;1 2 3 4 5\u0026#34; | xargs -n 1 -P 3 sleep # åŒæ™‚åŸ·è¡Œæœ€å¤š 3 å€‹ sleep å‘½ä»¤ # -P 0 - ç„¡é™åˆ¶ä¸¦è¡Œ seq 1 10 | xargs -n 1 -P 0 echo # å¯¦éš›ä¸¦è¡Œç¯„ä¾‹ find . -name \u0026#34;*.jpg\u0026#34; | xargs -n 1 -P 4 -I{} convert {} {}.thumb.jpg å¯¦æˆ°æ‡‰ç”¨å ´æ™¯ 1. æª”æ¡ˆç®¡ç†æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # æ‰¹æ¬¡åˆªé™¤æª”æ¡ˆ find /tmp -name \u0026#34;*.tmp\u0026#34; -mtime +7 | xargs rm -f # æ‰¹æ¬¡è¤‡è£½æª”æ¡ˆ ls *.txt | xargs -I{} cp {} backup/ # æ‰¹æ¬¡ç§»å‹•æª”æ¡ˆ find . -name \u0026#34;*.old\u0026#34; | xargs -I{} mv {} archive/ # æ‰¹æ¬¡é‡å‘½å ls *.jpeg | xargs -I{} sh -c \u0026#39;mv \u0026#34;$1\u0026#34; \u0026#34;${1%.jpeg}.jpg\u0026#34;\u0026#39; _ {} # å»ºç«‹å¤šå€‹ç›®éŒ„ echo \u0026#34;dir1 dir2 dir3\u0026#34; | xargs mkdir -p # ä¿®æ”¹æª”æ¡ˆæ¬Šé™ find /var/www -name \u0026#34;*.php\u0026#34; | xargs chmod 644 find /var/www -type d | xargs chmod 755 # æ‰¹æ¬¡å£“ç¸®æª”æ¡ˆ find . -name \u0026#34;*.log\u0026#34; -size +100M | xargs -I{} gzip {} 2. æ–‡æœ¬è™•ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ‰¹æ¬¡æœå°‹æ–‡æœ¬ find . -name \u0026#34;*.txt\u0026#34; | xargs grep -l \u0026#34;pattern\u0026#34; # æ‰¹æ¬¡æ›¿æ›æ–‡æœ¬ find . -name \u0026#34;*.conf\u0026#34; | xargs sed -i \u0026#39;s/old/new/g\u0026#39; # çµ±è¨ˆè¡Œæ•¸ find . -name \u0026#34;*.py\u0026#34; | xargs wc -l # æ‰¹æ¬¡ç·¨ç¢¼è½‰æ› find . -name \u0026#34;*.txt\u0026#34; | xargs -I{} iconv -f gbk -t utf8 {} -o {}.utf8 # æ‰¹æ¬¡æ ¼å¼åŒ–ç¨‹å¼ç¢¼ find . -name \u0026#34;*.js\u0026#34; | xargs prettier --write # æ‰¹æ¬¡æª¢æŸ¥èªæ³• find . -name \u0026#34;*.sh\u0026#34; | xargs -I{} bash -n {} 3. ç³»çµ±ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ‰¹æ¬¡æ®ºæ­»ç¨‹åº ps aux | grep \u0026#34;process_name\u0026#34; | awk \u0026#39;{print $2}\u0026#39; | xargs kill # æ‰¹æ¬¡æœå‹™é‡å•Ÿ echo \u0026#34;nginx apache2 mysql\u0026#34; | xargs -n 1 systemctl restart # æ‰¹æ¬¡å®‰è£è»Ÿé«”åŒ… cat package_list.txt | xargs apt-get install -y # ç£ç¢Ÿä½¿ç”¨çµ±è¨ˆ find /var/log -name \u0026#34;*.log\u0026#34; | xargs du -sh # æ‰¹æ¬¡ä¸‹è¼‰æª”æ¡ˆ cat urls.txt | xargs -n 1 -P 5 wget # æ‰¹æ¬¡å‚™ä»½ echo \u0026#34;/etc /var/log /home\u0026#34; | xargs -I{} tar -czf {//}.tar.gz {} 4. é–‹ç™¼èˆ‡éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ‰¹æ¬¡ç·¨è­¯ find . -name \u0026#34;*.c\u0026#34; | xargs gcc -o output # æ‰¹æ¬¡æ¸¬è©¦ find . -name \u0026#34;*_test.py\u0026#34; | xargs -I{} python {} # æ‰¹æ¬¡éƒ¨ç½² cat server_list.txt | xargs -I{} scp deploy.sh user@{}:/tmp/ # æ‰¹æ¬¡åŸ·è¡Œé ç¨‹å‘½ä»¤ cat servers.txt | xargs -I{} ssh {} \u0026#34;uptime\u0026#34; # æ‰¹æ¬¡ Git æ“ä½œ find . -name \u0026#34;.git\u0026#34; -type d | xargs -I{} sh -c \u0026#39;cd {} \u0026amp;\u0026amp; git pull\u0026#39; # æ‰¹æ¬¡å»ºæ§‹ Docker æ˜ åƒ ls */Dockerfile | xargs -I{} sh -c \u0026#39;cd $(dirname {}) \u0026amp;\u0026amp; docker build -t $(basename $(pwd)) .\u0026#39; 5. ç›£æ§èˆ‡æ—¥èªŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‰¹æ¬¡ç›£æ§æª”æ¡ˆè®ŠåŒ– find /var/log -name \u0026#34;*.log\u0026#34; | xargs -I{} tail -f {} # æ‰¹æ¬¡æ—¥èªŒåˆ†æ find . -name \u0026#34;access.log*\u0026#34; | xargs zcat | grep \u0026#34;ERROR\u0026#34; # æ‰¹æ¬¡æ¸…ç†æ—¥èªŒ find /var/log -name \u0026#34;*.log\u0026#34; -size +100M | xargs truncate -s 0 # ç³»çµ±è³‡è¨Šæ”¶é›† echo \u0026#34;/proc/cpuinfo /proc/meminfo /proc/loadavg\u0026#34; | xargs -I{} sh -c \u0026#39;echo \u0026#34;=== {} ===\u0026#34;; cat {}\u0026#39; # æ‰¹æ¬¡æª¢æŸ¥æœå‹™ç‹€æ…‹ echo \u0026#34;nginx mysql redis\u0026#34; | xargs -I{} systemctl status {} é€²éšæŠ€å·§ 1. è¤‡é›œå‘½ä»¤çµ„åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¤šå‘½ä»¤åŸ·è¡Œ find . -name \u0026#34;*.log\u0026#34; | xargs -I{} sh -c \u0026#39;echo \u0026#34;Processing {}\u0026#34;; wc -l {}; echo \u0026#34;Done\u0026#34;\u0026#39; # æ¢ä»¶åŸ·è¡Œ find . -name \u0026#34;*.txt\u0026#34; | xargs -I{} sh -c \u0026#39;if [ -s \u0026#34;{}\u0026#34; ]; then echo \u0026#34;Non-empty: {}\u0026#34;; fi\u0026#39; # éŒ¯èª¤è™•ç† find . -name \u0026#34;*.sh\u0026#34; | xargs -I{} sh -c \u0026#39;bash -n \u0026#34;{}\u0026#34; || echo \u0026#34;Syntax error in {}\u0026#34;\u0026#39; # çµæœæ”¶é›† find . -name \u0026#34;*.py\u0026#34; | xargs -I{} sh -c \u0026#39;echo \u0026#34;{}: $(wc -l \u0026lt; \u0026#34;{}\u0026#34;)\u0026#34;\u0026#39; | sort -k2 -nr # ç®¡é“çµ„åˆ find . -name \u0026#34;*.log\u0026#34; | xargs -I{} sh -c \u0026#39;cat \u0026#34;{}\u0026#34; | grep ERROR | wc -l\u0026#39; | awk \u0026#39;{sum+=$1} END {print sum}\u0026#39; 2. ä¸¦è¡Œè™•ç†æœ€ä½³åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # CPU å¯†é›†å‹ä»»å‹™ seq 1 100 | xargs -n 1 -P $(nproc) sh -c \u0026#39;echo \u0026#34;Processing $1\u0026#34;; sleep 1; echo \u0026#34;Done $1\u0026#34;\u0026#39; _ # I/O å¯†é›†å‹ä»»å‹™ cat urls.txt | xargs -n 1 -P 10 -I{} sh -c \u0026#39;echo \u0026#34;Downloading {}\u0026#34;; wget -q {}\u0026#39; # è¨˜æ†¶é«”ç®¡ç† find . -name \u0026#34;*.big\u0026#34; | xargs -n 1 -P 2 -I{} process_large_file {} # ä¸¦è¡Œæ—¥èªŒè™•ç† find /var/log -name \u0026#34;*.log\u0026#34; | xargs -n 1 -P 4 -I{} sh -c \u0026#39;gzip \u0026#34;{}\u0026#34; \u0026amp;\u0026amp; echo \u0026#34;Compressed {}\u0026#34;\u0026#39; # è² è¼‰å‡è¡¡ seq 1 1000 | xargs -n 10 -P 8 -I{} process_batch {} 3. å®‰å…¨æ€§è€ƒæ…® 1 2 3 4 5 6 7 8 9 10 11 # è™•ç†ç‰¹æ®Šå­—å…ƒ find . -name \u0026#34;*.txt\u0026#34; -print0 | xargs -0 ls -l # é¿å…å‘½ä»¤æ³¨å…¥ echo \u0026#34;file; rm -rf /\u0026#34; | xargs -I{} sh -c \u0026#39;ls \u0026#34;$1\u0026#34;\u0026#39; _ {} # åƒæ•¸é©—è­‰ cat files.txt | xargs -I{} sh -c \u0026#39;if [ -f \u0026#34;$1\u0026#34; ]; then process \u0026#34;$1\u0026#34;; fi\u0026#39; _ {} # è·¯å¾‘å®‰å…¨ find . -name \u0026#34;*.conf\u0026#34; | xargs -I{} sh -c \u0026#39;realpath \u0026#34;$1\u0026#34; | grep \u0026#34;^/safe/path\u0026#34; \u0026amp;\u0026amp; process \u0026#34;$1\u0026#34;\u0026#39; _ {} 4. æ•ˆèƒ½å„ªåŒ– 1 2 3 4 5 6 7 8 9 10 11 # æ‰¹æ¬¡å¤§å°å„ªåŒ– find . -name \u0026#34;*.txt\u0026#34; | xargs -n 100 process_files # è¨˜æ†¶é«”é™åˆ¶ find . -name \u0026#34;*.log\u0026#34; | xargs -s 4096 process_with_memory_limit # ä¸¦è¡Œæ•¸èª¿æ•´ find . -name \u0026#34;*.jpg\u0026#34; | xargs -n 1 -P $(nproc) optimize_image # ç·©è¡å€å„ªåŒ– find . -name \u0026#34;*.data\u0026#34; | xargs -n 50 -P 4 process_data_batch éŒ¯èª¤è™•ç†èˆ‡é™¤éŒ¯ 1. å¸¸è¦‹å•é¡Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å•é¡Œï¼šåƒæ•¸éé•· # è§£æ±ºï¼šä½¿ç”¨ -s é™åˆ¶æˆ–åˆ†æ‰¹è™•ç† find . -name \u0026#34;*.txt\u0026#34; | xargs -s 1000 rm # å•é¡Œï¼šæª”æ¡ˆååŒ…å«ç©ºæ ¼ # è§£æ±ºï¼šä½¿ç”¨ -0 å’Œ -print0 find . -name \u0026#34;*.txt\u0026#34; -print0 | xargs -0 rm # å•é¡Œï¼šç©ºè¼¸å…¥åŸ·è¡Œ # è§£æ±ºï¼šä½¿ç”¨ -r é¸é … echo \u0026#34;\u0026#34; | xargs -r echo \u0026#34;ä¸æœƒåŸ·è¡Œ\u0026#34; # å•é¡Œï¼šä¸¦è¡Œç«¶çˆ­ # è§£æ±ºï¼šä½¿ç”¨é©ç•¶çš„é–æ©Ÿåˆ¶ find . -name \u0026#34;*.log\u0026#34; | xargs -n 1 -P 4 -I{} flock /tmp/lock process {} 2. é™¤éŒ¯æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨ -t æŸ¥çœ‹åŸ·è¡Œå‘½ä»¤ find . -name \u0026#34;*.txt\u0026#34; | xargs -t rm # ä½¿ç”¨ -p äº¤äº’å¼ç¢ºèª find . -name \u0026#34;*.tmp\u0026#34; | xargs -p rm # é€æ­¥æ¸¬è©¦ echo \u0026#34;test1 test2\u0026#34; | xargs -n 1 echo # æª¢æŸ¥åƒæ•¸ find . -name \u0026#34;*.txt\u0026#34; | xargs -I{} echo \u0026#34;Will process: {}\u0026#34; # éŒ¯èª¤æ—¥èªŒ find . -name \u0026#34;*.sh\u0026#34; | xargs -I{} sh -c \u0026#39;bash -n \u0026#34;{}\u0026#34; 2\u0026gt;\u0026gt;error.log || echo \u0026#34;Error in {}\u0026#34;\u0026#39; 3. æ•ˆèƒ½ç›£æ§ 1 2 3 4 5 6 7 8 9 # åŸ·è¡Œæ™‚é–“æ¸¬é‡ time find . -name \u0026#34;*.txt\u0026#34; | xargs wc -l # ä¸¦è¡Œæ•ˆèƒ½æ¯”è¼ƒ time seq 1 100 | xargs -n 1 sleep 0.1 # ä¸²è¡Œ time seq 1 100 | xargs -n 1 -P 10 sleep 0.1 # ä¸¦è¡Œ # è³‡æºä½¿ç”¨ç›£æ§ find . -name \u0026#34;*.big\u0026#34; | xargs -n 1 -P 4 -I{} sh -c \u0026#39;echo \u0026#34;Processing {}\u0026#34;; /usr/bin/time -v process {}\u0026#39; èˆ‡å…¶ä»–å·¥å…·æ•´åˆ 1. èˆ‡ find çµ„åˆ 1 2 3 4 5 6 7 8 9 10 11 # åŸºæœ¬çµ„åˆ find /path -name \u0026#34;pattern\u0026#34; | xargs command # å®‰å…¨è™•ç† find /path -name \u0026#34;pattern\u0026#34; -print0 | xargs -0 command # æ¢ä»¶éæ¿¾ find /path -name \u0026#34;*.txt\u0026#34; -size +1M | xargs -I{} sh -c \u0026#39;echo \u0026#34;Large file: {}\u0026#34;\u0026#39; # è¤‡é›œæœå°‹ find /path -type f -mtime -7 \\( -name \u0026#34;*.log\u0026#34; -o -name \u0026#34;*.txt\u0026#34; \\) | xargs grep \u0026#34;pattern\u0026#34; 2. èˆ‡ grep çµ„åˆ 1 2 3 4 5 6 7 8 9 10 11 # æª”æ¡ˆå…§å®¹æœå°‹ find . -name \u0026#34;*.py\u0026#34; | xargs grep -l \u0026#34;import numpy\u0026#34; # å¤šæ¨¡å¼æœå°‹ find . -name \u0026#34;*.conf\u0026#34; | xargs grep -E \u0026#34;(error|warning|critical)\u0026#34; # çµ±è¨ˆåŒ¹é… find . -name \u0026#34;*.log\u0026#34; | xargs grep \u0026#34;ERROR\u0026#34; | wc -l # çµæœè™•ç† find . -name \u0026#34;*.txt\u0026#34; | xargs grep -H \u0026#34;pattern\u0026#34; | cut -d: -f1 | sort | uniq 3. èˆ‡ ssh çµ„åˆ 1 2 3 4 5 6 7 8 9 10 11 # é ç¨‹ä¸¦è¡ŒåŸ·è¡Œ cat servers.txt | xargs -n 1 -P 5 -I{} ssh {} \u0026#34;command\u0026#34; # æ‰¹æ¬¡æª”æ¡ˆå‚³è¼¸ cat servers.txt | xargs -I{} scp file.txt user@{}:/tmp/ # é ç¨‹ç›£æ§ cat servers.txt | xargs -I{} ssh {} \u0026#34;uptime; df -h\u0026#34; # åˆ†å¸ƒå¼è™•ç† cat servers.txt | xargs -n 1 -P 10 -I{} ssh {} \u0026#34;process_data input.txt\u0026#34; å¯¦ç”¨è…³æœ¬ç¯„ä¾‹ 1. æ‰¹æ¬¡æª”æ¡ˆè™•ç†è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/bin/bash # batch_process.sh - æ‰¹æ¬¡è™•ç†æª”æ¡ˆ SCRIPT_DIR=\u0026#34;$(cd \u0026#34;$(dirname \u0026#34;${BASH_SOURCE[0]}\u0026#34;)\u0026#34; \u0026amp;\u0026amp; pwd)\u0026#34; INPUT_DIR=\u0026#34;${1:-./input}\u0026#34; OUTPUT_DIR=\u0026#34;${2:-./output}\u0026#34; MAX_PARALLEL=\u0026#34;${3:-4}\u0026#34; # å»ºç«‹è¼¸å‡ºç›®éŒ„ mkdir -p \u0026#34;$OUTPUT_DIR\u0026#34; # æ‰¹æ¬¡è™•ç† find \u0026#34;$INPUT_DIR\u0026#34; -name \u0026#34;*.txt\u0026#34; -print0 | \\ xargs -0 -n 1 -P \u0026#34;$MAX_PARALLEL\u0026#34; -I{} \\ sh -c \u0026#39; input_file=\u0026#34;$1\u0026#34; output_file=\u0026#34;\u0026#39;\u0026#34;$OUTPUT_DIR\u0026#34;\u0026#39;/$(basename \u0026#34;$1\u0026#34; .txt).processed.txt\u0026#34; echo \u0026#34;Processing: $input_file\u0026#34; # è™•ç†é‚è¼¯ sed \u0026#34;s/old/new/g\u0026#34; \u0026#34;$input_file\u0026#34; \u0026gt; \u0026#34;$output_file\u0026#34; echo \u0026#34;Completed: $output_file\u0026#34; \u0026#39; _ {} echo \u0026#34;æ‰¹æ¬¡è™•ç†å®Œæˆ\u0026#34; 2. ç³»çµ±æ¸…ç†è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 #!/bin/bash # system_cleanup.sh - ç³»çµ±æ¸…ç†è…³æœ¬ LOG_FILE=\u0026#34;/var/log/cleanup.log\u0026#34; DRY_RUN=\u0026#34;${1:-false}\u0026#34; log() { echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; } cleanup_logs() { log \u0026#34;é–‹å§‹æ¸…ç†æ—¥èªŒæª”æ¡ˆ\u0026#34; if [ \u0026#34;$DRY_RUN\u0026#34; = \u0026#34;true\u0026#34; ]; then find /var/log -name \u0026#34;*.log\u0026#34; -size +100M | xargs -I{} echo \u0026#34;Will compress: {}\u0026#34; else find /var/log -name \u0026#34;*.log\u0026#34; -size +100M | \\ xargs -n 1 -P 4 -I{} sh -c \u0026#39;gzip \u0026#34;$1\u0026#34; \u0026amp;\u0026amp; echo \u0026#34;Compressed: $1\u0026#34;\u0026#39; _ {} | \\ tee -a \u0026#34;$LOG_FILE\u0026#34; fi } cleanup_temp() { log \u0026#34;é–‹å§‹æ¸…ç†è‡¨æ™‚æª”æ¡ˆ\u0026#34; if [ \u0026#34;$DRY_RUN\u0026#34; = \u0026#34;true\u0026#34; ]; then find /tmp -type f -mtime +7 | xargs -I{} echo \u0026#34;Will remove: {}\u0026#34; else find /tmp -type f -mtime +7 | \\ xargs -r rm -f fi } cleanup_cache() { log \u0026#34;é–‹å§‹æ¸…ç†å¿«å–æª”æ¡ˆ\u0026#34; if [ \u0026#34;$DRY_RUN\u0026#34; = \u0026#34;true\u0026#34; ]; then find /var/cache -name \u0026#34;*.cache\u0026#34; -mtime +30 | xargs -I{} echo \u0026#34;Will remove: {}\u0026#34; else find /var/cache -name \u0026#34;*.cache\u0026#34; -mtime +30 | \\ xargs -r rm -f fi } # ä¸»åŸ·è¡Œ log \u0026#34;é–‹å§‹ç³»çµ±æ¸…ç† (DRY_RUN: $DRY_RUN)\u0026#34; cleanup_logs cleanup_temp cleanup_cache log \u0026#34;ç³»çµ±æ¸…ç†å®Œæˆ\u0026#34; 3. ä¸¦è¡Œä¸‹è¼‰è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #!/bin/bash # parallel_download.sh - ä¸¦è¡Œä¸‹è¼‰è…³æœ¬ URL_FILE=\u0026#34;${1:-urls.txt}\u0026#34; DOWNLOAD_DIR=\u0026#34;${2:-./downloads}\u0026#34; MAX_PARALLEL=\u0026#34;${3:-5}\u0026#34; TIMEOUT=\u0026#34;${4:-30}\u0026#34; # æª¢æŸ¥è¼¸å…¥æª”æ¡ˆ if [ ! -f \u0026#34;$URL_FILE\u0026#34; ]; then echo \u0026#34;éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° URL æª”æ¡ˆ $URL_FILE\u0026#34; exit 1 fi # å»ºç«‹ä¸‹è¼‰ç›®éŒ„ mkdir -p \u0026#34;$DOWNLOAD_DIR\u0026#34; # ä¸¦è¡Œä¸‹è¼‰ cat \u0026#34;$URL_FILE\u0026#34; | \\ xargs -n 1 -P \u0026#34;$MAX_PARALLEL\u0026#34; -I{} \\ sh -c \u0026#39; url=\u0026#34;$1\u0026#34; dir=\u0026#34;$2\u0026#34; timeout=\u0026#34;$3\u0026#34; filename=$(basename \u0026#34;$url\u0026#34;) output_path=\u0026#34;$dir/$filename\u0026#34; echo \u0026#34;é–‹å§‹ä¸‹è¼‰: $url\u0026#34; if timeout \u0026#34;$timeout\u0026#34; wget -q -O \u0026#34;$output_path\u0026#34; \u0026#34;$url\u0026#34;; then echo \u0026#34;ä¸‹è¼‰æˆåŠŸ: $filename\u0026#34; else echo \u0026#34;ä¸‹è¼‰å¤±æ•—: $url\u0026#34; rm -f \u0026#34;$output_path\u0026#34; fi \u0026#39; _ {} \u0026#34;$DOWNLOAD_DIR\u0026#34; \u0026#34;$TIMEOUT\u0026#34; echo \u0026#34;ä¸‹è¼‰ä»»å‹™å®Œæˆ\u0026#34; # çµ±è¨ˆçµæœ total_files=$(wc -l \u0026lt; \u0026#34;$URL_FILE\u0026#34;) downloaded_files=$(find \u0026#34;$DOWNLOAD_DIR\u0026#34; -type f | wc -l) echo \u0026#34;ç¸½è¨ˆ: $total_files å€‹æª”æ¡ˆï¼ŒæˆåŠŸä¸‹è¼‰: $downloaded_files å€‹æª”æ¡ˆ\u0026#34; æ•ˆèƒ½æœ€ä½³åŒ– 1. ä¸¦è¡Œåº¦èª¿æ•´ 1 2 3 4 5 6 7 8 9 10 11 # CPU ç¶å®šä»»å‹™ CPU_CORES=$(nproc) find . -name \u0026#34;*.c\u0026#34; | xargs -n 1 -P \u0026#34;$CPU_CORES\u0026#34; gcc -c # I/O ç¶å®šä»»å‹™ IO_PARALLEL=$(($(nproc) * 2)) cat urls.txt | xargs -n 1 -P \u0026#34;$IO_PARALLEL\u0026#34; wget # æ··åˆè² è¼‰ MIXED_PARALLEL=$(($(nproc) + 2)) find . -name \u0026#34;*.log\u0026#34; | xargs -n 1 -P \u0026#34;$MIXED_PARALLEL\u0026#34; process_log 2. è¨˜æ†¶é«”ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 # é™åˆ¶æ‰¹æ¬¡å¤§å° find . -name \u0026#34;*.big\u0026#34; | xargs -n 1 process_large_file # é™åˆ¶å‘½ä»¤è¡Œé•·åº¦ find . -name \u0026#34;*.txt\u0026#34; | xargs -s 4096 process_files # åˆ†æ®µè™•ç† find . -name \u0026#34;*.data\u0026#34; | split -l 1000 - batch_ for batch in batch_*; do cat \u0026#34;$batch\u0026#34; | xargs -n 10 -P 4 process_data done 3. ç¶²è·¯å„ªåŒ– 1 2 3 4 5 6 7 8 # é€£æ¥æ±  cat servers.txt | xargs -n 1 -P 10 -I{} ssh -o ControlMaster=auto -o ControlPath=/tmp/ssh-%r@%h:%p {} \u0026#34;command\u0026#34; # é‡è©¦æ©Ÿåˆ¶ cat urls.txt | xargs -n 1 -I{} sh -c \u0026#39;for i in {1..3}; do wget \u0026#34;{}\u0026#34; \u0026amp;\u0026amp; break; sleep 5; done\u0026#39; # é »å¯¬é™åˆ¶ cat large_files.txt | xargs -n 1 -P 2 -I{} rsync --bwlimit=1000 {} destination/ ç¸½çµ æ ¸å¿ƒå„ªå‹¢ åƒæ•¸è™•ç†ï¼šè§£æ±ºå‘½ä»¤è¡Œåƒæ•¸é•·åº¦é™åˆ¶ æ‰¹æ¬¡æ“ä½œï¼šé«˜æ•ˆè™•ç†å¤§é‡æª”æ¡ˆå’Œè³‡æ–™ ä¸¦è¡ŒåŸ·è¡Œï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸å¿ƒç³»çµ±è³‡æº ç®¡é“å‹å¥½ï¼šèˆ‡å…¶ä»– Unix å·¥å…·å®Œç¾æ•´åˆ éˆæ´»æ§åˆ¶ï¼šè±å¯Œçš„é¸é …æ»¿è¶³å„ç¨®éœ€æ±‚ æœ€ä½³å¯¦è¸ å®‰å…¨ç¬¬ä¸€ï¼šè™•ç†åŒ…å«ç©ºæ ¼çš„æª”æ¡ˆåä½¿ç”¨ -0 å’Œ -print0 é©ç•¶ä¸¦è¡Œï¼šæ ¹æ“šä»»å‹™é¡å‹èª¿æ•´ä¸¦è¡Œåº¦ éŒ¯èª¤è™•ç†ï¼šä½¿ç”¨ -r é¿å…ç©ºè¼¸å…¥åŸ·è¡Œ æ¸¬è©¦å…ˆè¡Œï¼šä½¿ç”¨ -t å’Œ -p é¸é …æ¸¬è©¦å‘½ä»¤ æ•ˆèƒ½ç›£æ§ï¼šæ¸¬é‡ä¸¦å„ªåŒ–æ‰¹æ¬¡å¤§å°å’Œä¸¦è¡Œåº¦ å¸¸ç”¨æ¨¡å¼è¨˜æ†¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŸºæœ¬æ¨¡å¼ find . -name \u0026#34;pattern\u0026#34; | xargs command # å®‰å…¨æ¨¡å¼ find . -name \u0026#34;pattern\u0026#34; -print0 | xargs -0 command # ä¸¦è¡Œæ¨¡å¼ command | xargs -n 1 -P 4 process # æ›¿æ›æ¨¡å¼ echo \u0026#34;files\u0026#34; | xargs -I{} cp {} backup/{} # äº¤äº’æ¨¡å¼ find . -name \u0026#34;*.tmp\u0026#34; | xargs -p rm xargs æ˜¯å‘½ä»¤è¡Œæ‰¹æ¬¡è™•ç†å’Œä¸¦è¡ŒåŸ·è¡Œçš„ç‘å£«è»åˆ€ï¼ŒæŒæ¡å…¶æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨æŠ€å·§ï¼Œèƒ½å¤ å¤§å¹…æå‡ Linux ç³»çµ±ç®¡ç†å’Œè‡ªå‹•åŒ–ä»»å‹™çš„æ•ˆç‡ã€‚è¨˜ä½ï¼šåˆç†ä½¿ç”¨ä¸¦è¡Œè™•ç†èƒ½å¤ é¡¯è‘—æå‡æ•ˆèƒ½ï¼Œä½†è¦æ³¨æ„è³‡æºç®¡ç†å’ŒéŒ¯èª¤è™•ç†ã€‚\nåƒè€ƒè³‡æ–™ GNU Findutils Manual - xargs Linux man xargs Advanced Bash-Scripting Guide Unix Power Tools ","permalink":"https://xinqilin.github.io/post/tools/xargs/","tags":["Linux","Xargs","Command Line","Parallel Processing","Pipe","Shell","Unix"],"title":"Xargs å‘½ä»¤å®Œæ•´æŒ‡å—ï¼šLinux åƒæ•¸è™•ç†èˆ‡ä¸¦è¡ŒåŸ·è¡Œçš„å¼·å¤§å·¥å…·"},{"content":"æ¦‚è¿° find æ˜¯ Linux/Unix ç³»çµ±ä¸­æœ€å¼·å¤§ä¸”æœ€å¸¸ç”¨çš„æª”æ¡ˆæœå°‹å‘½ä»¤ä¹‹ä¸€ã€‚å®ƒä¸åƒ…èƒ½å¤ æ ¹æ“šå„ç¨®æ¢ä»¶æœå°‹æª”æ¡ˆå’Œç›®éŒ„ï¼Œé‚„èƒ½å°æœå°‹çµæœåŸ·è¡Œå„ç¨®æ“ä½œï¼Œæ˜¯ç³»çµ±ç®¡ç†å“¡å’Œé–‹ç™¼è€…å¿…å‚™çš„æ ¸å¿ƒå·¥å…·ã€‚\næ ¸å¿ƒç‰¹å¾µ éæ­¸æœå°‹ï¼šå¯æ·±å…¥å­ç›®éŒ„é€²è¡Œæœå°‹ å¤šé‡æ¢ä»¶ï¼šæ”¯æ´æª”åã€é¡å‹ã€å¤§å°ã€æ™‚é–“ç­‰å¤šç¨®æœå°‹æ¢ä»¶ å‹•ä½œåŸ·è¡Œï¼šå¯å°æœå°‹çµæœåŸ·è¡Œå„ç¨®æ“ä½œ é‚è¼¯çµ„åˆï¼šæ”¯æ´ ANDã€ORã€NOT ç­‰é‚è¼¯é‹ç®— é«˜æ•ˆèƒ½ï¼šé‡å°å¤§å‹æª”æ¡ˆç³»çµ±å„ªåŒ– åŸºæœ¬èªæ³• 1 find [æœå°‹è·¯å¾‘] [æœå°‹æ¢ä»¶] [å‹•ä½œ] åŸºæœ¬ä½¿ç”¨ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # åœ¨ç•¶å‰ç›®éŒ„æœå°‹æª”æ¡ˆ find . -name \u0026#34;test.txt\u0026#34; # åœ¨æŒ‡å®šç›®éŒ„æœå°‹ find /home/user -name \u0026#34;*.log\u0026#34; # å¿½ç•¥å¤§å°å¯«æœå°‹ find . -iname \u0026#34;README.md\u0026#34; # æœå°‹å¤šå€‹ç›®éŒ„ find /var/log /tmp -name \u0026#34;*.tmp\u0026#34; ä¾æ“šæª”æ¡ˆåç¨±æœå°‹ åŸºæœ¬æª”åæœå°‹ 1 2 3 4 5 6 7 8 9 10 11 # ç²¾ç¢ºæª”ååŒ¹é… find /home -name \u0026#34;config.conf\u0026#34; # è¬ç”¨å­—å…ƒæœå°‹ find . -name \u0026#34;*.txt\u0026#34; # æ‰€æœ‰ .txt æª”æ¡ˆ find . -name \u0026#34;test*\u0026#34; # ä»¥ test é–‹é ­çš„æª”æ¡ˆ find . -name \u0026#34;*backup*\u0026#34; # åŒ…å« backup çš„æª”æ¡ˆ # å¿½ç•¥å¤§å°å¯« find . -iname \u0026#34;*.PDF\u0026#34; # ä¸åˆ†å¤§å°å¯«æœå°‹ PDF æª”æ¡ˆ find . -iname \u0026#34;readme*\u0026#34; # ä¸åˆ†å¤§å°å¯«æœå°‹ readme é–‹é ­çš„æª”æ¡ˆ é€²éšæª”åæœå°‹ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨æ­£è¦è¡¨é”å¼ find . -regex \u0026#34;.*\\.\\(jpg\\|png\\|gif\\)$\u0026#34; # æœå°‹åœ–ç‰‡æª”æ¡ˆ find . -iregex \u0026#34;.*\\.\\(mp3\\|mp4\\|avi\\)$\u0026#34; # ä¸åˆ†å¤§å°å¯«æœå°‹åª’é«”æª”æ¡ˆ # æ’é™¤ç‰¹å®šæª”æ¡ˆ find . -name \u0026#34;*.txt\u0026#34; ! -name \u0026#34;temp*\u0026#34; # æœå°‹ txt ä½†æ’é™¤ temp é–‹é ­ find . ! -name \u0026#34;.*\u0026#34; # æ’é™¤éš±è—æª”æ¡ˆ # å¤šå€‹æ¢ä»¶çµ„åˆ find . \\( -name \u0026#34;*.log\u0026#34; -o -name \u0026#34;*.tmp\u0026#34; \\) # OR æ¢ä»¶ find . -name \u0026#34;*.txt\u0026#34; -a -size +1M # AND æ¢ä»¶ ä¾æ“šæª”æ¡ˆé¡å‹æœå°‹ åŸºæœ¬æª”æ¡ˆé¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æª”æ¡ˆé¡å‹åƒæ•¸èªªæ˜ # f: ä¸€èˆ¬æª”æ¡ˆ d: ç›®éŒ„ # l: ç¬¦è™Ÿé€£çµ p: å‘½åç®¡é“ (FIFO) # s: socket b: å€å¡Šè£ç½® # c: å­—å…ƒè£ç½® # æœå°‹ç›®éŒ„ find /var -type d -name \u0026#34;log*\u0026#34; # æœå°‹ä¸€èˆ¬æª”æ¡ˆ find . -type f -name \u0026#34;*.sh\u0026#34; # æœå°‹ç¬¦è™Ÿé€£çµ find /usr/bin -type l # æœå°‹ç©ºæª”æ¡ˆ find /tmp -type f -empty # æœå°‹ç©ºç›®éŒ„ find /home -type d -empty å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹ 1 2 3 4 5 6 7 8 # æ‰¾å‡ºæ‰€æœ‰ shell è…³æœ¬ find /usr/local/bin -type f -name \u0026#34;*.sh\u0026#34; -executable # æ‰¾å‡ºæ‰€æœ‰æå£çš„ç¬¦è™Ÿé€£çµ find /usr -type l ! -exec test -e {} \\; -print # æ‰¾å‡ºåŒ…å«ç‰¹å®šå‰¯æª”åçš„ç›®éŒ„ find . -type d -exec sh -c \u0026#39;ls \u0026#34;$1\u0026#34;/*.log \u0026gt;/dev/null 2\u0026gt;\u0026amp;1\u0026#39; _ {} \\; -print ä¾æ“šæª”æ¡ˆå¤§å°æœå°‹ åŸºæœ¬å¤§å°æœå°‹ 1 2 3 4 5 6 7 8 9 10 # å¤§å°å–®ä½èªªæ˜ # c: bytes k: KB (1024 bytes) # M: MB G: GB # +: å¤§æ–¼ -: å°æ–¼ ç²¾ç¢ºå€¼: ç­‰æ–¼ # åŸºæœ¬å¤§å°æœå°‹ find . -size 50M # ç­‰æ–¼ 50MB find . -size +100M # å¤§æ–¼ 100MB find . -size -1G # å°æ–¼ 1GB find /var/log -size +10M -size -100M # 10MB åˆ° 100MB ä¹‹é–“ é€²éšå¤§å°æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‰¾å‡ºæœ€å¤§çš„æª”æ¡ˆï¼ˆå‰ 10 å€‹ï¼‰ find /home -type f -exec ls -la {} \\; | sort -k5 -nr | head -10 # æ‰¾å‡ºè¶…é 1GB çš„æª”æ¡ˆä¸¦é¡¯ç¤ºå¤§å° find / -size +1G -type f -exec du -h {} \\; 2\u0026gt;/dev/null # æ‰¾å‡ºç©ºæª”æ¡ˆä¸¦åˆªé™¤ find /tmp -type f -empty -delete # æ‰¾å‡ºå¤§æª”æ¡ˆä¸¦è©¢å•æ˜¯å¦åˆªé™¤ find /var/log -size +100M -type f -ok rm {} \\; # æŒ‰å¤§å°ç¯„åœåˆ†é¡é¡¯ç¤º find . -type f -size +10M -size -100M -printf \u0026#34;%s %p\\n\u0026#34; | sort -nr ä¾æ“šæ™‚é–“æœå°‹ æ™‚é–“é¡å‹èªªæ˜ 1 2 3 4 5 6 7 8 9 10 # æ™‚é–“é¡å‹ # mtime: ä¿®æ”¹æ™‚é–“ (modify time) # atime: å­˜å–æ™‚é–“ (access time) # ctime: ç‹€æ…‹æ”¹è®Šæ™‚é–“ (change time) # æ™‚é–“å–®ä½ # é è¨­å–®ä½: å¤© (24å°æ™‚) # +n: nå¤©ä¹‹å‰ # -n: nå¤©ä¹‹å…§ # n: æ°å¥½nå¤©å‰ åŸºæœ¬æ™‚é–“æœå°‹ 1 2 3 4 5 6 7 8 9 10 11 12 # ä¿®æ”¹æ™‚é–“æœå°‹ find . -mtime 3 # æ°å¥½ 3 å¤©å‰ä¿®æ”¹ find . -mtime -7 # 7 å¤©å…§ä¿®æ”¹ find . -mtime +30 # 30 å¤©å‰ä¿®æ”¹ find . -mtime +7 -mtime -30 # 7-30 å¤©å‰ä¿®æ”¹ # å­˜å–æ™‚é–“æœå°‹ find /home -atime -1 # 1 å¤©å…§è¢«å­˜å– find /tmp -atime +7 # 7 å¤©ä»¥ä¸Šæœªè¢«å­˜å– # ç‹€æ…‹æ”¹è®Šæ™‚é–“ find . -ctime -1 # 1 å¤©å…§ç‹€æ…‹æ”¹è®Š ç²¾ç¢ºæ™‚é–“æœå°‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ†é˜ç‚ºå–®ä½çš„æ™‚é–“æœå°‹ find /var/log -mmin -60 # 60 åˆ†é˜å…§ä¿®æ”¹ find . -amin +120 # 120 åˆ†é˜å‰å­˜å– find /tmp -cmin -30 # 30 åˆ†é˜å…§ç‹€æ…‹æ”¹è®Š # æ¯”è¼ƒæª”æ¡ˆæ™‚é–“ find . -newer reference.txt # æ¯” reference.txt æ–°çš„æª”æ¡ˆ find . -cnewer backup.tar # ç‹€æ…‹æ¯” backup.tar æ–° # æŒ‡å®šæ—¥æœŸç¯„åœ find /var/log -newermt \u0026#34;2023-01-01\u0026#34; ! -newermt \u0026#34;2023-12-31\u0026#34; # ä»Šå¤©ä¿®æ”¹çš„æª”æ¡ˆ find . -daystart -mtime 0 # æ˜¨å¤©ä¿®æ”¹çš„æª”æ¡ˆ find . -daystart -mtime 1 ä¾æ“šæ¬Šé™æœå°‹ åŸºæœ¬æ¬Šé™æœå°‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ç²¾ç¢ºæ¬Šé™åŒ¹é… find /home -perm 755 # æ¬Šé™æ°å¥½æ˜¯ 755 find . -perm 644 # æ¬Šé™æ°å¥½æ˜¯ 644 # åŒ…å«æŒ‡å®šæ¬Šé™ find /usr/bin -perm -755 # è‡³å°‘æœ‰ 755 æ¬Šé™ find . -perm -u+x # æ“æœ‰è€…æœ‰åŸ·è¡Œæ¬Šé™ # ä»»ä¸€ç¬¦åˆæ¬Šé™ find /tmp -perm /222 # ä»»ä½•äººæœ‰å¯«å…¥æ¬Šé™ find . -perm /u+w,g+w,o+w # ä»»ä½•äººæœ‰å¯«å…¥æ¬Šé™ # å¯åŸ·è¡Œæª”æ¡ˆ find /usr/local/bin -type f -executable find . -type f -perm -u+x # æ“æœ‰è€…å¯åŸ·è¡Œ é€²éšæ¬Šé™æœå°‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ‰¾å‡º SUID æª”æ¡ˆ find /usr -perm -4000 -type f 2\u0026gt;/dev/null # æ‰¾å‡º SGID æª”æ¡ˆ find /usr -perm -2000 -type f 2\u0026gt;/dev/null # æ‰¾å‡º sticky bit ç›®éŒ„ find /tmp -perm -1000 -type d # æ‰¾å‡ºå¯å¯«çš„æª”æ¡ˆï¼ˆå®‰å…¨æª¢æŸ¥ï¼‰ find /etc -type f -writable 2\u0026gt;/dev/null # æ‰¾å‡ºç„¡æ¬Šé™è®€å–çš„æª”æ¡ˆ find /home -type f ! -readable 2\u0026gt;/dev/null ä¾æ“šæ“æœ‰è€…æœå°‹ åŸºæœ¬æ“æœ‰è€…æœå°‹ 1 2 3 4 5 6 7 8 9 10 11 12 # ä¾æ“šä½¿ç”¨è€…æœå°‹ find /home -user john # å±¬æ–¼ john çš„æª”æ¡ˆ find /var -user root # å±¬æ–¼ root çš„æª”æ¡ˆ find . -user $(whoami) # å±¬æ–¼ç•¶å‰ä½¿ç”¨è€…çš„æª”æ¡ˆ # ä¾æ“šç¾¤çµ„æœå°‹ find /home -group developers # å±¬æ–¼ developers ç¾¤çµ„ find /var/www -group www-data # å±¬æ–¼ www-data ç¾¤çµ„ # ä¾æ“š UID/GID æœå°‹ find /home -uid 1000 # UID ç‚º 1000 çš„æª”æ¡ˆ find /var -gid 100 # GID ç‚º 100 çš„æª”æ¡ˆ é€²éšæ“æœ‰è€…æœå°‹ 1 2 3 4 5 6 7 8 9 10 # æ‰¾å‡ºç„¡ä¸»æª”æ¡ˆï¼ˆå­¤å…’æª”æ¡ˆï¼‰ find /home -nouser # æ²’æœ‰å°æ‡‰ä½¿ç”¨è€…çš„æª”æ¡ˆ find /var -nogroup # æ²’æœ‰å°æ‡‰ç¾¤çµ„çš„æª”æ¡ˆ # çµ„åˆæ¢ä»¶æœå°‹ find /home -user john -group staff # å±¬æ–¼ john ä¸”ç¾¤çµ„æ˜¯ staff find /tmp -user root ! -group root # å±¬æ–¼ root ä½†ç¾¤çµ„ä¸æ˜¯ root # æ‰¾å‡ºç‰¹å®šä½¿ç”¨è€…çš„å¤§æª”æ¡ˆ find /home -user john -size +100M -type f åŸ·è¡Œå‹•ä½œ (-exec å’Œ -ok) åŸºæœ¬ -exec ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åŸºæœ¬èªæ³•ï¼š-exec command {} \\; # {} ä»£è¡¨æ‰¾åˆ°çš„æª”æ¡ˆ # \\; è¡¨ç¤ºå‘½ä»¤çµæŸ # åˆªé™¤æ‰¾åˆ°çš„æª”æ¡ˆ find /tmp -name \u0026#34;*.tmp\u0026#34; -exec rm {} \\; # è¤‡è£½æª”æ¡ˆ find . -name \u0026#34;*.txt\u0026#34; -exec cp {} backup/ \\; # ç§»å‹•æª”æ¡ˆ find . -name \u0026#34;*.log\u0026#34; -exec mv {} /var/log/ \\; # ä¿®æ”¹æ¬Šé™ find /var/www -type f -exec chmod 644 {} \\; find /var/www -type d -exec chmod 755 {} \\; é€²éš -exec ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨ -exec {} + æé«˜æ•ˆèƒ½ï¼ˆæ‰¹æ¬¡è™•ç†ï¼‰ find . -name \u0026#34;*.txt\u0026#34; -exec grep \u0026#34;pattern\u0026#34; {} + find /tmp -name \u0026#34;*.tmp\u0026#34; -exec rm {} + # åŸ·è¡Œè¤‡é›œå‘½ä»¤ find . -type f -name \u0026#34;*.sh\u0026#34; -exec sh -c \u0026#39;echo \u0026#34;Processing: $1\u0026#34;; chmod +x \u0026#34;$1\u0026#34;\u0026#39; _ {} \\; # åœ¨æ‰¾åˆ°çš„ç›®éŒ„ä¸­åŸ·è¡Œå‘½ä»¤ find /var/log -type d -exec sh -c \u0026#39;echo \u0026#34;Directory: $1\u0026#34;; ls -la \u0026#34;$1\u0026#34;\u0026#39; _ {} \\; # æ¢ä»¶åŸ·è¡Œ find . -name \u0026#34;*.txt\u0026#34; -exec test -s {} \\; -exec echo \u0026#34;Non-empty: {}\u0026#34; \\; äº’å‹•å¼ -ok ç”¨æ³• 1 2 3 4 5 6 7 8 # -ok æœƒåœ¨åŸ·è¡Œå‰è©¢å•ç¢ºèª find /tmp -name \u0026#34;*.old\u0026#34; -ok rm {} \\; # äº’å‹•å¼ç§»å‹•æª”æ¡ˆ find . -name \u0026#34;*.bak\u0026#34; -ok mv {} backup/ \\; # äº’å‹•å¼æ¬Šé™ä¿®æ”¹ find /home -name \u0026#34;*.sh\u0026#34; -ok chmod +x {} \\; é‚è¼¯é‹ç®—ç¬¦ åŸºæœ¬é‚è¼¯é‹ç®— 1 2 3 4 5 6 7 8 9 10 11 # AND é‹ç®—ï¼ˆé è¨­ï¼‰ find . -name \u0026#34;*.txt\u0026#34; -size +1M # åç¨±æ˜¯ *.txt ä¸”å¤§å° \u0026gt; 1M find . -type f -user john # æ˜¯æª”æ¡ˆä¸”å±¬æ–¼ john # OR é‹ç®— find . \\( -name \u0026#34;*.txt\u0026#34; -o -name \u0026#34;*.md\u0026#34; \\) # txt æˆ– md æª”æ¡ˆ find . -type f \\( -name \u0026#34;*.log\u0026#34; -o -name \u0026#34;*.tmp\u0026#34; \\) # NOT é‹ç®— find . -type f ! -name \u0026#34;*.txt\u0026#34; # ä¸æ˜¯ txt çš„æª”æ¡ˆ find . ! -path \u0026#34;*/.*\u0026#34; # æ’é™¤éš±è—ç›®éŒ„ è¤‡é›œé‚è¼¯çµ„åˆ 1 2 3 4 5 6 7 8 # è¤‡é›œæ¢ä»¶çµ„åˆ find . \\( -name \u0026#34;*.txt\u0026#34; -o -name \u0026#34;*.md\u0026#34; \\) -a -size +1k -a ! -path \u0026#34;*/tmp/*\u0026#34; # å¤šé‡æ’é™¤æ¢ä»¶ find /var/log \\( ! -name \u0026#34;*.gz\u0026#34; ! -name \u0026#34;*.old\u0026#34; \\) -type f -mtime -7 # å·¢ç‹€é‚è¼¯æ¢ä»¶ find . \\( \\( -name \u0026#34;*.c\u0026#34; -o -name \u0026#34;*.h\u0026#34; \\) -a -mtime -7 \\) -o \\( -name \u0026#34;*.py\u0026#34; -a -size +10k \\) è¼¸å‡ºæ ¼å¼åŒ– ä½¿ç”¨ -printf æ ¼å¼åŒ–è¼¸å‡º 1 2 3 4 5 6 7 8 9 10 11 # åŸºæœ¬æ ¼å¼åŒ– find . -type f -printf \u0026#34;%f\\n\u0026#34; # åªé¡¯ç¤ºæª”å find . -type f -printf \u0026#34;%p\\t%s\\n\u0026#34; # è·¯å¾‘å’Œå¤§å° find . -type f -printf \u0026#34;%M %u %g %s %p\\n\u0026#34; # æ¬Šé™ã€æ“æœ‰è€…ã€ç¾¤çµ„ã€å¤§å°ã€è·¯å¾‘ # æ™‚é–“æ ¼å¼åŒ– find . -type f -printf \u0026#34;%TY-%Tm-%Td %TH:%TM %p\\n\u0026#34; # ä¿®æ”¹æ™‚é–“å’Œè·¯å¾‘ find . -type f -printf \u0026#34;%Ac %p\\n\u0026#34; # å­˜å–æ™‚é–“ # å¤§å°æ ¼å¼åŒ– find . -type f -printf \u0026#34;%10s %p\\n\u0026#34; | sort -nr # æŒ‰å¤§å°æ’åº æ ¼å¼åŒ–åƒæ•¸èªªæ˜ 1 2 3 4 5 6 7 8 9 10 # å¸¸ç”¨æ ¼å¼åŒ–åƒæ•¸ # %p: æª”æ¡ˆè·¯å¾‘ # %f: æª”æ¡ˆåç¨± # %s: æª”æ¡ˆå¤§å°ï¼ˆbytesï¼‰ # %M: æª”æ¡ˆæ¬Šé™ # %u: æ“æœ‰è€…åç¨± # %g: ç¾¤çµ„åç¨± # %T: æ™‚é–“ç›¸é—œï¼ˆéœ€é…åˆæ™‚é–“æ ¼å¼ï¼‰ # %h: ç›®éŒ„è·¯å¾‘ # %d: æª”æ¡ˆæ·±åº¦ å¯¦æˆ°æ‡‰ç”¨å ´æ™¯ ç³»çµ±æ¸…ç†èˆ‡ç¶­è­· 1 2 3 4 5 6 7 8 9 # æ¸…ç†è‡¨æ™‚æª”æ¡ˆ find /tmp -type f -atime +7 -delete # åˆªé™¤ 7 å¤©æœªå­˜å–çš„æª”æ¡ˆ find /var/log -name \u0026#34;*.log\u0026#34; -size +100M -delete # åˆªé™¤å¤§æ—¥èªŒæª”æ¡ˆ # æ¸…ç†å¿«å–æª”æ¡ˆ find ~/.cache -type f -atime +30 -delete # æ¸…ç†èˆŠå¿«å– # å‚™ä»½å‰æ¸…ç† find /backup -name \u0026#34;*.tar.gz\u0026#34; -mtime +30 -delete # åˆªé™¤ 30 å¤©å‰çš„å‚™ä»½ æª”æ¡ˆæ•´ç†èˆ‡æ­¸æª” 1 2 3 4 5 6 7 8 # æŒ‰æ—¥æœŸæ­¸æª”æª”æ¡ˆ find /data -type f -name \u0026#34;*.log\u0026#34; -mtime +1 -exec gzip {} \\; # æŒ‰å¤§å°åˆ†é¡æª”æ¡ˆ find /home -type f -size +1G -exec ls -lh {} \\; # ç§»å‹•èˆŠæª”æ¡ˆåˆ°æ­¸æª”ç›®éŒ„ find /project -type f -mtime +90 -exec mv {} /archive/ \\; å®‰å…¨æª¢æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 # æª¢æŸ¥ SUID/SGID æª”æ¡ˆ find /usr -type f \\( -perm -4000 -o -perm -2000 \\) -exec ls -l {} \\; # æª¢æŸ¥å¯å¯«æª”æ¡ˆ find /etc -type f -writable 2\u0026gt;/dev/null # æª¢æŸ¥ç„¡ä¸»æª”æ¡ˆ find /home -nouser -o -nogroup # æª¢æŸ¥ç•°å¸¸æ¬Šé™ find /var/www -type f ! -perm 644 -o -type d ! -perm 755 é–‹ç™¼èˆ‡é™¤éŒ¯ 1 2 3 4 5 6 7 8 9 10 11 12 # æœå°‹ç¨‹å¼ç¢¼ find . -name \u0026#34;*.java\u0026#34; -exec grep -l \u0026#34;className\u0026#34; {} \\; # æ‰¾å‡ºç·¨è­¯ç”¢ç”Ÿçš„æª”æ¡ˆ find . \\( -name \u0026#34;*.class\u0026#34; -o -name \u0026#34;*.o\u0026#34; -o -name \u0026#34;*.pyc\u0026#34; \\) -delete # çµ±è¨ˆä¸åŒé¡å‹æª”æ¡ˆæ•¸é‡ find . -type f -name \u0026#34;*.java\u0026#34; | wc -l find . -type f -name \u0026#34;*.py\u0026#34; -exec wc -l {} + | tail -1 # æª¢æŸ¥ç¨‹å¼ç¢¼è¡Œæ•¸ find . -name \u0026#34;*.py\u0026#34; -exec wc -l {} + | sort -nr | head -10 ç›£æ§èˆ‡åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 # æ‰¾å‡ºæœ€è¿‘ä¿®æ”¹çš„æª”æ¡ˆ find /var/log -type f -mmin -60 -exec ls -lt {} \\; # ç›£æ§æª”æ¡ˆç³»çµ±è®ŠåŒ– find /etc -newer /tmp/baseline -type f # åˆ†æç£ç¢Ÿä½¿ç”¨ find /home -type f -printf \u0026#34;%s %p\\n\u0026#34; | sort -nr | head -20 # æ‰¾å‡ºé‡è¤‡æª”æ¡ˆï¼ˆåŸºæ–¼å¤§å°ï¼‰ find /data -type f -printf \u0026#34;%s %p\\n\u0026#34; | sort | uniq -d -w 10 æ•ˆèƒ½å„ªåŒ–æŠ€å·§ æå‡æœå°‹æ•ˆèƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 # é™åˆ¶æœå°‹æ·±åº¦ find /usr -maxdepth 3 -name \u0026#34;*.conf\u0026#34; # æ’é™¤ä¸å¿…è¦çš„ç›®éŒ„ find / -path /proc -prune -o -path /sys -prune -o -name \u0026#34;*.txt\u0026#34; -print # ä½¿ç”¨æ›´å…·é«”çš„è·¯å¾‘ find /var/log -name \u0026#34;*.log\u0026#34; # å¥½ find / -name \u0026#34;*.log\u0026#34; # è¼ƒæ…¢ # å°‡æœ€å…·é¸æ“‡æ€§çš„æ¢ä»¶æ”¾åœ¨å‰é¢ find . -name \u0026#34;*.txt\u0026#34; -size +1M # å¥½ find . -size +1M -name \u0026#34;*.txt\u0026#34; # ä¹Ÿå¯ä»¥ï¼Œä½†é †åºå½±éŸ¿æ•ˆèƒ½ æ‰¹æ¬¡è™•ç†å„ªåŒ– 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨ {} + è€Œé {} \\; æå‡æ•ˆèƒ½ find . -name \u0026#34;*.txt\u0026#34; -exec wc -l {} + # å¿« find . -name \u0026#34;*.txt\u0026#34; -exec wc -l {} \\; # æ…¢ # ä½¿ç”¨ç®¡é“è™•ç†å¤§é‡çµæœ find /var/log -name \u0026#34;*.log\u0026#34; -print0 | xargs -0 grep \u0026#34;ERROR\u0026#34; # ä¸¦è¡Œè™•ç† find . -name \u0026#34;*.jpg\u0026#34; -print0 | xargs -0 -P 4 -I {} convert {} {}.thumb.jpg å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±ºæ–¹æ¡ˆ æ¬Šé™éŒ¯èª¤è™•ç† 1 2 3 4 5 6 7 8 # å¿½ç•¥æ¬Šé™éŒ¯èª¤ find /var -name \u0026#34;*.log\u0026#34; 2\u0026gt;/dev/null # åªæœå°‹æœ‰æ¬Šé™çš„ç›®éŒ„ find /var -readable -name \u0026#34;*.log\u0026#34; # ä½¿ç”¨ sudo æœå°‹å—ä¿è­·çš„ç›®éŒ„ sudo find /root -name \u0026#34;*.conf\u0026#34; ç‰¹æ®Šå­—å…ƒè™•ç† 1 2 3 4 5 6 # è™•ç†æª”åä¸­çš„ç©ºæ ¼ find . -name \u0026#34;* *\u0026#34; -print0 | xargs -0 ls -l # è™•ç†ç‰¹æ®Šå­—å…ƒ find . -name \u0026#34;file[1-3].txt\u0026#34; find . -name \u0026#34;*.txt\u0026#34; -not -name \u0026#34;*\\\u0026amp;*\u0026#34; è¨˜æ†¶é«”ä½¿ç”¨å„ªåŒ– 1 2 3 4 5 6 7 8 9 10 # é¿å…ä¸€æ¬¡è¼‰å…¥éå¤šçµæœ find /large_dir -name \u0026#34;*.txt\u0026#34; | head -100 # ä½¿ç”¨ -quit åœ¨æ‰¾åˆ°ç¬¬ä¸€å€‹çµæœå¾Œåœæ­¢ find . -name \u0026#34;target.txt\u0026#34; -quit # åˆ†æ®µè™•ç†å¤§ç›®éŒ„ find /huge_dir -maxdepth 1 -type d | while read dir; do find \u0026#34;$dir\u0026#34; -name \u0026#34;*.txt\u0026#34; done èˆ‡å…¶ä»–å·¥å…·çµ„åˆ èˆ‡ grep çµ„åˆ 1 2 3 4 5 6 7 8 9 # åœ¨æª”æ¡ˆä¸­æœå°‹å…§å®¹ find . -name \u0026#34;*.txt\u0026#34; -exec grep -l \u0026#34;pattern\u0026#34; {} \\; # æœå°‹ä¸¦é¡¯ç¤ºåŒ¹é…è¡Œ find . -name \u0026#34;*.log\u0026#34; -exec grep -Hn \u0026#34;ERROR\u0026#34; {} \\; # ä½¿ç”¨ xargs æå‡æ•ˆèƒ½ find . -name \u0026#34;*.txt\u0026#34; | xargs grep \u0026#34;pattern\u0026#34; find . -name \u0026#34;*.txt\u0026#34; -print0 | xargs -0 grep \u0026#34;pattern\u0026#34; èˆ‡ tar çµ„åˆ 1 2 3 4 5 # å‚™ä»½æ‰¾åˆ°çš„æª”æ¡ˆ find /home -name \u0026#34;*.doc\u0026#34; -print0 | tar -czf backup.tar.gz --null -T - # æ­¸æª”èˆŠæª”æ¡ˆ find /data -mtime +30 -print0 | tar -czf old_files.tar.gz --null -T - èˆ‡ rsync çµ„åˆ 1 2 # åŒæ­¥æ‰¾åˆ°çš„æª”æ¡ˆ find /source -name \u0026#34;*.txt\u0026#34; -print0 | rsync -av --files-from=- --from0 /source/ /destination/ ç¸½çµ æ ¸å¿ƒå„ªå‹¢ å¼·å¤§çš„æœå°‹èƒ½åŠ›ï¼šæ”¯æ´å¤šç¨®æ¢ä»¶çµ„åˆæœå°‹ æ‰¹æ¬¡æ“ä½œï¼šå¯å°æœå°‹çµæœåŸ·è¡Œå„ç¨®å‹•ä½œ é«˜åº¦å¯é…ç½®ï¼šè±å¯Œçš„åƒæ•¸å’Œé¸é … è·¨å¹³å°ç›¸å®¹ï¼šåœ¨å„ç¨® Unix-like ç³»çµ±ä¸­ä¸€è‡´ æœ€ä½³å¯¦è¸ æ˜ç¢ºæœå°‹ç¯„åœï¼šä½¿ç”¨å…·é«”çš„è·¯å¾‘è€Œéæ ¹ç›®éŒ„ åˆç†ä½¿ç”¨æ¢ä»¶ï¼šå°‡æœ€å…·é¸æ“‡æ€§çš„æ¢ä»¶æ”¾åœ¨å‰é¢ å–„ç”¨é‚è¼¯é‹ç®—ï¼šåˆç†çµ„åˆ ANDã€ORã€NOT æ¢ä»¶ æ³¨æ„æ•ˆèƒ½ï¼šå¤§ç›®éŒ„æœå°‹æ™‚è€ƒæ…®ä½¿ç”¨ -maxdepth é™åˆ¶ å®‰å…¨æ“ä½œï¼šä½¿ç”¨ -ok è€Œé -exec é€²è¡Œå±éšªæ“ä½œ å¸¸ç”¨æŠ€å·§è¨˜æ†¶ 1 2 3 4 5 6 # æ—¥å¸¸æœ€å¸¸ç”¨çš„æ¨¡å¼ find . -name \u0026#34;*.txt\u0026#34; # åŸºæœ¬æª”åæœå°‹ find . -type f -size +100M # å¤§æª”æ¡ˆæœå°‹ find . -mtime -7 # æœ€è¿‘ä¿®æ”¹æª”æ¡ˆ find . -name \u0026#34;*.tmp\u0026#34; -delete # æ¸…ç†è‡¨æ™‚æª”æ¡ˆ find . -name \u0026#34;*.sh\u0026#34; -exec chmod +x {} \\; # æ‰¹æ¬¡ä¿®æ”¹æ¬Šé™ find å‘½ä»¤çš„å¼·å¤§ä¹‹è™•åœ¨æ–¼å…¶éˆæ´»æ€§å’Œå¯çµ„åˆæ€§ã€‚ç†Ÿç·´æŒæ¡é€™å€‹å·¥å…·ï¼Œèƒ½å¤ å¤§å¹…æå‡ Linux ç³»çµ±ç®¡ç†å’Œæ—¥å¸¸å·¥ä½œçš„æ•ˆç‡ã€‚è¨˜ä½ï¼šå¯¦å‹™ä¸­æœ€é‡è¦çš„æ˜¯ç†è§£å„ç¨®æ¢ä»¶çš„çµ„åˆé‚è¼¯ï¼Œä¸¦æ ¹æ“šå¯¦éš›éœ€æ±‚é¸æ“‡æœ€é©åˆçš„æœå°‹ç­–ç•¥ã€‚\nåƒè€ƒè³‡æ–™ GNU Findutils Manual Linux man find Advanced Bash-Scripting Guide Unix Power Tools ","permalink":"https://xinqilin.github.io/post/tools/find/","tags":["Linux","Find","Command Line","File Search","System Administration","Shell","Unix"],"title":"Find å‘½ä»¤å®Œæ•´æŒ‡å—ï¼šLinux æª”æ¡ˆæœå°‹èˆ‡ç®¡ç†çš„ç‘å£«è»åˆ€"},{"content":"æ¦‚è¿° Ubuntu æ˜¯åŸºæ–¼ Debian çš„ Linux ç™¼è¡Œç‰ˆï¼Œä»¥å…¶ç©©å®šæ€§ã€æ˜“ç”¨æ€§å’Œè±å¯Œçš„è»Ÿé«”ç”Ÿæ…‹ç³»çµ±è€Œèåã€‚å®ƒæ˜¯é›²ç«¯é‹ç®—ã€ä¼ºæœå™¨éƒ¨ç½²å’Œé–‹ç™¼ç’°å¢ƒçš„é¦–é¸å¹³å°ï¼Œæä¾›é•·æœŸæ”¯æ´ï¼ˆLTSï¼‰ç‰ˆæœ¬å’Œå®šæœŸæ›´æ–°çš„æ¨™æº–ç‰ˆæœ¬ã€‚\næ ¸å¿ƒç‰¹å¾µ ç©©å®šå¯é ï¼šåŸºæ–¼ Debian ç©©å®šåˆ†æ”¯ï¼Œç¶“éåš´æ ¼æ¸¬è©¦ å¥—ä»¶è±å¯Œï¼šAPT å¥—ä»¶ç®¡ç†ç³»çµ±ï¼Œæ•¸è¬å€‹è»Ÿé«”åŒ… ç¤¾ç¾¤æ”¯æ´ï¼šæ´»èºçš„é–‹ç™¼è€…å’Œä½¿ç”¨è€…ç¤¾ç¾¤ å®¹å™¨å‹å¥½ï¼šå„ªç§€çš„ Docker å’Œå®¹å™¨åŒ–æ”¯æ´ é›²ç«¯æ•´åˆï¼šåŸç”Ÿæ”¯æ´å„å¤§é›²ç«¯å¹³å° ç³»çµ±å®‰è£èˆ‡åˆå§‹è¨­ç½® åŸºæœ¬å®‰è£ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æª¢æŸ¥ç³»çµ±ç‰ˆæœ¬ lsb_release -a cat /etc/os-release # æª¢æŸ¥ç¡¬é«”è³‡è¨Š uname -a lscpu free -h df -h # æª¢æŸ¥ç¶²è·¯ç‹€æ…‹ ip addr show netstat -tuln ç³»çµ±æ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ›´æ–°å¥—ä»¶åˆ—è¡¨ sudo apt update # å‡ç´šå·²å®‰è£çš„å¥—ä»¶ sudo apt upgrade -y # å®Œæ•´ç³»çµ±å‡ç´š sudo apt full-upgrade -y # æ¸…ç†ä¸éœ€è¦çš„å¥—ä»¶ sudo apt autoremove -y sudo apt autoclean # æª¢æŸ¥å¯å‡ç´šçš„å¥—ä»¶ apt list --upgradable æ™‚å€å’Œèªè¨€è¨­å®š 1 2 3 4 5 6 7 8 9 10 # è¨­å®šæ™‚å€ sudo timedatectl set-timezone Asia/Taipei timedatectl status # èªè¨€å’Œåœ°å€è¨­å®š sudo locale-gen zh_TW.UTF-8 sudo update-locale LANG=zh_TW.UTF-8 # æª¢æŸ¥ç•¶å‰èªè¨€è¨­å®š locale å¥—ä»¶ç®¡ç†ç³»çµ± APT åŸºæœ¬æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # æœå°‹å¥—ä»¶ apt search keyword apt-cache search keyword # æŸ¥çœ‹å¥—ä»¶è³‡è¨Š apt show package-name apt-cache show package-name # å®‰è£å¥—ä»¶ sudo apt install package-name sudo apt install package1 package2 package3 # é‡æ–°å®‰è£å¥—ä»¶ sudo apt reinstall package-name # ç§»é™¤å¥—ä»¶ sudo apt remove package-name # ä¿ç•™é…ç½®æª”æ¡ˆ sudo apt purge package-name # å®Œå…¨ç§»é™¤ # æª¢æŸ¥ä¾è³´é—œä¿‚ apt depends package-name apt rdepends package-name # åˆ—å‡ºå·²å®‰è£å¥—ä»¶ dpkg -l apt list --installed å¥—ä»¶åº«ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ·»åŠ  PPA å¥—ä»¶åº« sudo add-apt-repository ppa:user/ppa-name sudo apt update # ç§»é™¤ PPA sudo add-apt-repository --remove ppa:user/ppa-name # ç®¡ç†å¥—ä»¶åº«é‡‘é‘° wget -qO - https://example.com/key.gpg | sudo apt-key add - sudo apt-key list sudo apt-key del KEY_ID # ç·¨è¼¯å¥—ä»¶ä¾†æº sudo nano /etc/apt/sources.list ls /etc/apt/sources.list.d/ DEB å¥—ä»¶è™•ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å®‰è£æœ¬åœ° DEB å¥—ä»¶ sudo dpkg -i package.deb # ä¿®å¾©ä¾è³´å•é¡Œ sudo apt install -f # ç§»é™¤ DEB å¥—ä»¶ sudo dpkg -r package-name # æŸ¥è©¢ DEB å¥—ä»¶å…§å®¹ dpkg -L package-name dpkg -c package.deb # æŸ¥è©¢æª”æ¡ˆå±¬æ–¼å“ªå€‹å¥—ä»¶ dpkg -S /path/to/file å¿…å‚™è»Ÿé«”å®‰è£ é–‹ç™¼å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŸºæœ¬é–‹ç™¼å·¥å…· sudo apt install build-essential git vim curl wget htop tree # ç¨‹å¼èªè¨€ç’°å¢ƒ sudo apt install python3 python3-pip nodejs npm default-jdk # ç‰ˆæœ¬æ§åˆ¶ sudo apt install git subversion # ç·¨è¼¯å™¨å’Œ IDE sudo apt install vim neovim emacs code # è³‡æ–™åº«å·¥å…· sudo apt install mysql-client postgresql-client redis-tools ç³»çµ±ç›£æ§å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç³»çµ±ç›£æ§ sudo apt install htop iotop iftop nethogs # ç³»çµ±è³‡è¨Š sudo apt install neofetch screenfetch inxi # ç¶²è·¯å·¥å…· sudo apt install net-tools traceroute nmap tcpdump wireshark # æ•ˆèƒ½åˆ†æ sudo apt install sysstat dstat glances # æ—¥èªŒåˆ†æ sudo apt install logwatch fail2ban åª’é«”å’Œè¾¦å…¬è»Ÿé«” 1 2 3 4 5 6 7 8 9 10 11 # åª’é«”æ’­æ”¾ sudo apt install vlc audacity gimp # è¾¦å…¬è»Ÿé«” sudo apt install libreoffice thunderbird firefox # å£“ç¸®å·¥å…· sudo apt install zip unzip rar unrar 7zip # æ–‡ä»¶è™•ç† sudo apt install pandoc texlive-full Docker ç’°å¢ƒè¨­ç½® Docker å®‰è£èˆ‡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # ç§»é™¤èˆŠç‰ˆæœ¬ sudo apt remove docker docker-engine docker.io containerd runc # å®‰è£ä¾è³´ sudo apt update sudo apt install apt-transport-https ca-certificates curl gnupg lsb-release # æ·»åŠ  Docker å®˜æ–¹ GPG é‡‘é‘° curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg # æ·»åŠ å¥—ä»¶åº« echo \u0026#34;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\u0026#34; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null # å®‰è£ Docker Engine sudo apt update sudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin # å•Ÿå‹•ä¸¦å•Ÿç”¨ Docker æœå‹™ sudo systemctl start docker sudo systemctl enable docker # å°‡ä½¿ç”¨è€…åŠ å…¥ docker ç¾¤çµ„ sudo usermod -aG docker $USER newgrp docker # é©—è­‰å®‰è£ docker --version docker run hello-world Ubuntu Docker å®¹å™¨è¨­ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 # æ‹‰å– Ubuntu æ˜ åƒ docker pull ubuntu:latest docker pull ubuntu:20.04 docker pull ubuntu:22.04 # å»ºç«‹ Docker ç¶²è·¯ docker network create ubuntu-network # å•Ÿå‹• Ubuntu å®¹å™¨ docker run -dit \\ --name ubuntu-container \\ --network ubuntu-network \\ -p 2222:22 \\ -p 8080:8080 \\ -v $(pwd)/workspace:/workspace \\ ubuntu:latest # é€²å…¥å®¹å™¨ docker exec -it ubuntu-container bash # å®¹å™¨å…§åˆå§‹åŒ– apt update \u0026amp;\u0026amp; apt upgrade -y yes | unminimize # å®‰è£åŸºæœ¬å·¥å…· apt install -y \\ curl \\ wget \\ git \\ vim \\ nano \\ htop \\ tree \\ less \\ man-db \\ openssh-server \\ sudo \\ zip \\ unzip \\ jq \\ python3 \\ python3-pip \\ nodejs \\ npm # è¨­å®š SSH æœå‹™ echo \u0026#39;PermitRootLogin yes\u0026#39; \u0026gt;\u0026gt; /etc/ssh/sshd_config echo \u0026#39;PasswordAuthentication yes\u0026#39; \u0026gt;\u0026gt; /etc/ssh/sshd_config service ssh start # å»ºç«‹ä½¿ç”¨è€… useradd -m -s /bin/bash developer echo \u0026#39;developer:password\u0026#39; | chpasswd usermod -aG sudo developer å®¹å™¨ç®¡ç†è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 #!/bin/bash # ubuntu_container_manager.sh - Ubuntu å®¹å™¨ç®¡ç†è…³æœ¬ CONTAINER_NAME=\u0026#34;ubuntu-dev\u0026#34; NETWORK_NAME=\u0026#34;ubuntu-network\u0026#34; IMAGE=\u0026#34;ubuntu:22.04\u0026#34; start_container() { echo \u0026#34;Starting Ubuntu development container...\u0026#34; # æª¢æŸ¥ç¶²è·¯æ˜¯å¦å­˜åœ¨ if ! docker network ls | grep -q \u0026#34;$NETWORK_NAME\u0026#34;; then echo \u0026#34;Creating network: $NETWORK_NAME\u0026#34; docker network create \u0026#34;$NETWORK_NAME\u0026#34; fi # æª¢æŸ¥å®¹å™¨æ˜¯å¦å·²å­˜åœ¨ if docker ps -a | grep -q \u0026#34;$CONTAINER_NAME\u0026#34;; then echo \u0026#34;Starting existing container...\u0026#34; docker start \u0026#34;$CONTAINER_NAME\u0026#34; else echo \u0026#34;Creating new container...\u0026#34; docker run -dit \\ --name \u0026#34;$CONTAINER_NAME\u0026#34; \\ --network \u0026#34;$NETWORK_NAME\u0026#34; \\ -p 2222:22 \\ -p 8080:8080 \\ -p 3000:3000 \\ -v \u0026#34;$(pwd)/workspace:/workspace\u0026#34; \\ -v \u0026#34;$(pwd)/config:/config\u0026#34; \\ \u0026#34;$IMAGE\u0026#34; # åˆå§‹åŒ–å®¹å™¨ echo \u0026#34;Initializing container...\u0026#34; docker exec \u0026#34;$CONTAINER_NAME\u0026#34; bash -c \u0026#34; apt update \u0026amp;\u0026amp; apt upgrade -y yes | unminimize apt install -y curl wget git vim htop tree less man-db openssh-server sudo zip unzip jq python3 python3-pip nodejs npm echo \u0026#39;PermitRootLogin yes\u0026#39; \u0026gt;\u0026gt; /etc/ssh/sshd_config echo \u0026#39;PasswordAuthentication yes\u0026#39; \u0026gt;\u0026gt; /etc/ssh/sshd_config service ssh start useradd -m -s /bin/bash developer echo \u0026#39;developer:developer\u0026#39; | chpasswd usermod -aG sudo developer \u0026#34; fi echo \u0026#34;Container started successfully!\u0026#34; echo \u0026#34;SSH: ssh -p 2222 developer@localhost\u0026#34; echo \u0026#34;Enter: docker exec -it $CONTAINER_NAME bash\u0026#34; } stop_container() { echo \u0026#34;Stopping container...\u0026#34; docker stop \u0026#34;$CONTAINER_NAME\u0026#34; } remove_container() { echo \u0026#34;Removing container...\u0026#34; docker stop \u0026#34;$CONTAINER_NAME\u0026#34; 2\u0026gt;/dev/null || true docker rm \u0026#34;$CONTAINER_NAME\u0026#34; 2\u0026gt;/dev/null || true } status_container() { echo \u0026#34;Container status:\u0026#34; docker ps -a | grep \u0026#34;$CONTAINER_NAME\u0026#34; || echo \u0026#34;Container not found\u0026#34; } case \u0026#34;$1\u0026#34; in start) start_container ;; stop) stop_container ;; remove) remove_container ;; status) status_container ;; restart) stop_container sleep 2 start_container ;; *) echo \u0026#34;Usage: $0 {start|stop|remove|status|restart}\u0026#34; exit 1 ;; esac ç³»çµ±ç®¡ç†èˆ‡ç¶­è­· æœå‹™ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æª¢æŸ¥æœå‹™ç‹€æ…‹ sudo systemctl status service-name sudo systemctl list-units --type=service # å•Ÿå‹•/åœæ­¢/é‡å•Ÿæœå‹™ sudo systemctl start service-name sudo systemctl stop service-name sudo systemctl restart service-name sudo systemctl reload service-name # å•Ÿç”¨/åœç”¨æœå‹™ sudo systemctl enable service-name sudo systemctl disable service-name # æª¢æŸ¥æœå‹™æ—¥èªŒ sudo journalctl -u service-name sudo journalctl -u service-name -f # å³æ™‚æ—¥èªŒ # æª¢æŸ¥é–‹æ©Ÿå•Ÿå‹•çš„æœå‹™ sudo systemctl list-unit-files --state=enabled ä½¿ç”¨è€…å’Œæ¬Šé™ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # ä½¿ç”¨è€…ç®¡ç† sudo useradd -m -s /bin/bash username sudo passwd username sudo userdel username sudo usermod -aG group username # ç¾¤çµ„ç®¡ç† sudo groupadd groupname sudo groupdel groupname groups username # æ¬Šé™ç®¡ç† chmod 755 file chmod u+x file chown user:group file sudo chown -R user:group directory/ # æŸ¥çœ‹ä½¿ç”¨è€…è³‡è¨Š id username who w last ç³»çµ±ç›£æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # CPU å’Œè¨˜æ†¶é«”ä½¿ç”¨ç‡ top htop free -h cat /proc/meminfo # ç£ç¢Ÿä½¿ç”¨æƒ…æ³ df -h du -sh directory/ lsblk fdisk -l # ç¶²è·¯ç‹€æ…‹ netstat -tuln ss -tuln iftop nethogs # ç³»çµ±è² è¼‰ uptime cat /proc/loadavg vmstat 1 5 iostat 1 5 æ—¥èªŒç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ç³»çµ±æ—¥èªŒ sudo journalctl sudo journalctl -f # å³æ™‚æ—¥èªŒ sudo journalctl --since \u0026#34;1 hour ago\u0026#34; sudo journalctl --until \u0026#34;2023-01-01\u0026#34; # æ—¥èªŒå¤§å°ç®¡ç† sudo journalctl --disk-usage sudo journalctl --vacuum-size=100M sudo journalctl --vacuum-time=30d # å‚³çµ±æ—¥èªŒæª”æ¡ˆ tail -f /var/log/syslog tail -f /var/log/auth.log tail -f /var/log/apache2/access.log # æ—¥èªŒè¼ªè½‰ sudo logrotate -d /etc/logrotate.conf sudo logrotate -f /etc/logrotate.conf ç¶²è·¯é…ç½® ç¶²è·¯æ¥å£ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # æª¢æŸ¥ç¶²è·¯æ¥å£ ip addr show ip link show ifconfig # ç¶²è·¯é…ç½®ï¼ˆNetplanï¼‰ sudo nano /etc/netplan/00-installer-config.yaml # ç¯„ä¾‹ Netplan é…ç½® network: version: 2 renderer: networkd ethernets: enp0s3: dhcp4: true enp0s8: addresses: - 192.168.1.100/24 gateway4: 192.168.1.1 nameservers: addresses: [8.8.8.8, 1.1.1.1] # æ‡‰ç”¨ç¶²è·¯é…ç½® sudo netplan try sudo netplan apply # é‡å•Ÿç¶²è·¯æœå‹™ sudo systemctl restart networking sudo systemctl restart systemd-networkd é˜²ç«ç‰†è¨­å®š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # UFW é˜²ç«ç‰† sudo ufw status sudo ufw enable sudo ufw disable # é–‹æ”¾é€£æ¥åŸ  sudo ufw allow 22/tcp sudo ufw allow 80/tcp sudo ufw allow 443/tcp sudo ufw allow from 192.168.1.0/24 # æ‹’çµ•é€£æ¥ sudo ufw deny 23/tcp sudo ufw deny from 192.168.2.100 # æª¢æŸ¥è¦å‰‡ sudo ufw status numbered sudo ufw delete 1 # é‡è¨­é˜²ç«ç‰† sudo ufw --force reset SSH é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # å®‰è£å’Œå•Ÿå‹• SSH sudo apt install openssh-server sudo systemctl start ssh sudo systemctl enable ssh # SSH é…ç½® sudo nano /etc/ssh/sshd_config # é‡è¦ SSH è¨­å®š Port 22 PermitRootLogin no PasswordAuthentication yes PubkeyAuthentication yes AllowUsers username # é‡å•Ÿ SSH æœå‹™ sudo systemctl restart ssh # SSH é‡‘é‘°ç®¡ç† ssh-keygen -t rsa -b 4096 ssh-copy-id user@host å®‰å…¨åŠ å›º ç³»çµ±å®‰å…¨è¨­å®š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æ›´æ–°ç³»çµ± sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y # å®‰è£å®‰å…¨å·¥å…· sudo apt install fail2ban ufw rkhunter chkrootkit # è¨­å®š fail2ban sudo nano /etc/fail2ban/jail.local [DEFAULT] bantime = 3600 findtime = 600 maxretry = 3 [sshd] enabled = true port = ssh filter = sshd logpath = /var/log/auth.log sudo systemctl restart fail2ban # æª¢æŸ¥å®‰å…¨ç‹€æ…‹ sudo rkhunter --check sudo chkrootkit æª”æ¡ˆç³»çµ±å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 # è¨­å®šé©ç•¶çš„æª”æ¡ˆæ¬Šé™ sudo chmod 644 /etc/passwd sudo chmod 600 /etc/shadow sudo chmod 644 /etc/group # æŸ¥æ‰¾å…·æœ‰ç‰¹æ®Šæ¬Šé™çš„æª”æ¡ˆ find / -perm -4000 -type f 2\u0026gt;/dev/null # SUID find / -perm -2000 -type f 2\u0026gt;/dev/null # SGID find / -perm -1000 -type d 2\u0026gt;/dev/null # Sticky bit # æª”æ¡ˆç³»çµ±æƒæ sudo find / -nouser -print 2\u0026gt;/dev/null sudo find / -nogroup -print 2\u0026gt;/dev/null æ•ˆèƒ½èª¿æ•´èˆ‡æœ€ä½³åŒ– ç³»çµ±æ•ˆèƒ½ç›£æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # ç³»çµ±æ•ˆèƒ½ç›£æ§è…³æœ¬ #!/bin/bash # system_monitor.sh echo \u0026#34;=== System Performance Monitor ===\u0026#34; echo \u0026#34;Timestamp: $(date)\u0026#34; echo echo \u0026#34;=== CPU Information ===\u0026#34; echo \u0026#34;CPU Usage:\u0026#34; top -bn1 | grep \u0026#34;Cpu(s)\u0026#34; | awk \u0026#39;{print \u0026#34;CPU Load: \u0026#34; $2}\u0026#39; echo -e \u0026#34;\\nCPU Cores:\u0026#34; nproc echo \u0026#34;=== Memory Information ===\u0026#34; free -h echo -e \u0026#34;\\n=== Disk Usage ===\u0026#34; df -h | grep -E \u0026#39;^/dev/\u0026#39; echo -e \u0026#34;\\n=== Network Statistics ===\u0026#34; ss -tuln | wc -l | awk \u0026#39;{print \u0026#34;Active Connections: \u0026#34; $1}\u0026#39; echo -e \u0026#34;\\n=== System Load ===\u0026#34; uptime echo -e \u0026#34;\\n=== Top Processes by CPU ===\u0026#34; ps aux --sort=-%cpu | head -6 echo -e \u0026#34;\\n=== Top Processes by Memory ===\u0026#34; ps aux --sort=-%mem | head -6 ç³»çµ±æ¸…ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # system_cleanup.sh - ç³»çµ±æ¸…ç†è…³æœ¬ echo \u0026#34;Starting system cleanup...\u0026#34; # æ¸…ç†å¥—ä»¶å¿«å– echo \u0026#34;Cleaning package cache...\u0026#34; sudo apt autoclean sudo apt autoremove -y # æ¸…ç†æ—¥èªŒæª”æ¡ˆ echo \u0026#34;Cleaning log files...\u0026#34; sudo journalctl --vacuum-time=30d # æ¸…ç†æš«å­˜æª”æ¡ˆ echo \u0026#34;Cleaning temporary files...\u0026#34; sudo rm -rf /tmp/* sudo rm -rf /var/tmp/* # æ¸…ç†ä½¿ç”¨è€…æš«å­˜ echo \u0026#34;Cleaning user cache...\u0026#34; rm -rf ~/.cache/* rm -rf ~/.local/share/Trash/* # æ¸…ç†èˆŠæ ¸å¿ƒ echo \u0026#34;Cleaning old kernels...\u0026#34; dpkg -l | grep linux-image | awk \u0026#39;{print $2}\u0026#39; | sort -V | head -n -2 | xargs sudo apt purge -y # æª¢æŸ¥ç£ç¢Ÿç©ºé–“ echo \u0026#34;Disk space after cleanup:\u0026#34; df -h echo \u0026#34;System cleanup completed!\u0026#34; å‚™ä»½èˆ‡æ¢å¾© ç³»çµ±å‚™ä»½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #!/bin/bash # backup_system.sh - ç³»çµ±å‚™ä»½è…³æœ¬ BACKUP_DIR=\u0026#34;/backup\u0026#34; DATE=$(date +%Y%m%d_%H%M%S) HOSTNAME=$(hostname) mkdir -p \u0026#34;$BACKUP_DIR\u0026#34; echo \u0026#34;Starting system backup...\u0026#34; # å‚™ä»½é‡è¦é…ç½®æª”æ¡ˆ echo \u0026#34;Backing up configuration files...\u0026#34; tar -czf \u0026#34;$BACKUP_DIR/config_$HOSTNAME_$DATE.tar.gz\u0026#34; \\ /etc \\ /var/log \\ /home \\ --exclude=/home/*/.cache \\ --exclude=/home/*/Downloads # å‚™ä»½å·²å®‰è£å¥—ä»¶åˆ—è¡¨ echo \u0026#34;Backing up package list...\u0026#34; dpkg --get-selections \u0026gt; \u0026#34;$BACKUP_DIR/packages_$HOSTNAME_$DATE.txt\u0026#34; apt-mark showmanual \u0026gt; \u0026#34;$BACKUP_DIR/manual_packages_$HOSTNAME_$DATE.txt\u0026#34; # å‚™ä»½ç³»çµ±è³‡è¨Š echo \u0026#34;Backing up system information...\u0026#34; { echo \u0026#34;=== System Information ===\u0026#34; uname -a lsb_release -a echo -e \u0026#34;\\n=== Hardware Information ===\u0026#34; lscpu free -h df -h echo -e \u0026#34;\\n=== Network Configuration ===\u0026#34; ip addr show } \u0026gt; \u0026#34;$BACKUP_DIR/system_info_$HOSTNAME_$DATE.txt\u0026#34; echo \u0026#34;Backup completed: $BACKUP_DIR\u0026#34; ls -la \u0026#34;$BACKUP_DIR\u0026#34;/*$DATE* ç³»çµ±æ¢å¾© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #!/bin/bash # restore_system.sh - ç³»çµ±æ¢å¾©è…³æœ¬ BACKUP_FILE=\u0026#34;$1\u0026#34; if [ -z \u0026#34;$BACKUP_FILE\u0026#34; ]; then echo \u0026#34;Usage: $0 \u0026lt;backup_file.tar.gz\u0026gt;\u0026#34; exit 1 fi if [ ! -f \u0026#34;$BACKUP_FILE\u0026#34; ]; then echo \u0026#34;Backup file not found: $BACKUP_FILE\u0026#34; exit 1 fi echo \u0026#34;WARNING: This will restore system files from backup.\u0026#34; echo \u0026#34;Backup file: $BACKUP_FILE\u0026#34; read -p \u0026#34;Continue? (y/N): \u0026#34; confirm if [[ $confirm != [yY] ]]; then echo \u0026#34;Restore cancelled.\u0026#34; exit 0 fi echo \u0026#34;Starting system restore...\u0026#34; # å‚™ä»½ç•¶å‰é…ç½® echo \u0026#34;Backing up current configuration...\u0026#34; sudo tar -czf \u0026#34;/tmp/current_config_$(date +%Y%m%d_%H%M%S).tar.gz\u0026#34; /etc # æ¢å¾©æª”æ¡ˆ echo \u0026#34;Restoring files...\u0026#34; sudo tar -xzf \u0026#34;$BACKUP_FILE\u0026#34; -C / echo \u0026#34;Restore completed. Please reboot the system.\u0026#34; è‡ªå‹•åŒ–è…³æœ¬ ç³»çµ±åˆå§‹åŒ–è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 #!/bin/bash # ubuntu_setup.sh - Ubuntu ç³»çµ±åˆå§‹åŒ–è…³æœ¬ set -e echo \u0026#34;=== Ubuntu System Setup Script ===\u0026#34; # æ›´æ–°ç³»çµ± echo \u0026#34;Updating system...\u0026#34; sudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y # å®‰è£åŸºæœ¬å·¥å…· echo \u0026#34;Installing essential tools...\u0026#34; sudo apt install -y \\ curl \\ wget \\ git \\ vim \\ htop \\ tree \\ unzip \\ zip \\ jq \\ build-essential \\ software-properties-common \\ apt-transport-https \\ ca-certificates \\ gnupg \\ lsb-release # å®‰è£é–‹ç™¼å·¥å…· echo \u0026#34;Installing development tools...\u0026#34; sudo apt install -y \\ python3 \\ python3-pip \\ nodejs \\ npm \\ default-jdk \\ golang-go # å®‰è£ Docker echo \u0026#34;Installing Docker...\u0026#34; curl -fsSL https://get.docker.com | sh sudo usermod -aG docker $USER # é…ç½® Git echo \u0026#34;Configuring Git...\u0026#34; read -p \u0026#34;Enter your Git username: \u0026#34; git_username read -p \u0026#34;Enter your Git email: \u0026#34; git_email git config --global user.name \u0026#34;$git_username\u0026#34; git config --global user.email \u0026#34;$git_email\u0026#34; # è¨­å®š SSH echo \u0026#34;Setting up SSH...\u0026#34; sudo systemctl enable ssh sudo systemctl start ssh # å®‰è£å¸¸ç”¨è»Ÿé«” echo \u0026#34;Installing common applications...\u0026#34; sudo apt install -y \\ firefox \\ vlc \\ gimp \\ libreoffice \\ thunderbird # æ¸…ç† echo \u0026#34;Cleaning up...\u0026#34; sudo apt autoremove -y sudo apt autoclean echo \u0026#34;=== Setup completed! ===\u0026#34; echo \u0026#34;Please reboot the system to ensure all changes take effect.\u0026#34; æ•…éšœæ’é™¤ å¸¸è¦‹å•é¡Œè§£æ±º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # å¥—ä»¶ç®¡ç†å•é¡Œ sudo apt update --fix-missing sudo dpkg --configure -a sudo apt install -f # ç¶²è·¯é€£æ¥å•é¡Œ sudo systemctl restart networking sudo systemctl restart systemd-resolved sudo dhclient -r \u0026amp;\u0026amp; sudo dhclient # SSH é€£æ¥å•é¡Œ sudo systemctl status ssh sudo systemctl restart ssh sudo tail -f /var/log/auth.log # ç£ç¢Ÿç©ºé–“ä¸è¶³ sudo du -sh /* | sort -hr sudo find / -type f -size +100M sudo apt autoremove sudo apt autoclean # è¨˜æ†¶é«”ä¸è¶³ free -h sudo swapoff -a \u0026amp;\u0026amp; sudo swapon -a echo 3 | sudo tee /proc/sys/vm/drop_caches ç¸½çµ æ ¸å¿ƒå„ªå‹¢ ç©©å®šå¯é ï¼šä¼æ¥­ç´šç©©å®šæ€§å’Œé•·æœŸæ”¯æ´ æ˜“æ–¼ä½¿ç”¨ï¼šå‹å¥½çš„ä½¿ç”¨è€…ä»‹é¢å’Œè±å¯Œçš„æ–‡æª” å¥—ä»¶è±å¯Œï¼šå¼·å¤§çš„ APT å¥—ä»¶ç®¡ç†ç³»çµ± ç¤¾ç¾¤æ”¯æ´ï¼šæ´»èºçš„é–‹ç™¼è€…å’Œä½¿ç”¨è€…ç¤¾ç¾¤ å®¹å™¨åŒ–å‹å¥½ï¼šå„ªç§€çš„ Docker å’Œé›²ç«¯æ”¯æ´ æœ€ä½³å¯¦è¸ å®šæœŸæ›´æ–°ï¼šä¿æŒç³»çµ±å’Œè»Ÿé«”åŒ…çš„æœ€æ–°ç‹€æ…‹ å®‰å…¨åŠ å›ºï¼šé…ç½®é˜²ç«ç‰†ã€fail2ban å’Œé©ç•¶çš„ä½¿ç”¨è€…æ¬Šé™ ç›£æ§ç³»çµ±ï¼šå®šæœŸæª¢æŸ¥ç³»çµ±æ•ˆèƒ½å’Œè³‡æºä½¿ç”¨æƒ…æ³ å‚™ä»½é‡è¦è³‡æ–™ï¼šå»ºç«‹å®šæœŸå‚™ä»½ç­–ç•¥ æ–‡æª”è¨˜éŒ„ï¼šè¨˜éŒ„ç³»çµ±é…ç½®å’Œè®Šæ›´ å­¸ç¿’è·¯å¾‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆå­¸è€…éšæ®µ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade # ç³»çµ±æ›´æ–° sudo apt install package-name # è»Ÿé«”å®‰è£ systemctl status service-name # æœå‹™ç®¡ç† # é€²éšéšæ®µ docker run -it ubuntu:latest # å®¹å™¨åŒ–æ‡‰ç”¨ sudo ufw allow 80/tcp # é˜²ç«ç‰†é…ç½® sudo journalctl -u service-name # æ—¥èªŒåˆ†æ # å°ˆå®¶éšæ®µ netplan apply # ç¶²è·¯é…ç½® systemctl edit service-name # æœå‹™è‡ªå®šç¾© crontab -e # è‡ªå‹•åŒ–ä»»å‹™ Ubuntu æ˜¯ç¾ä»£ Linux ç™¼è¡Œç‰ˆçš„ä»£è¡¨ï¼ŒæŒæ¡å…¶ä½¿ç”¨æŠ€å·§èƒ½å¤ å¤§å¹…æå‡ç³»çµ±ç®¡ç†å’Œé–‹ç™¼æ•ˆç‡ã€‚è¨˜ä½ï¼šç†è§£ Linux åŸºç¤æ¦‚å¿µæ˜¯æœ‰æ•ˆä½¿ç”¨ Ubuntu çš„é—œéµï¼Œå–„ç”¨ç¤¾ç¾¤è³‡æºå’Œæ–‡æª”å¯ä»¥è§£æ±ºå¤§éƒ¨åˆ†å•é¡Œã€‚\nåƒè€ƒè³‡æ–™ Ubuntu Official Documentation Ubuntu Community Help Wiki APT User\u0026rsquo;s Guide systemd Documentation Docker on Ubuntu ","permalink":"https://xinqilin.github.io/post/tools/ubuntu/","tags":["Ubuntu","Linux","System Administration","Package Management","Docker","Server","Command Line"],"title":"Ubuntu ç³»çµ±ç®¡ç†å®Œæ•´æŒ‡å—ï¼šLinux å…¥é–€åˆ°é€²éšå¯¦æˆ°"},{"content":"TreeSet TreeSetä½¿ç”¨æ˜¯ç´…é»‘æ¨¹ã€‚\nè‡ªè¨‚æ’åº\nSet treeSet = new TreeSet\u0026lt;\u0026gt;(Comparator.comparing(String::length));\n1 2 3 4 5 6 7 8 9 10 11 12 Set\u0026lt;Integer\u0026gt; treeSet = new TreeSet\u0026lt;\u0026gt;(); treeSet.add(1); treeSet.add(2); treeSet.add(3); Iterator\u0026lt;Integer\u0026gt; itr = treeSet.iterator(); // Iterator\u0026lt;String\u0026gt; itr = treeSet.descendingIterator(); // é™å†ª while (itr.hasNext()) { log.info(itr.next()); } .first() =\u0026gt; è¿”å›ç¬¬ä¸€å€‹å…ƒç´ , last() =\u0026gt; è¿”å›æœ€å¾Œä¸€å€‹å…ƒç´  1 2 3 4 5 6 7 8 9 10 TreeSet\u0026lt;String\u0026gt; treeSet = new TreeSet\u0026lt;\u0026gt;(); treeSet.add(1); treeSet.add(2); treeSet.add(3); treeSet.add(4); treeSet.add(5); assertEquals(1, treeSet.first()); assertEquals(5, treeSet.last()); subSet(fromKey, toKey) =\u0026gt; fromElement åˆ° toElementçš„å…ƒç´  (è·Ÿ substring ä¸€æ¨£ åŒ…é ­ä¸åŒ…å°¾) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 SortedSet\u0026lt;Integer\u0026gt; treeSet = new TreeSet\u0026lt;\u0026gt;(); treeSet.add(1); treeSet.add(2); treeSet.add(3); treeSet.add(4); treeSet.add(5); treeSet.add(6); Set\u0026lt;Integer\u0026gt; expectedSet = new TreeSet\u0026lt;\u0026gt;(); expectedSet.add(2); expectedSet.add(3); expectedSet.add(4); expectedSet.add(5); assertEquals(expectedSet, treeSet.subSet(2, 6)); headSet() =\u0026gt; è¿”å›å°æ–¼æŒ‡å®š key çš„ element, tailSet() =\u0026gt; è¿”å›å¤§æ–¼ç­‰æ–¼æŒ‡å®š key çš„ element 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 SortedSet\u0026lt;Integer\u0026gt; treeSet = new TreeSet\u0026lt;\u0026gt;(); treeSet.add(1); treeSet.add(2); treeSet.add(3); treeSet.add(4); treeSet.add(5); treeSet.add(6); System.out.println(treeSet.headSet(6)); // [1, 2, 3, 4, 5] System.out.println(treeSet.tailSet(3)); // [3, 4, 5, 6] System.out.println( treeSet.subSet(3, 7)); // [3, 4, 5, 6] assertEquals(treeSet.headSet(6), treeSet.subSet(1, 6)); assertEquals(treeSet.tailSet(3), treeSet.subSet(3, 7)); issue: LC issue\n","permalink":"https://xinqilin.github.io/post/backend/treeset/","tags":["Java","TreeSet","Data Structure","Red-Black Tree","Collections","Sorting"],"title":"Java TreeSet è³‡æ–™çµæ§‹è©³è§£ï¼šæ’åºé›†åˆèˆ‡ç´…é»‘æ¨¹å¯¦ä½œåŸç†"},{"content":"æ¦‚è¿° åœ¨æ’°å¯« Shell Script æ™‚ï¼Œæˆ‘å€‘ç¶“å¸¸éœ€è¦å°æª”æ¡ˆã€ç›®éŒ„æˆ–å­—ä¸²çš„ç‹€æ…‹é€²è¡Œåˆ¤æ–·ï¼Œä¾‹å¦‚æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€æ˜¯å¦å¯è®€ï¼Œæˆ–åˆ¤æ–·å­—ä¸²æ˜¯å¦ç‚ºç©ºã€‚é€™æ™‚å°±éœ€è¦ä½¿ç”¨æ¸¬è©¦è¡¨é”å¼ [ ... ] æˆ– test æŒ‡ä»¤ã€‚æœ¬æ–‡å°‡è©³ç´°ä»‹ç´¹é€™äº›å¸¸ç”¨çš„è¡¨é”å¼åŠå…¶ç”¨æ³•ã€‚\næª”æ¡ˆæ¸¬è©¦è¡¨é”å¼ æª”æ¡ˆæ¸¬è©¦è¡¨é”å¼ç”¨æ–¼åˆ¤æ–·æª”æ¡ˆçš„é¡å‹æˆ–æ¬Šé™ç‹€æ…‹ã€‚å…¶å›å‚³å€¼ç‚ºå¸ƒæ—å€¼ï¼ˆtrue æˆ– falseï¼‰ï¼Œå¯æ­é… if æ¢ä»¶å¼ä½¿ç”¨ã€‚\nèªæ³• 1 2 3 if [ -\u0026lt;operator\u0026gt; \u0026lt;filename\u0026gt; ]; then # do something fi å¸¸ç”¨é‹ç®—å­ é‹ç®—å­ èªªæ˜ ç¯„ä¾‹ -e å¦‚æœæª”æ¡ˆå­˜åœ¨ (exist)ï¼Œå‰‡ç‚º true [ -e /etc/hosts ] -d å¦‚æœæª”æ¡ˆæ˜¯ç›®éŒ„ (directory)ï¼Œå‰‡ç‚º true [ -d /home/user ] -f å¦‚æœæª”æ¡ˆæ˜¯å¸¸è¦æª”æ¡ˆ (regular file)ï¼Œå‰‡ç‚º true [ -f /etc/passwd ] -L å¦‚æœæª”æ¡ˆæ˜¯ç¬¦è™Ÿé€£çµ (symbolic link)ï¼Œå‰‡ç‚º true [ -L /usr/bin/python ] -h èˆ‡ -L ç›¸åŒï¼Œå¦‚æœæª”æ¡ˆæ˜¯ç¬¦è™Ÿé€£çµï¼Œå‰‡ç‚º true [ -h /usr/bin/python ] -r å¦‚æœæª”æ¡ˆå¯è®€ (readable)ï¼Œå‰‡ç‚º true [ -r /etc/shadow ] -w å¦‚æœæª”æ¡ˆå¯å¯« (writable)ï¼Œå‰‡ç‚º true [ -w /tmp/test.log ] -x å¦‚æœæª”æ¡ˆå¯åŸ·è¡Œ (executable)ï¼Œå‰‡ç‚º true [ -x ./deploy.sh ] -s å¦‚æœæª”æ¡ˆå¤§å°ä¸ç‚º 0ï¼Œå‰‡ç‚º true [ -s /var/log/syslog ] æª”æ¡ˆæ¯”è¼ƒé‹ç®—å­ ç”¨æ–¼æ¯”è¼ƒå…©å€‹æª”æ¡ˆçš„æ–°èˆŠé—œä¿‚ã€‚\né‹ç®—å­ èªªæ˜ ç¯„ä¾‹ f1 -nt f2 å¦‚æœæª”æ¡ˆ f1 æ¯” f2 æ–° (newer than)ï¼Œå‰‡ç‚º true [ file1.log -nt file2.log ] f1 -ot f2 å¦‚æœæª”æ¡ˆ f1 æ¯” f2 èˆŠ (older than)ï¼Œå‰‡ç‚º true [ file1.log -ot file2.log ] å­—ä¸²èˆ‡æ•¸å€¼æ¸¬è©¦è¡¨é”å¼ é™¤äº†æª”æ¡ˆï¼Œæ¸¬è©¦è¡¨é”å¼ä¹Ÿå¸¸ç”¨æ–¼æ¯”è¼ƒæ•¸å€¼æˆ–åˆ¤æ–·å­—ä¸²ç‹€æ…‹ã€‚\næ•¸å€¼æ¯”è¼ƒ é‹ç®—å­ èªªæ˜ ç­‰åƒ¹ç¬¦è™Ÿ -eq ç­‰æ–¼ (equal) == -ne ä¸ç­‰æ–¼ (not equal) != -gt å¤§æ–¼ (greater than) \u0026gt; -ge å¤§æ–¼æˆ–ç­‰æ–¼ (greater or equal) \u0026gt;= -lt å°æ–¼ (less than) \u0026lt; -le å°æ–¼æˆ–ç­‰æ–¼ (less or equal) \u0026lt;= å­—ä¸²æ¯”è¼ƒ é‹ç®—å­ èªªæ˜ ç¯„ä¾‹ -n å¦‚æœå­—ä¸²é•·åº¦ä¸ç‚º 0ï¼Œå‰‡ç‚º true [ -n \u0026quot;$my_var\u0026quot; ] -z å¦‚æœå­—ä¸²é•·åº¦ç‚º 0 (zero)ï¼Œå‰‡ç‚º true [ -z \u0026quot;$my_var\u0026quot; ] $string å¦‚æœå­—ä¸²ä¸ç‚ºç©ºï¼Œå‰‡ç‚º true (èˆ‡ -n æ•ˆæœç›¸åŒ) [ \u0026quot;$my_var\u0026quot; ] é‚è¼¯é‹ç®—å­ ç”¨æ–¼çµ„åˆå¤šå€‹è¡¨é”å¼ã€‚\né‹ç®—å­ èªªæ˜ ç¯„ä¾‹ ! NOTï¼šåè½‰è¡¨é”å¼çš„çµæœ [ ! -d /tmp/non_existent ] -a ANDï¼šå…©å€‹è¡¨é”å¼éƒ½ç‚º true æ™‚ï¼Œçµæœæ‰ç‚º true [ -r \u0026quot;$file\u0026quot; -a -s \u0026quot;$file\u0026quot; ] -o ORï¼šå…©å€‹è¡¨é”å¼åªè¦æœ‰ä¸€å€‹ç‚º trueï¼Œçµæœå°±ç‚º true [ -d \u0026quot;$dir\u0026quot; -o -f \u0026quot;$dir\u0026quot; ] æ³¨æ„ï¼šå»ºè­°ä½¿ç”¨ \u0026amp;\u0026amp; å’Œ || ä¾†å–ä»£ -a å’Œ -oï¼Œå› ç‚ºå®ƒå€‘æ›´ç¬¦åˆç¾ä»£ Shell çš„æ¨™æº–ä¸”æ›´å®‰å…¨ã€‚\n1 2 3 4 5 6 7 8 9 # ä½¿ç”¨ \u0026amp;\u0026amp; (AND) if [ -r \u0026#34;$file\u0026#34; ] \u0026amp;\u0026amp; [ -s \u0026#34;$file\u0026#34; ]; then echo \u0026#34;æª”æ¡ˆå¯è®€ä¸”å…§å®¹ä¸ç‚ºç©º\u0026#34; fi # ä½¿ç”¨ || (OR) if [ -d \u0026#34;$path\u0026#34; ] || [ -f \u0026#34;$path\u0026#34; ]; then echo \u0026#34;è·¯å¾‘æ˜¯ä¸€å€‹ç›®éŒ„æˆ–æª”æ¡ˆ\u0026#34; fi å¯¦ç”¨ç¯„ä¾‹ ç¯„ä¾‹ 1ï¼šæª¢æŸ¥ç›®éŒ„æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å‰‡å»ºç«‹ 1 2 3 4 5 6 7 8 9 10 #!/bin/bash LOG_DIR=\u0026#34;/var/log/myapp\u0026#34; if [ ! -d \u0026#34;$LOG_DIR\u0026#34; ]; then echo \u0026#34;æ—¥èªŒç›®éŒ„ä¸å­˜åœ¨ï¼Œæ­£åœ¨å»ºç«‹: $LOG_DIR\u0026#34; mkdir -p \u0026#34;$LOG_DIR\u0026#34; else echo \u0026#34;æ—¥èªŒç›®éŒ„å·²å­˜åœ¨ã€‚\u0026#34; fi ç¯„ä¾‹ 2ï¼šæª¢æŸ¥å­—ä¸²è®Šæ•¸æ˜¯å¦ç‚ºç©º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #!/bin/bash USERNAME=\u0026#34;\u0026#34; # ... å¾æŸè™•è®€å–ä½¿ç”¨è€…åç¨± ... if [ -z \u0026#34;$USERNAME\u0026#34; ]; then echo \u0026#34;éŒ¯èª¤ï¼šä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©ºï¼\u0026#34; exit 1 fi # å¦ä¸€ç¨®å¯«æ³• if [ ! \u0026#34;$USERNAME\u0026#34; ]; then echo \u0026#34;éŒ¯èª¤ï¼šä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©ºï¼\u0026#34; exit 1 fi ç¯„ä¾‹ 3ï¼šçµåˆå¤šå€‹æ¢ä»¶ 1 2 3 4 5 6 7 8 9 10 #!/bin/bash CONFIG_FILE=\u0026#34;config.conf\u0026#34; if [ -f \u0026#34;$CONFIG_FILE\u0026#34; ] \u0026amp;\u0026amp; [ -r \u0026#34;$CONFIG_FILE\u0026#34; ]; then echo \u0026#34;è¨­å®šæª”å­˜åœ¨ä¸”å¯è®€å–ï¼Œè¼‰å…¥è¨­å®š...\u0026#34; source \u0026#34;$CONFIG_FILE\u0026#34; else echo \u0026#34;è­¦å‘Šï¼šæ‰¾ä¸åˆ°è¨­å®šæª”æˆ–ç„¡æ³•è®€å–ã€‚\u0026#34; fi ","permalink":"https://xinqilin.github.io/post/tools/fileexpress/","tags":["Shell","Bash","File System","Scripting"],"title":"Shell æª”æ¡ˆèˆ‡å­—ä¸²è¡¨é”å¼è©³è§£"},{"content":"æ¦‚è¿° éˆè¡¨åè½‰æ˜¯æ•¸æ“šçµæ§‹èˆ‡æ¼”ç®—æ³•ä¸­çš„ç¶“å…¸å•é¡Œï¼Œè¦æ±‚å°‡å–®å‘éˆè¡¨çš„æŒ‡å‘é—œä¿‚å®Œå…¨åè½‰ã€‚é€™å€‹å•é¡Œçœ‹ä¼¼ç°¡å–®ï¼Œä½†æ¶‰åŠåˆ°æŒ‡æ¨™æ“ä½œçš„ç´°ç¯€ï¼Œæ˜¯è€ƒé©—ç·¨ç¨‹åŸºæœ¬åŠŸçš„é‡è¦é¡Œå‹ã€‚\nå•é¡Œå®šç¾© çµ¦å®šä¸€å€‹å–®å‘éˆè¡¨ï¼Œå°‡å…¶åè½‰ä¸¦å›å‚³æ–°çš„é ­ç¯€é»ã€‚\nç¯„ä¾‹ï¼š\n1 2 è¼¸å…¥ï¼š1 -\u0026gt; 2 -\u0026gt; 3 -\u0026gt; 4 -\u0026gt; 5 -\u0026gt; NULL è¼¸å‡ºï¼š5 -\u0026gt; 4 -\u0026gt; 3 -\u0026gt; 2 -\u0026gt; 1 -\u0026gt; NULL éˆè¡¨ç¯€é»å®šç¾© 1 2 3 4 5 6 7 8 9 10 11 public class ListNode { int val; ListNode next; ListNode() {} ListNode(int val) { this.val = val; } ListNode(int val, ListNode next) { this.val = val; this.next = next; } } è§£æ³•ä¸€ï¼šè¿­ä»£å¯¦ä½œ åŸºæœ¬æ€è·¯ ä½¿ç”¨ä¸‰å€‹æŒ‡æ¨™ prevã€currentã€next ä¾†é€æ­¥æ”¹è®Šæ¯å€‹ç¯€é»çš„æŒ‡å‘é—œä¿‚ã€‚\nç®—æ³•æ­¥é©Ÿ åˆå§‹åŒ– prev = nullï¼Œcurrent = head ç•¶ current != null æ™‚ï¼š ä¿å­˜ current.next åˆ° next å°‡ current.next æŒ‡å‘ prev ç§»å‹• prev å’Œ current æŒ‡æ¨™ å›å‚³ prevï¼ˆæ–°çš„é ­ç¯€é»ï¼‰ å¯¦ä½œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class Solution { public ListNode reverseList(ListNode head) { ListNode prev = null; ListNode current = head; while (current != null) { ListNode next = current.next; // ä¿å­˜ä¸‹ä¸€å€‹ç¯€é» current.next = prev; // åè½‰æŒ‡æ¨™ prev = current; // ç§»å‹• prev current = next; // ç§»å‹• current } return prev; // prev ç¾åœ¨æ˜¯æ–°çš„é ­ç¯€é» } } åœ–è§£éç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 åˆå§‹ç‹€æ…‹ï¼š prev = null, current = 1 null 1 -\u0026gt; 2 -\u0026gt; 3 -\u0026gt; 4 -\u0026gt; 5 -\u0026gt; null ç¬¬ä¸€æ­¥ï¼š next = 2, current.next = prev null \u0026lt;- 1 2 -\u0026gt; 3 -\u0026gt; 4 -\u0026gt; 5 -\u0026gt; null prev current ç¬¬äºŒæ­¥ï¼š next = 3, current.next = prev null \u0026lt;- 1 \u0026lt;- 2 3 -\u0026gt; 4 -\u0026gt; 5 -\u0026gt; null prev current ... æœ€çµ‚ç‹€æ…‹ï¼š null \u0026lt;- 1 \u0026lt;- 2 \u0026lt;- 3 \u0026lt;- 4 \u0026lt;- 5 null prev current è§£æ³•äºŒï¼šéæ­¸å¯¦ä½œ åŸºæœ¬æ€è·¯ ä½¿ç”¨éæ­¸çš„æ–¹å¼ï¼Œå¾éˆè¡¨å°¾éƒ¨é–‹å§‹åè½‰ï¼Œåˆ©ç”¨éæ­¸å›æº¯çš„ç‰¹æ€§ä¾†æ”¹è®ŠæŒ‡æ¨™æŒ‡å‘ã€‚\nç®—æ³•æ­¥é©Ÿ éæ­¸åˆ°éˆè¡¨æœ€å¾Œä¸€å€‹ç¯€é» åœ¨å›æº¯éç¨‹ä¸­ï¼Œé€æ­¥åè½‰æ¯å€‹ç¯€é»çš„æŒ‡å‘ å›å‚³åŸéˆè¡¨çš„å°¾ç¯€é»ï¼ˆæ–°çš„é ­ç¯€é»ï¼‰ å¯¦ä½œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public class Solution { public ListNode reverseList(ListNode head) { // åŸºç¤æƒ…æ³ï¼šç©ºç¯€é»æˆ–åªæœ‰ä¸€å€‹ç¯€é» if (head == null || head.next == null) { return head; } // éæ­¸åè½‰å­éˆè¡¨ ListNode newHead = reverseList(head.next); // åè½‰ç•¶å‰ç¯€é»çš„æŒ‡å‘ head.next.next = head; head.next = null; return newHead; } } éæ­¸éç¨‹åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 åŸéˆè¡¨ï¼š1 -\u0026gt; 2 -\u0026gt; 3 -\u0026gt; 4 -\u0026gt; 5 -\u0026gt; null éæ­¸èª¿ç”¨æ£§ï¼š reverseList(1) -\u0026gt; reverseList(2) -\u0026gt; ... -\u0026gt; reverseList(5) å›æº¯éšæ®µï¼š 1. reverseList(5) å›å‚³ 5 2. reverseList(4)ï¼š - newHead = 5 - 4.next.next = 4 (å³ 5.next = 4) - 4.next = null - å›å‚³ 5 3. reverseList(3)ï¼š - newHead = 5 - 3.next.next = 3 (å³ 4.next = 3) - 3.next = null - å›å‚³ 5 ... æœ€çµ‚çµæœï¼š5 -\u0026gt; 4 -\u0026gt; 3 -\u0026gt; 2 -\u0026gt; 1 -\u0026gt; null æ™‚é–“èˆ‡ç©ºé–“è¤‡é›œåº¦åˆ†æ æ–¹æ³• æ™‚é–“è¤‡é›œåº¦ ç©ºé–“è¤‡é›œåº¦ å„ªé» ç¼ºé» è¿­ä»£ O(n) O(1) ç©ºé–“æ•ˆç‡é«˜ï¼Œç›´è§€æ˜“æ‡‚ éœ€è¦è™•ç†å¤šå€‹æŒ‡æ¨™ éæ­¸ O(n) O(n) ä»£ç¢¼ç°¡æ½”ï¼Œé‚è¼¯æ¸…æ™° ä½¿ç”¨é¡å¤–å †ç–Šç©ºé–“ é€²éšæ‡‰ç”¨ 1. åè½‰éˆè¡¨çš„å‰ N å€‹ç¯€é» å•é¡Œï¼šåè½‰éˆè¡¨çš„å‰ N å€‹ç¯€é»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class Solution { private ListNode successor = null; // å¾Œé©…ç¯€é» public ListNode reverseN(ListNode head, int n) { if (n == 1) { // è¨˜éŒ„ç¬¬ n+1 å€‹ç¯€é» successor = head.next; return head; } // ä»¥ head.next ç‚ºèµ·é»ï¼Œéœ€è¦åè½‰å‰ n-1 å€‹ç¯€é» ListNode last = reverseN(head.next, n - 1); head.next.next = head; head.next = successor; // è®“åè½‰ä¹‹å¾Œçš„ head ç¯€é»å’Œå¾Œé¢çš„ç¯€é»é€£èµ·ä¾† return last; } } 2. åè½‰éˆè¡¨çš„æŒ‡å®šå€é–“ï¼ˆLeetCode 92ï¼‰ å•é¡Œï¼šåè½‰å¾ä½ç½® m åˆ° n çš„éˆè¡¨ã€‚è«‹ä½¿ç”¨ä¸€è¶Ÿæƒæå®Œæˆåè½‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public class Solution { public ListNode reverseBetween(ListNode head, int left, int right) { // å‰µå»ºè™›æ“¬é ­ç¯€é» ListNode dummy = new ListNode(0); dummy.next = head; // æ‰¾åˆ° left çš„å‰ä¸€å€‹ç¯€é» ListNode prev = dummy; for (int i = 0; i \u0026lt; left - 1; i++) { prev = prev.next; } // é–‹å§‹åè½‰ ListNode current = prev.next; ListNode next = null; for (int i = 0; i \u0026lt; right - left; i++) { next = current.next; current.next = next.next; next.next = prev.next; prev.next = next; } return dummy.next; } } 3. K å€‹ä¸€çµ„åè½‰éˆè¡¨ï¼ˆLeetCode 25ï¼‰ å•é¡Œï¼šçµ¦å®šä¸€å€‹éˆè¡¨ï¼Œæ¯ k å€‹ç¯€é»ä¸€çµ„é€²è¡Œåè½‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 public class Solution { public ListNode reverseKGroup(ListNode head, int k) { if (head == null) return null; // æª¢æŸ¥å‰©é¤˜ç¯€é»æ˜¯å¦è¶³å¤  k å€‹ ListNode a = head, b = head; for (int i = 0; i \u0026lt; k; i++) { if (b == null) return head; // ä¸è¶³ k å€‹ï¼Œç›´æ¥è¿”å› b = b.next; } // åè½‰å‰ k å€‹å…ƒç´  ListNode newHead = reverse(a, b); // éæ­¸åè½‰å¾ŒçºŒçš„éˆè¡¨ä¸¦é€£æ¥ a.next = reverseKGroup(b, k); return newHead; } // åè½‰ [a, b) å€é–“çš„éˆè¡¨ private ListNode reverse(ListNode a, ListNode b) { ListNode prev = null; ListNode current = a; while (current != b) { ListNode next = current.next; current.next = prev; prev = current; current = next; } return prev; } } å¯¦ä½œæŠ€å·§èˆ‡æ³¨æ„äº‹é … 1. é‚Šç•Œæ¢ä»¶è™•ç† 1 2 3 4 // æª¢æŸ¥ç©ºéˆè¡¨å’Œå–®ç¯€é»éˆè¡¨ if (head == null || head.next == null) { return head; } 2. ä½¿ç”¨è™›æ“¬é ­ç¯€é» åœ¨è™•ç†éˆè¡¨é ­éƒ¨è®ŠåŒ–çš„å•é¡Œæ™‚ï¼Œè™›æ“¬é ­ç¯€é»å¯ä»¥ç°¡åŒ–é‚è¼¯ï¼š\n1 2 3 4 ListNode dummy = new ListNode(0); dummy.next = head; // ... æ“ä½œ return dummy.next; 3. æŒ‡æ¨™æ“ä½œçš„é †åº åœ¨æ”¹è®ŠæŒ‡æ¨™æŒ‡å‘æ™‚ï¼Œå¿…é ˆå…ˆä¿å­˜ä¸‹ä¸€å€‹ç¯€é»ï¼š\n1 2 ListNode next = current.next; // å…ˆä¿å­˜ current.next = prev; // å†ä¿®æ”¹ 4. éæ­¸çµ‚æ­¢æ¢ä»¶ ç¢ºä¿éæ­¸æœ‰æ˜ç¢ºçš„çµ‚æ­¢æ¢ä»¶ï¼š\n1 2 3 if (head == null || head.next == null) { return head; // åŸºç¤æƒ…æ³ } å¸¸è¦‹è®Šé«”å•é¡Œ 1. åˆ¤æ–·éˆè¡¨æ˜¯å¦ç‚ºå›æ–‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public boolean isPalindrome(ListNode head) { if (head == null) return true; // æ‰¾åˆ°ä¸­é» ListNode slow = head, fast = head; while (fast.next != null \u0026amp;\u0026amp; fast.next.next != null) { slow = slow.next; fast = fast.next.next; } // åè½‰å¾ŒåŠéƒ¨åˆ† ListNode secondHalf = reverseList(slow.next); // æ¯”è¼ƒå‰å¾Œå…©éƒ¨åˆ† ListNode p1 = head, p2 = secondHalf; while (p2 != null) { if (p1.val != p2.val) return false; p1 = p1.next; p2 = p2.next; } return true; } 2. å…©å…©äº¤æ›éˆè¡¨ä¸­çš„ç¯€é» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public ListNode swapPairs(ListNode head) { ListNode dummy = new ListNode(0); dummy.next = head; ListNode prev = dummy; while (prev.next != null \u0026amp;\u0026amp; prev.next.next != null) { ListNode first = prev.next; ListNode second = prev.next.next; // äº¤æ› prev.next = second; first.next = second.next; second.next = first; // ç§»å‹• prev prev = first; } return dummy.next; } æœ€ä½³å¯¦è¸ é¸æ“‡åˆé©çš„æ–¹æ³•ï¼šå°æ–¼ç°¡å–®çš„éˆè¡¨åè½‰ï¼Œæ¨è–¦ä½¿ç”¨è¿­ä»£æ–¹æ³• æ³¨æ„ç©ºé–“è¤‡é›œåº¦ï¼šåœ¨ç©ºé–“å—é™çš„ç’°å¢ƒä¸‹é¿å…ä½¿ç”¨éæ­¸ è™•ç†é‚Šç•Œæƒ…æ³ï¼šå§‹çµ‚æª¢æŸ¥ç©ºéˆè¡¨å’Œå–®ç¯€é»æƒ…æ³ ä½¿ç”¨è™›æ“¬ç¯€é»ï¼šç°¡åŒ–é ­ç¯€é»çš„è™•ç†é‚è¼¯ æ¸¬è©¦å……åˆ†ï¼šæ¸¬è©¦å„ç¨®é‚Šç•Œæƒ…æ³å’Œç‰¹æ®Šè¼¸å…¥ ç¸½çµ éˆè¡¨åè½‰æ˜¯ä¸€å€‹çœ‹ä¼¼ç°¡å–®ä½†ç´°ç¯€è±å¯Œçš„å•é¡Œã€‚æŒæ¡é€™å€‹å•é¡Œçš„é—œéµåœ¨æ–¼ï¼š\nç†è§£æŒ‡æ¨™æ“ä½œï¼šæ­£ç¢ºè™•ç†ç¯€é»é–“çš„æŒ‡å‘é—œä¿‚ é¸æ“‡åˆé©æ–¹æ³•ï¼šæ ¹æ“šå ´æ™¯é¸æ“‡è¿­ä»£æˆ–éæ­¸å¯¦ä½œ è™•ç†é‚Šç•Œæƒ…æ³ï¼šç¢ºä¿ç®—æ³•åœ¨å„ç¨®è¼¸å…¥ä¸‹éƒ½èƒ½æ­£ç¢ºé‹è¡Œ éˆæ´»æ‡‰ç”¨ï¼šå°‡åŸºæœ¬æŠ€å·§æ‡‰ç”¨åˆ°æ›´è¤‡é›œçš„è®Šé«”å•é¡Œä¸­ é€šéåå¾©ç·´ç¿’å’Œç†è§£ï¼Œéˆè¡¨åè½‰å°‡æˆç‚ºè§£æ±ºæ›´è¤‡é›œéˆè¡¨å•é¡Œçš„åŸºç¤æŠ€èƒ½ã€‚\nåƒè€ƒè³‡æ–™ LeetCode 206. Reverse Linked List LeetCode 92. Reverse Linked List II LeetCode 25. Reverse Nodes in k-Group LeetCode 234. Palindrome Linked List æ¼”ç®—æ³•å°è«– - éˆè¡¨æ“ä½œ ","permalink":"https://xinqilin.github.io/post/algorithm/reverselinkedlist/","tags":["Algorithm","LinkedList","Recursion","Java","Pointer"],"title":"éˆè¡¨åè½‰ï¼ˆReverse Linked Listï¼‰å®Œæ•´è§£æ"},{"content":"æ¦‚è¿° ä¸¦æŸ¥é›†ï¼ˆUnion-Findï¼‰åˆç¨±ç‚ºä¸ç›¸äº¤é›†åˆï¼ˆDisjoint Setï¼‰ï¼Œæ˜¯ä¸€ç¨®ç”¨ä¾†è™•ç†ä¸ç›¸äº¤é›†åˆçš„åˆä½µå’ŒæŸ¥è©¢å•é¡Œçš„æ•¸æ“šçµæ§‹ã€‚å®ƒæ”¯æ´å…©ç¨®ä¸»è¦æ“ä½œï¼š\nFindï¼šæŸ¥æ‰¾å…ƒç´ æ‰€å±¬çš„é›†åˆï¼ˆè¿”å›é›†åˆçš„ä»£è¡¨å…ƒç´ ï¼‰ Unionï¼šåˆä½µå…©å€‹ä¸åŒçš„é›†åˆ ä¸¦æŸ¥é›†åœ¨åœ–è«–æ¼”ç®—æ³•ä¸­æ‡‰ç”¨å»£æ³›ï¼Œç‰¹åˆ¥é©ç”¨æ–¼è§£æ±ºé€£é€šæ€§å•é¡Œã€‚\nåŸºæœ¬åŸç† æ ¸å¿ƒæ¦‚å¿µ ä¸¦æŸ¥é›†å°‡æ¯å€‹é›†åˆè¡¨ç¤ºç‚ºä¸€æ£µæ¨¹ï¼Œæ¨¹çš„æ ¹ç¯€é»ä½œç‚ºè©²é›†åˆçš„ä»£è¡¨å…ƒç´ ã€‚åˆå§‹ç‹€æ…‹ä¸‹ï¼Œæ¯å€‹å…ƒç´ éƒ½æ˜¯ç¨ç«‹çš„é›†åˆï¼ˆè‡ªå·±æ˜¯è‡ªå·±çš„çˆ¶ç¯€é»ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 åˆå§‹ç‹€æ…‹ï¼š 0 1 2 3 4 â†“ â†“ â†“ â†“ â†“ 0 1 2 3 4 åˆä½µ 0 å’Œ 1 å¾Œï¼š 0 2 3 4 â†™ â†“ â†“ â†“ 1 2 3 4 åˆä½µ 2 å’Œ 3 å¾Œï¼š 0 2 4 â†™ â†™ â†“ 1 3 4 åŸºæœ¬å¯¦ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 public class UnionFind { private int[] parent; // parent[i] è¡¨ç¤ºå…ƒç´  i çš„çˆ¶ç¯€é» private int[] rank; // rank[i] è¡¨ç¤ºä»¥ i ç‚ºæ ¹çš„æ¨¹çš„é«˜åº¦ private int components; // é€£é€šåˆ†é‡çš„æ•¸é‡ public UnionFind(int n) { parent = new int[n]; rank = new int[n]; components = n; // åˆå§‹åŒ–ï¼šæ¯å€‹å…ƒç´ éƒ½æ˜¯ç¨ç«‹çš„é›†åˆ for (int i = 0; i \u0026lt; n; i++) { parent[i] = i; // è‡ªå·±æ˜¯è‡ªå·±çš„çˆ¶ç¯€é» rank[i] = 0; // åˆå§‹é«˜åº¦ç‚º 0 } } /** * æŸ¥æ‰¾å…ƒç´  x æ‰€å±¬é›†åˆçš„ä»£è¡¨å…ƒç´  */ public int find(int x) { if (parent[x] != x) { // è·¯å¾‘å£“ç¸®ï¼šå°‡è·¯å¾‘ä¸Šæ‰€æœ‰ç¯€é»ç›´æ¥é€£æ¥åˆ°æ ¹ç¯€é» parent[x] = find(parent[x]); } return parent[x]; } /** * åˆä½µå…ƒç´  x å’Œ y æ‰€å±¬çš„é›†åˆ */ public boolean union(int x, int y) { int rootX = find(x); int rootY = find(y); // å¦‚æœå·²ç¶“åœ¨åŒä¸€å€‹é›†åˆä¸­ï¼Œè¿”å› false if (rootX == rootY) { return false; } // æŒ‰ç§©åˆä½µï¼šå°‡è¼ƒçŸ®çš„æ¨¹åˆä½µåˆ°è¼ƒé«˜çš„æ¨¹ä¸‹ if (rank[rootX] \u0026lt; rank[rootY]) { parent[rootX] = rootY; } else if (rank[rootX] \u0026gt; rank[rootY]) { parent[rootY] = rootX; } else { parent[rootY] = rootX; rank[rootX]++; // é«˜åº¦ç›¸åŒæ™‚ï¼Œåˆä½µå¾Œé«˜åº¦åŠ  1 } components--; // é€£é€šåˆ†é‡æ¸› 1 return true; } /** * æª¢æŸ¥å…©å€‹å…ƒç´ æ˜¯å¦åœ¨åŒä¸€å€‹é›†åˆä¸­ */ public boolean connected(int x, int y) { return find(x) == find(y); } /** * ç²å–é€£é€šåˆ†é‡çš„æ•¸é‡ */ public int getComponentCount() { return components; } } å„ªåŒ–æŠ€å·§ 1. è·¯å¾‘å£“ç¸®ï¼ˆPath Compressionï¼‰ åœ¨ find æ“ä½œä¸­ï¼Œå°‡æŸ¥æ‰¾è·¯å¾‘ä¸Šçš„æ‰€æœ‰ç¯€é»ç›´æ¥é€£æ¥åˆ°æ ¹ç¯€é»ï¼Œä½¿æ¨¹è®Šå¾—æ›´åŠ æ‰å¹³ã€‚\n1 2 3 4 5 6 public int find(int x) { if (parent[x] != x) { parent[x] = find(parent[x]); // éæ­¸å£“ç¸®è·¯å¾‘ } return parent[x]; } 2. æŒ‰ç§©åˆä½µï¼ˆUnion by Rankï¼‰ ç¸½æ˜¯å°‡è¼ƒçŸ®çš„æ¨¹åˆä½µåˆ°è¼ƒé«˜çš„æ¨¹ä¸‹ï¼Œé¿å…æ¨¹è®Šå¾—éé«˜ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public boolean union(int x, int y) { int rootX = find(x); int rootY = find(y); if (rootX == rootY) return false; // æŒ‰ç§©åˆä½µ if (rank[rootX] \u0026lt; rank[rootY]) { parent[rootX] = rootY; } else if (rank[rootX] \u0026gt; rank[rootY]) { parent[rootY] = rootX; } else { parent[rootY] = rootX; rank[rootX]++; } return true; } 3. æŒ‰å¤§å°åˆä½µï¼ˆUnion by Sizeï¼‰ å¦ä¸€ç¨®å„ªåŒ–ç­–ç•¥æ˜¯å°‡è¼ƒå°çš„é›†åˆåˆä½µåˆ°è¼ƒå¤§çš„é›†åˆä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 public class UnionFindBySize { private int[] parent; private int[] size; // size[i] è¡¨ç¤ºä»¥ i ç‚ºæ ¹çš„é›†åˆå¤§å° public UnionFindBySize(int n) { parent = new int[n]; size = new int[n]; for (int i = 0; i \u0026lt; n; i++) { parent[i] = i; size[i] = 1; // åˆå§‹æ¯å€‹é›†åˆå¤§å°ç‚º 1 } } public boolean union(int x, int y) { int rootX = find(x); int rootY = find(y); if (rootX == rootY) return false; // æŒ‰å¤§å°åˆä½µï¼šå°‡å°é›†åˆåˆä½µåˆ°å¤§é›†åˆ if (size[rootX] \u0026lt; size[rootY]) { parent[rootX] = rootY; size[rootY] += size[rootX]; } else { parent[rootY] = rootX; size[rootX] += size[rootY]; } return true; } } æ™‚é–“è¤‡é›œåº¦ æ“ä½œ æ™‚é–“è¤‡é›œåº¦ èªªæ˜ åˆå§‹åŒ– O(n) å»ºç«‹ n å€‹ç¨ç«‹é›†åˆ Findï¼ˆç„¡å„ªåŒ–ï¼‰ O(n) æœ€å£æƒ…æ³ä¸‹éœ€è¦éæ­·æ•´æ¢éˆ Unionï¼ˆç„¡å„ªåŒ–ï¼‰ O(n) éœ€è¦èª¿ç”¨ Find æ“ä½œ Findï¼ˆè·¯å¾‘å£“ç¸®ï¼‰ O(Î±(n)) Î±(n) æ˜¯é˜¿å…‹æ›¼å‡½æ•¸çš„åå‡½æ•¸ Unionï¼ˆæŒ‰ç§©åˆä½µï¼‰ O(Î±(n)) è¿‘ä¼¼å¸¸æ•¸æ™‚é–“ å…¶ä¸­ Î±(n) æ˜¯é˜¿å…‹æ›¼å‡½æ•¸çš„åå‡½æ•¸ï¼Œåœ¨å¯¦éš›æ‡‰ç”¨ä¸­å¯è¦–ç‚ºå¸¸æ•¸ã€‚\nç¶“å…¸æ‡‰ç”¨é¡Œå‹ 1. ç­‰å¼æ–¹ç¨‹çš„å¯æ»¿è¶³æ€§ï¼ˆLeetCode 990ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹ç”±è¡¨ç¤ºè®Šæ•¸ä¹‹é–“é—œä¿‚çš„å­—ä¸²çµ„æˆçš„é™£åˆ— equationsï¼Œæ¯å€‹å­—ä¸² equations[i] çš„é•·åº¦ç‚º 4ï¼Œæœ‰å…©ç¨®å½¢å¼ï¼š\u0026quot;a==b\u0026quot; æˆ– \u0026quot;a!=b\u0026quot;ã€‚åˆ¤æ–·æ˜¯å¦æ‰€æœ‰ç­‰å¼éƒ½èƒ½åŒæ™‚æ»¿è¶³ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 class Solution { private int[] parent = new int[26]; // 26 å€‹å­—æ¯ public boolean equationsPossible(String[] equations) { // åˆå§‹åŒ–ä¸¦æŸ¥é›† for (int i = 0; i \u0026lt; 26; i++) { parent[i] = i; } // ç¬¬ä¸€éï¼šè™•ç†æ‰€æœ‰ç­‰å¼ï¼Œåˆä½µç›¸ç­‰çš„è®Šæ•¸ for (String equation : equations) { if (equation.charAt(1) == \u0026#39;=\u0026#39;) { union(equation.charAt(0) - \u0026#39;a\u0026#39;, equation.charAt(3) - \u0026#39;a\u0026#39;); } } // ç¬¬äºŒéï¼šæª¢æŸ¥ä¸ç­‰å¼æ˜¯å¦é•åäº†ç­‰å¼çš„çµæœ for (String equation : equations) { if (equation.charAt(1) == \u0026#39;!\u0026#39;) { int x = equation.charAt(0) - \u0026#39;a\u0026#39;; int y = equation.charAt(3) - \u0026#39;a\u0026#39;; if (find(x) == find(y)) { return false; // ä¸ç­‰å¼çŸ›ç›¾ } } } return true; } private int find(int x) { if (parent[x] != x) { parent[x] = find(parent[x]); } return parent[x]; } private void union(int x, int y) { parent[find(x)] = find(y); } } 2. æœ‹å‹åœˆæ•¸é‡ï¼ˆLeetCode 547ï¼‰ å•é¡Œæè¿°ï¼šç­ä¸Šæœ‰ N åå­¸ç”Ÿã€‚å…¶ä¸­æœ‰äº›äººæ˜¯æœ‹å‹ï¼Œæœ‰äº›å‰‡ä¸æ˜¯ã€‚ä»–å€‘çš„å‹èª¼å…·æœ‰å‚³éæ€§ã€‚æ‰¾å‡ºæœ‹å‹åœˆçš„ç¸½æ•¸ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class Solution { public int findCircleNum(int[][] isConnected) { int n = isConnected.length; UnionFind uf = new UnionFind(n); // éæ­·æ‰€æœ‰å­¸ç”Ÿå°ï¼Œå¦‚æœæ˜¯æœ‹å‹å°±åˆä½µ for (int i = 0; i \u0026lt; n; i++) { for (int j = i + 1; j \u0026lt; n; j++) { if (isConnected[i][j] == 1) { uf.union(i, j); } } } return uf.getComponentCount(); } } 3. å³¶å¶¼æ•¸é‡ï¼ˆLeetCode 200ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹ç”± \u0026lsquo;1\u0026rsquo;ï¼ˆé™¸åœ°ï¼‰å’Œ \u0026lsquo;0\u0026rsquo;ï¼ˆæ°´ï¼‰çµ„æˆçš„äºŒç¶­ç¶²æ ¼ï¼Œè¨ˆç®—å³¶å¶¼çš„æ•¸é‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 class Solution { public int numIslands(char[][] grid) { if (grid == null || grid.length == 0) return 0; int rows = grid.length; int cols = grid[0].length; UnionFind uf = new UnionFind(rows * cols); int waterCells = 0; // æ–¹å‘é™£åˆ—ï¼šä¸Šã€ä¸‹ã€å·¦ã€å³ int[][] directions = {{-1, 0}, {1, 0}, {0, -1}, {0, 1}}; for (int i = 0; i \u0026lt; rows; i++) { for (int j = 0; j \u0026lt; cols; j++) { if (grid[i][j] == \u0026#39;0\u0026#39;) { waterCells++; } else { // æª¢æŸ¥å››å€‹æ–¹å‘çš„ç›¸é„°é™¸åœ° for (int[] dir : directions) { int newRow = i + dir[0]; int newCol = j + dir[1]; if (newRow \u0026gt;= 0 \u0026amp;\u0026amp; newRow \u0026lt; rows \u0026amp;\u0026amp; newCol \u0026gt;= 0 \u0026amp;\u0026amp; newCol \u0026lt; cols \u0026amp;\u0026amp; grid[newRow][newCol] == \u0026#39;1\u0026#39;) { uf.union(i * cols + j, newRow * cols + newCol); } } } } } return uf.getComponentCount() - waterCells; } } 4. å†—ä½™é€£æ¥ï¼ˆLeetCode 684ï¼‰ å•é¡Œæè¿°ï¼šåœ¨ç„¡å‘åœ–ä¸­æ‰¾åˆ°ä¸€æ¢é‚Šï¼Œç§»é™¤å®ƒå¾Œåœ–å°‡è®Šæˆæ¨¹ã€‚å¦‚æœæœ‰å¤šå€‹ç­”æ¡ˆï¼Œè¿”å›æœ€å¾Œå‡ºç¾åœ¨çµ¦å®šäºŒç¶­é™£åˆ—ä¸­çš„é‚Šã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 class Solution { public int[] findRedundantConnection(int[][] edges) { UnionFind uf = new UnionFind(edges.length + 1); for (int[] edge : edges) { // å¦‚æœå…©å€‹ç¯€é»å·²ç¶“é€£é€šï¼Œé€™æ¢é‚Šå°±æ˜¯å†—ä½™çš„ if (!uf.union(edge[0], edge[1])) { return edge; } } return new int[0]; // ç†è«–ä¸Šä¸æœƒåˆ°é”é€™è£¡ } } 5. è³¬æˆ¶åˆä½µï¼ˆLeetCode 721ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹è³¬æˆ¶åˆ—è¡¨ï¼Œæ¯å€‹å…ƒç´  accounts[i] æ˜¯ä¸€å€‹å­—ä¸²åˆ—è¡¨ï¼Œå…¶ä¸­ç¬¬ä¸€å€‹å…ƒç´ æ˜¯åå­—ï¼Œå…¶é¤˜å…ƒç´ æ˜¯ emailsã€‚åˆä½µå±¬æ–¼åŒä¸€äººçš„è³¬æˆ¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 class Solution { public List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; accountsMerge(List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; accounts) { Map\u0026lt;String, Integer\u0026gt; emailToIndex = new HashMap\u0026lt;\u0026gt;(); Map\u0026lt;String, String\u0026gt; emailToName = new HashMap\u0026lt;\u0026gt;(); int emailCount = 0; // ç‚ºæ¯å€‹ email åˆ†é…å”¯ä¸€ç´¢å¼• for (List\u0026lt;String\u0026gt; account : accounts) { String name = account.get(0); for (int i = 1; i \u0026lt; account.size(); i++) { String email = account.get(i); if (!emailToIndex.containsKey(email)) { emailToIndex.put(email, emailCount++); } emailToName.put(email, name); } } UnionFind uf = new UnionFind(emailCount); // åˆä½µåŒä¸€è³¬æˆ¶ä¸‹çš„æ‰€æœ‰ email for (List\u0026lt;String\u0026gt; account : accounts) { String firstEmail = account.get(1); for (int i = 2; i \u0026lt; account.size(); i++) { uf.union(emailToIndex.get(firstEmail), emailToIndex.get(account.get(i))); } } // æ ¹æ“šä¸¦æŸ¥é›†çµæœåˆ†çµ„ email Map\u0026lt;Integer, List\u0026lt;String\u0026gt;\u0026gt; groups = new HashMap\u0026lt;\u0026gt;(); for (String email : emailToIndex.keySet()) { int root = uf.find(emailToIndex.get(email)); groups.computeIfAbsent(root, k -\u0026gt; new ArrayList\u0026lt;\u0026gt;()).add(email); } // æ§‹å»ºæœ€çµ‚çµæœ List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); for (List\u0026lt;String\u0026gt; emails : groups.values()) { Collections.sort(emails); List\u0026lt;String\u0026gt; account = new ArrayList\u0026lt;\u0026gt;(); account.add(emailToName.get(emails.get(0))); account.addAll(emails); result.add(account); } return result; } } é«˜ç´šæ‡‰ç”¨ å‹•æ…‹é€£é€šæ€§å•é¡Œ ä¸¦æŸ¥é›†ç‰¹åˆ¥é©ç”¨æ–¼è™•ç†å‹•æ…‹é€£é€šæ€§å•é¡Œï¼Œå³åœ¨ç·šå›ç­”ã€Œå…©å€‹ç¯€é»æ˜¯å¦é€£é€šã€çš„æŸ¥è©¢ã€‚\næœ€å°ç”Ÿæˆæ¨¹ï¼ˆKruskal æ¼”ç®—æ³•ï¼‰ Kruskal æ¼”ç®—æ³•ä½¿ç”¨ä¸¦æŸ¥é›†ä¾†æª¢æ¸¬ç’°çš„å­˜åœ¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class KruskalMST { public int kruskalMST(int n, int[][] edges) { // æŒ‰æ¬Šé‡æ’åºé‚Š Arrays.sort(edges, (a, b) -\u0026gt; a[2] - b[2]); UnionFind uf = new UnionFind(n); int mstWeight = 0; int edgesUsed = 0; for (int[] edge : edges) { int u = edge[0], v = edge[1], weight = edge[2]; // å¦‚æœä¸æœƒå½¢æˆç’°ï¼ŒåŠ å…¥ MST if (uf.union(u, v)) { mstWeight += weight; edgesUsed++; // MST æœ‰ n-1 æ¢é‚Š if (edgesUsed == n - 1) { break; } } } return mstWeight; } } å¯¦ä½œæŠ€å·§èˆ‡æ³¨æ„äº‹é … è·¯å¾‘å£“ç¸®ï¼šåœ¨ find æ“ä½œä¸­ä½¿ç”¨è·¯å¾‘å£“ç¸®å¯ä»¥é¡¯è‘—æå‡æ€§èƒ½ æŒ‰ç§©åˆä½µï¼šé¿å…æ¨¹è®Šå¾—éé«˜ï¼Œä¿æŒæ“ä½œçš„é«˜æ•ˆæ€§ å…ƒç´ æ˜ å°„ï¼šç•¶å…ƒç´ ä¸æ˜¯é€£çºŒæ•´æ•¸æ™‚ï¼Œéœ€è¦å»ºç«‹æ˜ å°„é—œä¿‚ é€£é€šåˆ†é‡è¨ˆæ•¸ï¼šç¶­è­·é€£é€šåˆ†é‡çš„æ•¸é‡å¯ä»¥å¿«é€Ÿå›ç­”ç›¸é—œæŸ¥è©¢ ç¸½çµ ä¸¦æŸ¥é›†æ˜¯è§£æ±ºå‹•æ…‹é€£é€šæ€§å•é¡Œçš„é«˜æ•ˆæ•¸æ“šçµæ§‹ï¼Œåœ¨åœ–è«–ã€ç¶²è·¯åˆ†æã€é›†åˆåŠƒåˆ†ç­‰é ˜åŸŸæœ‰å»£æ³›æ‡‰ç”¨ã€‚æŒæ¡ä¸¦æŸ¥é›†çš„é—œéµåœ¨æ–¼ï¼š\nç†è§£åŸºæœ¬åŸç†ï¼šæ¨¹å½¢çµæ§‹è¡¨ç¤ºé›†åˆï¼Œæ ¹ç¯€é»ä½œç‚ºä»£è¡¨å…ƒç´  æŒæ¡å„ªåŒ–æŠ€å·§ï¼šè·¯å¾‘å£“ç¸®å’ŒæŒ‰ç§©/æŒ‰å¤§å°åˆä½µ éˆæ´»æ‡‰ç”¨ï¼šæ ¹æ“šå•é¡Œç‰¹é»é¸æ“‡åˆé©çš„å¯¦ä½œæ–¹å¼ æ³¨æ„ç´°ç¯€ï¼šé‚Šç•Œæ¢ä»¶è™•ç†å’Œå…ƒç´ æ˜ å°„ åƒè€ƒè³‡æ–™ LeetCode 990. Satisfiability of Equality Equations LeetCode 547. Number of Provinces LeetCode 200. Number of Islands LeetCode 684. Redundant Connection LeetCode 721. Accounts Merge æ¼”ç®—æ³•å°è«– - ä¸ç›¸äº¤é›†åˆçš„æ•¸æ“šçµæ§‹ ","permalink":"https://xinqilin.github.io/post/algorithm/unionfind/","tags":["Algorithm","UnionFind","DisjointSet","Graph","Java"],"title":"ä¸¦æŸ¥é›†ï¼ˆUnion-Findï¼‰æ¼”ç®—æ³•å®Œæ•´æŒ‡å—"},{"content":"Snowflake - Distribution Key å–®é«”å¼ ID ä¸€èˆ¬å–®é«”å¼ UUID(Universally Unique identifier) 8-4-4-4-12 ç¸½å…± 32 å€‹ 16 é€²ä½\n1 UUID.randomUUID() // 80e06459-942d-4a63-9fd4-81691b127363 å„ªé» æ€§èƒ½é«˜ æœ¬åœ°ç”Ÿæˆ ç„¡ç¶²è·¯å»¶é² ç¼ºé» ç„¡é †åºæ€§ å­—ä¸²ä¸é©åˆå­˜ db ç•¶ index or PK ä¸” 32 é•·åº¦å¤ªé•· å› ç„¡åº æ‰€ä»¥å° b+ Tree ä¾†èªª æ’å…¥æ™‚æ•ˆèƒ½ä½ æ¥µå°æ©Ÿæœƒä½† æœƒé‡è¤‡ =\u0026gt; ï¼¤ï¼¢ è§£æ³•: replace into è·ŸinsertåŠŸèƒ½é¡ä¼¼, ä½† replace into æœƒæª¢æŸ¥æ˜¯å¦å­˜åœ¨, å¦‚å­˜åœ¨å‰‡å…ˆåˆªé™¤, å†æ’å…¥, å¦åˆ™ç›´æ¥æ’å…¥ åˆ†ä½ˆå¼ ID twitter é–‹ç™¼çš„ é›ªèŠ±ç®—æ³• - snowflake ç¸½å…± 64 bit\n1bit ä¸ç”¨ï¼Œå› ç‚ºäºŒé€²åˆ¶ä¸­æœ€é«˜ä½æ˜¯ç¬¦è™Ÿä½ï¼Œ1è¡¨ç¤ºè² æ•¸ï¼Œ0è¡¨ç¤ºæ­£æ•¸ã€‚ ç”Ÿæˆçš„idä¸€èˆ¬éƒ½æ˜¯ç”¨æ•´æ•¸ï¼Œæ‰€ä»¥æœ€é«˜ä½å›ºå®šç‚º0ã€‚\n41bit-æ™‚é–“æˆ³ï¼Œç”¨ä¾†è¨˜éŒ„æ™‚é–“æˆ³ï¼Œäº³ç§’ç´šã€‚ 41ä½å¯ä»¥è¡¨ç¤º 2^41-1å€‹æ•¸å­—ï¼Œ å¦‚æœåªç”¨ä¾†è¡¨ç¤ºæ­£æ•´æ•¸(è¨ˆç®—æ©Ÿä¸­æ­£æ•¸åŒ…å«0)ï¼Œå¯ä»¥è¡¨ç¤ºçš„æ•¸å€¼ç¯„åœæ˜¯: 0 è‡³ 2^41 - 1ï¼Œ æ¸›1æ˜¯å› ç‚ºå¯è¡¨ç¤ºçš„æ•¸å€¼ç¯„åœæ˜¯å¾0é–‹å§‹ç®—çš„ï¼Œè€Œä¸æ˜¯1.ä¹Ÿå°±æ˜¯èªª41ä½å¯ä»¥è¡¨ç¤º 2^41 - 1 å€‹æ¯«ç§’çš„å€¼ï¼Œè½‰åŒ–æˆå–®ä½å¹´å‰‡æ˜¯( 2^41 - 1 )/ (1000* 60 * 60 * 24 *365)= 69å¹´\n10bit-å·¥ä½œæ©Ÿå™¨id,ç”¨ä¾†è¨˜éŒ„å·¥ä½œæ©Ÿå™¨id. å¯ä»¥éƒ¨ç½²åœ¨ 2^10 = 1024 å€‹ç¯€é»ï¼ŒåŒ…æ‹¬5ä½ dataCenterId å’Œ 15 ä½ workerId 5ä½(bit) å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ­£æ•´æ•¸æ˜¯ 2^5-1 = 31ï¼Œå³å¯ä»¥ç”¨ 0, 1, 2, 3\u0026hellip; é€™ 32 å€‹æ•¸å­—ä¾†è¡¨ç¤ºä¸åŒçš„ dataCenterId æˆ– workerId\n12bit, åºåˆ—è™Ÿï¼Œåºåˆ—è™Ÿï¼Œç”¨ä¾†è¨˜éŒ„åŒæ¯«ç§’å…§ç”¢ç”Ÿçš„ä¸åŒid. 12ä½(bit) å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ­£æ•´æ•¸æ˜¯ 2^12 - 1 = 4095ï¼Œå³å¯ä»¥ç”¨ 0, 1, 2, 3\u0026hellip; 4094 é€™ 4095 å€‹æ•¸å­—, ä¾†è¡¨ç¤ºåŒä¸€æ©Ÿå™¨åŒä¸€æ™‚é–“æˆª(æ¯«ç§’)å…§ç”¢ç”Ÿçš„ 4095 å€‹IDåºè™Ÿã€‚\nå„ªé» å…¨å±€å”¯ä¸€æ€§ é€’å¢æ€§, ç¢ºä¿ç”Ÿæˆ ID å°æ–¼ç”¨æˆ·æˆ–æ¥­å‹™æ˜¯é€’å¢çš„ã€‚ é«˜å¯ç”¨æ€§, ç¢ºä¿ä»»ä½•æ™‚å€™éƒ½èƒ½ç”Ÿæˆæ­£ç¢ºçš„ ID é«˜æ€§èƒ½, åœ¨é«˜ä½µç™¼ä¸‹ä¾ç„¶ ok äº³ç§’æ•°åœ¨é«˜ä½ï¼Œè‡ªå¢åºåˆ—åœ¨ä½ä½ï¼Œæ•´å€‹ ID éƒ½æ˜¯éå¢çš„ã€‚ ç¼ºé» ä¾è³´æ©Ÿå™¨æ™‚é˜ï¼Œå¦‚æœæ©Ÿå™¨æ™‚é˜å›æ’¥ï¼Œæœƒå°è‡´é‡è¤‡ ID ç”Ÿæˆ åœ¨å–®æ©Ÿä¸Šæ˜¯éå¢çš„ï¼Œä½†æ˜¯ç”±æ–¼è¨­è¨ˆåˆ°åˆ†ä½ˆå¼ç’°å¢ƒï¼Œæ¯å°æ©Ÿå™¨ä¸Šçš„æ™‚é˜ä¸å¯èƒ½å®Œå…¨åŒæ­¥ï¼Œæœ‰æ™‚å€™æœƒå‡ºç¾ä¸æ˜¯å…¨å±€éå¢çš„æƒ…æ³(æ­¤ç¼ºé»å¯ä»¥èªç‚ºç„¡æ‰€è¬‚ï¼Œ- .èˆ¬åˆ†ä½ˆå¼IDåªè¦æ±‚è¶¨å‹¢éå¢ï¼Œä¸¦ä¸æœƒåš´æ ¼è¦æ±‚éå¢ï¼Œ90%çš„éœ€æ±‚éƒ½åªè¦æ±‚è¶¨å‹¢éå¢) additional è§£æ±ºæ©Ÿå™¨æ™‚é˜å›æ’¥å•é¡Œ Leaf - ç¾åœ˜é»è©•åˆ†ä½ˆå¼IDç”Ÿæˆç³»çµ± ç™¾åº¦ open source - UidGenerator java sample code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 public class SnowflakeIdWorker { /** * å¼€å§‹æ—¶é—´æˆª (2015-01-01) */ private final long twepoch = 1420041600000L; /** * æœºå™¨idæ‰€å çš„ä½æ•° */ private final long workerIdBits = 5L; /** * æ•°æ®æ ‡è¯†idæ‰€å çš„ä½æ•° */ private final long datacenterIdBits = 5L; /** * æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°) */ private final long maxWorkerId = -1L ^ (-1L \u0026lt;\u0026lt; workerIdBits); /** * æ”¯æŒçš„æœ€å¤§æ•°æ®æ ‡è¯†idï¼Œç»“æœæ˜¯31 */ private final long maxDatacenterId = -1L ^ (-1L \u0026lt;\u0026lt; datacenterIdBits); /** * åºåˆ—åœ¨idä¸­å çš„ä½æ•° */ private final long sequenceBits = 12L; /** * æœºå™¨IDå‘å·¦ç§»12ä½ */ private final long workerIdShift = sequenceBits; /** * æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5) */ private final long datacenterIdShift = sequenceBits + workerIdBits; /** * æ—¶é—´æˆªå‘å·¦ç§»22ä½(5+5+12) */ private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits; /** * ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095) */ private final long sequenceMask = -1L ^ (-1L \u0026lt;\u0026lt; sequenceBits); /** * å·¥ä½œæœºå™¨ID(0~31) */ private long workerId; /** * æ•°æ®ä¸­å¿ƒID(0~31) */ private long datacenterId; /** * æ¯«ç§’å†…åºåˆ—(0~4095) */ private long sequence = 0L; /** * ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª */ private long lastTimestamp = -1L; /** * æ„é€ å‡½æ•° * @param workerId å·¥ä½œID (0~31) * @param datacenterId æ•°æ®ä¸­å¿ƒID (0~31) */ public SnowflakeIdWorker(long workerId, long datacenterId) { if (workerId \u0026gt; maxWorkerId || workerId \u0026lt; 0) { throw new IllegalArgumentException(String.format(\u0026#34;worker Id can\u0026#39;t be greater than %d or less than 0\u0026#34;, maxWorkerId)); } if (datacenterId \u0026gt; maxDatacenterId || datacenterId \u0026lt; 0) { throw new IllegalArgumentException(String.format(\u0026#34;datacenter Id can\u0026#39;t be greater than %d or less than 0\u0026#34;, maxDatacenterId)); } this.workerId = workerId; this.datacenterId = datacenterId; } /** * è·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„) * @return SnowflakeId */ public synchronized long nextId() { long timestamp = timeGen(); // å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸ if (timestamp \u0026lt; lastTimestamp) { throw new RuntimeException( String.format(\u0026#34;Clock moved backwards. Refusing to generate id for %d milliseconds\u0026#34;, lastTimestamp - timestamp)); } // å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ— if (lastTimestamp == timestamp) { sequence = (sequence + 1) \u0026amp; sequenceMask; // æ¯«ç§’å†…åºåˆ—æº¢å‡º if (sequence == 0) { //é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³ timestamp = tilNextMillis(lastTimestamp); } } // æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½® else { sequence = 0L; } // ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª lastTimestamp = timestamp; // ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID return ((timestamp - twepoch) \u0026lt;\u0026lt; timestampLeftShift) // | (datacenterId \u0026lt;\u0026lt; datacenterIdShift) // | (workerId \u0026lt;\u0026lt; workerIdShift) // | sequence; } /** * é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³ * @param lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª * @return å½“å‰æ—¶é—´æˆ³ */ protected long tilNextMillis(long lastTimestamp) { long timestamp = timeGen(); while (timestamp \u0026lt;= lastTimestamp) { timestamp = timeGen(); } return timestamp; } /** * è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´ * @return å½“å‰æ—¶é—´(æ¯«ç§’) */ protected long timeGen() { return System.currentTimeMillis(); } public static void main(String[] args) throws InterruptedException { SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0); for (int i = 0; i \u0026lt; 10; i++) { long id = idWorker.nextId(); Thread.sleep(1); System.out.println(id); } } } reference: https://github.com/twitter-archive/snowflake https://github.com/beyondfengyu/SnowFlake/blob/master/SnowFlake.java https://blog.csdn.net/qq_45408390/article/details/119793810 ","permalink":"https://xinqilin.github.io/post/architecture/snowflake-distributionkey/","tags":[],"title":"SnowFlake DistributionKey"},{"content":"æ¦‚è¿° å›æº¯æ¼”ç®—æ³•ï¼ˆBacktrackingï¼‰æ˜¯ä¸€ç¨®é€éè©¦éŒ¯ä¾†å°‹æ‰¾å•é¡Œè§£æ±ºæ–¹æ¡ˆçš„ç®—æ³•ç­–ç•¥ã€‚å®ƒç³»çµ±æ€§åœ°æœå°‹æ‰€æœ‰å¯èƒ½çš„å€™é¸è§£ï¼Œç•¶ç™¼ç¾å€™é¸è§£ä¸å¯èƒ½å®Œæˆæœ‰æ•ˆè§£æ™‚ï¼Œæœƒæ”¾æ£„è©²å€™é¸è§£ä¸¦ã€Œå›æº¯ã€åˆ°ä¸Šä¸€æ­¥ã€‚\nåŸºæœ¬åŸç† å›æº¯æ¼”ç®—æ³•éµå¾ªä¸‰å€‹æ ¸å¿ƒæ­¥é©Ÿï¼š\né¸æ“‡ï¼ˆChooseï¼‰ï¼šå¾ç•¶å‰ç‹€æ…‹çš„å¯é¸é …ä¸­åšå‡ºé¸æ“‡ æ¢ç´¢ï¼ˆExploreï¼‰ï¼šRecursionåœ°æ¢ç´¢é€™å€‹é¸æ“‡çš„å¾Œæœ æ’¤éŠ·ï¼ˆUn-chooseï¼‰ï¼šæ’¤éŠ·é¸æ“‡ï¼Œæ¢å¾©åˆ°é¸æ“‡å‰çš„ç‹€æ…‹ æ¼”ç®—æ³•æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 void backtrack(è·¯å¾‘, é¸æ“‡åˆ—è¡¨) { if (æ»¿è¶³çµæŸæ¢ä»¶) { result.add(è·¯å¾‘); return; } for (é¸æ“‡ : é¸æ“‡åˆ—è¡¨) { åšé¸æ“‡; // Choose backtrack(è·¯å¾‘, é¸æ“‡åˆ—è¡¨); // Explore æ’¤éŠ·é¸æ“‡; // Un-choose } } æ™‚é–“è¤‡é›œåº¦ ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œå›æº¯æ¼”ç®—æ³•çš„æ™‚é–“è¤‡é›œåº¦ç‚º O(b^d)ï¼Œå…¶ä¸­ï¼š\nb æ˜¯åˆ†æ”¯å› å­ï¼ˆæ¯å€‹ç¯€é»çš„å¹³å‡å­ç¯€é»æ•¸ï¼‰ d æ˜¯æœå°‹æ·±åº¦ ç¶“å…¸æ‡‰ç”¨é¡Œå‹ 1. å­é›†å•é¡Œï¼ˆSubsetsï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹æ•´æ•¸é™£åˆ— numsï¼Œå›å‚³è©²é™£åˆ—æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå†ªé›†åˆï¼‰ã€‚\nè§£é¡Œæ€è·¯ï¼š\nå°æ–¼æ¯å€‹å…ƒç´ ï¼Œæˆ‘å€‘éƒ½æœ‰ã€Œé¸æ“‡ã€æˆ–ã€Œä¸é¸æ“‡ã€å…©ç¨®æ±ºç­– ä½¿ç”¨å›æº¯æ³•éæ­·æ‰€æœ‰å¯èƒ½çš„çµ„åˆ æ¯æ¬¡Recursionéƒ½å°‡ç•¶å‰è·¯å¾‘åŠ å…¥çµæœé›† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 public List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; subsets(int[] nums) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); Arrays.sort(nums); // æ’åºä¾¿æ–¼è™•ç† backtrack(result, new ArrayList\u0026lt;\u0026gt;(), nums, 0); return result; } private void backtrack(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result, List\u0026lt;Integer\u0026gt; currentPath, int[] nums, int startIndex) { // æ¯å€‹ç‹€æ…‹éƒ½æ˜¯ä¸€å€‹æœ‰æ•ˆçš„å­é›† result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); // å¾ startIndex é–‹å§‹éæ­·ï¼Œé¿å…é‡è¤‡çµ„åˆ for (int i = startIndex; i \u0026lt; nums.length; i++) { // åšé¸æ“‡ï¼šå°‡ç•¶å‰å…ƒç´ åŠ å…¥è·¯å¾‘ currentPath.add(nums[i]); // Recursionæ¢ç´¢ï¼šç¹¼çºŒé¸æ“‡ä¸‹ä¸€å€‹å…ƒç´  backtrack(result, currentPath, nums, i + 1); // æ’¤éŠ·é¸æ“‡ï¼šç§»é™¤ç•¶å‰å…ƒç´ ï¼Œå›æº¯ currentPath.remove(currentPath.size() - 1); } } æ™‚é–“è¤‡é›œåº¦ï¼šO(2^n)ï¼Œå…¶ä¸­ n æ˜¯é™£åˆ—é•·åº¦ï¼Œå› ç‚ºæ¯å€‹å…ƒç´ éƒ½æœ‰é¸æˆ–ä¸é¸å…©ç¨®ç‹€æ…‹ã€‚\n2. å­é›†å•é¡Œ IIï¼ˆSubsets II - å«é‡è¤‡å…ƒç´ ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹å¯èƒ½åŒ…å«é‡è¤‡æ•´æ•¸çš„é™£åˆ— numsï¼Œå›å‚³è©²é™£åˆ—æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆä¸åŒ…å«é‡è¤‡çš„å­é›†ï¼‰ã€‚\nè§£é¡Œæ€è·¯ï¼š\nåŸºæ–¼å­é›†å•é¡Œçš„è§£æ³•ï¼Œä½†éœ€è¦è™•ç†é‡è¤‡å…ƒç´  å…ˆæ’åºé™£åˆ—ï¼Œè®“ç›¸åŒå…ƒç´ ç›¸é„° é€éè·³éé‡è¤‡å…ƒç´ ä¾†é¿å…ç”¢ç”Ÿé‡è¤‡çš„å­é›† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; subsetsWithDup(int[] nums) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); Arrays.sort(nums); // æ’åºæ˜¯é—œéµï¼Œè®“é‡è¤‡å…ƒç´ ç›¸é„° backtrack(result, new ArrayList\u0026lt;\u0026gt;(), nums, 0); return result; } private void backtrack(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result, List\u0026lt;Integer\u0026gt; currentPath, int[] nums, int startIndex) { // æ¯å€‹ç‹€æ…‹éƒ½æ˜¯ä¸€å€‹æœ‰æ•ˆçš„å­é›† result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); for (int i = startIndex; i \u0026lt; nums.length; i++) { // è·³éé‡è¤‡å…ƒç´ ï¼šç•¶å‰å…ƒç´ èˆ‡å‰ä¸€å€‹å…ƒç´ ç›¸åŒï¼Œä¸”ä¸æ˜¯èµ·å§‹ä½ç½® if (i \u0026gt; startIndex \u0026amp;\u0026amp; nums[i] == nums[i - 1]) { continue; // è·³éé‡è¤‡å…ƒç´ é¿å…ç”¢ç”Ÿé‡è¤‡å­é›† } // åšé¸æ“‡ currentPath.add(nums[i]); // Recursionæ¢ç´¢ backtrack(result, currentPath, nums, i + 1); // æ’¤éŠ·é¸æ“‡ currentPath.remove(currentPath.size() - 1); } } å»é‡é—œéµï¼ši \u0026gt; startIndex \u0026amp;\u0026amp; nums[i] == nums[i-1] é€™å€‹æ¢ä»¶ç¢ºä¿åœ¨åŒä¸€å±¤Recursionä¸­è·³éé‡è¤‡å…ƒç´ ã€‚\n3. å…¨æ’åˆ—ï¼ˆPermutationsï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹ä¸å«é‡è¤‡æ•¸å­—çš„é™£åˆ— numsï¼Œå›å‚³å…¶æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—ã€‚\nè§£é¡Œæ€è·¯ï¼š\nå…¨æ’åˆ—éœ€è¦ç”¨åˆ°é™£åˆ—ä¸­çš„æ¯ä¸€å€‹å…ƒç´ ï¼Œä¸”é †åºä¸åŒçµæœä¸åŒ ä½¿ç”¨ contains æª¢æŸ¥é¿å…é‡è¤‡ä½¿ç”¨åŒä¸€å€‹å…ƒç´  ç•¶è·¯å¾‘é•·åº¦ç­‰æ–¼é™£åˆ—é•·åº¦æ™‚ï¼Œæ‰¾åˆ°ä¸€å€‹å®Œæ•´çš„æ’åˆ— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; permute(int[] nums) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); backtrack(result, new ArrayList\u0026lt;\u0026gt;(), nums); return result; } private void backtrack(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result, List\u0026lt;Integer\u0026gt; currentPath, int[] nums) { // é”åˆ°ç›®æ¨™é•·åº¦ï¼Œæ‰¾åˆ°ä¸€å€‹å®Œæ•´çš„æ’åˆ— if (currentPath.size() == nums.length) { result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); return; } // å˜—è©¦æ·»åŠ æ¯ä¸€å€‹å…ƒç´  for (int i = 0; i \u0026lt; nums.length; i++) { // è·³éå·²ç¶“ä½¿ç”¨çš„å…ƒç´  if (currentPath.contains(nums[i])) { continue; // è©²å…ƒç´ å·²åœ¨ç•¶å‰è·¯å¾‘ä¸­ï¼Œè·³é } // åšé¸æ“‡ currentPath.add(nums[i]); // Recursionæ¢ç´¢ backtrack(result, currentPath, nums); // æ’¤éŠ·é¸æ“‡ currentPath.remove(currentPath.size() - 1); } } æ•ˆèƒ½å„ªåŒ–ï¼šä½¿ç”¨ boolean[] used é™£åˆ—å–ä»£ contains æ–¹æ³•å¯ä»¥æå‡æ•ˆèƒ½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 private void backtrackOptimized(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result, List\u0026lt;Integer\u0026gt; currentPath, int[] nums, boolean[] used) { if (currentPath.size() == nums.length) { result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); return; } for (int i = 0; i \u0026lt; nums.length; i++) { if (used[i]) continue; // O(1) æ™‚é–“æª¢æŸ¥ used[i] = true; currentPath.add(nums[i]); backtrackOptimized(result, currentPath, nums, used); currentPath.remove(currentPath.size() - 1); used[i] = false; } } æ™‚é–“è¤‡é›œåº¦ï¼šO(n Ã— n!)ï¼Œå…¶ä¸­ n! æ˜¯æ’åˆ—çš„æ•¸é‡ï¼Œn æ˜¯è¤‡è£½æ¯å€‹æ’åˆ—æ‰€éœ€çš„æ™‚é–“ã€‚\n4. å…¨æ’åˆ— IIï¼ˆPermutations II - å«é‡è¤‡å…ƒç´ ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹å¯åŒ…å«é‡è¤‡æ•¸å­—çš„åºåˆ— numsï¼ŒæŒ‰ä»»æ„é †åºå›å‚³æ‰€æœ‰ä¸é‡è¤‡çš„å…¨æ’åˆ—ã€‚\nè§£é¡Œæ€è·¯ï¼š\nåœ¨å…¨æ’åˆ—çš„åŸºç¤ä¸Šå¢åŠ å»é‡é‚è¼¯ å…ˆæ’åºè®“ç›¸åŒå…ƒç´ ç›¸é„° ä½¿ç”¨å‰ªææ¢ä»¶é¿å…ç”¢ç”Ÿé‡è¤‡çš„æ’åˆ— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 public List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; permuteUnique(int[] nums) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); Arrays.sort(nums); // æ’åºæ˜¯å»é‡çš„é—œéµ boolean[] used = new boolean[nums.length]; backtrack(result, new ArrayList\u0026lt;\u0026gt;(), nums, used); return result; } private void backtrack(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result, List\u0026lt;Integer\u0026gt; currentPath, int[] nums, boolean[] used) { // é”åˆ°ç›®æ¨™é•·åº¦ï¼Œæ‰¾åˆ°ä¸€å€‹å®Œæ•´çš„æ’åˆ— if (currentPath.size() == nums.length) { result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); return; } for (int i = 0; i \u0026lt; nums.length; i++) { // è·³éå·²ä½¿ç”¨çš„å…ƒç´  if (used[i]) continue; // å»é‡é—œéµï¼šè·³éé‡è¤‡å…ƒç´  // ç•¶å‰å…ƒç´ èˆ‡å‰ä¸€å€‹å…ƒç´ ç›¸åŒï¼Œä¸”å‰ä¸€å€‹å…ƒç´ æœªè¢«ä½¿ç”¨ if (i \u0026gt; 0 \u0026amp;\u0026amp; nums[i] == nums[i - 1] \u0026amp;\u0026amp; !used[i - 1]) { continue; } // åšé¸æ“‡ used[i] = true; currentPath.add(nums[i]); // Recursionæ¢ç´¢ backtrack(result, currentPath, nums, used); // æ’¤éŠ·é¸æ“‡ currentPath.remove(currentPath.size() - 1); used[i] = false; } } å»é‡åŸç†ï¼š!used[i-1] ç¢ºä¿åœ¨åŒä¸€å±¤Recursionä¸­ï¼Œç›¸åŒçš„å…ƒç´ åªæœƒè¢«é¸æ“‡ä¸€æ¬¡ï¼Œå¾è€Œé¿å…é‡è¤‡æ’åˆ—ã€‚\n5. çµ„åˆç¸½å’Œï¼ˆCombination Sum - å¯é‡è¤‡ä½¿ç”¨å…ƒç´ ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹ç„¡é‡è¤‡å…ƒç´ çš„é™£åˆ— candidates å’Œä¸€å€‹ç›®æ¨™æ•¸ targetï¼Œæ‰¾å‡ºæ‰€æœ‰ä½¿å…ƒç´ å’Œç‚º target çš„çµ„åˆã€‚åŒä¸€å€‹æ•¸å­—å¯ä»¥è¢«é‡è¤‡é¸æ“‡ã€‚\nè§£é¡Œæ€è·¯ï¼š\næ¯å€‹å…ƒç´ éƒ½å¯ä»¥è¢«ç„¡é™æ¬¡é‡è¤‡ä½¿ç”¨ ä½¿ç”¨ startIndex é¿å…ç”¢ç”Ÿé‡è¤‡çµ„åˆï¼ˆå¦‚ [2,3] å’Œ [3,2]ï¼‰ ç•¶å‰©é¤˜ç›®æ¨™å€¼ç‚º 0 æ™‚æ‰¾åˆ°ä¸€å€‹æœ‰æ•ˆçµ„åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 public List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; combinationSum(int[] candidates, int target) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); Arrays.sort(candidates); // æ’åºä¾¿æ–¼å‰ªæ backtrack(result, new ArrayList\u0026lt;\u0026gt;(), candidates, target, 0); return result; } private void backtrack(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result, List\u0026lt;Integer\u0026gt; currentPath, int[] candidates, int remainingTarget, int startIndex) { // å‰ªæï¼šå‰©é¤˜ç›®æ¨™å€¼å°æ–¼ 0ï¼Œç„¡æ•ˆè·¯å¾‘ if (remainingTarget \u0026lt; 0) { return; } // æ‰¾åˆ°ä¸€å€‹æœ‰æ•ˆçµ„åˆ if (remainingTarget == 0) { result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); return; } for (int i = startIndex; i \u0026lt; candidates.length; i++) { // å‰ªæå„ªåŒ–ï¼šå¦‚æœç•¶å‰å…ƒç´ å·²ç¶“å¤§æ–¼å‰©é¤˜ç›®æ¨™å€¼ï¼Œå¾Œé¢çš„å…ƒç´ ä¹Ÿæœƒæ›´å¤§ if (candidates[i] \u0026gt; remainingTarget) { break; } // åšé¸æ“‡ currentPath.add(candidates[i]); // Recursionæ¢ç´¢ï¼šæ³¨æ„é€™è£¡å‚³å…¥ i è€Œä¸æ˜¯ i+1ï¼Œå› ç‚ºå¯ä»¥é‡è¤‡ä½¿ç”¨åŒä¸€å…ƒç´  backtrack(result, currentPath, candidates, remainingTarget - candidates[i], i); // æ’¤éŠ·é¸æ“‡ currentPath.remove(currentPath.size() - 1); } } é—œéµé»ï¼š\nRecursionæ™‚å‚³å…¥ i è€Œé i+1ï¼Œå…è¨±é‡è¤‡ä½¿ç”¨ç•¶å‰å…ƒç´  æ’åºå¾Œå¯ä»¥é€²è¡Œå‰ªæå„ªåŒ–ï¼Œææ—©çµ‚æ­¢ç„¡æ•ˆåˆ†æ”¯ 6. çµ„åˆç¸½å’Œ IIï¼ˆCombination Sum II - å«é‡è¤‡å…ƒç´ ä½†ä¸å¯é‡è¤‡ä½¿ç”¨ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹é™£åˆ— candidates å’Œä¸€å€‹ç›®æ¨™æ•¸ targetï¼Œæ‰¾å‡ºæ‰€æœ‰ä½¿å…ƒç´ å’Œç‚º target çš„çµ„åˆã€‚é™£åˆ—ä¸­æ¯å€‹å…ƒç´ åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä½†é™£åˆ—ä¸­å¯èƒ½åŒ…å«é‡è¤‡å…ƒç´ ã€‚\nè§£é¡Œæ€è·¯ï¼š\næ¯å€‹å…ƒç´ åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œéœ€è¦è·³éé‡è¤‡å…ƒç´ é¿å…é‡è¤‡çµ„åˆ æ’åºå¾Œä½¿ç”¨å»é‡é‚è¼¯ Recursionæ™‚å‚³å…¥ i+1 ç¢ºä¿æ¯å€‹ä½ç½®çš„å…ƒç´ åªèƒ½ä½¿ç”¨ä¸€æ¬¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 public List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; combinationSum2(int[] candidates, int target) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); Arrays.sort(candidates); // æ’åºæ˜¯å»é‡çš„å‰æ backtrack(result, new ArrayList\u0026lt;\u0026gt;(), candidates, target, 0); return result; } private void backtrack(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; result, List\u0026lt;Integer\u0026gt; currentPath, int[] candidates, int remainingTarget, int startIndex) { // å‰ªæï¼šå‰©é¤˜ç›®æ¨™å€¼å°æ–¼ 0 if (remainingTarget \u0026lt; 0) { return; } // æ‰¾åˆ°ä¸€å€‹æœ‰æ•ˆçµ„åˆ if (remainingTarget == 0) { result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); return; } for (int i = startIndex; i \u0026lt; candidates.length; i++) { // è·³éé‡è¤‡å…ƒç´ ï¼šé¿å…åœ¨åŒä¸€å±¤Recursionä¸­ä½¿ç”¨ç›¸åŒçš„å…ƒç´  if (i \u0026gt; startIndex \u0026amp;\u0026amp; candidates[i] == candidates[i - 1]) { continue; // è·³éé‡è¤‡å…ƒç´  } // å‰ªæå„ªåŒ– if (candidates[i] \u0026gt; remainingTarget) { break; } // åšé¸æ“‡ currentPath.add(candidates[i]); // Recursionæ¢ç´¢ï¼šå‚³å…¥ i+1 ç¢ºä¿æ¯å€‹å…ƒç´ åªä½¿ç”¨ä¸€æ¬¡ backtrack(result, currentPath, candidates, remainingTarget - candidates[i], i + 1); // æ’¤éŠ·é¸æ“‡ currentPath.remove(currentPath.size() - 1); } } èˆ‡ Combination Sum çš„å·®ç•°ï¼š\nRecursionæ™‚å‚³å…¥ i+1 è€Œé iï¼Œæ¯å€‹å…ƒç´ åªèƒ½ä½¿ç”¨ä¸€æ¬¡ å¢åŠ å»é‡é‚è¼¯è™•ç†é™£åˆ—ä¸­çš„é‡è¤‡å…ƒç´  7. å›æ–‡å­—ä¸²åˆ†å‰²ï¼ˆPalindrome Partitioningï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šä¸€å€‹å­—ä¸² sï¼Œå°‡ s åˆ†å‰²æˆä¸€äº›å­å­—ä¸²ï¼Œä½¿å¾—æ¯å€‹å­å­—ä¸²éƒ½æ˜¯å›æ–‡å­—ä¸²ã€‚å›å‚³æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚\nè§£é¡Œæ€è·¯ï¼š\né€éå›æº¯æ³•å˜—è©¦æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²é» å°æ–¼æ¯å€‹åˆ†å‰²é»ï¼Œæª¢æŸ¥å­å­—ä¸²æ˜¯å¦ç‚ºå›æ–‡ åªæœ‰ç•¶å­å­—ä¸²æ˜¯å›æ–‡æ™‚ï¼Œæ‰ç¹¼çºŒRecursionåˆ†å‰² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 public List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; partition(String s) { List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); backtrack(result, new ArrayList\u0026lt;\u0026gt;(), s, 0); return result; } private void backtrack(List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; result, List\u0026lt;String\u0026gt; currentPath, String s, int startIndex) { // é”åˆ°å­—ä¸²çµå°¾ï¼Œæ‰¾åˆ°ä¸€å€‹å®Œæ•´çš„åˆ†å‰²æ–¹æ¡ˆ if (startIndex == s.length()) { result.add(new ArrayList\u0026lt;\u0026gt;(currentPath)); return; } // å˜—è©¦æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²é» for (int endIndex = startIndex; endIndex \u0026lt; s.length(); endIndex++) { // æª¢æŸ¥ç•¶å‰å­å­—ä¸²æ˜¯å¦ç‚ºå›æ–‡ if (isPalindrome(s, startIndex, endIndex)) { // åšé¸æ“‡ï¼šå°‡å›æ–‡å­å­—ä¸²åŠ å…¥è·¯å¾‘ currentPath.add(s.substring(startIndex, endIndex + 1)); // Recursionæ¢ç´¢ï¼šç¹¼çºŒåˆ†å‰²å‰©é¤˜éƒ¨åˆ† backtrack(result, currentPath, s, endIndex + 1); // æ’¤éŠ·é¸æ“‡ currentPath.remove(currentPath.size() - 1); } } } /** * æª¢æŸ¥å­—ä¸²çš„æŒ‡å®šç¯„åœæ˜¯å¦ç‚ºå›æ–‡ */ private boolean isPalindrome(String s, int left, int right) { while (left \u0026lt; right) { if (s.charAt(left) != s.charAt(right)) { return false; } left++; right--; } return true; } å„ªåŒ–æŠ€å·§ï¼šå¯ä»¥é è™•ç†å›æ–‡åˆ¤æ–·çµæœï¼Œä½¿ç”¨å‹•æ…‹è¦åŠƒå»ºç«‹å›æ–‡æŸ¥è©¢è¡¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // é è™•ç†å„ªåŒ–ç‰ˆæœ¬ private boolean[][] precomputePalindromes(String s) { int n = s.length(); boolean[][] isPalin = new boolean[n][n]; // å–®å€‹å­—å…ƒéƒ½æ˜¯å›æ–‡ for (int i = 0; i \u0026lt; n; i++) { isPalin[i][i] = true; } // æª¢æŸ¥é•·åº¦ç‚º 2 çš„å­å­—ä¸² for (int i = 0; i \u0026lt; n - 1; i++) { isPalin[i][i + 1] = (s.charAt(i) == s.charAt(i + 1)); } // æª¢æŸ¥é•·åº¦å¤§æ–¼ 2 çš„å­å­—ä¸² for (int len = 3; len \u0026lt;= n; len++) { for (int i = 0; i \u0026lt;= n - len; i++) { int j = i + len - 1; isPalin[i][j] = (s.charAt(i) == s.charAt(j)) \u0026amp;\u0026amp; isPalin[i + 1][j - 1]; } } return isPalin; } æœ€ä½³å¯¦è¸èˆ‡æŠ€å·§ 1. å‰ªæå„ªåŒ– ææ—©çµ‚æ­¢ï¼šç•¶ç™¼ç¾ç•¶å‰è·¯å¾‘ä¸å¯èƒ½ç”¢ç”Ÿæœ‰æ•ˆè§£æ™‚ï¼Œç«‹å³è¿”å› æ’åºå„ªåŒ–ï¼šå°è¼¸å…¥é€²è¡Œæ’åºï¼Œä¾¿æ–¼è·³éé‡è¤‡å…ƒç´ å’Œé€²è¡Œç¯„åœå‰ªæ é‚Šç•Œæª¢æŸ¥ï¼šåœ¨Recursionå‰æª¢æŸ¥é‚Šç•Œæ¢ä»¶ï¼Œé¿å…ç„¡æ•ˆRecursion 2. å»é‡æŠ€å·§ å›æº¯å•é¡Œä¸­çš„å»é‡é€šå¸¸æœ‰å…©ç¨®æƒ…æ³ï¼š\næ¨¹æå»é‡ï¼šé¿å…åœ¨åŒä¸€æ¢è·¯å¾‘ä¸Šé‡è¤‡ä½¿ç”¨åŒä¸€å€‹å…ƒç´  æ¨¹å±¤å»é‡ï¼šé¿å…åœ¨åŒä¸€å±¤Recursionä¸­ç”¢ç”Ÿé‡è¤‡çš„é¸æ“‡ 1 2 3 4 5 // æ¨¹å±¤å»é‡ï¼ˆé©ç”¨æ–¼æœ‰é‡è¤‡å…ƒç´ çš„çµ„åˆå•é¡Œï¼‰ if (i \u0026gt; startIndex \u0026amp;\u0026amp; nums[i] == nums[i-1]) continue; // æ¨¹æå»é‡ï¼ˆé©ç”¨æ–¼æ’åˆ—å•é¡Œï¼‰ if (i \u0026gt; 0 \u0026amp;\u0026amp; nums[i] == nums[i-1] \u0026amp;\u0026amp; !used[i-1]) continue; 3. æ•ˆèƒ½å„ªåŒ– ä½¿ç”¨ boolean[] å–ä»£ List.contains() é€²è¡Œå…ƒç´ æŸ¥æ‰¾ é è™•ç†è¨ˆç®—çµæœï¼ˆå¦‚å›æ–‡åˆ¤æ–·è¡¨ï¼‰ åˆç†é¸æ“‡è³‡æ–™çµæ§‹ï¼ˆå¦‚ä½¿ç”¨ StringBuilder è™•ç†å­—ä¸²ï¼‰ å¸¸è¦‹éŒ¯èª¤èˆ‡é™·é˜± å¿˜è¨˜æ’¤éŠ·é¸æ“‡ï¼šé€™æ˜¯å›æº¯æ¼”ç®—æ³•æœ€å¸¸è¦‹çš„éŒ¯èª¤ é‡è¤‡è§£è™•ç†ä¸ç•¶ï¼šæ²’æœ‰æ­£ç¢ºå¯¦ç¾å»é‡é‚è¼¯ é‚Šç•Œæ¢ä»¶éŒ¯èª¤ï¼šRecursionçµ‚æ­¢æ¢ä»¶è¨­ç½®ä¸æ­£ç¢º ç´¢å¼•ä½¿ç”¨éŒ¯èª¤ï¼šåœ¨çµ„åˆå’Œæ’åˆ—å•é¡Œä¸­æ··æ·† i å’Œ i+1 çš„ä½¿ç”¨ ç¸½çµ å›æº¯æ¼”ç®—æ³•æ˜¯è§£æ±ºçµ„åˆã€æ’åˆ—ã€åˆ†å‰²ç­‰å•é¡Œçš„é‡è¦å·¥å…·ã€‚æŒæ¡ä»¥ä¸‹è¦é»ï¼š\nç†è§£æ¨¡æ¿ï¼šChoose â†’ Explore â†’ Un-choose ä¸‰æ­¥é©Ÿ è­˜åˆ¥å•é¡Œé¡å‹ï¼šå­é›†ã€æ’åˆ—ã€çµ„åˆã€åˆ†å‰²ç­‰ä¸åŒé¡å‹æœ‰ä¸åŒçš„è™•ç†æ–¹å¼ æŒæ¡å»é‡æŠ€å·§ï¼šæ¨¹å±¤å»é‡å’Œæ¨¹æå»é‡çš„å€åˆ¥å’Œæ‡‰ç”¨ å–„ç”¨å‰ªæï¼šé€éå‰ªæå¤§å¹…æå‡æ¼”ç®—æ³•æ•ˆèƒ½ ç´°å¿ƒå¯¦ä½œï¼šæ³¨æ„é‚Šç•Œæ¢ä»¶å’Œç´¢å¼•ä½¿ç”¨ é€éå¤§é‡ç·´ç¿’å’Œç†è§£é€™äº›ç¶“å…¸é¡Œå‹ï¼Œèƒ½å¤ å¹«åŠ©æˆ‘å€‘æ›´å¥½åœ°æŒæ¡å›æº¯æ¼”ç®—æ³•çš„ç²¾é«“ã€‚\n","permalink":"https://xinqilin.github.io/post/algorithm/backtracking/","tags":["Algorithm","Backtracking","Recursion"],"title":"å›æº¯æ¼”ç®—æ³•ï¼ˆBacktrackingï¼‰å®Œæ•´æŒ‡å—"},{"content":"Rigidity, é›£ä»¥è®Šæ›´ ä»»ä½•è®Šæ›´, éƒ½éœ€è¦å»æ”¹å…¶ä»–çš„æ±è¥¿, é€ æˆä¸€å€‹å°å°çš„éœ€æ±‚å°±è¦å»æ›´æ”¹å¦å€‹å¾ˆå¤§çš„æ±è¥¿\nFragility, å®¹æ˜“å£æ‰ ä»»ä½•è®Šæ›´éƒ½æœƒå°è‡´å…¶ä»–æœ‰ç›¸ä¾æˆ–ç„¡ç›¸ä¾çš„æ±è¥¿è¶…å‡ºæƒ³è±¡çš„ç ´å£, æ”¹ä¸€å€‹å°æ±è¥¿, çµæœå…¶ä»–é‡è¦çš„æ±è¥¿å£æ‰\nImmobility, é›£ä»¥è¤‡ç”¨ ç³»çµ±ä¸­ç›¸ä¾æƒ…æ³åš´é‡, é€ æˆæƒ³è¦ç§»å‡ºcode å¯«æˆ function çš„æˆæœ¬ é«˜æ–¼æ‰“æ‰é‡å¯«çš„æˆæœ¬\nViscosity, é›£ä»¥æ­£ç¢ºä¿®æ”¹ ç³»çµ±è®Šæ›´æ™‚, å› æˆæœ¬è€ƒé‡å¤§å¤šæœƒä»¥ æ²»æ¨™ä¸æ²»æœ¬çš„æ–¹å¼æ”¹å®Œéœ€æ±‚,è€Œéå¾æºé ­è™•ä¿®æ”¹\n","permalink":"https://xinqilin.github.io/post/architecture/badsmell/","tags":[],"title":"BadSmell"},{"content":"GitHub SSH Setting 1 2 3 4 5 6 7 8 9 10 11 12 cd ~/ mkdir .ssh ssh-keygen -t ed25519 -C \u0026#34;your_email@example.com\u0026#34; (æ˜¯å¦è¦ç”¨é è¨­æª”å) enter \u0026gt;\u0026gt; (å¯†ç¢¼) enter \u0026gt;\u0026gt; (å¯†ç¢¼ç¢ºèª) enter cat .ssh/id_ed25519.pub \u0026gt;\u0026gt; è·‘å‡ºå…¬é‘° è²¼åˆ° github ä¸Š ssh -T git@github.com \u0026gt;\u0026gt; æ¸¬è©¦é€£ç·š \u0026gt;\u0026gt; \u0026#34;Hi xinqilin! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access.\u0026#34; é‡è¨­ remote url =\u0026gt; https æ”¹ ssh 1 2 git remote rm origin git remote add origin [url] æ‡‰ç”¨ç¨‹å¼è¦ç”¨çš„ token setting -\u0026gt; developer setting -\u0026gt; personal access token -\u0026gt; generate new token\nGitHub æ•™å­¸ ","permalink":"https://xinqilin.github.io/post/tools/github-ssh/","tags":[],"title":"Github Ssh"},{"content":"æ¦‚è¿° åœ¨ç¾ä»£é–‹ç™¼æµç¨‹ä¸­ï¼Œä½¿ç”¨ Docker éƒ¨ç½²è³‡æ–™åº«å·²æˆç‚ºä¸»æµã€‚å°‡ MySQL é‹è¡Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œå¯ä»¥å¸¶ä¾†è¨±å¤šå¥½è™•ï¼šç’°å¢ƒéš”é›¢ã€å¿«é€Ÿéƒ¨ç½²ã€ç‰ˆæœ¬æ§åˆ¶ã€ä»¥åŠæ–¹ä¾¿çš„é·ç§»ã€‚é€™ç¯‡æ–‡ç« å°‡å¼•å°æ‚¨å¦‚ä½•åœ¨ Docker ä¸­è¨­å®šå’Œç®¡ç† MySQL å®¹å™¨ã€‚\nå•Ÿå‹• MySQL å®¹å™¨ ä½¿ç”¨ docker run æŒ‡ä»¤å¯ä»¥å¿«é€Ÿå•Ÿå‹•ä¸€å€‹ MySQL å®¹å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹å¸¸ç”¨çš„ç¯„ä¾‹ï¼ŒåŒ…å«äº†å¯†ç¢¼è¨­å®šã€åŸ æ˜ å°„å’Œå­—å…ƒé›†è¨­å®šã€‚\n1 2 3 4 5 6 7 8 9 docker run \\ --name mysql-server \\ -e MYSQL_ROOT_PASSWORD=your_strong_password \\ -p 3306:3306 \\ -d \\ mysql/mysql-server \\ --character-set-server=utf8mb4 \\ --collation-server=utf8mb4_unicode_ci \\ --skip-character-set-client-handshake æŒ‡ä»¤åƒæ•¸èªªæ˜ --name mysql-server: ç‚ºå®¹å™¨æŒ‡å®šä¸€å€‹æ˜“æ–¼è­˜åˆ¥çš„åç¨±ï¼Œé€™è£¡å‘½åç‚º mysql-serverã€‚ -e MYSQL_ROOT_PASSWORD=your_strong_password: è¨­å®š MySQL root ä½¿ç”¨è€…çš„å¯†ç¢¼ã€‚è«‹å‹™å¿…å°‡ your_strong_password æ›¿æ›ç‚ºæ‚¨è‡ªå·±çš„å¼·å¯†ç¢¼ã€‚ -p 3306:3306: å°‡ä¸»æ©Ÿçš„ 3306 åŸ æ˜ å°„åˆ°å®¹å™¨çš„ 3306 åŸ ã€‚é€™æ¨£æ‚¨å°±å¯ä»¥å¾ä¸»æ©Ÿé€é 3306 åŸ é€£æ¥åˆ°å®¹å™¨å…§çš„ MySQL æœå‹™ã€‚ -d: ä»¥èƒŒæ™¯æ¨¡å¼ (detached mode) é‹è¡Œå®¹å™¨ï¼Œè®“å®¹å™¨åœ¨èƒŒæ™¯åŸ·è¡Œã€‚ mysql/mysql-server: æŒ‡å®šè¦ä½¿ç”¨çš„ Docker æ˜ åƒæª”ã€‚mysql/mysql-server æ˜¯ MySQL å®˜æ–¹æä¾›çš„æ˜ åƒæª”ã€‚ --character-set-server=utf8mb4: è¨­å®š MySQL ä¼ºæœå™¨çš„é è¨­å­—å…ƒé›†ç‚º utf8mb4ï¼Œä»¥æ”¯æ´æ›´å»£æ³›çš„å­—å…ƒï¼ŒåŒ…æ‹¬è¡¨æƒ…ç¬¦è™Ÿã€‚ --collation-server=utf8mb4_unicode_ci: è¨­å®šä¼ºæœå™¨çš„é è¨­æ’åºè¦å‰‡ç‚º utf8mb4_unicode_ciï¼Œé€™æ˜¯ä¸€ç¨®ä¸å€åˆ†å¤§å°å¯«å’Œé‡éŸ³çš„æ’åºè¦å‰‡ã€‚ --skip-character-set-client-handshake: ç¦ç”¨å®¢æˆ¶ç«¯å­—å…ƒé›†æ¡æ‰‹ã€‚é€™æœ‰åŠ©æ–¼ç¢ºä¿å®¢æˆ¶ç«¯å’Œä¼ºæœå™¨ä¹‹é–“çš„å­—å…ƒé›†ä¸€è‡´æ€§ï¼Œé¿å…äº‚ç¢¼å•é¡Œã€‚ å­—å…ƒé›†è¨­å®šçš„ç­‰æ•ˆé…ç½® ä¸Šè¿°å­—å…ƒé›†ç›¸é—œçš„ docker run åƒæ•¸ï¼Œåœ¨ MySQL çš„é…ç½®æª” (my.cnf) ä¸­ï¼Œç­‰æ•ˆæ–¼ä»¥ä¸‹è¨­å®šï¼š\n1 2 3 4 5 6 7 8 9 [client] default-character-set=utf8mb4 [mysql] default-character-set=utf8mb4 [mysqld] collation-server = utf8mb4_unicode_ci character-set-server = utf8mb4 è³‡æ–™æŒä¹…åŒ– (Data Persistence) å°æ–¼è³‡æ–™åº«å®¹å™¨ï¼Œè³‡æ–™æŒä¹…åŒ–æ˜¯è‡³é—œé‡è¦çš„ã€‚å¦‚æœæ²’æœ‰å°‡è³‡æ–™å„²å­˜åˆ°ä¸»æ©Ÿä¸Šï¼Œä¸€æ—¦å®¹å™¨è¢«ç§»é™¤ï¼Œæ‰€æœ‰è³‡æ–™éƒ½å°‡ä¸Ÿå¤±ã€‚Docker æä¾›äº†å…©ç¨®ä¸»è¦æ–¹å¼ä¾†å¯¦ç¾è³‡æ–™æŒä¹…åŒ–ï¼šç¶å®šæ›è¼‰ (Bind Mounts) å’Œ å…·åå„²å­˜å· (Named Volumes)ã€‚\nä½¿ç”¨å…·åå„²å­˜å· (æ¨è–¦) å…·åå„²å­˜å·ç”± Docker ç®¡ç†ï¼Œæ˜¯æŒä¹…åŒ–è³‡æ–™çš„æœ€ä½³æ–¹å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 docker run \\ --name mysql-server \\ -e MYSQL_ROOT_PASSWORD=your_strong_password \\ -p 3306:3306 \\ -d \\ -v mysql_data:/var/lib/mysql \\ mysql/mysql-server \\ --character-set-server=utf8mb4 \\ --collation-server=utf8mb4_unicode_ci \\ --skip-character-set-client-handshake -v mysql_data:/var/lib/mysql: é€™è£¡ mysql_data æ˜¯ä¸€å€‹å…·åå„²å­˜å·ã€‚Docker æœƒè‡ªå‹•å‰µå»ºä¸¦ç®¡ç†é€™å€‹å„²å­˜å·ï¼Œå°‡å®¹å™¨å…§ /var/lib/mysql (MySQL è³‡æ–™é è¨­å„²å­˜è·¯å¾‘) çš„è³‡æ–™æŒä¹…åŒ–åˆ°é€™å€‹å„²å­˜å·ä¸­ã€‚ æ‚¨å¯ä»¥é€é docker volume ls æŸ¥çœ‹æ‰€æœ‰å…·åå„²å­˜å·ï¼Œä¸¦é€é docker volume inspect mysql_data æŸ¥çœ‹å…¶è©³ç´°è³‡è¨Šã€‚\nä½¿ç”¨ç¶å®šæ›è¼‰ ç¶å®šæ›è¼‰å…è¨±æ‚¨å°‡ä¸»æ©Ÿä¸Šçš„ä»»æ„ç›®éŒ„ç›´æ¥æ›è¼‰åˆ°å®¹å™¨ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 docker run \\ --name mysql-server \\ -e MYSQL_ROOT_PASSWORD=your_strong_password \\ -p 3306:3306 \\ -d \\ -v /path/to/your/mysql_data:/var/lib/mysql \\ mysql/mysql-server \\ --character-set-server=utf8mb4 \\ --collation-server=utf8mb4_unicode_ci \\ --skip-character-set-client-handshake -v /path/to/your/mysql_data:/var/lib/mysql: å°‡ä¸»æ©Ÿä¸Šçš„ /path/to/your/mysql_data ç›®éŒ„æ›è¼‰åˆ°å®¹å™¨å…§çš„ /var/lib/mysqlã€‚è«‹å°‡ /path/to/your/mysql_data æ›¿æ›ç‚ºæ‚¨ä¸»æ©Ÿä¸Šçš„å¯¦éš›è·¯å¾‘ã€‚ é€£æ¥åˆ° MySQL å®¹å™¨ ä¸€æ—¦ MySQL å®¹å™¨é‹è¡Œèµ·ä¾†ï¼Œæ‚¨æœ‰å¤šç¨®æ–¹å¼å¯ä»¥é€£æ¥åˆ°å®ƒã€‚\nå¾ä¸»æ©Ÿé€£æ¥ å¦‚æœæ‚¨çš„ä¸»æ©Ÿä¸Šå®‰è£äº† MySQL å®¢æˆ¶ç«¯ï¼Œå¯ä»¥ç›´æ¥é€é localhost å’Œæ˜ å°„çš„åŸ é€£æ¥ï¼š\n1 mysql -h 127.0.0.1 -P 3306 -u root -p ç„¶å¾Œè¼¸å…¥æ‚¨åœ¨ docker run æŒ‡ä»¤ä¸­è¨­å®šçš„ MYSQL_ROOT_PASSWORDã€‚\né€²å…¥å®¹å™¨å…§éƒ¨é€£æ¥ æ‚¨å¯ä»¥ä½¿ç”¨ docker exec æŒ‡ä»¤é€²å…¥é‹è¡Œä¸­çš„å®¹å™¨ï¼Œç„¶å¾Œåœ¨å®¹å™¨å…§éƒ¨ä½¿ç”¨ MySQL å®¢æˆ¶ç«¯ï¼š\n1 2 3 4 5 # é€²å…¥å®¹å™¨çš„ bash shell docker exec -it mysql-server /bin/bash # åœ¨å®¹å™¨å…§éƒ¨åŸ·è¡Œ MySQL å®¢æˆ¶ç«¯ mysql -u root -p ç„¶å¾Œè¼¸å…¥å¯†ç¢¼ã€‚\næœ€ä½³å¯¦è¸èˆ‡è€ƒé‡ å¯†ç¢¼å®‰å…¨ï¼šåœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œè«‹å‹¿å°‡å¯†ç¢¼ç›´æ¥å¯«åœ¨ docker run æŒ‡ä»¤ä¸­ã€‚è€ƒæ…®ä½¿ç”¨ Docker Secrets æˆ–ç’°å¢ƒè®Šæ•¸æª”æ¡ˆ (.env) ä¾†ç®¡ç†æ•æ„Ÿè³‡è¨Šã€‚ è³‡æºé™åˆ¶ï¼šå°æ–¼ç”Ÿç”¢ç’°å¢ƒï¼Œå»ºè­°ç‚º MySQL å®¹å™¨è¨­å®š CPU å’Œè¨˜æ†¶é«”é™åˆ¶ï¼Œä»¥é¿å…å…¶ä½”ç”¨éå¤šä¸»æ©Ÿè³‡æºã€‚ æ—¥èªŒç®¡ç†ï¼šç›£æ§ MySQL å®¹å™¨çš„æ—¥èªŒ (docker logs mysql-server) å°æ–¼æ•…éšœæ’é™¤éå¸¸é‡è¦ã€‚ Docker Composeï¼šå°æ–¼å¤šæœå‹™æ‡‰ç”¨ç¨‹å¼ï¼Œå¼·çƒˆå»ºè­°ä½¿ç”¨ Docker Compose ä¾†å®šç¾©å’Œç®¡ç† MySQL æœå‹™ï¼Œé€™æœƒè®“æ•´å€‹æ‡‰ç”¨ç¨‹å¼çš„éƒ¨ç½²å’Œç®¡ç†æ›´åŠ ä¾¿æ·ã€‚ é€é Docker å®¹å™¨åŒ–éƒ¨ç½² MySQLï¼Œæ‚¨å¯ä»¥æ›´é«˜æ•ˆã€æ›´éˆæ´»åœ°ç®¡ç†æ‚¨çš„è³‡æ–™åº«ç’°å¢ƒã€‚\n","permalink":"https://xinqilin.github.io/post/devops/docker-mysql/","tags":["Docker","MySQL","DevOps","Database","Containerization"],"title":"Docker MySQLï¼šå®¹å™¨åŒ–éƒ¨ç½²èˆ‡è¨­å®š"},{"content":"Basic u: All Users +: add permission x: execute chmod u+x *.sh\nHomebrew /usr/bin/ruby -e \u0026quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\u0026quot; brew install cask brew install wget\nSDKMAN curl -s \u0026quot;https://get.sdkman.io\u0026quot; | bash source \u0026quot;$HOME/.sdkman/bin/sdkman-init.sh\u0026quot;\nOPENJDK /Library/Java/JavaVirtualMachines/ ä¸‹é¢ /usr/libexec/java_home --verbose\nremove\n1 2 cd /Library/Java/JavaVirtualMachines/ sudo rm -rf amazon-corretto-11.jdk MAVEN \u0026amp; GRADLE 1 2 3 4 5 6 7 8 9 10 sdk list java sdk current java sdk list java sdk list gradle sdk install gradle \u0026#39;version\u0026#39; sdk list maven sdk list java history| grep sdk sdk list maven sdk install maven \u0026#39;version\u0026#39; NVM curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash\nCheatSheet Fig brew install --cask fig\nleave end of file to change userName 1 2 3 4 5 prompt_context() { if [[ \u0026#34;$USER\u0026#34; != \u0026#34;$DEFAULT_USER\u0026#34; || -n \u0026#34;$SSH_CLIENT\u0026#34; ]]; then prompt_segment black default \u0026#34;%(!.%{%F{yellow}%}.)Bill\u0026#34; fi } zsh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 # Fig pre block. Keep at the top of this file. [[ -f \u0026#34;$HOME/.fig/shell/zshrc.pre.zsh\u0026#34; ]] \u0026amp;\u0026amp; builtin source \u0026#34;$HOME/.fig/shell/zshrc.pre.zsh\u0026#34; # Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc. # Initialization code that may require console input (password prompts, [y/n] # confirmations, etc.) must go above this block; everything else may go below. if [[ -r \u0026#34;${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh\u0026#34; ]]; then source \u0026#34;${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh\u0026#34; fi # æ‡¶äººæŒ‡ä»¤ alias hist=\u0026#39;history\u0026#39; alias d=\u0026#39;docker\u0026#39; alias gs=\u0026#39;git status\u0026#39; alias g=\u0026#39;git\u0026#39; # JDK # JAVA_HOME=/Library/Java/JavaVirtualMachines/amazon-corretto-11.jdk/Contents/Home JAVA_HOME=/Library/Java/JavaVirtualMachines/amazon-corretto-17.jdk/Contents/Home # JAVA_HOME=/Library/Java/JavaVirtualMachines/graalvm-ce-lts-java11-20.3.4/Contents/Home # JAVA_HOME=/Library/Java/JavaVirtualMachines/graalvm-ce-java17-22.1.0/Contents/Home PATH=$JAVA_HOME/bin:$PATH:. CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:. export JAVA_HOME export PATH export CLASSPATH #THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!! export SDKMAN_DIR=\u0026#34;$HOME/.sdkman\u0026#34; [[ -s \u0026#34;$HOME/.sdkman/bin/sdkman-init.sh\u0026#34; ]] \u0026amp;\u0026amp; source \u0026#34;$HOME/.sdkman/bin/sdkman-init.sh\u0026#34; # homebrew # x86_64 version brew path # é€™é‚ŠæœƒæŠŠèˆŠç‰ˆæœ¬å–ç‚º brow (o for old) export PATH=/opt/homebrew/bin:$PATH alias brow=\u0026#39;arch --x86_64 /usr/local/Homebrew/bin/brew\u0026#39; # nvm export NVM_DIR=\u0026#34;$([ -z \u0026#34;${XDG_CONFIG_HOME-}\u0026#34; ] \u0026amp;\u0026amp; printf %s \u0026#34;${HOME}/.nvm\u0026#34; || printf %s \u0026#34;${XDG_CONFIG_HOME}/nvm\u0026#34;)\u0026#34; [ -s \u0026#34;$NVM_DIR/nvm.sh\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/nvm.sh\u0026#34; # This loads nvm # If you come from bash you might have to change your $PATH. # export PATH=$HOME/bin:/usr/local/bin:$PATH # Path to your oh-my-zsh installation. export ZSH=\u0026#34;$HOME/.oh-my-zsh\u0026#34; # Set name of the theme to load --- if set to \u0026#34;random\u0026#34;, it will # load a random theme each time oh-my-zsh is loaded, in which case, # to know which specific one was loaded, run: echo $RANDOM_THEME # See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes ZSH_THEME=\u0026#34;agnoster\u0026#34; # ZSH_THEME=\u0026#34;powerlevel10k/powerlevel10k\u0026#34; # Set list of themes to pick from when loading at random # Setting this variable when ZSH_THEME=random will cause zsh to load # a theme from this variable instead of looking in $ZSH/themes/ # If set to an empty array, this variable will have no effect. # ZSH_THEME_RANDOM_CANDIDATES=( \u0026#34;robbyrussell\u0026#34; \u0026#34;agnoster\u0026#34; ) # Uncomment the following line to use case-sensitive completion. # CASE_SENSITIVE=\u0026#34;true\u0026#34; # Uncomment the following line to use hyphen-insensitive completion. # Case-sensitive completion must be off. _ and - will be interchangeable. # HYPHEN_INSENSITIVE=\u0026#34;true\u0026#34; # Uncomment one of the following lines to change the auto-update behavior # zstyle \u0026#39;:omz:update\u0026#39; mode disabled # disable automatic updates # zstyle \u0026#39;:omz:update\u0026#39; mode auto # update automatically without asking # zstyle \u0026#39;:omz:update\u0026#39; mode reminder # just remind me to update when it\u0026#39;s time # Uncomment the following line to change how often to auto-update (in days). # zstyle \u0026#39;:omz:update\u0026#39; frequency 13 # Uncomment the following line if pasting URLs and other text is messed up. # DISABLE_MAGIC_FUNCTIONS=\u0026#34;true\u0026#34; # Uncomment the following line to disable colors in ls. # DISABLE_LS_COLORS=\u0026#34;true\u0026#34; # Uncomment the following line to disable auto-setting terminal title. # DISABLE_AUTO_TITLE=\u0026#34;true\u0026#34; # Uncomment the following line to enable command auto-correction. # ENABLE_CORRECTION=\u0026#34;true\u0026#34; # Uncomment the following line to display red dots whilst waiting for completion. # You can also set it to another string to have that shown instead of the default red dots. # e.g. COMPLETION_WAITING_DOTS=\u0026#34;%F{yellow}waiting...%f\u0026#34; # Caution: this setting can cause issues with multiline prompts in zsh \u0026lt; 5.7.1 (see #5765) # COMPLETION_WAITING_DOTS=\u0026#34;true\u0026#34; # Uncomment the following line if you want to disable marking untracked files # under VCS as dirty. This makes repository status check for large repositories # much, much faster. # DISABLE_UNTRACKED_FILES_DIRTY=\u0026#34;true\u0026#34; # Uncomment the following line if you want to change the command execution time # stamp shown in the history command output. # You can set one of the optional three formats: # \u0026#34;mm/dd/yyyy\u0026#34;|\u0026#34;dd.mm.yyyy\u0026#34;|\u0026#34;yyyy-mm-dd\u0026#34; # or set a custom format using the strftime function format specifications, # see \u0026#39;man strftime\u0026#39; for details. # HIST_STAMPS=\u0026#34;mm/dd/yyyy\u0026#34; # Would you like to use another custom folder than $ZSH/custom? # ZSH_CUSTOM=/path/to/new-custom-folder # Which plugins would you like to load? # Standard plugins can be found in $ZSH/plugins/ # Custom plugins may be added to $ZSH_CUSTOM/plugins/ # Example format: plugins=(rails git textmate ruby lighthouse) # Add wisely, as too many plugins slow down shell startup. plugins=(git) source $ZSH/oh-my-zsh.sh # User configuration # export MANPATH=\u0026#34;/usr/local/man:$MANPATH\u0026#34; # You may need to manually set your language environment # export LANG=en_US.UTF-8 # Preferred editor for local and remote sessions # if [[ -n $SSH_CONNECTION ]]; then # export EDITOR=\u0026#39;vim\u0026#39; # else # export EDITOR=\u0026#39;mvim\u0026#39; # fi # Compilation flags # export ARCHFLAGS=\u0026#34;-arch x86_64\u0026#34; # Set personal aliases, overriding those provided by oh-my-zsh libs, # plugins, and themes. Aliases can be placed here, though oh-my-zsh # users are encouraged to define aliases within the ZSH_CUSTOM folder. # For a full list of active aliases, run `alias`. # # Example aliases # alias zshconfig=\u0026#34;mate ~/.zshrc\u0026#34; # alias ohmyzsh=\u0026#34;mate ~/.oh-my-zsh\u0026#34; code () { VSCODE_CWD=\u0026#34;$PWD\u0026#34; open -n -b \u0026#34;com.microsoft.VSCode\u0026#34; --args $* ;} plugins=( git zsh-syntax-highlighting zsh-autosuggestions ) # To customize prompt, run `p10k configure` or edit ~/.p10k.zsh. [[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh # é€™è¡Œæ§åˆ¶ userName prompt_context() { if [[ \u0026#34;$USER\u0026#34; != \u0026#34;$DEFAULT_USER\u0026#34; || -n \u0026#34;$SSH_CLIENT\u0026#34; ]]; then prompt_segment black default \u0026#34;%(!.%{%F{yellow}%}.)Bill\u0026#34; fi } # Fig post block. Keep at the bottom of this file. [[ -f \u0026#34;$HOME/.fig/shell/zshrc.post.zsh\u0026#34; ]] \u0026amp;\u0026amp; builtin source \u0026#34;$HOME/.fig/shell/zshrc.post.zsh\u0026#34; ","permalink":"https://xinqilin.github.io/post/tools/env/","tags":[],"title":"Env"},{"content":"æ¦‚è¿° æ‹“æ’²æ’åºï¼ˆTopological Sortï¼‰æ˜¯å°**æœ‰å‘ç„¡ç’°åœ–ï¼ˆDAG, Directed Acyclic Graphï¼‰**é€²è¡Œæ’åºçš„æ¼”ç®—æ³•ã€‚æ’åºçµæœæ˜¯ä¸€å€‹ç·šæ€§åºåˆ—ï¼Œä½¿å¾—å°æ–¼åœ–ä¸­ä»»æ„æœ‰å‘é‚Š (u, v)ï¼Œåœ¨æ’åºçµæœä¸­ u éƒ½å‡ºç¾åœ¨ v ä¹‹å‰ã€‚\nåŸºæœ¬æ¦‚å¿µ æ‡‰ç”¨å ´æ™¯ èª²ç¨‹æ’èª²ï¼šæŸäº›èª²ç¨‹æœ‰å…ˆä¿®èª²ç¨‹çš„è¦æ±‚ ç·¨è­¯ä¾è³´ï¼šç¨‹å¼æ¨¡çµ„é–“çš„ç·¨è­¯é †åº ä»»å‹™èª¿åº¦ï¼šæœ‰ä¾è³´é—œä¿‚çš„ä»»å‹™åŸ·è¡Œé †åº Makefile å»ºæ§‹ï¼šæª”æ¡ˆé–“çš„ä¾è³´é—œä¿‚ å‰ææ¢ä»¶ åœ–å¿…é ˆæ˜¯æœ‰å‘ç„¡ç’°åœ–ï¼ˆDAGï¼‰ å¦‚æœåœ–ä¸­å­˜åœ¨ç’°ï¼Œå‰‡ç„¡æ³•é€²è¡Œæ‹“æ’²æ’åº æ¼”ç®—æ³•å¯¦ä½œ æ–¹æ³•ä¸€ï¼šKahn æ¼”ç®—æ³•ï¼ˆBFS åŸºç¤ï¼‰ åŸºæœ¬æ€è·¯ è¨ˆç®—æ‰€æœ‰ç¯€é»çš„å…¥åº¦ å°‡å…¥åº¦ç‚º 0 çš„ç¯€é»åŠ å…¥ä½‡åˆ— ä¸æ–·å¾ä½‡åˆ—ä¸­å–å‡ºç¯€é»ï¼Œä¸¦æ¸›å°‘å…¶ç›¸é„°ç¯€é»çš„å…¥åº¦ å¦‚æœç›¸é„°ç¯€é»çš„å…¥åº¦è®Šç‚º 0ï¼Œå‰‡åŠ å…¥ä½‡åˆ— é‡è¤‡ç›´åˆ°ä½‡åˆ—ç‚ºç©º å¯¦ä½œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 public class TopologicalSort { public List\u0026lt;Integer\u0026gt; topologicalSort(int numNodes, List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; edges) { // å»ºç«‹é„°æ¥è¡¨å’Œå…¥åº¦é™£åˆ— List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; graph = new ArrayList\u0026lt;\u0026gt;(); int[] indegree = new int[numNodes]; for (int i = 0; i \u0026lt; numNodes; i++) { graph.add(new ArrayList\u0026lt;\u0026gt;()); } // å»ºæ§‹åœ–ä¸¦è¨ˆç®—å…¥åº¦ for (List\u0026lt;Integer\u0026gt; edge : edges) { int from = edge.get(0); int to = edge.get(1); graph.get(from).add(to); indegree[to]++; } // å°‡å…¥åº¦ç‚º 0 çš„ç¯€é»åŠ å…¥ä½‡åˆ— Queue\u0026lt;Integer\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; numNodes; i++) { if (indegree[i] == 0) { queue.offer(i); } } List\u0026lt;Integer\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); // BFS è™•ç† while (!queue.isEmpty()) { int node = queue.poll(); result.add(node); // æ¸›å°‘ç›¸é„°ç¯€é»çš„å…¥åº¦ for (int neighbor : graph.get(node)) { indegree[neighbor]--; if (indegree[neighbor] == 0) { queue.offer(neighbor); } } } // æª¢æŸ¥æ˜¯å¦å­˜åœ¨ç’° if (result.size() != numNodes) { return new ArrayList\u0026lt;\u0026gt;(); // å­˜åœ¨ç’°ï¼Œç„¡æ³•æ‹“æ’²æ’åº } return result; } } æ–¹æ³•äºŒï¼šDFS åŸºç¤ åŸºæœ¬æ€è·¯ å°æ¯å€‹æœªè¨ªå•çš„ç¯€é»é€²è¡Œ DFS åœ¨ DFS å›æº¯æ™‚å°‡ç¯€é»åŠ å…¥çµæœ åè½‰çµæœå¾—åˆ°æ‹“æ’²æ’åº å¯¦ä½œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 public class TopologicalSortDFS { private static final int WHITE = 0; // æœªè¨ªå• private static final int GRAY = 1; // æ­£åœ¨è¨ªå• private static final int BLACK = 2; // å·²å®Œæˆ public List\u0026lt;Integer\u0026gt; topologicalSort(int numNodes, List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; edges) { // å»ºç«‹é„°æ¥è¡¨ List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; graph = new ArrayList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; numNodes; i++) { graph.add(new ArrayList\u0026lt;\u0026gt;()); } for (List\u0026lt;Integer\u0026gt; edge : edges) { graph.get(edge.get(0)).add(edge.get(1)); } int[] color = new int[numNodes]; Stack\u0026lt;Integer\u0026gt; stack = new Stack\u0026lt;\u0026gt;(); // å°æ¯å€‹æœªè¨ªå•çš„ç¯€é»é€²è¡Œ DFS for (int i = 0; i \u0026lt; numNodes; i++) { if (color[i] == WHITE) { if (!dfs(graph, i, color, stack)) { return new ArrayList\u0026lt;\u0026gt;(); // å­˜åœ¨ç’° } } } // åè½‰çµæœ List\u0026lt;Integer\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); while (!stack.isEmpty()) { result.add(stack.pop()); } return result; } private boolean dfs(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; graph, int node, int[] color, Stack\u0026lt;Integer\u0026gt; stack) { color[node] = GRAY; // æ¨™è¨˜ç‚ºæ­£åœ¨è¨ªå• for (int neighbor : graph.get(node)) { if (color[neighbor] == GRAY) { return false; // ç™¼ç¾å¾Œå‘é‚Šï¼Œå­˜åœ¨ç’° } if (color[neighbor] == WHITE \u0026amp;\u0026amp; !dfs(graph, neighbor, color, stack)) { return false; } } color[node] = BLACK; // æ¨™è¨˜ç‚ºå·²å®Œæˆ stack.push(node); // å¾Œåºéæ­·é †åº return true; } } å¯¦éš›æ‡‰ç”¨é¡Œå‹ 1. èª²ç¨‹å®‰æ’ï¼ˆLeetCode 207 \u0026amp; 210ï¼‰ å•é¡Œ 207ï¼šåˆ¤æ–·æ˜¯å¦å¯ä»¥å®Œæˆæ‰€æœ‰èª²ç¨‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 public boolean canFinish(int numCourses, int[][] prerequisites) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; graph = new ArrayList\u0026lt;\u0026gt;(); int[] indegree = new int[numCourses]; // åˆå§‹åŒ–åœ– for (int i = 0; i \u0026lt; numCourses; i++) { graph.add(new ArrayList\u0026lt;\u0026gt;()); } // å»ºæ§‹åœ– for (int[] prereq : prerequisites) { graph.get(prereq[1]).add(prereq[0]); indegree[prereq[0]]++; } // Kahn æ¼”ç®—æ³• Queue\u0026lt;Integer\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; numCourses; i++) { if (indegree[i] == 0) { queue.offer(i); } } int completedCourses = 0; while (!queue.isEmpty()) { int course = queue.poll(); completedCourses++; for (int nextCourse : graph.get(course)) { indegree[nextCourse]--; if (indegree[nextCourse] == 0) { queue.offer(nextCourse); } } } return completedCourses == numCourses; } å•é¡Œ 210ï¼šè¿”å›èª²ç¨‹å®‰æ’çš„é †åºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 public int[] findOrder(int numCourses, int[][] prerequisites) { List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; graph = new ArrayList\u0026lt;\u0026gt;(); int[] indegree = new int[numCourses]; // å»ºæ§‹åœ–ï¼ˆåŒä¸Šï¼‰ for (int i = 0; i \u0026lt; numCourses; i++) { graph.add(new ArrayList\u0026lt;\u0026gt;()); } for (int[] prereq : prerequisites) { graph.get(prereq[1]).add(prereq[0]); indegree[prereq[0]]++; } Queue\u0026lt;Integer\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; numCourses; i++) { if (indegree[i] == 0) { queue.offer(i); } } int[] result = new int[numCourses]; int index = 0; while (!queue.isEmpty()) { int course = queue.poll(); result[index++] = course; for (int nextCourse : graph.get(course)) { indegree[nextCourse]--; if (indegree[nextCourse] == 0) { queue.offer(nextCourse); } } } return index == numCourses ? result : new int[0]; } 2. æ‰€æœ‰å¯èƒ½çš„èœè­œï¼ˆLeetCode 2115ï¼‰ å•é¡Œæè¿°ï¼šçµ¦å®šå¯è£½ä½œçš„èœè­œã€æ‰€éœ€åŸæ–™ä»¥åŠç¾æœ‰åŸæ–™ï¼Œæ‰¾å‡ºæ‰€æœ‰å¯èƒ½è£½ä½œçš„èœè­œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 class Solution { private static final int NOT_VISITED = 0; private static final int VISITING = 1; private static final int VISITED = 2; public List\u0026lt;String\u0026gt; findAllRecipes(String[] recipes, List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; ingredients, String[] supplies) { Map\u0026lt;String, Integer\u0026gt; status = new HashMap\u0026lt;\u0026gt;(); Map\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; prereqs = new HashMap\u0026lt;\u0026gt;(); // åˆå§‹åŒ–é£Ÿè­œå’Œå…¶æ‰€éœ€åŸæ–™ for (int i = 0; i \u0026lt; recipes.length; i++) { status.put(recipes[i], NOT_VISITED); prereqs.put(recipes[i], ingredients.get(i)); } // å°‡ç¾æœ‰åŸæ–™æ¨™è¨˜ç‚ºå·²è¨ªå• for (String supply : supplies) { status.put(supply, VISITED); } List\u0026lt;String\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); // å°æ¯å€‹é£Ÿè­œé€²è¡Œ DFS for (String recipe : recipes) { dfs(recipe, prereqs, status, result); } return result; } private boolean dfs(String item, Map\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; prereqs, Map\u0026lt;String, Integer\u0026gt; status, List\u0026lt;String\u0026gt; result) { if (!status.containsKey(item)) { return false; // ä¸å­˜åœ¨æ­¤åŸæ–™æˆ–é£Ÿè­œ } if (status.get(item) == VISITING) { return false; // ç™¼ç¾ç’°ï¼Œç„¡æ³•è£½ä½œ } if (status.get(item) == VISITED) { return true; // å·²ç¶“å¯ä»¥è£½ä½œ } // æ¨™è¨˜ç‚ºæ­£åœ¨è¨ªå• status.put(item, VISITING); // æª¢æŸ¥æ‰€æœ‰å‰ç½®æ¢ä»¶ if (prereqs.containsKey(item)) { for (String ingredient : prereqs.get(item)) { if (!dfs(ingredient, prereqs, status, result)) { return false; } } } // æ¨™è¨˜ç‚ºå·²å®Œæˆ status.put(item, VISITED); result.add(item); return true; } } è¤‡é›œåº¦åˆ†æ æ¼”ç®—æ³• æ™‚é–“è¤‡é›œåº¦ ç©ºé–“è¤‡é›œåº¦ å„ªé» ç¼ºé» Kahn (BFS) O(V + E) O(V) å¯¦ä½œç°¡å–®ï¼Œæ˜“æ–¼ç†è§£ éœ€è¦é¡å¤–çš„å…¥åº¦é™£åˆ— DFS O(V + E) O(V) å¯ä»¥æª¢æ¸¬ç’°ï¼Œè¨˜æ†¶é«”ä½¿ç”¨è¼ƒå°‘ å¯¦ä½œç¨è¤‡é›œ å…¶ä¸­ V æ˜¯ç¯€é»æ•¸ï¼ŒE æ˜¯é‚Šæ•¸ã€‚\nå¯¦ä½œæŠ€å·§ 1. ç’°çš„æª¢æ¸¬ 1 2 3 4 5 6 7 8 9 10 // Kahn æ¼”ç®—æ³•ï¼šå¦‚æœè™•ç†çš„ç¯€é»æ•¸ä¸ç­‰æ–¼ç¸½ç¯€é»æ•¸ï¼Œå‰‡å­˜åœ¨ç’° if (processedNodes != totalNodes) { // å­˜åœ¨ç’° } // DFSï¼šä½¿ç”¨ä¸‰è‰²æ¨™è¨˜æ³•æª¢æ¸¬å¾Œå‘é‚Š if (color[neighbor] == GRAY) { // ç™¼ç¾å¾Œå‘é‚Šï¼Œå­˜åœ¨ç’° return false; } 2. å¤šå€‹æ‹“æ’²æ’åºè§£ å¦‚æœéœ€è¦æ‰¾å‡ºæ‰€æœ‰å¯èƒ½çš„æ‹“æ’²æ’åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 public void findAllTopologicalSorts(List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; graph, int[] indegree, List\u0026lt;Integer\u0026gt; current, List\u0026lt;List\u0026lt;Integer\u0026gt;\u0026gt; allResults) { Queue\u0026lt;Integer\u0026gt; available = new LinkedList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; indegree.length; i++) { if (indegree[i] == 0) { available.offer(i); } } if (available.isEmpty()) { if (current.size() == indegree.length) { allResults.add(new ArrayList\u0026lt;\u0026gt;(current)); } return; } // å˜—è©¦æ‰€æœ‰å¯èƒ½çš„ä¸‹ä¸€å€‹ç¯€é» for (int node : available) { // é¸æ“‡ current.add(node); int[] newIndegree = indegree.clone(); newIndegree[node] = -1; // æ¨™è¨˜ç‚ºå·²ä½¿ç”¨ for (int neighbor : graph.get(node)) { newIndegree[neighbor]--; } // éæ­¸ findAllTopologicalSorts(graph, newIndegree, current, allResults); // æ’¤éŠ·é¸æ“‡ current.remove(current.size() - 1); } } ç¸½çµ æ‹“æ’²æ’åºæ˜¯è™•ç†æœ‰ä¾è³´é—œä¿‚å•é¡Œçš„é‡è¦æ¼”ç®—æ³•ã€‚æŒæ¡è¦é»ï¼š\né©ç”¨æ¢ä»¶ï¼šåªèƒ½ç”¨æ–¼æœ‰å‘ç„¡ç’°åœ– å…©ç¨®æ–¹æ³•ï¼šKahn æ¼”ç®—æ³•ï¼ˆBFSï¼‰å’Œ DFS æ–¹æ³• ç’°çš„æª¢æ¸¬ï¼šå…©ç¨®æ–¹æ³•éƒ½èƒ½æª¢æ¸¬åœ–ä¸­æ˜¯å¦å­˜åœ¨ç’° å¯¦éš›æ‡‰ç”¨ï¼šèª²ç¨‹å®‰æ’ã€ä»»å‹™èª¿åº¦ã€ç·¨è­¯ä¾è³´ç­‰ é¸æ“‡æ¼”ç®—æ³•æ™‚ï¼š\nKahn æ¼”ç®—æ³•ï¼šé‚è¼¯ç›´è§€ï¼Œé©åˆåˆå­¸è€… DFS æ–¹æ³•ï¼šæ›´éˆæ´»ï¼Œèƒ½æä¾›æ›´å¤šä¿¡æ¯ï¼ˆå¦‚å®Œæˆæ™‚é–“ï¼‰ åƒè€ƒè³‡æ–™ LeetCode 207. Course Schedule LeetCode 210. Course Schedule II LeetCode 2115. Find All Possible Recipes from Given Supplies æ¼”ç®—æ³•å°è«– - åœ–çš„æ‹“æ’²æ’åº ","permalink":"https://xinqilin.github.io/post/algorithm/topologicalsort/","tags":["Algorithm","Graph","TopologicalSort","DFS","BFS","Java"],"title":"æ‹“æ’²æ’åºï¼ˆTopological Sortï¼‰æ¼”ç®—æ³•è©³è§£"},{"content":"æ¦‚è¿° Reactive Programmingï¼ˆéŸ¿æ‡‰å¼ç¨‹å¼è¨­è¨ˆï¼‰æ˜¯ä¸€ç¨®åŸºæ–¼è³‡æ–™æµå’Œè®ŠåŒ–å‚³æ’­çš„ç¨‹å¼è¨­è¨ˆæ¨¡å¼ã€‚åœ¨ Java ç”Ÿæ…‹ç³»çµ±ä¸­ï¼ŒProject Reactor æ˜¯å¯¦ç¾éŸ¿æ‡‰å¼ç¨‹å¼è¨­è¨ˆçš„æ ¸å¿ƒå‡½å¼åº«ï¼Œè€Œ Spring WebFlux å‰‡å»ºç«‹åœ¨å…¶ä¹‹ä¸Šï¼Œæä¾›éé˜»å¡å¼çš„ Web æ‡‰ç”¨ç¨‹å¼é–‹ç™¼èƒ½åŠ›ã€‚\næ ¸å¿ƒæ¦‚å¿µ ä»€éº¼æ˜¯ Reactive Programmingï¼Ÿ éŸ¿æ‡‰å¼ç¨‹å¼è¨­è¨ˆçš„æ ¸å¿ƒç‰¹å¾µï¼š\néé˜»å¡ï¼ˆNon-blockingï¼‰ï¼šåŸ·è¡Œç·’ä¸æœƒè¢« I/O æ“ä½œé˜»å¡ äº‹ä»¶é©…å‹•ï¼ˆEvent-drivenï¼‰ï¼šåŸºæ–¼äº‹ä»¶æµè™•ç†è³‡æ–™ èƒŒå£“æ”¯æ´ï¼ˆBackpressureï¼‰ï¼šè‡ªå‹•è™•ç†ç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…ä¹‹é–“çš„é€Ÿåº¦å·®ç•° å½ˆæ€§ï¼ˆResilientï¼‰ï¼šå…·å‚™éŒ¯èª¤è™•ç†å’Œæ¢å¾©èƒ½åŠ› éŸ¿æ‡‰æ€§ï¼ˆResponsiveï¼‰ï¼šå¿«é€Ÿå›æ‡‰ä½¿ç”¨è€…è«‹æ±‚ Reactive Streams è¦ç¯„ Reactive Streams å®šç¾©äº†å››å€‹æ ¸å¿ƒä»‹é¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public interface Publisher\u0026lt;T\u0026gt; { void subscribe(Subscriber\u0026lt;? super T\u0026gt; s); } public interface Subscriber\u0026lt;T\u0026gt; { void onSubscribe(Subscription s); void onNext(T t); void onError(Throwable t); void onComplete(); } public interface Subscription { void request(long n); void cancel(); } public interface Processor\u0026lt;T, R\u0026gt; extends Subscriber\u0026lt;T\u0026gt;, Publisher\u0026lt;R\u0026gt; { } Project Reactor åŸºç¤ Mono èˆ‡ Flux Project Reactor æä¾›å…©å€‹æ ¸å¿ƒé¡å‹ï¼š\nMonoï¼šç™¼å‡º 0 æˆ– 1 å€‹å…ƒç´ çš„éŸ¿æ‡‰å¼æµ Fluxï¼šç™¼å‡º 0 åˆ° N å€‹å…ƒç´ çš„éŸ¿æ‡‰å¼æµ å‰µå»ºéŸ¿æ‡‰å¼æµ Mono å‰µå»ºæ–¹å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // å‰µå»ºåŒ…å«å–®ä¸€å€¼çš„ Mono Mono\u0026lt;String\u0026gt; mono1 = Mono.just(\u0026#34;Hello Reactive\u0026#34;); // å‰µå»ºç©ºçš„ Mono Mono\u0026lt;String\u0026gt; empty = Mono.empty(); // å¾ Optional å‰µå»º Mono\u0026lt;String\u0026gt; mono2 = Mono.justOrEmpty(Optional.of(\u0026#34;Optional Value\u0026#34;)); // å»¶é²å‰µå»º Mono\u0026lt;String\u0026gt; lazy = Mono.fromSupplier(() -\u0026gt; { // è¤‡é›œçš„è¨ˆç®—é‚è¼¯ return \u0026#34;Computed Value\u0026#34;; }); // å¾ Callable å‰µå»º Mono\u0026lt;String\u0026gt; callable = Mono.fromCallable(() -\u0026gt; { Thread.sleep(1000); // æ¨¡æ“¬è€—æ™‚æ“ä½œ return \u0026#34;Delayed Value\u0026#34;; }); // éŒ¯èª¤ Mono Mono\u0026lt;String\u0026gt; error = Mono.error(new RuntimeException(\u0026#34;Something went wrong\u0026#34;)); Flux å‰µå»ºæ–¹å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // å¾å¯è®Šåƒæ•¸å‰µå»º Flux\u0026lt;String\u0026gt; flux1 = Flux.just(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;D\u0026#34;); // å¾é›†åˆå‰µå»º List\u0026lt;String\u0026gt; list = Arrays.asList(\u0026#34;Apple\u0026#34;, \u0026#34;Banana\u0026#34;, \u0026#34;Cherry\u0026#34;); Flux\u0026lt;String\u0026gt; flux2 = Flux.fromIterable(list); // å‰µå»ºæ•¸å­—ç¯„åœ Flux\u0026lt;Integer\u0026gt; range = Flux.range(1, 10); // 1 åˆ° 10 // å®šæ™‚ç™¼å°„ Flux\u0026lt;Long\u0026gt; interval = Flux.interval(Duration.ofSeconds(1)); // æ¯ç§’ç™¼å°„ä¸€å€‹éå¢æ•¸å­— // å¾é™£åˆ—å‰µå»º String[] array = {\u0026#34;X\u0026#34;, \u0026#34;Y\u0026#34;, \u0026#34;Z\u0026#34;}; Flux\u0026lt;String\u0026gt; flux3 = Flux.fromArray(array); // å¾ Stream å‰µå»º Flux\u0026lt;String\u0026gt; flux4 = Flux.fromStream(Stream.of(\u0026#34;Stream1\u0026#34;, \u0026#34;Stream2\u0026#34;)); è¨‚é–±èˆ‡æ¶ˆè²» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // åŸºæœ¬è¨‚é–± Flux\u0026lt;Integer\u0026gt; numbers = Flux.range(1, 5); // åªè™•ç†æ•¸æ“š numbers.subscribe(System.out::println); // è™•ç†æ•¸æ“šå’ŒéŒ¯èª¤ numbers.subscribe( data -\u0026gt; System.out.println(\u0026#34;Data: \u0026#34; + data), error -\u0026gt; System.err.println(\u0026#34;Error: \u0026#34; + error) ); // å®Œæ•´çš„è¨‚é–±è™•ç† numbers.subscribe( data -\u0026gt; System.out.println(\u0026#34;Next: \u0026#34; + data), // onNext error -\u0026gt; System.err.println(\u0026#34;Error: \u0026#34; + error), // onError () -\u0026gt; System.out.println(\u0026#34;Completed!\u0026#34;) // onComplete ); // ä½¿ç”¨è‡ªè¨‚ Subscriber numbers.subscribe(new BaseSubscriber\u0026lt;Integer\u0026gt;() { @Override protected void hookOnSubscribe(Subscription subscription) { System.out.println(\u0026#34;Subscribed\u0026#34;); request(1); // è«‹æ±‚ç¬¬ä¸€å€‹å…ƒç´  } @Override protected void hookOnNext(Integer value) { System.out.println(\u0026#34;Value: \u0026#34; + value); if (value \u0026lt; 3) { request(1); // ç¹¼çºŒè«‹æ±‚ä¸‹ä¸€å€‹ } else { cancel(); // å–æ¶ˆè¨‚é–± } } }); æ ¸å¿ƒæ“ä½œç¬¦è©³è§£ è½‰æ›æ“ä½œç¬¦ map - å…ƒç´ è½‰æ› 1 2 3 4 5 6 7 8 9 Flux\u0026lt;String\u0026gt; names = Flux.just(\u0026#34;alice\u0026#34;, \u0026#34;bob\u0026#34;, \u0026#34;charlie\u0026#34;); // è½‰æ›ç‚ºå¤§å¯« Flux\u0026lt;String\u0026gt; upperNames = names.map(String::toUpperCase); upperNames.subscribe(System.out::println); // ALICE, BOB, CHARLIE // è½‰æ›ç‚ºé•·åº¦ Flux\u0026lt;Integer\u0026gt; lengths = names.map(String::length); lengths.subscribe(System.out::println); // 5, 3, 7 flatMap - æ‰å¹³åŒ–è™•ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Flux\u0026lt;String\u0026gt; sentences = Flux.just(\u0026#34;Hello World\u0026#34;, \u0026#34;Reactive Programming\u0026#34;); // å°‡æ¯å€‹å¥å­æ‹†åˆ†ç‚ºå–®è© Flux\u0026lt;String\u0026gt; words = sentences.flatMap(sentence -\u0026gt; Flux.fromArray(sentence.split(\u0026#34; \u0026#34;)) ); words.subscribe(System.out::println); // Hello, World, Reactive, Programming // éåŒæ­¥è™•ç† Flux\u0026lt;String\u0026gt; urls = Flux.just(\u0026#34;url1\u0026#34;, \u0026#34;url2\u0026#34;, \u0026#34;url3\u0026#34;); Flux\u0026lt;String\u0026gt; responses = urls.flatMap(url -\u0026gt; Mono.fromCallable(() -\u0026gt; { // æ¨¡æ“¬ HTTP è«‹æ±‚ Thread.sleep(100); return \u0026#34;Response from \u0026#34; + url; }).subscribeOn(Schedulers.boundedElastic()) ); concatMap - é †åºè™•ç† 1 2 3 4 5 // èˆ‡ flatMap ä¸åŒï¼ŒconcatMap ä¿æŒé †åº Flux\u0026lt;String\u0026gt; ordered = urls.concatMap(url -\u0026gt; Mono.fromCallable(() -\u0026gt; \u0026#34;Response from \u0026#34; + url) .subscribeOn(Schedulers.boundedElastic()) ); éæ¿¾æ“ä½œç¬¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 Flux\u0026lt;Integer\u0026gt; numbers = Flux.range(1, 10); // éæ¿¾å¶æ•¸ Flux\u0026lt;Integer\u0026gt; evenNumbers = numbers.filter(n -\u0026gt; n % 2 == 0); // å–å‰ 3 å€‹å…ƒç´  Flux\u0026lt;Integer\u0026gt; first3 = numbers.take(3); // è·³éå‰ 5 å€‹å…ƒç´  Flux\u0026lt;Integer\u0026gt; skip5 = numbers.skip(5); // å»é‡ Flux\u0026lt;String\u0026gt; duplicates = Flux.just(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;A\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;B\u0026#34;); Flux\u0026lt;String\u0026gt; distinct = duplicates.distinct(); // å–ä¸é‡è¤‡å…ƒç´ ç›´åˆ°é‡åˆ°é‡è¤‡ Flux\u0026lt;String\u0026gt; distinctUntilChanged = Flux.just(\u0026#34;A\u0026#34;, \u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;) .distinctUntilChanged(); çµ„åˆæ“ä½œç¬¦ merge - åˆä½µå¤šå€‹æµ 1 2 3 4 5 6 7 8 9 Flux\u0026lt;String\u0026gt; flux1 = Flux.just(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;).delayElements(Duration.ofMillis(100)); Flux\u0026lt;String\u0026gt; flux2 = Flux.just(\u0026#34;C\u0026#34;, \u0026#34;D\u0026#34;).delayElements(Duration.ofMillis(150)); // åˆä½µï¼ˆé †åºä¸ä¿è­‰ï¼‰ Flux\u0026lt;String\u0026gt; merged = Flux.merge(flux1, flux2); merged.subscribe(System.out::println); // å¯èƒ½è¼¸å‡º: A, C, B, D // ä½¿ç”¨ mergeWith Flux\u0026lt;String\u0026gt; merged2 = flux1.mergeWith(flux2); concat - é€£æ¥æµ 1 2 3 4 5 6 // é€£æ¥ï¼ˆä¿æŒé †åºï¼‰ Flux\u0026lt;String\u0026gt; concatenated = Flux.concat(flux1, flux2); concatenated.subscribe(System.out::println); // è¼¸å‡º: A, B, C, D // ä½¿ç”¨ concatWith Flux\u0026lt;String\u0026gt; concatenated2 = flux1.concatWith(flux2); zip - é…å°å…ƒç´  1 2 3 4 5 6 7 8 9 10 11 Flux\u0026lt;String\u0026gt; names = Flux.just(\u0026#34;Alice\u0026#34;, \u0026#34;Bob\u0026#34;, \u0026#34;Charlie\u0026#34;); Flux\u0026lt;Integer\u0026gt; ages = Flux.just(25, 30, 35); // é…å°å…ƒç´  Flux\u0026lt;String\u0026gt; people = Flux.zip(names, ages, (name, age) -\u0026gt; name + \u0026#34; is \u0026#34; + age + \u0026#34; years old\u0026#34; ); people.subscribe(System.out::println); // Alice is 25 years old // Bob is 30 years old // Charlie is 35 years old éŒ¯èª¤è™•ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 Flux\u0026lt;String\u0026gt; source = Flux.just(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;) .map(s -\u0026gt; { if (\u0026#34;B\u0026#34;.equals(s)) { throw new RuntimeException(\u0026#34;Error on B\u0026#34;); } return s; }); // æä¾›é è¨­å€¼ Flux\u0026lt;String\u0026gt; withDefault = source.onErrorReturn(\u0026#34;DEFAULT\u0026#34;); // ç¹¼çºŒå…¶ä»–æµ Flux\u0026lt;String\u0026gt; fallback = source.onErrorResume(error -\u0026gt; Flux.just(\u0026#34;FALLBACK1\u0026#34;, \u0026#34;FALLBACK2\u0026#34;) ); // é‡è©¦ Flux\u0026lt;String\u0026gt; withRetry = source.retry(3); // é‡è©¦ä¸”å»¶é² Flux\u0026lt;String\u0026gt; withRetryDelay = source.retryWhen( Retry.backoff(3, Duration.ofSeconds(1)) ); // æ•ç²éŒ¯èª¤ä¸¦ç¹¼çºŒ Flux\u0026lt;String\u0026gt; continueOnError = source.onErrorContinue((error, item) -\u0026gt; { System.err.println(\u0026#34;Error on item \u0026#34; + item + \u0026#34;: \u0026#34; + error.getMessage()); }); èƒŒå£“ï¼ˆBackpressureï¼‰è™•ç† èƒŒå£“æ˜¯éŸ¿æ‡‰å¼ç¨‹å¼è¨­è¨ˆä¸­çš„é‡è¦æ¦‚å¿µï¼Œç”¨æ–¼è™•ç†ç”Ÿç”¢è€…é€Ÿåº¦è¶…éæ¶ˆè²»è€…è™•ç†èƒ½åŠ›çš„æƒ…æ³ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // èƒŒå£“ç­–ç•¥ç¤ºä¾‹ Flux\u0026lt;Integer\u0026gt; fastProducer = Flux.range(1, 1000) .delayElements(Duration.ofMillis(1)); // æ¶ˆè²»è€…è™•ç†è¼ƒæ…¢ fastProducer .onBackpressureBuffer(10) // ç·©è¡å€å¤§å°ç‚º 10 .subscribe(new BaseSubscriber\u0026lt;Integer\u0026gt;() { @Override protected void hookOnSubscribe(Subscription subscription) { request(1); } @Override protected void hookOnNext(Integer value) { try { Thread.sleep(100); // æ¨¡æ“¬æ…¢è™•ç† System.out.println(\u0026#34;Processed: \u0026#34; + value); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } request(1); } }); // å…¶ä»–èƒŒå£“ç­–ç•¥ Flux\u0026lt;Integer\u0026gt; dropped = fastProducer.onBackpressureDrop(); Flux\u0026lt;Integer\u0026gt; latest = fastProducer.onBackpressureLatest(); Flux\u0026lt;Integer\u0026gt; error = fastProducer.onBackpressureError(); æ’ç¨‹å™¨ï¼ˆSchedulerï¼‰ Reactor æä¾›å¤šç¨®æ’ç¨‹å™¨ä¾†æ§åˆ¶åŸ·è¡Œä¸Šä¸‹æ–‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // ä¸åŒé¡å‹çš„æ’ç¨‹å™¨ Scheduler single = Schedulers.single(); // å–®åŸ·è¡Œç·’ Scheduler parallel = Schedulers.parallel(); // ä¸¦è¡Œè™•ç†ï¼ˆCPU å¯†é›†ï¼‰ Scheduler boundedElastic = Schedulers.boundedElastic(); // å½ˆæ€§åŸ·è¡Œç·’æ± ï¼ˆI/O å¯†é›†ï¼‰ Scheduler immediate = Schedulers.immediate(); // ç•¶å‰åŸ·è¡Œç·’ // ä½¿ç”¨æ’ç¨‹å™¨ Flux\u0026lt;String\u0026gt; source = Flux.just(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;); // åœ¨æŒ‡å®šæ’ç¨‹å™¨ä¸Šç™¼å¸ƒ Flux\u0026lt;String\u0026gt; published = source.publishOn(Schedulers.parallel()); // åœ¨æŒ‡å®šæ’ç¨‹å™¨ä¸Šè¨‚é–± Flux\u0026lt;String\u0026gt; subscribed = source.subscribeOn(Schedulers.boundedElastic()); // çµ„åˆä½¿ç”¨ source .subscribeOn(Schedulers.boundedElastic()) // è¨‚é–±åœ¨å½ˆæ€§åŸ·è¡Œç·’æ±  .map(s -\u0026gt; s.toLowerCase()) // è½‰æ›æ“ä½œ .publishOn(Schedulers.parallel()) // å¾ŒçºŒæ“ä½œåœ¨ä¸¦è¡Œæ’ç¨‹å™¨ .map(s -\u0026gt; s.toUpperCase()) .subscribe(System.out::println); Spring WebFlux å¯¦æˆ° ä¾è³´é…ç½® 1 2 3 4 5 6 7 8 9 10 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-webflux\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-r2dbc\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; éŸ¿æ‡‰å¼ REST Controller 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 @RestController @RequestMapping(\u0026#34;/api/users\u0026#34;) public class UserController { private final UserService userService; public UserController(UserService userService) { this.userService = userService; } @GetMapping public Flux\u0026lt;User\u0026gt; getAllUsers() { return userService.findAll(); } @GetMapping(\u0026#34;/{id}\u0026#34;) public Mono\u0026lt;ResponseEntity\u0026lt;User\u0026gt;\u0026gt; getUserById(@PathVariable String id) { return userService.findById(id) .map(user -\u0026gt; ResponseEntity.ok(user)) .defaultIfEmpty(ResponseEntity.notFound().build()); } @PostMapping public Mono\u0026lt;User\u0026gt; createUser(@RequestBody User user) { return userService.save(user); } @PutMapping(\u0026#34;/{id}\u0026#34;) public Mono\u0026lt;ResponseEntity\u0026lt;User\u0026gt;\u0026gt; updateUser(@PathVariable String id, @RequestBody User user) { return userService.update(id, user) .map(updatedUser -\u0026gt; ResponseEntity.ok(updatedUser)) .defaultIfEmpty(ResponseEntity.notFound().build()); } @DeleteMapping(\u0026#34;/{id}\u0026#34;) public Mono\u0026lt;ResponseEntity\u0026lt;Void\u0026gt;\u0026gt; deleteUser(@PathVariable String id) { return userService.deleteById(id) .then(Mono.just(ResponseEntity.noContent().\u0026lt;Void\u0026gt;build())) .defaultIfEmpty(ResponseEntity.notFound().build()); } // ä¸²æµç«¯é» @GetMapping(value = \u0026#34;/stream\u0026#34;, produces = MediaType.TEXT_EVENT_STREAM_VALUE) public Flux\u0026lt;User\u0026gt; getUserStream() { return userService.findAll() .delayElements(Duration.ofSeconds(1)); // æ¯ç§’ç™¼é€ä¸€å€‹ç”¨æˆ¶ } } éŸ¿æ‡‰å¼ Service å±¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 @Service public class UserService { private final UserRepository userRepository; private final WebClient webClient; public UserService(UserRepository userRepository, WebClient.Builder webClientBuilder) { this.userRepository = userRepository; this.webClient = webClientBuilder.baseUrl(\u0026#34;https://api.external.com\u0026#34;).build(); } public Flux\u0026lt;User\u0026gt; findAll() { return userRepository.findAll(); } public Mono\u0026lt;User\u0026gt; findById(String id) { return userRepository.findById(id); } public Mono\u0026lt;User\u0026gt; save(User user) { return userRepository.save(user); } public Mono\u0026lt;User\u0026gt; update(String id, User user) { return userRepository.findById(id) .flatMap(existingUser -\u0026gt; { existingUser.setName(user.getName()); existingUser.setEmail(user.getEmail()); return userRepository.save(existingUser); }); } public Mono\u0026lt;Void\u0026gt; deleteById(String id) { return userRepository.deleteById(id); } // çµ„åˆå¤šå€‹éåŒæ­¥æ“ä½œ public Mono\u0026lt;UserProfile\u0026gt; getUserProfile(String userId) { Mono\u0026lt;User\u0026gt; userMono = findById(userId); Mono\u0026lt;List\u0026lt;Order\u0026gt;\u0026gt; ordersMono = getOrdersByUserId(userId); Mono\u0026lt;UserPreferences\u0026gt; preferencesMono = getUserPreferences(userId); return Mono.zip(userMono, ordersMono, preferencesMono) .map(tuple -\u0026gt; new UserProfile( tuple.getT1(), // User tuple.getT2(), // Orders tuple.getT3() // Preferences )); } // å¤–éƒ¨ API å‘¼å« private Mono\u0026lt;List\u0026lt;Order\u0026gt;\u0026gt; getOrdersByUserId(String userId) { return webClient.get() .uri(\u0026#34;/orders?userId={userId}\u0026#34;, userId) .retrieve() .bodyToFlux(Order.class) .collectList() .timeout(Duration.ofSeconds(5)) // 5 ç§’é€¾æ™‚ .onErrorReturn(Collections.emptyList()); // éŒ¯èª¤æ™‚è¿”å›ç©ºåˆ—è¡¨ } private Mono\u0026lt;UserPreferences\u0026gt; getUserPreferences(String userId) { return webClient.get() .uri(\u0026#34;/preferences/{userId}\u0026#34;, userId) .retrieve() .bodyToMono(UserPreferences.class) .onErrorReturn(new UserPreferences()); // é è¨­åå¥½è¨­å®š } } éŸ¿æ‡‰å¼è³‡æ–™åº«å­˜å– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // R2DBC Repository @Repository public interface UserRepository extends ReactiveCrudRepository\u0026lt;User, String\u0026gt; { Flux\u0026lt;User\u0026gt; findByNameContaining(String name); Flux\u0026lt;User\u0026gt; findByEmailDomain(String domain); @Query(\u0026#34;SELECT * FROM users WHERE created_at \u0026gt; :date\u0026#34;) Flux\u0026lt;User\u0026gt; findUsersCreatedAfter(LocalDateTime date); @Modifying @Query(\u0026#34;UPDATE users SET last_login = :loginTime WHERE id = :userId\u0026#34;) Mono\u0026lt;Integer\u0026gt; updateLastLogin(String userId, LocalDateTime loginTime); } // è‡ªè¨‚ Repository å¯¦ä½œ @Component public class CustomUserRepository { private final DatabaseClient databaseClient; public CustomUserRepository(DatabaseClient databaseClient) { this.databaseClient = databaseClient; } public Flux\u0026lt;User\u0026gt; findUsersByComplexCriteria(UserSearchCriteria criteria) { return databaseClient.sql(\u0026#34;\u0026#34;\u0026#34; SELECT * FROM users WHERE (:name IS NULL OR name LIKE :name) AND (:email IS NULL OR email = :email) AND (:minAge IS NULL OR age \u0026gt;= :minAge) ORDER BY created_at DESC \u0026#34;\u0026#34;\u0026#34;) .bind(\u0026#34;name\u0026#34;, criteria.getName() != null ? \u0026#34;%\u0026#34; + criteria.getName() + \u0026#34;%\u0026#34; : null) .bind(\u0026#34;email\u0026#34;, criteria.getEmail()) .bind(\u0026#34;minAge\u0026#34;, criteria.getMinAge()) .map((row, metadata) -\u0026gt; User.builder() .id(row.get(\u0026#34;id\u0026#34;, String.class)) .name(row.get(\u0026#34;name\u0026#34;, String.class)) .email(row.get(\u0026#34;email\u0026#34;, String.class)) .age(row.get(\u0026#34;age\u0026#34;, Integer.class)) .createdAt(row.get(\u0026#34;created_at\u0026#34;, LocalDateTime.class)) .build()) .all(); } } WebClient ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 @Component public class ExternalApiClient { private final WebClient webClient; public ExternalApiClient(WebClient.Builder webClientBuilder) { this.webClient = webClientBuilder .baseUrl(\u0026#34;https://jsonplaceholder.typicode.com\u0026#34;) .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE) .build(); } // GET è«‹æ±‚ public Mono\u0026lt;Post\u0026gt; getPost(Long id) { return webClient.get() .uri(\u0026#34;/posts/{id}\u0026#34;, id) .retrieve() .onStatus(HttpStatus::is4xxClientError, response -\u0026gt; Mono.error(new NotFoundException(\u0026#34;Post not found\u0026#34;))) .onStatus(HttpStatus::is5xxServerError, response -\u0026gt; Mono.error(new ServiceException(\u0026#34;Server error\u0026#34;))) .bodyToMono(Post.class) .timeout(Duration.ofSeconds(10)) .retry(3); } // POST è«‹æ±‚ public Mono\u0026lt;Post\u0026gt; createPost(Post post) { return webClient.post() .uri(\u0026#34;/posts\u0026#34;) .bodyValue(post) .retrieve() .bodyToMono(Post.class); } // æ‰¹é‡è«‹æ±‚ public Flux\u0026lt;Post\u0026gt; getAllPosts() { return webClient.get() .uri(\u0026#34;/posts\u0026#34;) .retrieve() .bodyToFlux(Post.class) .onBackpressureBuffer(100); // ç·©è¡è™•ç† } // ä¸¦è¡Œè«‹æ±‚ public Mono\u0026lt;List\u0026lt;PostWithComments\u0026gt;\u0026gt; getPostsWithComments(List\u0026lt;Long\u0026gt; postIds) { return Flux.fromIterable(postIds) .flatMap(this::getPostWithComments, 5) // æœ€å¤š 5 å€‹ä¸¦è¡Œè«‹æ±‚ .collectList(); } private Mono\u0026lt;PostWithComments\u0026gt; getPostWithComments(Long postId) { Mono\u0026lt;Post\u0026gt; postMono = getPost(postId); Mono\u0026lt;List\u0026lt;Comment\u0026gt;\u0026gt; commentsMono = getCommentsByPostId(postId); return Mono.zip(postMono, commentsMono, PostWithComments::new); } private Mono\u0026lt;List\u0026lt;Comment\u0026gt;\u0026gt; getCommentsByPostId(Long postId) { return webClient.get() .uri(\u0026#34;/posts/{postId}/comments\u0026#34;, postId) .retrieve() .bodyToFlux(Comment.class) .collectList(); } } æ¸¬è©¦éŸ¿æ‡‰å¼ç¨‹å¼ç¢¼ æ¸¬è©¦é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 @ExtendWith(MockitoExtension.class) class UserServiceTest { @Mock private UserRepository userRepository; @Mock private WebClient webClient; @Mock private WebClient.RequestHeadersUriSpec requestHeadersUriSpec; @Mock private WebClient.ResponseSpec responseSpec; @InjectMocks private UserService userService; @Test void testFindById() { // Given String userId = \u0026#34;123\u0026#34;; User expectedUser = new User(userId, \u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;); when(userRepository.findById(userId)).thenReturn(Mono.just(expectedUser)); // When Mono\u0026lt;User\u0026gt; result = userService.findById(userId); // Then StepVerifier.create(result) .expectNext(expectedUser) .verifyComplete(); verify(userRepository).findById(userId); } @Test void testFindByIdNotFound() { // Given String userId = \u0026#34;999\u0026#34;; when(userRepository.findById(userId)).thenReturn(Mono.empty()); // When Mono\u0026lt;User\u0026gt; result = userService.findById(userId); // Then StepVerifier.create(result) .verifyComplete(); // æœŸæœ›ç©ºçµæœ } @Test void testGetAllUsers() { // Given List\u0026lt;User\u0026gt; users = Arrays.asList( new User(\u0026#34;1\u0026#34;, \u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;), new User(\u0026#34;2\u0026#34;, \u0026#34;Jane\u0026#34;, \u0026#34;jane@example.com\u0026#34;) ); when(userRepository.findAll()).thenReturn(Flux.fromIterable(users)); // When Flux\u0026lt;User\u0026gt; result = userService.findAll(); // Then StepVerifier.create(result) .expectNext(users.get(0)) .expectNext(users.get(1)) .verifyComplete(); } @Test void testSaveUser() { // Given User userToSave = new User(null, \u0026#34;New User\u0026#34;, \u0026#34;new@example.com\u0026#34;); User savedUser = new User(\u0026#34;123\u0026#34;, \u0026#34;New User\u0026#34;, \u0026#34;new@example.com\u0026#34;); when(userRepository.save(userToSave)).thenReturn(Mono.just(savedUser)); // When Mono\u0026lt;User\u0026gt; result = userService.save(userToSave); // Then StepVerifier.create(result) .expectNext(savedUser) .verifyComplete(); } @Test void testErrorHandling() { // Given String userId = \u0026#34;123\u0026#34;; when(userRepository.findById(userId)) .thenReturn(Mono.error(new RuntimeException(\u0026#34;Database error\u0026#34;))); // When Mono\u0026lt;User\u0026gt; result = userService.findById(userId); // Then StepVerifier.create(result) .expectError(RuntimeException.class) .verify(); } } æ•´åˆæ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) class UserControllerIntegrationTest { @Autowired private WebTestClient webTestClient; @MockBean private UserService userService; @Test void testGetAllUsers() { // Given List\u0026lt;User\u0026gt; users = Arrays.asList( new User(\u0026#34;1\u0026#34;, \u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;), new User(\u0026#34;2\u0026#34;, \u0026#34;Jane\u0026#34;, \u0026#34;jane@example.com\u0026#34;) ); when(userService.findAll()).thenReturn(Flux.fromIterable(users)); // When \u0026amp; Then webTestClient.get() .uri(\u0026#34;/api/users\u0026#34;) .exchange() .expectStatus().isOk() .expectBodyList(User.class) .hasSize(2) .contains(users.toArray(new User[0])); } @Test void testGetUserById() { // Given String userId = \u0026#34;123\u0026#34;; User user = new User(userId, \u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;); when(userService.findById(userId)).thenReturn(Mono.just(user)); // When \u0026amp; Then webTestClient.get() .uri(\u0026#34;/api/users/{id}\u0026#34;, userId) .exchange() .expectStatus().isOk() .expectBody(User.class) .isEqualTo(user); } @Test void testGetUserByIdNotFound() { // Given String userId = \u0026#34;999\u0026#34;; when(userService.findById(userId)).thenReturn(Mono.empty()); // When \u0026amp; Then webTestClient.get() .uri(\u0026#34;/api/users/{id}\u0026#34;, userId) .exchange() .expectStatus().isNotFound(); } @Test void testCreateUser() { // Given User userToCreate = new User(null, \u0026#34;New User\u0026#34;, \u0026#34;new@example.com\u0026#34;); User createdUser = new User(\u0026#34;123\u0026#34;, \u0026#34;New User\u0026#34;, \u0026#34;new@example.com\u0026#34;); when(userService.save(any(User.class))).thenReturn(Mono.just(createdUser)); // When \u0026amp; Then webTestClient.post() .uri(\u0026#34;/api/users\u0026#34;) .bodyValue(userToCreate) .exchange() .expectStatus().isOk() .expectBody(User.class) .isEqualTo(createdUser); } } æ•ˆèƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸ 1. é©ç•¶çš„èƒŒå£“ç­–ç•¥ 1 2 3 4 5 6 7 8 9 // æ ¹æ“šæƒ…æ³é¸æ“‡åˆé©çš„èƒŒå£“ç­–ç•¥ public Flux\u0026lt;ProcessedData\u0026gt; processLargeDataset(Flux\u0026lt;RawData\u0026gt; input) { return input .onBackpressureBuffer(1000) // é©åº¦ç·©è¡ .flatMap(this::processData, 10) // é™åˆ¶ä¸¦è¡Œåº¦ .onErrorContinue((error, item) -\u0026gt; { log.warn(\u0026#34;è™•ç†é …ç›® {} æ™‚ç™¼ç”ŸéŒ¯èª¤: {}\u0026#34;, item, error.getMessage()); }); } 2. åˆç†ä½¿ç”¨æ’ç¨‹å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @Service public class OptimizedService { // CPU å¯†é›†å‹æ“ä½œä½¿ç”¨ parallel() public Mono\u0026lt;String\u0026gt; cpuIntensiveTask(String input) { return Mono.fromCallable(() -\u0026gt; { // è¤‡é›œè¨ˆç®— return performComplexCalculation(input); }).subscribeOn(Schedulers.parallel()); } // I/O æ“ä½œä½¿ç”¨ boundedElastic() public Mono\u0026lt;String\u0026gt; ioTask(String filename) { return Mono.fromCallable(() -\u0026gt; { // æª”æ¡ˆè®€å– return readFromFile(filename); }).subscribeOn(Schedulers.boundedElastic()); } } 3. è³‡æºç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // ä½¿ç”¨ using() ç¢ºä¿è³‡æºæ­£ç¢ºé‡‹æ”¾ public Mono\u0026lt;String\u0026gt; processFileWithProperCleanup(String filename) { return Mono.using( () -\u0026gt; Files.newBufferedReader(Paths.get(filename)), // è³‡æºä¾›æ‡‰å•† reader -\u0026gt; Mono.fromCallable(() -\u0026gt; { // ä½¿ç”¨è³‡æº return reader.lines().collect(Collectors.joining(\u0026#34;\\n\u0026#34;)); }).subscribeOn(Schedulers.boundedElastic()), reader -\u0026gt; { // æ¸…ç†è³‡æº try { reader.close(); } catch (IOException e) { log.warn(\u0026#34;é—œé–‰æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤\u0026#34;, e); } } ); } 4. å¿«å–ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @Service public class CachedUserService { private final Cache\u0026lt;String, User\u0026gt; userCache = Caffeine.newBuilder() .maximumSize(1000) .expireAfterWrite(Duration.ofMinutes(10)) .build(); public Mono\u0026lt;User\u0026gt; getUserWithCache(String userId) { User cachedUser = userCache.getIfPresent(userId); if (cachedUser != null) { return Mono.just(cachedUser); } return userRepository.findById(userId) .doOnNext(user -\u0026gt; userCache.put(userId, user)) .cache(Duration.ofMinutes(5)); // Reactor å±¤ç´šå¿«å– } } ç›£æ§èˆ‡é™¤éŒ¯ 1. æ—¥èªŒè¨˜éŒ„ 1 2 3 4 5 6 7 8 public Flux\u0026lt;User\u0026gt; processUsers() { return userRepository.findAll() .doOnSubscribe(subscription -\u0026gt; log.info(\u0026#34;é–‹å§‹è™•ç†ç”¨æˆ¶\u0026#34;)) .doOnNext(user -\u0026gt; log.debug(\u0026#34;è™•ç†ç”¨æˆ¶: {}\u0026#34;, user.getId())) .doOnError(error -\u0026gt; log.error(\u0026#34;è™•ç†éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤\u0026#34;, error)) .doOnComplete(() -\u0026gt; log.info(\u0026#34;ç”¨æˆ¶è™•ç†å®Œæˆ\u0026#34;)) .doFinally(signalType -\u0026gt; log.info(\u0026#34;è™•ç†çµæŸï¼Œä¿¡è™Ÿé¡å‹: {}\u0026#34;, signalType)); } 2. åº¦é‡æ”¶é›† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 @Component public class MetricsService { private final MeterRegistry meterRegistry; private final Counter userProcessedCounter; private final Timer userProcessingTimer; public MetricsService(MeterRegistry meterRegistry) { this.meterRegistry = meterRegistry; this.userProcessedCounter = Counter.builder(\u0026#34;users.processed\u0026#34;) .description(\u0026#34;è™•ç†çš„ç”¨æˆ¶æ•¸é‡\u0026#34;) .register(meterRegistry); this.userProcessingTimer = Timer.builder(\u0026#34;users.processing.time\u0026#34;) .description(\u0026#34;ç”¨æˆ¶è™•ç†æ™‚é–“\u0026#34;) .register(meterRegistry); } public Mono\u0026lt;User\u0026gt; processUserWithMetrics(User user) { return Mono.fromCallable(() -\u0026gt; { // è™•ç†é‚è¼¯ return processUser(user); }) .doOnNext(u -\u0026gt; userProcessedCounter.increment()) .doOnSuccess(u -\u0026gt; userProcessingTimer.recordCallable(() -\u0026gt; { // è¨ˆæ™‚é‚è¼¯ return u; })) .subscribeOn(Schedulers.boundedElastic()); } } ç¸½çµ Reactive Programming ç‚º Java é–‹ç™¼è€…æä¾›äº†è™•ç†éåŒæ­¥ã€éé˜»å¡ç¨‹å¼è¨­è¨ˆçš„å¼·å¤§å·¥å…·ã€‚é€é Project Reactor å’Œ Spring WebFluxï¼Œæˆ‘å€‘å¯ä»¥ï¼š\næ ¸å¿ƒå„ªå‹¢ é«˜æ•ˆèƒ½ï¼šéé˜»å¡ I/O æå‡ç³»çµ±ååé‡ å¯æ“´å±•æ€§ï¼šæ›´å¥½åœ°åˆ©ç”¨ç³»çµ±è³‡æº å½ˆæ€§ï¼šå…§å»ºéŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶ çµ„åˆæ€§ï¼šè±å¯Œçš„æ“ä½œç¬¦æ”¯æ´è¤‡é›œçš„è³‡æ–™æµè™•ç† æœ€ä½³å¯¦è¸è¦é» é©ç•¶å ´æ™¯ï¼šI/O å¯†é›†å‹æ‡‰ç”¨ç¨‹å¼æœ€é©åˆ æ“ä½œç¬¦é¸æ“‡ï¼šç†è§£ä¸åŒæ“ä½œç¬¦çš„ç‰¹æ€§å’Œé©ç”¨å ´æ™¯ éŒ¯èª¤è™•ç†ï¼šè¨­è¨ˆå®Œå–„çš„éŒ¯èª¤è™•ç†ç­–ç•¥ æ¸¬è©¦ï¼šä½¿ç”¨ StepVerifier é€²è¡Œå®Œæ•´æ¸¬è©¦ ç›£æ§ï¼šå»ºç«‹é©ç•¶çš„æ—¥èªŒå’Œåº¦é‡æ©Ÿåˆ¶ éŸ¿æ‡‰å¼ç¨‹å¼è¨­è¨ˆé›–ç„¶å­¸ç¿’æ›²ç·šè¼ƒé™¡ï¼Œä½†æŒæ¡å¾Œèƒ½é¡¯è‘—æå‡æ‡‰ç”¨ç¨‹å¼çš„æ•ˆèƒ½å’Œå¯ç¶­è­·æ€§ï¼Œç‰¹åˆ¥é©åˆç¾ä»£å¾®æœå‹™æ¶æ§‹å’Œé›²ç«¯ç’°å¢ƒã€‚\nåƒè€ƒè³‡æ–™ Project Reactor å®˜æ–¹æ–‡æª” Spring WebFlux åƒè€ƒæŒ‡å— Reactive Streams è¦ç¯„ R2DBC éŸ¿æ‡‰å¼è³‡æ–™åº«å­˜å– Reactor 3 Reference Guide ","permalink":"https://xinqilin.github.io/post/backend/reactivejava/","tags":["Java","Spring","WebFlux","Reactor","Reactive","Async","Mono","Flux"],"title":"Reactive Programming å®Œæ•´æŒ‡å—ï¼šSpring WebFlux èˆ‡ Project Reactor"},{"content":"#721 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 Input: accounts = [ [\u0026#34;John\u0026#34;,\u0026#34;johnsmith@mail.com\u0026#34;,\u0026#34;john_newyork@mail.com\u0026#34;], [\u0026#34;John\u0026#34;,\u0026#34;johnsmith@mail.com\u0026#34;,\u0026#34;john00@mail.com\u0026#34;], [\u0026#34;Mary\u0026#34;,\u0026#34;mary@mail.com\u0026#34;], [\u0026#34;John\u0026#34;,\u0026#34;johnnybravo@mail.com\u0026#34;] ] Output: [ [\u0026#34;John\u0026#34;,\u0026#34;john00@mail.com\u0026#34;,\u0026#34;john_newyork@mail.com\u0026#34;,\u0026#34;johnsmith@mail.com\u0026#34;], [\u0026#34;Mary\u0026#34;,\u0026#34;mary@mail.com\u0026#34;], [\u0026#34;John\u0026#34;,\u0026#34;johnnybravo@mail.com\u0026#34;] ] Explanation: The first and second John\u0026#39;s are the same person as they have the common email \u0026#34;johnsmith@mail.com\u0026#34;. The third John and Mary are different people as none of their email addresses are used by other accounts. We could return these lists in any order, for example the answer [[\u0026#39;Mary\u0026#39;, \u0026#39;mary@mail.com\u0026#39;], [\u0026#39;John\u0026#39;, \u0026#39;johnnybravo@mail.com\u0026#39;], [\u0026#39;John\u0026#39;, \u0026#39;john00@mail.com\u0026#39;, \u0026#39;john_newyork@mail.com\u0026#39;, \u0026#39;johnsmith@mail.com\u0026#39;]] would still be accepted. Sol: Graph + DFS ref: click me!\n1 2 3 4 5 6 7 Use these edges to build some components. Common email addresses are like the intersections that connect each single component for each account. Because each component represents a merged account, do DFS search for each components and add into a list. Before add the name into this list, sort the emails. Then add name string into it. Examples: Assume we have three accounts, we connect them like this in order to use DFS. {Name, 1, 2, 3} =\u0026gt; Name -- 1 -- 2 -- 3 {Name, 2, 4, 5} =\u0026gt; Name -- 2 -- 4 -- 5 (The same graph node 2 appears) {Name, 6, 7, 8} =\u0026gt; Name -- 6 -- 7 -- 8 (Where numbers represent email addresses). 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 class Solution { public List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; accountsMerge(List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; accounts) { List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); if(accounts==null || accounts.size()==0) return result; Map\u0026lt;String, String\u0026gt; names = new HashMap\u0026lt;String, String\u0026gt;(); //email - username Map\u0026lt;String, Set\u0026lt;String\u0026gt;\u0026gt; map = new HashMap\u0026lt;String, Set\u0026lt;String\u0026gt;\u0026gt;(); //email - neighbors Set\u0026lt;String\u0026gt; emails = new HashSet\u0026lt;String\u0026gt;(); for(List\u0026lt;String\u0026gt; list : accounts){ String name = list.get(0); for(int i=1; i\u0026lt;list.size(); i++){ String email = list.get(i); emails.add( email ); names.put( email, name ); map.putIfAbsent( email, new HashSet\u0026lt;String\u0026gt;() ); if(i==1) continue; //build the \u0026#34;edge\u0026#34; between two adjacent email-nodes map.get( list.get(i-1) ).add( email ); map.get( email ).add( list.get(i-1) ); } } Set\u0026lt;String\u0026gt; visited = new HashSet\u0026lt;String\u0026gt;(); for(String s : emails) if( !visited.contains(s) ){ visited.add(s); List\u0026lt;String\u0026gt; buffer = new ArrayList\u0026lt;String\u0026gt;(); buffer.add(s); helper(s, map, visited, buffer); Collections.sort(buffer); buffer.add(0, names.get(s)); result.add(buffer); } return result; } private void helper(String s, Map\u0026lt;String, Set\u0026lt;String\u0026gt;\u0026gt; map, Set\u0026lt;String\u0026gt; visited, List\u0026lt;String\u0026gt; buffer){ for(String node : map.get(s)) if( !visited.contains(node) ){ visited.add(node); buffer.add(node); helper(node, map, visited, buffer); } } } BFS 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 public List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; accountsMerge(List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; accounts) { HashMap\u0026lt;String,String\u0026gt; emailName = new HashMap\u0026lt;\u0026gt;(); HashMap\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; graph = new HashMap\u0026lt;\u0026gt;(); for(List\u0026lt;String\u0026gt; account: accounts){ String name = account.get(0); graph.putIfAbsent(account.get(1), new LinkedList\u0026lt;\u0026gt;()); emailName.put(account.get(1), name); for(int i = 2; i \u0026lt; account.size(); i++){ emailName.put(account.get(i), name); graph.putIfAbsent(account.get(i), new LinkedList\u0026lt;\u0026gt;()); graph.get(account.get(i)).add(account.get(1)); graph.get(account.get(1)).add(account.get(i)); } } List\u0026lt;List\u0026lt;String\u0026gt;\u0026gt; res = new LinkedList\u0026lt;\u0026gt;(); HashSet\u0026lt;String\u0026gt; visited = new HashSet\u0026lt;\u0026gt;(); for(String email: graph.keySet()){ if(visited.contains(email)) continue; visited.add(email); String name = emailName.get(email); List\u0026lt;String\u0026gt; emails = new LinkedList\u0026lt;\u0026gt;(); Queue\u0026lt;String\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); queue.offer(email); while(!queue.isEmpty()){ String cur = queue.poll(); emails.add(cur); for(String next: graph.get(cur)){ if(!visited.contains(next)){ queue.offer(next); visited.add(next); } } } Collections.sort(emails); emails.add(0,name); res.add(emails); } return res; } ","permalink":"https://xinqilin.github.io/post/algorithm/graphaccountmerge/","tags":["Algorithm"],"title":"GraphAccountMerge"},{"content":"æ¦‚è¿° äºŒå…ƒæ¨¹éæ­·æ˜¯è³‡æ–™çµæ§‹èˆ‡æ¼”ç®—æ³•ä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦æœ‰ä¸‰ç¨®éæ­·æ–¹å¼ï¼šå‰åºéæ­·ï¼ˆPreOrderï¼‰ã€ä¸­åºéæ­·ï¼ˆInOrderï¼‰ã€å¾Œåºéæ­·ï¼ˆPostOrderï¼‰ã€‚æ¯ç¨®éæ­·æ–¹å¼éƒ½æœ‰å…¶ç‰¹å®šçš„æ‡‰ç”¨å ´æ™¯å’Œå„ªå‹¢ã€‚\nåŸºæœ¬æ¦‚å¿µ è€ƒæ…®ä»¥ä¸‹äºŒå…ƒæ¨¹çµæ§‹ï¼š\n1 2 3 4 5 4 / \\ 2 6 / \\ / \\ 1 3 5 7 ä¸‰ç¨®éæ­·æ–¹å¼çš„é †åº å‰åºéæ­·ï¼ˆPreOrderï¼‰ï¼šä¸­ â†’ å·¦ â†’ å³\néæ­·é †åºï¼š4 â†’ 2 â†’ 1 â†’ 3 â†’ 6 â†’ 5 â†’ 7 ä¸­åºéæ­·ï¼ˆInOrderï¼‰ï¼šå·¦ â†’ ä¸­ â†’ å³\néæ­·é †åºï¼š1 â†’ 2 â†’ 3 â†’ 4 â†’ 5 â†’ 6 â†’ 7 å°æ–¼äºŒå…ƒæœå°‹æ¨¹ï¼Œä¸­åºéæ­·å¯å¾—åˆ°æœ‰åºåºåˆ— å¾Œåºéæ­·ï¼ˆPostOrderï¼‰ï¼šå·¦ â†’ å³ â†’ ä¸­\néæ­·é †åºï¼š1 â†’ 3 â†’ 2 â†’ 5 â†’ 7 â†’ 6 â†’ 4 éæ­·å¯¦ä½œ 1. ä¸­åºéæ­·ï¼ˆInOrder Traversalï¼‰ ä¸­åºéæ­·åœ¨äºŒå…ƒæœå°‹æ¨¹ä¸­ç‰¹åˆ¥æœ‰ç”¨ï¼Œå› ç‚ºå®ƒæœƒæŒ‰å‡åºè¨ªå•æ‰€æœ‰ç¯€é»ã€‚\néæ­¸å¯¦ä½œ 1 2 3 4 5 6 7 public void inorderTraversal(TreeNode root) { if (root == null) return; inorderTraversal(root.left); // éæ­·å·¦å­æ¨¹ System.out.print(root.val + \u0026#34; \u0026#34;); // è™•ç†æ ¹ç¯€é» inorderTraversal(root.right); // éæ­·å³å­æ¨¹ } è¿­ä»£å¯¦ä½œï¼ˆä½¿ç”¨å †ç–Šï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public List\u0026lt;Integer\u0026gt; inorderTraversal(TreeNode root) { List\u0026lt;Integer\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); Stack\u0026lt;TreeNode\u0026gt; stack = new Stack\u0026lt;\u0026gt;(); TreeNode current = root; while (current != null || !stack.isEmpty()) { // å°‡æ‰€æœ‰å·¦å­ç¯€é»æ¨å…¥å †ç–Š while (current != null) { stack.push(current); current = current.left; } // è™•ç†å †ç–Šé ‚éƒ¨ç¯€é» current = stack.pop(); result.add(current.val); // ç§»å‹•åˆ°å³å­æ¨¹ current = current.right; } return result; } 2. å‰åºéæ­·ï¼ˆPreOrder Traversalï¼‰ å‰åºéæ­·é©ç”¨æ–¼è¤‡è£½æ¨¹çµæ§‹æˆ–å»ºç«‹è¡¨é”å¼æ¨¹ç­‰å ´æ™¯ã€‚\néæ­¸å¯¦ä½œ 1 2 3 4 5 6 7 public void preorderTraversal(TreeNode root) { if (root == null) return; System.out.print(root.val + \u0026#34; \u0026#34;); // è™•ç†æ ¹ç¯€é» preorderTraversal(root.left); // éæ­·å·¦å­æ¨¹ preorderTraversal(root.right); // éæ­·å³å­æ¨¹ } è¿­ä»£å¯¦ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public List\u0026lt;Integer\u0026gt; preorderTraversal(TreeNode root) { List\u0026lt;Integer\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); if (root == null) return result; Stack\u0026lt;TreeNode\u0026gt; stack = new Stack\u0026lt;\u0026gt;(); stack.push(root); while (!stack.isEmpty()) { TreeNode current = stack.pop(); result.add(current.val); // æ³¨æ„ï¼šå…ˆæ¨å…¥å³å­ç¯€é»ï¼Œå†æ¨å…¥å·¦å­ç¯€é» // é€™æ¨£ç¢ºä¿å·¦å­ç¯€é»å…ˆè¢«è™•ç† if (current.right != null) { stack.push(current.right); } if (current.left != null) { stack.push(current.left); } } return result; } 3. å¾Œåºéæ­·ï¼ˆPostOrder Traversalï¼‰ å¾Œåºéæ­·é©ç”¨æ–¼è¨ˆç®—æ¨¹çš„å¤§å°ã€åˆªé™¤ç¯€é»æˆ–è¨ˆç®—è¡¨é”å¼å€¼ç­‰å ´æ™¯ã€‚\néæ­¸å¯¦ä½œ 1 2 3 4 5 6 7 public void postorderTraversal(TreeNode root) { if (root == null) return; postorderTraversal(root.left); // éæ­·å·¦å­æ¨¹ postorderTraversal(root.right); // éæ­·å³å­æ¨¹ System.out.print(root.val + \u0026#34; \u0026#34;); // è™•ç†æ ¹ç¯€é» } è¿­ä»£å¯¦ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public List\u0026lt;Integer\u0026gt; postorderTraversal(TreeNode root) { List\u0026lt;Integer\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(); if (root == null) return result; Stack\u0026lt;TreeNode\u0026gt; stack = new Stack\u0026lt;\u0026gt;(); TreeNode lastVisited = null; TreeNode current = root; while (current != null || !stack.isEmpty()) { if (current != null) { stack.push(current); current = current.left; } else { TreeNode peekNode = stack.peek(); // å¦‚æœå³å­ç¯€é»å­˜åœ¨ä¸”æœªè¢«è¨ªå•é if (peekNode.right != null \u0026amp;\u0026amp; lastVisited != peekNode.right) { current = peekNode.right; } else { result.add(peekNode.val); lastVisited = stack.pop(); } } } return result; } å¯¦éš›æ‡‰ç”¨ï¼šå¾éæ­·åºåˆ—é‡å»ºäºŒå…ƒæ¨¹ 1. å¾ä¸­åºèˆ‡å¾Œåºéæ­·é‡å»ºäºŒå…ƒæ¨¹ LeetCode 106. Construct Binary Tree from Inorder and Postorder Traversal\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 public class Solution { public TreeNode buildTree(int[] inorder, int[] postorder) { if (inorder == null || inorder.length == 0 || postorder == null || postorder.length == 0) { return null; } return helper(postorder, postorder.length - 1, inorder, 0, inorder.length - 1); } private TreeNode helper(int[] postorder, int postIndex, int[] inorder, int inStart, int inEnd) { if (inStart \u0026gt; inEnd || postIndex \u0026lt; 0) { return null; } // å¾Œåºéæ­·çš„æœ€å¾Œä¸€å€‹å…ƒç´ æ˜¯æ ¹ç¯€é» TreeNode root = new TreeNode(postorder[postIndex]); // åœ¨ä¸­åºéæ­·ä¸­æ‰¾åˆ°æ ¹ç¯€é»çš„ä½ç½® int rootIndex = 0; for (int i = inStart; i \u0026lt;= inEnd; i++) { if (inorder[i] == root.val) { rootIndex = i; break; } } // éæ­¸å»ºæ§‹å·¦å³å­æ¨¹ // æ³¨æ„ï¼šå…ˆå»ºæ§‹å³å­æ¨¹ï¼Œå› ç‚ºå¾Œåºéæ­·æ˜¯å·¦-å³-æ ¹ root.right = helper(postorder, postIndex - 1, inorder, rootIndex + 1, inEnd); root.left = helper(postorder, postIndex - (inEnd - rootIndex + 1), inorder, inStart, rootIndex - 1); return root; } } 2. å¾å‰åºèˆ‡ä¸­åºéæ­·é‡å»ºäºŒå…ƒæ¨¹ LeetCode 105. Construct Binary Tree from Preorder and Inorder Traversal\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 public class Solution { public TreeNode buildTree(int[] preorder, int[] inorder) { return helper(preorder, inorder, 0, 0, inorder.length - 1); } private TreeNode helper(int[] preorder, int[] inorder, int preStart, int inStart, int inEnd) { if (preStart \u0026gt; preorder.length - 1 || inStart \u0026gt; inEnd) { return null; } // å‰åºéæ­·çš„ç¬¬ä¸€å€‹å…ƒç´ æ˜¯æ ¹ç¯€é» TreeNode root = new TreeNode(preorder[preStart]); // åœ¨ä¸­åºéæ­·ä¸­æ‰¾åˆ°æ ¹ç¯€é»çš„ä½ç½® int rootIndex = 0; for (int i = inStart; i \u0026lt;= inEnd; i++) { if (inorder[i] == preorder[preStart]) { rootIndex = i; break; } } // éæ­¸å»ºæ§‹å·¦å³å­æ¨¹ root.left = helper(preorder, inorder, preStart + 1, inStart, rootIndex - 1); root.right = helper(preorder, inorder, preStart + rootIndex - inStart + 1, rootIndex + 1, inEnd); return root; } } æ™‚é–“èˆ‡ç©ºé–“è¤‡é›œåº¦ éæ­·æ–¹å¼ æ™‚é–“è¤‡é›œåº¦ ç©ºé–“è¤‡é›œåº¦ï¼ˆéæ­¸ï¼‰ ç©ºé–“è¤‡é›œåº¦ï¼ˆè¿­ä»£ï¼‰ å‰åºéæ­· O(n) O(h) O(h) ä¸­åºéæ­· O(n) O(h) O(h) å¾Œåºéæ­· O(n) O(h) O(h) å…¶ä¸­ n æ˜¯ç¯€é»æ•¸é‡ï¼Œh æ˜¯æ¨¹çš„é«˜åº¦ï¼ˆæœ€å£æƒ…æ³ä¸‹ h = nï¼Œæœ€ä½³æƒ…æ³ä¸‹ h = log nï¼‰ã€‚\næ‡‰ç”¨å ´æ™¯ç¸½çµ å‰åºéæ­·ï¼šè¤‡è£½æ¨¹ã€åºåˆ—åŒ–æ¨¹çµæ§‹ã€å»ºç«‹è¡¨é”å¼æ¨¹ ä¸­åºéæ­·ï¼šäºŒå…ƒæœå°‹æ¨¹çš„æœ‰åºè¼¸å‡ºã€é©—è­‰äºŒå…ƒæœå°‹æ¨¹ å¾Œåºéæ­·ï¼šè¨ˆç®—æ¨¹çš„å¤§å°ã€åˆªé™¤æ¨¹ã€è¨ˆç®—è¡¨é”å¼å€¼ã€é‡‹æ”¾è¨˜æ†¶é«” åƒè€ƒè³‡æ–™ LeetCode 94. Binary Tree Inorder Traversal LeetCode 144. Binary Tree Preorder Traversal LeetCode 145. Binary Tree Postorder Traversal æ¼”ç®—æ³•å°è«– - äºŒå…ƒæ¨¹çš„åŸºæœ¬æ“ä½œ ","permalink":"https://xinqilin.github.io/post/algorithm/treetraversal/","tags":["Algorithm","Tree","éæ­¸","Java"],"title":"äºŒå…ƒæ¨¹éæ­·ï¼ˆBinary Tree Traversalï¼‰å®Œæ•´æŒ‡å—"},{"content":"TreeMap Method Map \u0026lt;-ç¹¼æ‰¿ SortedMap \u0026lt;-ç¹¼æ‰¿ NavigableMap \u0026lt;-å¯¦ä½œ TreeMap\nSortedMap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public interface SortedMap\u0026lt;K,V\u0026gt; extends Map\u0026lt;K,V\u0026gt; { //return å…ƒç´ comparatorã€‚å¦‚æœæ˜¯ ASCï¼Œåˆ™è¿”å›nullï¼› Comparator\u0026lt;? super K\u0026gt; comparator(); //fromKeyåˆ°toKeyçš„é›†åˆï¼šå«é ­ä¸å«å°¾ java.util.SortedMap\u0026lt;K,V\u0026gt; subMap(K fromKey, K toKey); // 0 åˆ°toKeyçš„é›†åˆï¼šä¸åŒ…å«toKey java.util.SortedMap\u0026lt;K,V\u0026gt; headMap(K toKey); //è¿”å› fromKey åˆ°ç»“å°¾çš„é›†åˆï¼šåŒ…å«fromKey java.util.SortedMap\u0026lt;K,V\u0026gt; tailMap(K fromKey); //è¿”å›é›†åˆä¸­çš„ç¬¬ä¸€å€‹å…ƒç´ ï¼š K firstKey(); //è¿”å›é›†åˆä¸­çš„æœ€åä¸€å€‹å…ƒç´ ï¼š K lastKey(); //è¿”å›é›†åˆä¸­æ‰€æœ‰keyçš„é›†åˆï¼š Set\u0026lt;K\u0026gt; keySet(); //è¿”å›é›†åˆä¸­æ‰€æœ‰valueçš„é›†åˆï¼š Collection\u0026lt;V\u0026gt; values(); //è¿”å›é›†åˆä¸­çš„å…ƒç´ æ˜ å°„ï¼š Set\u0026lt;Map.Entry\u0026lt;K, V\u0026gt;\u0026gt; entrySet(); } NavigableMap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 public interface NavigableMap\u0026lt;K,V\u0026gt; extends SortedMap\u0026lt;K,V\u0026gt; { //è¿”å› \u0026lt; keyçš„ç¬¬ä¸€å€‹å…ƒç´ ï¼š Map.Entry\u0026lt;K,V\u0026gt; lowerEntry(K key); // è¿”å› \u0026lt; keyçš„ç¬¬ä¸€å€‹ keyï¼š K lowerKey(K key); // è¿”å› \u0026lt;= keyçš„ç¬¬ä¸€å€‹å…ƒç´ ï¼š Map.Entry\u0026lt;K,V\u0026gt; floorEntry(K key); //è¿”å› \u0026lt;= keyçš„ç¬¬ä¸€å€‹é”®ï¼š K floorKey(K key); //è¿”å› \u0026gt;= keyçš„ç¬¬ä¸€å€‹å…ƒç´ ï¼š Map.Entry\u0026lt;K,V\u0026gt; ceilingEntry(K key); //è¿”å› \u0026gt;= keyçš„ç¬¬ä¸€å€‹é”®ï¼š K ceilingKey(K key); //è¿”å› \u0026gt; keyçš„ç¬¬ä¸€å€‹å…ƒç´ ï¼š Map.Entry\u0026lt;K,V\u0026gt; higherEntry(K key); //è¿”å› \u0026gt; keyçš„ç¬¬ä¸€å€‹é”®ï¼š K higherKey(K key); //return ç¬¬ä¸€å€‹å…ƒç´ ï¼š Map.Entry\u0026lt;K,V\u0026gt; firstEntry(); //return æœ€å¾Œä¸€å€‹å…ƒç´ ï¼š Map.Entry\u0026lt;K,V\u0026gt; lastEntry(); //return ç¬¬ä¸€å€‹å…ƒç´ ï¼Œä¸¦åˆªé™¤ï¼š Map.Entry\u0026lt;K,V\u0026gt; pollFirstEntry(); //return æœ€å¾Œä¸€å€‹å…ƒç´ ï¼Œä¸¦åˆªé™¤ï¼š Map.Entry\u0026lt;K,V\u0026gt; pollLastEntry(); //è¿”å› desc çš„Mapé›†åˆï¼š java.util.NavigableMap\u0026lt;K,V\u0026gt; descendingMap(); NavigableSet\u0026lt;K\u0026gt; navigableKeySet(); //è¿”å›Mapé›†åˆä¸­ desc çš„Keyç»„æˆçš„Seté›†åˆï¼š NavigableSet\u0026lt;K\u0026gt; descendingKeySet(); java.util.NavigableMap\u0026lt;K,V\u0026gt; subMap(K fromKey, boolean fromInclusive, K toKey, boolean toInclusive); java.util.NavigableMap\u0026lt;K,V\u0026gt; headMap(K toKey, boolean inclusive); java.util.NavigableMap\u0026lt;K,V\u0026gt; tailMap(K fromKey, boolean inclusive); SortedMap\u0026lt;K,V\u0026gt; subMap(K fromKey, K toKey); SortedMap\u0026lt;K,V\u0026gt; headMap(K toKey); SortedMap\u0026lt;K,V\u0026gt; tailMap(K fromKey); } Practice Leetcode 2055. Map.Entry ceilingEntry(K key) It returns the key-value pair having the least key, greater than or equal to the specified key, or null if there is no such key. K ceilingKey(K key)\tIt returns the least key, greater than the specified key or null if there is no such key. ","permalink":"https://xinqilin.github.io/post/backend/treemap/","tags":["Java","TreeMap","NavigableMap","Red-Black Tree","Data Structure","Sorting"],"title":"Java TreeMap å®Œæ•´æ–¹æ³•æŒ‡å—ï¼šNavigableMap ä»‹é¢èˆ‡ç´…é»‘æ¨¹å¯¦ä½œ"},{"content":"Maven integration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.querydsl\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;querydsl-apt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${querydsl.version}\u0026lt;/version\u0026gt; \u0026lt;!-- //å¯ä¸å¯«ï¼Œç”± spring è‡ªå‹•åˆ¤æ–· --\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.querydsl\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;querydsl-jpa\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${querydsl.version}\u0026lt;/version\u0026gt; \u0026lt;!-- //å¯ä¸å¯«ï¼Œç”± spring è‡ªå‹•åˆ¤æ–· --\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- æœƒåœ¨ target/generated-sources/kotlin ç”Ÿæˆ @Entity çš„ Qé¡åˆ¥ --\u0026gt; \u0026lt;project\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; ... \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;com.mysema.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;apt-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.1.3\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;process\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;outputDirectory\u0026gt;target/generated-sources/kotlin\u0026lt;/outputDirectory\u0026gt; \u0026lt;processor\u0026gt;com.querydsl.apt.jpa.JPAAnnotationProcessor\u0026lt;/processor\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; ... \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; ç”¢ç”Ÿ Q é¡ 1 mvn clean compile ä½¿ç”¨ select 1 2 3 4 5 6 7 8 9 10 @Autowired lateinit var queryFactory: JPAQueryFactory val qadmin: QAdmin.admin bill = queryFactory.selectFrom(qadmin) .where(qadmin.account.eq(\u0026#34;Bill\u0026#34;)) .and(qadmin.password.ed(\u0026#34;password\u0026#34;)) .fetchOne(); join ===== ä»¥ä¸‹ å®˜ç¶² java ç¯„ä¾‹ =====\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Autowired private JPAQueryFactory queryFactory; QCat cat = QCat.cat; QCat mate = new QCat(\u0026#34;mate\u0026#34;); QCat kitten = new QCat(\u0026#34;kitten\u0026#34;); queryFactory.selectFrom(cat) .innerJoin(cat.mate, mate) .leftJoin(cat.kittens, kitten) .fetch(); queryFactory.selectFrom(cat) .leftJoin(cat.kittens, kitten) .on(kitten.bodyWeight.gt(10.0)) .fetch(); update 1 2 3 4 5 QCustomer customer = QCustomer.customer; // rename customers named Bob to Bobby queryFactory.update(customer).where(customer.name.eq(\u0026#34;Bob\u0026#34;)) .set(customer.name, \u0026#34;Bobby\u0026#34;) .execute(); delete 1 2 3 4 5 QCustomer customer = QCustomer.customer; // delete all customers queryFactory.delete(customer).execute(); // delete all customers with a level less than 3 queryFactory.delete(customer).where(customer.level.lt(3)).execute(); å­æŸ¥è©¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 QDepartment department = QDepartment.department; QDepartment d = new QDepartment(\u0026#34;d\u0026#34;); queryFactory.selectFrom(department) .where(department.size.eq(JPAExpressions.select(d.size.max()).from(d))) .fetch(); //---------- QEmployee employee = QEmployee.employee; QEmployee e = new QEmployee(\u0026#34;e\u0026#34;); queryFactory.selectFrom(employee) .where(employee.weeklyhours.gt( JPAExpressions.select(e.weeklyhours.avg()) .from(employee.department.employees, e) .where(e.manager.eq(employee.manager)))) .fetch(); order by 1 2 3 4 QCustomer customer = QCustomer.customer; queryFactory.selectFrom(customer) .orderBy(customer.lastName.asc(), customer.firstName.desc()) .fetch(); group by 1 2 3 4 QCustomer customer = QCustomer.customer; queryFactory.select(customer.lastName).from(customer) .groupBy(customer.lastName) .fetch(); Reference : å®˜ç¶²ç¯„ä¾‹ è«‹é»æˆ‘!\n","permalink":"https://xinqilin.github.io/post/backend/querydsl/","tags":["QueryDSL","JPA","Spring Data","Database","Query Builder","Type Safety"],"title":"QueryDSL å‹•æ…‹æŸ¥è©¢æ¡†æ¶ï¼šé¡å‹å®‰å…¨çš„ SQL æŸ¥è©¢å»ºæ§‹å™¨"},{"content":"lateinitï¼šå»¶é²åˆå§‹åŒ– ç•¶ä¸æƒ³è¨­å®š init value åˆä¸æƒ³åŠ ä¸Š !! ï¼Œ ?. ï¼Œ è²“ç‹é‹ç®— æ™‚ å¯ä»¥ä½¿ç”¨\nex: DI æ™‚å¯ä»¥ä½¿ç”¨\n1 lateinit var adminUserRepository: AdminUserRepository lateinit with val 1 lateinit modifier is allowed only on mutable properties lateinit ç®—æœ‰é»èªæ³•ç³–ï¼Œå¼·åˆ¶ä¸åˆå§‹åŒ–ï¼Œç¹écompilerï¼Œä½†è¦å°å¿ƒ ä¹‹å¾Œä¸€å®šè¦çµ¦å€¼ï¼Œä¸ç„¶å°±è¸©åˆ°è‡ªå·±åŸ‹çš„åœ°é›· æª¢æŸ¥ lateinit æ˜¯å¦å·²çµ¦å€¼:\n1 xxx.isInitialized ","permalink":"https://xinqilin.github.io/post/backend/lateinit/","tags":["Kotlin","lateinit","Property","Initialization","Android"],"title":"Kotlin lateinit é—œéµå­—è©³è§£ï¼šå»¶é²åˆå§‹åŒ–èˆ‡ä½¿ç”¨æœ€ä½³å¯¦è¸"},{"content":"æ¦‚è¿° cURLï¼ˆClient URLï¼‰æ˜¯ä¸€å€‹åŠŸèƒ½å¼·å¤§çš„å‘½ä»¤è¡Œå·¥å…·å’Œå‡½å¼åº«ï¼Œç”¨æ–¼å‚³è¼¸å„ç¨®ç¶²è·¯å”å®šçš„è³‡æ–™ã€‚å®ƒæ”¯æ´ HTTPã€HTTPSã€FTPã€SFTPã€TELNET ç­‰å¤šç¨®å”å®šï¼Œæ˜¯é–‹ç™¼è€…é€²è¡Œ API æ¸¬è©¦ã€ç¶²è·¯é™¤éŒ¯å’Œè‡ªå‹•åŒ–è…³æœ¬çš„å¿…å‚™å·¥å…·ã€‚\næ ¸å¿ƒç‰¹å¾µ å¤šå”å®šæ”¯æ´ï¼šHTTP/HTTPSã€FTPã€SFTPã€SMTPã€POP3 ç­‰ è±å¯Œçš„é¸é …ï¼šæ”¯æ´å„ç¨® HTTP æ–¹æ³•ã€æ¨™é ­ã€èªè­‰æ–¹å¼ è·¨å¹³å°ï¼šé©ç”¨æ–¼ Linuxã€macOSã€Windows ç­‰ç³»çµ± è…³æœ¬å‹å¥½ï¼šè¼¸å‡ºæ ¼å¼åŒ–ï¼Œé©åˆè‡ªå‹•åŒ–è™•ç† å®‰å…¨æ€§ï¼šæ”¯æ´ SSL/TLSã€å„ç¨®èªè­‰æ©Ÿåˆ¶ åŸºæœ¬èªæ³• 1 curl [é¸é …] [URL] ç°¡å–®ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # åŸºæœ¬ GET è«‹æ±‚ curl https://httpbin.org/get # æŸ¥çœ‹ HTTP éŸ¿æ‡‰æ¨™é ­ curl -I https://google.com # ä¸‹è¼‰æª”æ¡ˆ curl -o filename.html https://example.com # éœé»˜æ¨¡å¼ curl -s https://api.github.com/users/octocat æ ¸å¿ƒé¸é …è©³è§£ åŸºæœ¬æ“ä½œé¸é … 1 2 3 4 5 6 7 8 9 10 11 12 13 # è¼¸å‡ºæ§åˆ¶ -o, --output \u0026lt;file\u0026gt; # å°‡è¼¸å‡ºå¯«å…¥æª”æ¡ˆ -O, --remote-name # ä½¿ç”¨é ç¨‹æª”æ¡ˆåç¨±å„²å­˜ -s, --silent # éœé»˜æ¨¡å¼ï¼Œä¸é¡¯ç¤ºé€²åº¦ -S, --show-error # é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ -v, --verbose # è©³ç´°è¼¸å‡ºæ¨¡å¼ -w, --write-out \u0026lt;format\u0026gt; # è‡ªè¨‚è¼¸å‡ºæ ¼å¼ # åŸºæœ¬ç¯„ä¾‹ curl -o index.html https://example.com curl -O https://example.com/file.zip curl -s https://api.example.com/data curl -v https://httpbin.org/get HTTP æ–¹æ³•é¸é … 1 2 3 4 5 6 7 8 9 10 11 # è«‹æ±‚æ–¹æ³• -X, --request \u0026lt;method\u0026gt; # æŒ‡å®š HTTP æ–¹æ³• -G, --get # å¼·åˆ¶ä½¿ç”¨ GET æ–¹æ³• -I, --head # åªç²å– HTTP æ¨™é ­ (HEAD æ–¹æ³•) # ç¯„ä¾‹ curl -X POST https://httpbin.org/post curl -X PUT https://httpbin.org/put curl -X DELETE https://httpbin.org/delete curl -X PATCH https://httpbin.org/patch curl -I https://httpbin.org/headers è³‡æ–™å‚³é€é¸é … 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # è³‡æ–™å‚³é€ -d, --data \u0026lt;data\u0026gt; # ç™¼é€ POST è³‡æ–™ -d @filename # å¾æª”æ¡ˆè®€å–è³‡æ–™ -F, --form \u0026lt;name=content\u0026gt; # è¡¨å–®è³‡æ–™ (multipart/form-data) -T, --upload-file \u0026lt;file\u0026gt; # ä¸Šå‚³æª”æ¡ˆ # JSON è³‡æ–™ç¯„ä¾‹ curl -X POST https://httpbin.org/post \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{\u0026#34;name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;age\u0026#34;: 30}\u0026#39; # è¡¨å–®è³‡æ–™ç¯„ä¾‹ curl -X POST https://httpbin.org/post \\ -F \u0026#34;name=John\u0026#34; \\ -F \u0026#34;file=@upload.txt\u0026#34; # å¾æª”æ¡ˆè®€å–è³‡æ–™ curl -X POST https://httpbin.org/post \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d @data.json HTTP æ¨™é ­é¸é … 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ¨™é ­è¨­å®š -H, --header \u0026lt;header\u0026gt; # æ·»åŠ è‡ªè¨‚æ¨™é ­ -A, --user-agent \u0026lt;agent\u0026gt; # è¨­å®š User-Agent -e, --referer \u0026lt;URL\u0026gt; # è¨­å®š Referer -i, --include # åœ¨è¼¸å‡ºä¸­åŒ…å«éŸ¿æ‡‰æ¨™é ­ # ç¯„ä¾‹ curl -H \u0026#34;Authorization: Bearer token123\u0026#34; https://api.example.com curl -H \u0026#34;Content-Type: application/json\u0026#34; \\ -H \u0026#34;Accept: application/json\u0026#34; \\ https://api.example.com curl -A \u0026#34;MyApp/1.0\u0026#34; https://httpbin.org/user-agent curl -e \u0026#34;https://google.com\u0026#34; https://httpbin.org/headers curl -i https://httpbin.org/get HTTP æ–¹æ³•æ‡‰ç”¨ GET è«‹æ±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŸºæœ¬ GET è«‹æ±‚ curl https://jsonplaceholder.typicode.com/posts # å¸¶æŸ¥è©¢åƒæ•¸çš„ GET curl \u0026#34;https://jsonplaceholder.typicode.com/posts?userId=1\u0026#34; # ä½¿ç”¨ -G å’Œ -d æ§‹å»ºæŸ¥è©¢å­—ä¸² curl -G -d \u0026#34;userId=1\u0026#34; -d \u0026#34;id=1\u0026#34; https://jsonplaceholder.typicode.com/posts # å¸¶èªè­‰çš„ GET curl -H \u0026#34;Authorization: Bearer your-token\u0026#34; https://api.example.com/user # è‡ªè¨‚ User-Agent curl -A \u0026#34;Mozilla/5.0 (Custom Agent)\u0026#34; https://httpbin.org/user-agent POST è«‹æ±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # JSON è³‡æ–™ POST curl -X POST https://jsonplaceholder.typicode.com/posts \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;title\u0026#34;: \u0026#34;New Post\u0026#34;, \u0026#34;body\u0026#34;: \u0026#34;This is the content\u0026#34;, \u0026#34;userId\u0026#34;: 1 }\u0026#39; # è¡¨å–®è³‡æ–™ POST curl -X POST https://httpbin.org/post \\ -d \u0026#34;username=john\u0026#34; \\ -d \u0026#34;password=secret\u0026#34; # æª”æ¡ˆä¸Šå‚³ POST curl -X POST https://httpbin.org/post \\ -F \u0026#34;file=@document.pdf\u0026#34; \\ -F \u0026#34;description=Important document\u0026#34; # URL ç·¨ç¢¼è³‡æ–™ curl -X POST https://httpbin.org/post \\ -H \u0026#34;Content-Type: application/x-www-form-urlencoded\u0026#34; \\ -d \u0026#34;name=John%20Doe\u0026amp;email=john%40example.com\u0026#34; PUT å’Œ PATCH è«‹æ±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # PUT æ›´æ–°è³‡æº curl -X PUT https://jsonplaceholder.typicode.com/posts/1 \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;id\u0026#34;: 1, \u0026#34;title\u0026#34;: \u0026#34;Updated Title\u0026#34;, \u0026#34;body\u0026#34;: \u0026#34;Updated content\u0026#34;, \u0026#34;userId\u0026#34;: 1 }\u0026#39; # PATCH éƒ¨åˆ†æ›´æ–° curl -X PATCH https://jsonplaceholder.typicode.com/posts/1 \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{\u0026#34;title\u0026#34;: \u0026#34;Partially Updated Title\u0026#34;}\u0026#39; # æª”æ¡ˆæ›¿æ›ä¸Šå‚³ curl -X PUT https://api.example.com/files/document.pdf \\ -T document.pdf \\ -H \u0026#34;Authorization: Bearer token\u0026#34; DELETE è«‹æ±‚ 1 2 3 4 5 6 7 8 9 10 11 # åŸºæœ¬ DELETE curl -X DELETE https://jsonplaceholder.typicode.com/posts/1 # å¸¶èªè­‰çš„ DELETE curl -X DELETE https://api.example.com/users/123 \\ -H \u0026#34;Authorization: Bearer your-token\u0026#34; # å¸¶ç¢ºèªè³‡æ–™çš„ DELETE curl -X DELETE https://api.example.com/dangerous-action \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{\u0026#34;confirm\u0026#34;: true, \u0026#34;reason\u0026#34;: \u0026#34;No longer needed\u0026#34;}\u0026#39; èªè­‰èˆ‡å®‰å…¨ åŸºæœ¬èªè­‰ 1 2 3 4 5 6 7 8 9 # HTTP Basic Authentication curl -u username:password https://httpbin.org/basic-auth/username/password # å¾æç¤ºè¼¸å…¥å¯†ç¢¼ curl -u username https://httpbin.org/basic-auth/username/password # ä½¿ç”¨ Base64 ç·¨ç¢¼ curl -H \u0026#34;Authorization: Basic $(echo -n username:password | base64)\u0026#34; \\ https://httpbin.org/basic-auth/username/password Bearer Token èªè­‰ 1 2 3 4 5 6 7 8 9 # JWT Token curl -H \u0026#34;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\u0026#34; \\ https://api.example.com/protected # API Key in Header curl -H \u0026#34;X-API-Key: your-api-key\u0026#34; https://api.example.com/data # API Key in Query curl \u0026#34;https://api.example.com/data?api_key=your-api-key\u0026#34; OAuth 2.0 1 2 3 4 5 6 7 8 9 10 # ç²å–å­˜å–ä»¤ç‰Œ curl -X POST https://oauth.example.com/token \\ -H \u0026#34;Content-Type: application/x-www-form-urlencoded\u0026#34; \\ -d \u0026#34;grant_type=client_credentials\u0026#34; \\ -d \u0026#34;client_id=your-client-id\u0026#34; \\ -d \u0026#34;client_secret=your-client-secret\u0026#34; # ä½¿ç”¨å­˜å–ä»¤ç‰Œ curl -H \u0026#34;Authorization: Bearer access-token\u0026#34; \\ https://api.example.com/protected-resource SSL/TLS é¸é … 1 2 3 4 5 6 7 8 9 10 # SSL ç›¸é—œé¸é … -k, --insecure # å…è¨±ä¸å®‰å…¨çš„ SSL é€£æ¥ --cert \u0026lt;certificate\u0026gt; # å®¢æˆ¶ç«¯è­‰æ›¸ --key \u0026lt;private-key\u0026gt; # ç§é‘°æª”æ¡ˆ --cacert \u0026lt;CA-certificate\u0026gt; # CA è­‰æ›¸æª”æ¡ˆ # ç¯„ä¾‹ curl -k https://self-signed.example.com curl --cert client.crt --key client.key https://secure.example.com curl --cacert ca-bundle.crt https://secure.example.com Cookie è™•ç† Cookie åŸºæœ¬æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ç™¼é€ Cookie curl -b \u0026#34;session=abc123; user=john\u0026#34; https://httpbin.org/cookies # å¾æª”æ¡ˆè®€å– Cookie curl -b cookies.txt https://httpbin.org/cookies # å„²å­˜ Cookie åˆ°æª”æ¡ˆ curl -c cookies.txt https://httpbin.org/cookies/set/session/abc123 # åŒæ™‚è®€å–å’Œå„²å­˜ Cookie curl -b cookies.txt -c cookies.txt https://example.com/login # Cookie Jar æ ¼å¼ curl -b cookie-jar.txt -c cookie-jar.txt https://example.com æœƒè©±ç®¡ç† 1 2 3 4 5 6 7 8 9 # ç™»å…¥ä¸¦ä¿æŒæœƒè©± curl -c session.txt -d \u0026#34;username=john\u0026amp;password=secret\u0026#34; \\ https://example.com/login # ä½¿ç”¨æœƒè©±è¨ªå•å—ä¿è­·é é¢ curl -b session.txt https://example.com/dashboard # ç™»å‡ºä¸¦æ¸…é™¤æœƒè©± curl -b session.txt -c /dev/null https://example.com/logout æª”æ¡ˆå‚³è¼¸ æª”æ¡ˆä¸‹è¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åŸºæœ¬ä¸‹è¼‰ curl -O https://example.com/file.zip # è‡ªè¨‚æª”æ¡ˆå curl -o myfile.zip https://example.com/file.zip # æ–·é»çºŒå‚³ curl -C - -O https://example.com/largefile.zip # é™åˆ¶ä¸‹è¼‰é€Ÿåº¦ curl --limit-rate 100k -O https://example.com/file.zip # ä¸‹è¼‰å¤šå€‹æª”æ¡ˆ curl -O https://example.com/file1.zip -O https://example.com/file2.zip # ä½¿ç”¨ç¯„åœä¸‹è¼‰ curl -r 0-1023 https://example.com/file.txt # ä¸‹è¼‰å‰ 1024 ä½å…ƒçµ„ æª”æ¡ˆä¸Šå‚³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # FTP ä¸Šå‚³ curl -T localfile.txt ftp://ftp.example.com/remote/ # HTTP PUT ä¸Šå‚³ curl -T document.pdf https://api.example.com/upload # è¡¨å–®æª”æ¡ˆä¸Šå‚³ curl -F \u0026#34;file=@document.pdf\u0026#34; -F \u0026#34;title=My Document\u0026#34; \\ https://example.com/upload # å¤šæª”æ¡ˆä¸Šå‚³ curl -F \u0026#34;file1=@doc1.pdf\u0026#34; -F \u0026#34;file2=@doc2.pdf\u0026#34; \\ https://example.com/upload # å¸¶é€²åº¦æ¢çš„ä¸Šå‚³ curl -# -T largefile.zip https://api.example.com/upload é€²éšåŠŸèƒ½ è¼¸å‡ºæ ¼å¼åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # è‡ªè¨‚è¼¸å‡ºæ ¼å¼ curl -w \u0026#34;Status: %{http_code}\\nTime: %{time_total}s\\nSize: %{size_download} bytes\\n\u0026#34; \\ -o /dev/null -s https://example.com # å¸¸ç”¨æ ¼å¼è®Šæ•¸ %{http_code} # HTTP ç‹€æ…‹ç¢¼ %{time_total} # ç¸½è€—æ™‚ %{time_connect} # é€£æ¥æ™‚é–“ %{time_starttransfer} # é–‹å§‹å‚³è¼¸æ™‚é–“ %{size_download} # ä¸‹è¼‰å¤§å° %{size_upload} # ä¸Šå‚³å¤§å° %{speed_download} # ä¸‹è¼‰é€Ÿåº¦ %{speed_upload} # ä¸Šå‚³é€Ÿåº¦ # æ•ˆèƒ½æ¸¬è©¦ç¯„ä¾‹ curl -w \u0026#34;@curl-format.txt\u0026#34; -o /dev/null -s https://example.com å»ºç«‹ curl-format.txt æª”æ¡ˆï¼š\n1 2 3 4 5 6 7 8 time_namelookup: %{time_namelookup}s\\n time_connect: %{time_connect}s\\n time_appconnect: %{time_appconnect}s\\n time_pretransfer: %{time_pretransfer}s\\n time_redirect: %{time_redirect}s\\n time_starttransfer: %{time_starttransfer}s\\n ----------\\n time_total: %{time_total}s\\n é‡å®šå‘è™•ç† 1 2 3 4 5 6 7 8 9 10 11 # è·Ÿéš¨é‡å®šå‘ curl -L https://bit.ly/shortened-url # é™åˆ¶é‡å®šå‘æ¬¡æ•¸ curl -L --max-redirs 5 https://example.com # é¡¯ç¤ºé‡å®šå‘éç¨‹ curl -L -v https://bit.ly/shortened-url # ä¸è·Ÿéš¨é‡å®šå‘ï¼ˆé è¨­ï¼‰ curl https://bit.ly/shortened-url ä»£ç†è¨­å®š 1 2 3 4 5 6 7 8 9 10 11 12 13 # HTTP ä»£ç† curl --proxy http://proxy.example.com:8080 https://httpbin.org/ip # SOCKS ä»£ç† curl --socks5 localhost:1080 https://httpbin.org/ip # ä»£ç†èªè­‰ curl --proxy-user username:password \\ --proxy http://proxy.example.com:8080 \\ https://httpbin.org/ip # æ’é™¤ä»£ç† curl --noproxy localhost,127.0.0.1 https://localhost:8080/api ä¸¦è¡Œè«‹æ±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # èƒŒæ™¯åŸ·è¡Œ curl https://api1.example.com \u0026amp; curl https://api2.example.com \u0026amp; curl https://api3.example.com \u0026amp; wait # ä½¿ç”¨ xargs ä¸¦è¡Œ echo -e \u0026#34;https://api1.example.com\\nhttps://api2.example.com\u0026#34; | \\ xargs -n 1 -P 2 curl -s # å¾ªç’°è«‹æ±‚ for i in {1..5}; do curl -s \u0026#34;https://api.example.com/data/$i\u0026#34; \u0026amp; done wait API æ¸¬è©¦å¯¦æˆ° REST API æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # ä½¿ç”¨è€…ç®¡ç† API æ¸¬è©¦ BASE_URL=\u0026#34;https://jsonplaceholder.typicode.com\u0026#34; # 1. ç²å–æ‰€æœ‰ä½¿ç”¨è€… curl -s \u0026#34;$BASE_URL/users\u0026#34; | jq \u0026#39;.[0:3]\u0026#39; # 2. ç²å–ç‰¹å®šä½¿ç”¨è€… curl -s \u0026#34;$BASE_URL/users/1\u0026#34; | jq \u0026#39;.\u0026#39; # 3. å‰µå»ºæ–°ä½¿ç”¨è€… curl -X POST \u0026#34;$BASE_URL/users\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;johndoe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34; }\u0026#39; | jq \u0026#39;.\u0026#39; # 4. æ›´æ–°ä½¿ç”¨è€… curl -X PUT \u0026#34;$BASE_URL/users/1\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;Jane Doe\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;janedoe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;jane@example.com\u0026#34; }\u0026#39; | jq \u0026#39;.\u0026#39; # 5. åˆªé™¤ä½¿ç”¨è€… curl -X DELETE \u0026#34;$BASE_URL/users/1\u0026#34; -w \u0026#34;Status: %{http_code}\\n\u0026#34; API æ•ˆèƒ½æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # éŸ¿æ‡‰æ™‚é–“æ¸¬è©¦ test_api_performance() { local url=\u0026#34;$1\u0026#34; local requests=\u0026#34;$2\u0026#34; echo \u0026#34;Testing $url with $requests requests...\u0026#34; for i in $(seq 1 $requests); do curl -w \u0026#34;%{time_total}\\n\u0026#34; -o /dev/null -s \u0026#34;$url\u0026#34; done | awk \u0026#39;{sum+=$1; count++} END {print \u0026#34;Average:\u0026#34;, sum/count \u0026#34;s\u0026#34;}\u0026#39; } test_api_performance \u0026#34;https://httpbin.org/delay/1\u0026#34; 5 # ä¸¦ç™¼æ¸¬è©¦ concurrent_test() { local url=\u0026#34;$1\u0026#34; local concurrent=\u0026#34;$2\u0026#34; local total=\u0026#34;$3\u0026#34; echo \u0026#34;Concurrent test: $concurrent parallel requests, $total total\u0026#34; seq 1 $total | xargs -n 1 -P $concurrent -I {} \\ curl -w \u0026#34;Request {}: %{time_total}s\\n\u0026#34; -o /dev/null -s \u0026#34;$url\u0026#34; } concurrent_test \u0026#34;https://httpbin.org/delay/1\u0026#34; 3 10 API å¥åº·æª¢æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/bin/bash # api_health_check.sh check_api_health() { local name=\u0026#34;$1\u0026#34; local url=\u0026#34;$2\u0026#34; local expected_status=\u0026#34;$3\u0026#34; echo -n \u0026#34;Checking $name... \u0026#34; response=$(curl -s -w \u0026#34;HTTPSTATUS:%{http_code}\u0026#34; \u0026#34;$url\u0026#34;) http_code=$(echo \u0026#34;$response\u0026#34; | tr -d \u0026#39;\\n\u0026#39; | sed -E \u0026#39;s/.*HTTPSTATUS:([0-9]{3})$/\\1/\u0026#39;) body=$(echo \u0026#34;$response\u0026#34; | sed -E \u0026#39;s/HTTPSTATUS:[0-9]{3}$//\u0026#39;) if [ \u0026#34;$http_code\u0026#34; -eq \u0026#34;$expected_status\u0026#34; ]; then echo \u0026#34;âœ“ OK (HTTP $http_code)\u0026#34; return 0 else echo \u0026#34;âœ— FAIL (HTTP $http_code)\u0026#34; echo \u0026#34;Response: $body\u0026#34; return 1 fi } # å¥åº·æª¢æŸ¥ check_api_health \u0026#34;Main API\u0026#34; \u0026#34;https://api.example.com/health\u0026#34; 200 check_api_health \u0026#34;User Service\u0026#34; \u0026#34;https://api.example.com/users/1\u0026#34; 200 check_api_health \u0026#34;Auth Service\u0026#34; \u0026#34;https://api.example.com/auth/status\u0026#34; 200 é™¤éŒ¯èˆ‡ç›£æ§ è©³ç´°é™¤éŒ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è©³ç´°æ¨¡å¼ curl -v https://httpbin.org/get # è¿½è¹¤ ASCII æ ¼å¼ curl --trace-ascii debug.txt https://httpbin.org/get # è¿½è¹¤äºŒé€²ä½æ ¼å¼ curl --trace debug.bin https://httpbin.org/get # åªé¡¯ç¤ºæ¨™é ­ curl -I https://httpbin.org/get # é¡¯ç¤ºè«‹æ±‚å’ŒéŸ¿æ‡‰æ¨™é ­ curl -D headers.txt https://httpbin.org/get ç¶²è·¯è¨ºæ–· 1 2 3 4 5 6 7 8 9 10 11 12 13 # DNS è§£ææ™‚é–“ curl -w \u0026#34;DNS lookup: %{time_namelookup}s\\n\u0026#34; -o /dev/null -s https://example.com # é€£æ¥æ™‚é–“åˆ†æ curl -w \u0026#34;Connect: %{time_connect}s, Start transfer: %{time_starttransfer}s, Total: %{time_total}s\\n\u0026#34; \\ -o /dev/null -s https://example.com # æª¢æŸ¥ SSL è­‰æ›¸ curl -vI https://example.com 2\u0026gt;\u0026amp;1 | grep -E \u0026#34;(SSL|TLS|certificate)\u0026#34; # æ¸¬è©¦ä¸åŒ HTTP ç‰ˆæœ¬ curl --http1.1 -I https://example.com curl --http2 -I https://example.com éŒ¯èª¤è™•ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # åŸºæœ¬éŒ¯èª¤è™•ç† if curl -s --fail https://api.example.com/data; then echo \u0026#34;Request successful\u0026#34; else echo \u0026#34;Request failed with exit code $?\u0026#34; fi # è©³ç´°éŒ¯èª¤è³‡è¨Š curl -s -w \u0026#34;Status: %{http_code}, Exit: %{exitcode}\\n\u0026#34; \\ https://httpbin.org/status/404 # é‡è©¦æ©Ÿåˆ¶ retry_curl() { local url=\u0026#34;$1\u0026#34; local max_attempts=3 local attempt=1 while [ $attempt -le $max_attempts ]; do echo \u0026#34;Attempt $attempt of $max_attempts...\u0026#34; if curl -s --fail \u0026#34;$url\u0026#34;; then echo \u0026#34;Success on attempt $attempt\u0026#34; return 0 fi echo \u0026#34;Failed attempt $attempt\u0026#34; ((attempt++)) sleep 2 done echo \u0026#34;All attempts failed\u0026#34; return 1 } retry_curl \u0026#34;https://unstable-api.example.com\u0026#34; å¯¦ç”¨è…³æœ¬ç¯„ä¾‹ 1. API æ‰¹æ¬¡æ¸¬è©¦è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 #!/bin/bash # api_batch_test.sh API_BASE=\u0026#34;https://jsonplaceholder.typicode.com\u0026#34; AUTH_TOKEN=\u0026#34;your-auth-token\u0026#34; # æ¸¬è©¦é…ç½® declare -A TESTS=( [\u0026#34;GET /users\u0026#34;]=\u0026#34;$API_BASE/users\u0026#34; [\u0026#34;GET /posts\u0026#34;]=\u0026#34;$API_BASE/posts\u0026#34; [\u0026#34;GET /user/1\u0026#34;]=\u0026#34;$API_BASE/users/1\u0026#34; [\u0026#34;POST /posts\u0026#34;]=\u0026#34;$API_BASE/posts\u0026#34; ) # åŸ·è¡Œæ¸¬è©¦ run_tests() { echo \u0026#34;Starting API batch tests...\u0026#34; echo \u0026#34;==========================\u0026#34; local passed=0 local failed=0 for test_name in \u0026#34;${!TESTS[@]}\u0026#34;; do local url=\u0026#34;${TESTS[$test_name]}\u0026#34; echo -n \u0026#34;Testing $test_name... \u0026#34; if [[ \u0026#34;$test_name\u0026#34; == \u0026#34;POST\u0026#34;* ]]; then # POST æ¸¬è©¦ response=$(curl -s -w \u0026#34;HTTPSTATUS:%{http_code}\u0026#34; \\ -X POST \u0026#34;$url\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -H \u0026#34;Authorization: Bearer $AUTH_TOKEN\u0026#34; \\ -d \u0026#39;{\u0026#34;title\u0026#34;:\u0026#34;Test\u0026#34;,\u0026#34;body\u0026#34;:\u0026#34;Test content\u0026#34;,\u0026#34;userId\u0026#34;:1}\u0026#39;) else # GET æ¸¬è©¦ response=$(curl -s -w \u0026#34;HTTPSTATUS:%{http_code}\u0026#34; \\ -H \u0026#34;Authorization: Bearer $AUTH_TOKEN\u0026#34; \\ \u0026#34;$url\u0026#34;) fi http_code=$(echo \u0026#34;$response\u0026#34; | tr -d \u0026#39;\\n\u0026#39; | sed -E \u0026#39;s/.*HTTPSTATUS:([0-9]{3})$/\\1/\u0026#39;) if [[ \u0026#34;$http_code\u0026#34; -ge 200 \u0026amp;\u0026amp; \u0026#34;$http_code\u0026#34; -lt 300 ]]; then echo \u0026#34;âœ“ PASS (HTTP $http_code)\u0026#34; ((passed++)) else echo \u0026#34;âœ— FAIL (HTTP $http_code)\u0026#34; ((failed++)) fi done echo \u0026#34;==========================\u0026#34; echo \u0026#34;Results: $passed passed, $failed failed\u0026#34; } run_tests 2. æª”æ¡ˆåŒæ­¥è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/bin/bash # file_sync.sh LOCAL_DIR=\u0026#34;./local_files\u0026#34; REMOTE_BASE=\u0026#34;https://api.example.com/files\u0026#34; AUTH_TOKEN=\u0026#34;your-token\u0026#34; sync_files() { echo \u0026#34;Starting file synchronization...\u0026#34; # ç²å–é ç¨‹æª”æ¡ˆåˆ—è¡¨ remote_files=$(curl -s -H \u0026#34;Authorization: Bearer $AUTH_TOKEN\u0026#34; \\ \u0026#34;$REMOTE_BASE\u0026#34; | jq -r \u0026#39;.[].filename\u0026#39;) for file in $remote_files; do local_file=\u0026#34;$LOCAL_DIR/$file\u0026#34; remote_url=\u0026#34;$REMOTE_BASE/$file\u0026#34; echo -n \u0026#34;Checking $file... \u0026#34; if [ -f \u0026#34;$local_file\u0026#34; ]; then # æ¯”è¼ƒæª”æ¡ˆé›œæ¹Š local_hash=$(sha256sum \u0026#34;$local_file\u0026#34; | cut -d\u0026#39; \u0026#39; -f1) remote_hash=$(curl -s -I -H \u0026#34;Authorization: Bearer $AUTH_TOKEN\u0026#34; \\ \u0026#34;$remote_url\u0026#34; | grep -i \u0026#34;x-file-hash\u0026#34; | cut -d\u0026#39; \u0026#39; -f2 | tr -d \u0026#39;\\r\u0026#39;) if [ \u0026#34;$local_hash\u0026#34; = \u0026#34;$remote_hash\u0026#34; ]; then echo \u0026#34;âœ“ Up to date\u0026#34; continue fi fi # ä¸‹è¼‰æª”æ¡ˆ echo \u0026#34;â¬‡ Downloading...\u0026#34; curl -s -H \u0026#34;Authorization: Bearer $AUTH_TOKEN\u0026#34; \\ -o \u0026#34;$local_file\u0026#34; \u0026#34;$remote_url\u0026#34; if [ $? -eq 0 ]; then echo \u0026#34;âœ“ Downloaded successfully\u0026#34; else echo \u0026#34;âœ— Download failed\u0026#34; fi done } mkdir -p \u0026#34;$LOCAL_DIR\u0026#34; sync_files 3. ç¶²ç«™ç›£æ§è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #!/bin/bash # website_monitor.sh SITES=( \u0026#34;https://example.com\u0026#34; \u0026#34;https://api.example.com/health\u0026#34; \u0026#34;https://cdn.example.com\u0026#34; ) TIMEOUT=10 LOG_FILE=\u0026#34;/var/log/website_monitor.log\u0026#34; log_message() { echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - $1\u0026#34; | tee -a \u0026#34;$LOG_FILE\u0026#34; } check_site() { local url=\u0026#34;$1\u0026#34; local name=$(echo \u0026#34;$url\u0026#34; | sed \u0026#39;s|https\\?://||\u0026#39; | sed \u0026#39;s|/.*||\u0026#39;) response=$(curl -s -w \u0026#34;HTTPSTATUS:%{http_code};TIME:%{time_total}\u0026#34; \\ --max-time \u0026#34;$TIMEOUT\u0026#34; \u0026#34;$url\u0026#34;) if [ $? -eq 0 ]; then http_code=$(echo \u0026#34;$response\u0026#34; | grep -o \u0026#34;HTTPSTATUS:[0-9]*\u0026#34; | cut -d: -f2) time_total=$(echo \u0026#34;$response\u0026#34; | grep -o \u0026#34;TIME:[0-9.]*\u0026#34; | cut -d: -f2) if [ \u0026#34;$http_code\u0026#34; = \u0026#34;200\u0026#34; ]; then log_message \u0026#34;âœ“ $name - OK (${time_total}s)\u0026#34; else log_message \u0026#34;âš  $name - HTTP $http_code (${time_total}s)\u0026#34; fi else log_message \u0026#34;âœ— $name - TIMEOUT or ERROR\u0026#34; fi } log_message \u0026#34;Starting website monitoring...\u0026#34; for site in \u0026#34;${SITES[@]}\u0026#34;; do check_site \u0026#34;$site\u0026#34; done log_message \u0026#34;Monitoring completed\u0026#34; æ•ˆèƒ½æœ€ä½³åŒ– é€£æ¥é‡ç”¨ 1 2 3 4 5 6 7 8 9 10 # HTTP/1.1 Keep-Alive curl --keepalive-time 30 https://api.example.com/endpoint1 curl --keepalive-time 30 https://api.example.com/endpoint2 # HTTP/2 å¤šè·¯å¾©ç”¨ curl --http2 https://example.com/resource1 curl --http2 https://example.com/resource2 # é€£æ¥æ± é…ç½® curl --max-time 30 --connect-timeout 10 https://api.example.com å¿«å–èˆ‡å£“ç¸® 1 2 3 4 5 6 7 8 9 10 # å•Ÿç”¨å£“ç¸® curl -H \u0026#34;Accept-Encoding: gzip, deflate\u0026#34; https://example.com # æ¢ä»¶è«‹æ±‚ curl -H \u0026#34;If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT\u0026#34; \\ https://example.com/data # ETag æ”¯æ´ curl -H \u0026#34;If-None-Match: \\\u0026#34;33a64df551425fcc55e4d42a148795d9f25f89d4\\\u0026#34;\u0026#34; \\ https://example.com/resource æ‰¹æ¬¡å„ªåŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä¸¦è¡Œä¸‹è¼‰ urls=( \u0026#34;https://api.example.com/data1\u0026#34; \u0026#34;https://api.example.com/data2\u0026#34; \u0026#34;https://api.example.com/data3\u0026#34; ) for url in \u0026#34;${urls[@]}\u0026#34;; do curl -s \u0026#34;$url\u0026#34; \u0026gt; \u0026#34;$(basename \u0026#34;$url\u0026#34;).json\u0026#34; \u0026amp; done wait # é™åˆ¶ä¸¦è¡Œæ•¸ printf \u0026#34;%s\\n\u0026#34; \u0026#34;${urls[@]}\u0026#34; | xargs -n 1 -P 3 -I {} \\ sh -c \u0026#39;curl -s \u0026#34;{}\u0026#34; \u0026gt; \u0026#34;$(basename \u0026#34;{}\u0026#34;).json\u0026#34;\u0026#39; å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ SSL/TLS å•é¡Œ 1 2 3 4 5 6 7 8 9 # è­‰æ›¸é©—è­‰å•é¡Œ curl -k https://self-signed.example.com # è·³éé©—è­‰ï¼ˆä¸æ¨è–¦ï¼‰ curl --cacert /path/to/ca-bundle.crt https://example.com # æŒ‡å®š CA # æª¢æŸ¥è­‰æ›¸è³‡è¨Š curl -vI https://example.com 2\u0026gt;\u0026amp;1 | grep -A 10 \u0026#34;Server certificate\u0026#34; # æ¸¬è©¦ SSL é…ç½® curl --tlsv1.2 --ciphers HIGH https://example.com ç·¨ç¢¼å•é¡Œ 1 2 3 4 5 6 7 8 # UTF-8 ç·¨ç¢¼ curl -H \u0026#34;Accept-Charset: utf-8\u0026#34; https://example.com # URL ç·¨ç¢¼ curl \u0026#34;https://example.com/search?q=$(echo \u0026#39;ä¸­æ–‡æŸ¥è©¢\u0026#39; | curl -Gso /dev/null -w %{url_effective} --data-urlencode @- | cut -c3-)\u0026#34; # è™•ç†ç‰¹æ®Šå­—å…ƒ curl -G -d \u0026#34;query=hello world\u0026#34; https://example.com/search è¶…æ™‚èˆ‡é‡è©¦ 1 2 3 4 5 6 7 8 9 # è¶…æ™‚è¨­å®š curl --connect-timeout 10 --max-time 30 https://slow-api.example.com # è‡ªå‹•é‡è©¦ curl --retry 3 --retry-delay 5 https://unstable-api.example.com # æŒ‡æ•¸é€€é¿ curl --retry 3 --retry-delay 1 --retry-max-time 60 \\ https://api.example.com ç¸½çµ æ ¸å¿ƒå„ªå‹¢ å¤šåŠŸèƒ½æ€§ï¼šæ”¯æ´å¤šç¨®å”å®šå’Œæ“ä½œæ–¹å¼ éˆæ´»æ€§ï¼šè±å¯Œçš„é¸é …å’Œé…ç½®èƒ½åŠ› å¯ç¨‹å¼æ€§ï¼šé©åˆè‡ªå‹•åŒ–å’Œè…³æœ¬è™•ç† è·¨å¹³å°ï¼šåœ¨å„ç¨®ç³»çµ±ä¸Šè¡¨ç¾ä¸€è‡´ æ•ˆèƒ½ï¼šé«˜æ•ˆçš„ç¶²è·¯é€šè¨Šå’Œå‚³è¼¸ æœ€ä½³å¯¦è¸ å®‰å…¨ç¬¬ä¸€ï¼šæ­£ç¢ºè™•ç†èªè­‰å’Œ SSL é©—è­‰ éŒ¯èª¤è™•ç†ï¼šå¯¦ä½œé©ç•¶çš„é‡è©¦å’ŒéŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶ æ•ˆèƒ½å„ªåŒ–ï¼šä½¿ç”¨é€£æ¥é‡ç”¨å’Œä¸¦è¡Œè™•ç† æ—¥èªŒè¨˜éŒ„ï¼šä¿ç•™è©³ç´°çš„è«‹æ±‚å’ŒéŸ¿æ‡‰æ—¥èªŒ æ¸¬è©¦è‡ªå‹•åŒ–ï¼šå°‡ API æ¸¬è©¦æ•´åˆåˆ° CI/CD æµç¨‹ å¸¸ç”¨æ¨¡å¼è¨˜æ†¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # API æ¸¬è©¦åŸºæœ¬æ¨¡å¼ curl -X POST https://api.example.com/resource \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -H \u0026#34;Authorization: Bearer token\u0026#34; \\ -d \u0026#39;{\u0026#34;key\u0026#34;: \u0026#34;value\u0026#34;}\u0026#39; # æª”æ¡ˆæ“ä½œæ¨¡å¼ curl -O https://example.com/file.zip # ä¸‹è¼‰ curl -T file.txt https://api.example.com/upload # ä¸Šå‚³ # é™¤éŒ¯æ¨¡å¼ curl -v -I https://example.com # è©³ç´°æ¨™é ­ curl -w \u0026#34;%{http_code}\\n\u0026#34; https://example.com # ç‹€æ…‹ç¢¼ # æ•ˆèƒ½æ¸¬è©¦æ¨¡å¼ curl -w \u0026#34;@curl-format.txt\u0026#34; -o /dev/null -s https://example.com cURL æ˜¯ç¾ä»£é–‹ç™¼è€…å·¥å…·ç®±ä¸­ä¸å¯æˆ–ç¼ºçš„åˆ©å™¨ï¼ŒæŒæ¡å…¶æ ¸å¿ƒåŠŸèƒ½å’Œé€²éšæŠ€å·§ï¼Œèƒ½å¤ å¤§å¹…æå‡ API é–‹ç™¼ã€æ¸¬è©¦å’Œç¶­è­·çš„æ•ˆç‡ã€‚è¨˜ä½ï¼šå¯¦å‹™ä¸­æœ€é‡è¦çš„æ˜¯ç†è§£ HTTP å”å®šåŸºç¤ï¼Œä¸¦å–„ç”¨ cURL çš„è±å¯Œé¸é …ä¾†è§£æ±ºå¯¦éš›å•é¡Œã€‚\nåƒè€ƒè³‡æ–™ cURL å®˜æ–¹æ–‡æª” cURL Tutorial HTTP/1.1 è¦ç¯„ REST API è¨­è¨ˆæŒ‡å— JSON API è¦ç¯„ ","permalink":"https://xinqilin.github.io/post/tools/curl/","tags":["cURL","HTTP","API","REST","Web Development","Command Line","Network"],"title":"cURL å®Œæ•´æŒ‡å—ï¼šHTTP å®¢æˆ¶ç«¯å·¥å…·èˆ‡ API æ¸¬è©¦åˆ©å™¨"},{"content":"æ¦‚è¿° åœ¨ç¾ä»£æ‡‰ç”¨ç¨‹å¼é–‹ç™¼ä¸­ï¼Œä¸€å€‹å°ˆæ¡ˆå¾€å¾€ç”±å¤šå€‹æœå‹™çµ„æˆï¼Œä¾‹å¦‚å‰ç«¯ã€å¾Œç«¯ APIã€è³‡æ–™åº«ã€å¿«å–ç­‰ã€‚é€™äº›æœå‹™å„è‡ªé‹è¡Œåœ¨ä¸åŒçš„å®¹å™¨ä¸­ï¼Œè€Œ Docker Compose æ­£æ˜¯ç‚ºäº†è§£æ±ºé€™ç¨®å¤šå®¹å™¨æ‡‰ç”¨ç¨‹å¼çš„å®šç¾©èˆ‡ç®¡ç†è€Œç”Ÿã€‚\nDocker Compose å…è¨±æ‚¨ä½¿ç”¨ä¸€å€‹ YAML æª”æ¡ˆ (docker-compose.yml) ä¾†å®šç¾©æ‡‰ç”¨ç¨‹å¼çš„æ‰€æœ‰æœå‹™ã€ç¶²è·¯å’Œå„²å­˜å·ï¼Œç„¶å¾Œé€éå–®ä¸€æŒ‡ä»¤å•Ÿå‹•ã€åœæ­¢æˆ–ç®¡ç†æ•´å€‹æ‡‰ç”¨ç¨‹å¼å †ç–Šã€‚é€™æ¥µå¤§åœ°ç°¡åŒ–äº†é–‹ç™¼ã€æ¸¬è©¦å’Œéƒ¨ç½²çš„æµç¨‹ã€‚\nå¸¸ç”¨ Docker Compose æŒ‡ä»¤ ä»¥ä¸‹æ˜¯ Docker Compose çš„ä¸€äº›å¸¸ç”¨æŒ‡ä»¤ï¼Œç”¨æ–¼ç®¡ç†æ‚¨çš„å¤šå®¹å™¨æ‡‰ç”¨ç¨‹å¼ï¼š\næŒ‡ä»¤ èªªæ˜ ç¯„ä¾‹ docker-compose --version é¡¯ç¤º Docker Compose çš„ç‰ˆæœ¬è³‡è¨Šã€‚ docker-compose --version docker-compose -h é¡¯ç¤º Docker Compose çš„å¹«åŠ©è¨Šæ¯ã€‚ docker-compose -h docker-compose up å•Ÿå‹•ä¸¦å»ºç«‹æ‰€æœ‰æœå‹™çš„å®¹å™¨ã€‚å¦‚æœå®¹å™¨å·²å­˜åœ¨ï¼Œå‰‡æœƒé‡æ–°å»ºç«‹ã€‚ docker-compose up docker-compose up -d åœ¨èƒŒæ™¯æ¨¡å¼ (detached mode) å•Ÿå‹•ä¸¦å»ºç«‹æ‰€æœ‰æœå‹™çš„å®¹å™¨ã€‚ docker-compose up -d docker-compose down åœæ­¢ä¸¦ç§»é™¤æ‰€æœ‰æœå‹™çš„å®¹å™¨ã€ç¶²è·¯å’Œé è¨­å„²å­˜å·ã€‚ docker-compose down docker-compose exec \u0026lt;service_name\u0026gt; \u0026lt;command\u0026gt; åœ¨æŒ‡å®šæœå‹™çš„å®¹å™¨ä¸­åŸ·è¡ŒæŒ‡ä»¤ã€‚ docker-compose exec microService /bin/bash docker-compose ps åˆ—å‡ºæ‰€æœ‰æœå‹™çš„å®¹å™¨ç‹€æ…‹ã€‚ docker-compose ps docker-compose top é¡¯ç¤ºæœå‹™å®¹å™¨çš„é‹è¡Œé€²ç¨‹ã€‚ docker-compose top docker-compose logs \u0026lt;service_name\u0026gt; é¡¯ç¤ºæŒ‡å®šæœå‹™å®¹å™¨çš„æ—¥èªŒè¼¸å‡ºã€‚ docker-compose logs microService docker-compose config é©—è­‰ docker-compose.yml æª”æ¡ˆçš„èªæ³•æ˜¯å¦æ­£ç¢ºï¼Œä¸¦é¡¯ç¤ºè§£æå¾Œçš„é…ç½®ã€‚ docker-compose config docker-compose config -q éœé»˜æ¨¡å¼é©—è­‰é…ç½®ï¼Œåªåœ¨æœ‰éŒ¯èª¤æ™‚è¼¸å‡ºè¨Šæ¯ã€‚ docker-compose config -q docker-compose restart \u0026lt;service_name\u0026gt; é‡æ–°å•Ÿå‹•æŒ‡å®šæœå‹™çš„å®¹å™¨ã€‚è‹¥æœªæŒ‡å®šæœå‹™ï¼Œå‰‡é‡æ–°å•Ÿå‹•æ‰€æœ‰æœå‹™ã€‚ docker-compose restart microService docker-compose start \u0026lt;service_name\u0026gt; å•Ÿå‹•æŒ‡å®šæœå‹™çš„å®¹å™¨ã€‚è‹¥æœªæŒ‡å®šæœå‹™ï¼Œå‰‡å•Ÿå‹•æ‰€æœ‰å·²åœæ­¢çš„æœå‹™ã€‚ docker-compose start microService docker-compose stop \u0026lt;service_name\u0026gt; åœæ­¢æŒ‡å®šæœå‹™çš„å®¹å™¨ã€‚è‹¥æœªæŒ‡å®šæœå‹™ï¼Œå‰‡åœæ­¢æ‰€æœ‰é‹è¡Œä¸­çš„æœå‹™ã€‚ docker-compose stop microService å¸¸ç”¨çµ„åˆæŒ‡ä»¤ 1 2 # é©—è­‰é…ç½®å¾Œï¼Œåœæ­¢ä¸¦é‡æ–°å•Ÿå‹•æ‰€æœ‰æœå‹™ docker-compose config -q \u0026amp;\u0026amp; docker-compose down \u0026amp;\u0026amp; docker-compose up -d docker-compose.yml æª”æ¡ˆçµæ§‹è©³è§£ docker-compose.yml æ˜¯ Docker Compose çš„æ ¸å¿ƒé…ç½®æª”æ¡ˆï¼Œå®ƒä½¿ç”¨ YAML èªæ³•ä¾†å®šç¾©æ‡‰ç”¨ç¨‹å¼çš„æœå‹™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 # æŒ‡å®š Docker Compose æª”æ¡ˆæ ¼å¼çš„ç‰ˆæœ¬ï¼Œå»ºè­°ä½¿ç”¨æœ€æ–°ç©©å®šç‰ˆ (ç›®å‰ç‚º \u0026#39;3.x\u0026#39;) version: \u0026#34;3.8\u0026#34; # å»ºè­°ä½¿ç”¨ 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œä»¥æ”¯æ´æ›´å¤šåŠŸèƒ½ # å®šç¾©æ‡‰ç”¨ç¨‹å¼ä¸­çš„æ‰€æœ‰æœå‹™ (å³å®¹å™¨) services: # è‡ªè¨‚æœå‹™åç¨±ï¼Œä¾‹å¦‚ \u0026#39;microService\u0026#39;ã€\u0026#39;web\u0026#39;ã€\u0026#39;db\u0026#39; ç­‰ microService: # æŒ‡å®šæœå‹™æ‰€ä½¿ç”¨çš„ Docker æ˜ åƒæª” image: my_image:1.0 # å®šç¾©å®¹å™¨çš„åç¨±ï¼Œæ–¹ä¾¿è­˜åˆ¥å’Œç®¡ç† container_name: ms_01 # åŸ æ˜ å°„ï¼šå°‡ä¸»æ©ŸåŸ æ˜ å°„åˆ°å®¹å™¨åŸ  (HOST_PORT:CONTAINER_PORT) ports: - \u0026#34;8081:8080\u0026#34; # å°‡ä¸»æ©Ÿçš„ 8081 åŸ æ˜ å°„åˆ°å®¹å™¨çš„ 8080 åŸ  # å„²å­˜å·æ˜ å°„ï¼šå°‡ä¸»æ©Ÿè·¯å¾‘æ˜ å°„åˆ°å®¹å™¨è·¯å¾‘ (HOST_PATH:CONTAINER_PATH) volumes: - /Users/bill/microService:/app # å°‡ä¸»æ©Ÿçš„ /Users/bill/microService ç›®éŒ„æ˜ å°„åˆ°å®¹å™¨çš„ /app ç›®éŒ„ # æŒ‡å®šæœå‹™æ‰€é€£æ¥çš„ç¶²è·¯ networks: - my_network # é€£æ¥åˆ°åç‚º \u0026#39;my_network\u0026#39; çš„ç¶²è·¯ # å®šç¾©æœå‹™çš„å•Ÿå‹•é †åºä¾è³´é—œä¿‚ # æ³¨æ„ï¼šdepends_on åªä¿è­‰æœå‹™å•Ÿå‹•é †åºï¼Œä¸ä¿è­‰æœå‹™å…§éƒ¨æ‡‰ç”¨ç¨‹å¼å®Œå…¨å°±ç·’ # å¯æ­é… https://github.com/vishnubob/wait-for-it æˆ–å…¶ä»–å¥åº·æª¢æŸ¥æ©Ÿåˆ¶ç¢ºä¿æœå‹™å¯ç”¨ depends_on: - redis # microService æœå‹™æœƒåœ¨ redis æœå‹™å•Ÿå‹•å¾Œæ‰å•Ÿå‹• - mysql # microService æœå‹™æœƒåœ¨ mysql æœå‹™å•Ÿå‹•å¾Œæ‰å•Ÿå‹• # ç¯„ä¾‹ï¼šç­‰åŒæ–¼ `docker run -d -p 8081:8080 -v /Users/bill/microService:/app --network my_network` redis: image: redis:6.0.8 # ä½¿ç”¨ Redis 6.0.8 æ˜ åƒæª” ports: - \u0026#34;6379:6379\u0026#34; # æ˜ å°„ Redis é è¨­åŸ  volumes: # æ˜ å°„ Redis é…ç½®æª”ï¼Œè®“å®¹å™¨ä½¿ç”¨è‡ªè¨‚é…ç½® - /app/redis/redis.conf:/etc/redis/redis.conf # æ˜ å°„ Redis è³‡æ–™ç›®éŒ„ï¼Œå¯¦ç¾è³‡æ–™æŒä¹…åŒ– - /app/redis/data:/data networks: - my_network # è¦†å¯«å®¹å™¨çš„é è¨­å•Ÿå‹•æŒ‡ä»¤ï¼Œè®“ Redis ä½¿ç”¨æŒ‡å®šçš„é…ç½®æª”å•Ÿå‹• command: redis-server /etc/redis/redis.conf mysql: image: mysql:5.7 # ä½¿ç”¨ MySQL 5.7 æ˜ åƒæª” # è¨­å®š MySQL å®¹å™¨çš„ç’°å¢ƒè®Šæ•¸ environment: MYSQL_ROOT_PASSWORD: \u0026#39;123456\u0026#39; # è¨­å®š root ä½¿ç”¨è€…çš„å¯†ç¢¼ MYSQL_ALLOW_EMPTY_PASSWORD: \u0026#39;no\u0026#39; # ä¸å…è¨± root å¯†ç¢¼ç‚ºç©º MYSQL_DATABASE: \u0026#39;my_test_db\u0026#39; # å»ºç«‹ä¸€å€‹åç‚º \u0026#39;my_test_db\u0026#39; çš„è³‡æ–™åº« MYSQL_USER: \u0026#39;bill\u0026#39; # å»ºç«‹ä¸€å€‹åç‚º \u0026#39;bill\u0026#39; çš„ä½¿ç”¨è€… MYSQL_PASSWORD: \u0026#39;user_pwd\u0026#39; # è¨­å®š \u0026#39;bill\u0026#39; ä½¿ç”¨è€…çš„å¯†ç¢¼ ports: - \u0026#34;3306:3306\u0026#34; # æ˜ å°„ MySQL é è¨­åŸ  volumes: # æ˜ å°„ MySQL è³‡æ–™ç›®éŒ„ï¼Œå¯¦ç¾è³‡æ–™æŒä¹…åŒ– - /app/mysql/db:/var/lib/mysql # æ˜ å°„ MySQL é…ç½®æª” - /app/mysql/conf/my.cnf:/etc/my.cnf # æ˜ å°„åˆå§‹åŒ–è…³æœ¬ç›®éŒ„ï¼Œå®¹å™¨å•Ÿå‹•æ™‚æœƒåŸ·è¡Œæ­¤ç›®éŒ„ä¸‹çš„ .sh æˆ– .sql è…³æœ¬ - /app/mysql/init:/docker-entrypoint-initdb.d networks: - my_network # è§£æ±º MySQL 8.0 ä¹‹å¾Œé è¨­èªè­‰æ’ä»¶å°è‡´å¤–éƒ¨å®¢æˆ¶ç«¯ç„¡æ³•é€£æ¥çš„å•é¡Œ command: --default-authentication-plugin=mysql_native_password # å®šç¾©æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨çš„ç¶²è·¯ networks: my_network: # è‡ªè¨‚ç¶²è·¯åç¨±ï¼Œæ‰€æœ‰æœå‹™å°‡åœ¨æ­¤ç¶²è·¯ä¸­äº’ç›¸é€šè¨Š # å®šç¾©æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨çš„å„²å­˜å· (å¯é¸ï¼Œå¦‚æœæœå‹™ä¸­ç›´æ¥ä½¿ç”¨åŒ¿åå·æˆ–ç¶å®šæ›è¼‰å‰‡ä¸éœ€è¦åœ¨æ­¤å®šç¾©) # volumes: # my_data: # è‡ªè¨‚å„²å­˜å·åç¨± ","permalink":"https://xinqilin.github.io/post/devops/docker-compose/","tags":["Docker","Docker Compose","DevOps","Containerization","Microservices","YAML"],"title":"Docker Compose å®Œæ•´æŒ‡å—ï¼šå¤šå®¹å™¨æ‡‰ç”¨ç¨‹å¼çš„å®šç¾©èˆ‡åŸ·è¡Œ"},{"content":"æ¦‚è¿° Docker ç¶²è·¯æ˜¯å®¹å™¨åŒ–æ‡‰ç”¨ç¨‹å¼çš„åŸºçŸ³ï¼Œå®ƒæ±ºå®šäº†å®¹å™¨å¦‚ä½•èˆ‡å¤–éƒ¨ä¸–ç•Œé€šè¨Šï¼Œä»¥åŠå®¹å™¨ä¹‹é–“å¦‚ä½•äº’ç›¸é€£æ¥ã€‚ç†è§£ Docker çš„ç¶²è·¯æ¨¡å¼å°æ–¼å»ºæ§‹ç©©å¥ã€å¯æ“´å±•çš„å®¹å™¨åŒ–æ‡‰ç”¨ç¨‹å¼è‡³é—œé‡è¦ã€‚æœ¬æ–‡å°‡è©³ç´°ä»‹ç´¹ Docker æä¾›çš„å¹¾ç¨®ä¸»è¦ç¶²è·¯æ¨¡å¼åŠå…¶æ‡‰ç”¨å ´æ™¯ã€‚\nDocker ç¶²è·¯æ¨¡å¼ Docker æä¾›äº†å¤šç¨®ç¶²è·¯é©…å‹•ç¨‹å¼ï¼Œæ¯ç¨®é©…å‹•ç¨‹å¼éƒ½æä¾›ä¸åŒçš„ç¶²è·¯åŠŸèƒ½ã€‚æœ€å¸¸ç”¨çš„åŒ…æ‹¬ bridgeã€hostã€none å’Œ containerã€‚\n1. Bridge (æ©‹æ¥æ¨¡å¼) èªªæ˜ï¼šé€™æ˜¯ Docker çš„é è¨­ç¶²è·¯æ¨¡å¼ã€‚ç•¶æ‚¨ä¸æŒ‡å®šç¶²è·¯æ¨¡å¼æ™‚ï¼ŒDocker æœƒè‡ªå‹•ç‚ºå®¹å™¨åˆ†é…ä¸€å€‹ IP ä½å€ï¼Œä¸¦å°‡å…¶é€£æ¥åˆ°ä¸€å€‹åç‚º docker0 çš„è™›æ“¬æ©‹æ¥å™¨ä¸Šã€‚æ¯å€‹å®¹å™¨éƒ½æœƒç²å¾—ä¸€å€‹ç¨ç«‹çš„ç¶²è·¯å †ç–Šã€‚ å·¥ä½œåŸç†ï¼š Docker æœƒåœ¨ä¸»æ©Ÿä¸Šå»ºç«‹ä¸€å€‹åç‚º docker0 çš„è™›æ“¬æ©‹æ¥å™¨ã€‚ æ¯å€‹å®¹å™¨éƒ½æœƒå»ºç«‹ä¸€å°è™›æ“¬ä¹™å¤ªç¶²å¡ (veth pair)ï¼Œå…¶ä¸­ä¸€ç«¯é€£æ¥åˆ°å®¹å™¨å…§çš„ eth0ï¼Œå¦ä¸€ç«¯é€£æ¥åˆ° docker0 æ©‹æ¥å™¨ã€‚ å®¹å™¨å¯ä»¥é€é docker0 æ©‹æ¥å™¨èˆ‡åŒä¸€æ©‹æ¥å™¨ä¸Šçš„å…¶ä»–å®¹å™¨é€šè¨Šï¼Œä¹Ÿå¯ä»¥é€éä¸»æ©Ÿçš„ç¶²è·¯ä»‹é¢èˆ‡å¤–éƒ¨ç¶²è·¯é€šè¨Šã€‚ å„ªé»ï¼šæä¾›è‰¯å¥½çš„éš”é›¢æ€§ï¼Œå®¹å™¨é–“é è¨­ä¸ç›´æ¥æš´éœ²åŸ ã€‚ ç¼ºé»ï¼šå®¹å™¨éœ€è¦é€éåŸ æ˜ å°„æ‰èƒ½å¾å¤–éƒ¨è¨ªå•ã€‚ 2. Host (ä¸»æ©Ÿæ¨¡å¼) èªªæ˜ï¼šåœ¨ä¸»æ©Ÿæ¨¡å¼ä¸‹ï¼Œå®¹å™¨ä¸æœƒæœ‰è‡ªå·±çš„ç¨ç«‹ç¶²è·¯å †ç–Šï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ä¸»æ©Ÿçš„ç¶²è·¯å †ç–Šã€‚é€™æ„å‘³è‘—å®¹å™¨æœƒç›´æ¥ä½¿ç”¨ä¸»æ©Ÿçš„ IP ä½å€å’ŒåŸ ã€‚ å·¥ä½œåŸç†ï¼šå®¹å™¨å…§çš„æ‡‰ç”¨ç¨‹å¼æœƒç›´æ¥ç¶å®šåˆ°ä¸»æ©Ÿçš„ç¶²è·¯ä»‹é¢å’ŒåŸ ä¸Šã€‚ å„ªé»ï¼šç¶²è·¯æ•ˆèƒ½æœ€ä½³ï¼Œå› ç‚ºæ²’æœ‰é¡å¤–çš„ç¶²è·¯å±¤ã€‚ ç¼ºé»ï¼š å®¹å™¨ä¸å†èˆ‡ä¸»æ©Ÿéš”é›¢ï¼Œå®¹å™¨å…§æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨çš„åŸ ä¸èƒ½èˆ‡ä¸»æ©Ÿä¸Šå·²ä½”ç”¨çš„åŸ è¡çªã€‚ å®‰å…¨æ€§è¼ƒä½ï¼Œå› ç‚ºå®¹å™¨ç›´æ¥æš´éœ²åœ¨ä¸»æ©Ÿç¶²è·¯ä¸­ã€‚ ä½¿ç”¨æ–¹å¼ï¼š--network host 3. None (ç„¡ç¶²è·¯æ¨¡å¼) èªªæ˜ï¼šåœ¨ç„¡ç¶²è·¯æ¨¡å¼ä¸‹ï¼Œå®¹å™¨æœƒå»ºç«‹ä¸€å€‹ç¨ç«‹çš„ç¶²è·¯å †ç–Šï¼Œä½†ä¸æœƒå°å…¶é€²è¡Œä»»ä½•ç¶²è·¯é…ç½®ã€‚å®¹å™¨å°‡æ²’æœ‰ç¶²è·¯ä»‹é¢ï¼Œç„¡æ³•èˆ‡å¤–éƒ¨é€šè¨Šã€‚ å·¥ä½œåŸç†ï¼šå®¹å™¨åªåŒ…å«ä¸€å€‹ lo (loopback) ä»‹é¢ã€‚ å„ªé»ï¼šé©ç”¨æ–¼åªéœ€è¦è¨ˆç®—è³‡æºè€Œä¸éœ€è¦ç¶²è·¯é€£æ¥çš„ç‰¹æ®Šå ´æ™¯ï¼Œæˆ–è€…éœ€è¦æ‰‹å‹•é…ç½®ç¶²è·¯çš„é€²éšæƒ…æ³ã€‚ ç¼ºé»ï¼šå®¹å™¨ç„¡æ³•é€²è¡Œä»»ä½•ç¶²è·¯é€šè¨Šï¼Œé™¤éæ‰‹å‹•é…ç½®ã€‚ ä½¿ç”¨æ–¹å¼ï¼š--network none 4. Container (å®¹å™¨æ¨¡å¼) èªªæ˜ï¼šåœ¨å®¹å™¨æ¨¡å¼ä¸‹ï¼Œæ–°å»ºç«‹çš„å®¹å™¨ä¸æœƒæœ‰è‡ªå·±çš„ç¶²è·¯å †ç–Šï¼Œè€Œæ˜¯èˆ‡å¦ä¸€å€‹å·²å­˜åœ¨çš„å®¹å™¨å…±äº«å…¶ç¶²è·¯å †ç–Šã€‚é€™æ„å‘³è‘—å…©å€‹å®¹å™¨æœƒå…±äº«åŒä¸€å€‹ IP ä½å€å’ŒåŸ ç©ºé–“ã€‚ å·¥ä½œåŸç†ï¼šå…©å€‹å®¹å™¨å…±äº«åŒä¸€å€‹ç¶²è·¯å‘½åç©ºé–“ã€‚ å„ªé»ï¼šé©ç”¨æ–¼éœ€è¦ç·Šå¯†å”åŒå·¥ä½œçš„æ‡‰ç”¨ç¨‹å¼ï¼Œä¾‹å¦‚ä¸»æ‡‰ç”¨ç¨‹å¼å®¹å™¨å’Œä¸€å€‹ä»£ç†æˆ–æ—¥èªŒæ”¶é›†å®¹å™¨ã€‚ ç¼ºé»ï¼šå…©å€‹å®¹å™¨æœƒå…±äº«åŸ ï¼Œå¯èƒ½å°è‡´åŸ è¡çªã€‚ ä½¿ç”¨æ–¹å¼ï¼š--network container:\u0026lt;name_or_id\u0026gt; å¸¸ç”¨ Docker ç¶²è·¯æŒ‡ä»¤ æŒ‡ä»¤ èªªæ˜ ç¯„ä¾‹ docker network ls åˆ—å‡ºæ‰€æœ‰ Docker ç¶²è·¯ã€‚ docker network ls docker network prune åˆªé™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç¶²è·¯ã€‚ docker network prune docker network inspect \u0026lt;network_name_or_id\u0026gt; é¡¯ç¤ºæŒ‡å®šç¶²è·¯çš„è©³ç´°è³‡è¨Šï¼ŒåŒ…æ‹¬é€£æ¥åˆ°è©²ç¶²è·¯çš„å®¹å™¨ã€‚ docker network inspect bridge docker inspect \u0026lt;container_id\u0026gt; é¡¯ç¤ºæŒ‡å®šå®¹å™¨çš„è©³ç´°è³‡è¨Šï¼ŒåŒ…æ‹¬å…¶ç¶²è·¯é…ç½®ã€‚ docker inspect \u0026lt;container_id\u0026gt; è‡ªè¨‚ç¶²è·¯ (User-defined Bridge Networks) é›–ç„¶ Docker é è¨­çš„ bridge ç¶²è·¯ (docker0) å·²ç¶“è¶³å¤ æ‡‰ä»˜è¨±å¤šæƒ…æ³ï¼Œä½†å¼·çƒˆå»ºè­°æ‚¨å»ºç«‹è‡ªè¨‚æ©‹æ¥ç¶²è·¯ (User-defined Bridge Networks)ã€‚è‡ªè¨‚ç¶²è·¯æä¾›äº†æ›´å¥½çš„éš”é›¢æ€§ã€å…§å»ºçš„ DNS è§£æå’Œæ›´éˆæ´»çš„é…ç½®ã€‚\nå„ªé» å…§å»º DNS è§£æï¼šåœ¨è‡ªè¨‚ç¶²è·¯ä¸­ï¼Œå®¹å™¨å¯ä»¥é€éæœå‹™åç¨±ï¼ˆè€Œä¸æ˜¯ IP ä½å€ï¼‰äº’ç›¸é€šè¨Šï¼Œå› ç‚º Docker æœƒç‚ºè‡ªè¨‚ç¶²è·¯æä¾›å…§å»ºçš„ DNS è§£ææœå‹™ã€‚é€™ä½¿å¾—å®¹å™¨çš„ IP ä½å€è®ŠåŒ–ä¸å†æ˜¯å•é¡Œã€‚ æ›´å¥½çš„éš”é›¢æ€§ï¼šè‡ªè¨‚ç¶²è·¯ä¸­çš„å®¹å™¨é è¨­åªèƒ½èˆ‡åŒä¸€ç¶²è·¯ä¸­çš„å…¶ä»–å®¹å™¨é€šè¨Šï¼Œæä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§ã€‚ å¯ç§»æ¤æ€§ï¼šåœ¨ Docker Compose ä¸­ï¼Œè‡ªè¨‚ç¶²è·¯æ˜¯é è¨­è¡Œç‚ºï¼Œé€™ä½¿å¾—å¤šå®¹å™¨æ‡‰ç”¨ç¨‹å¼çš„å®šç¾©æ›´åŠ ç°¡æ½”å’Œå¯ç§»æ¤ã€‚ å»ºç«‹è‡ªè¨‚ç¶²è·¯ 1 2 # å»ºç«‹ä¸€å€‹åç‚º \u0026#39;my_network\u0026#39; çš„è‡ªè¨‚æ©‹æ¥ç¶²è·¯ docker network create my_network å°‡å®¹å™¨é€£æ¥åˆ°è‡ªè¨‚ç¶²è·¯ åœ¨å•Ÿå‹•å®¹å™¨æ™‚ï¼Œä½¿ç”¨ --network åƒæ•¸æŒ‡å®šè‡ªè¨‚ç¶²è·¯åç¨±ï¼š\n1 2 3 4 5 # å•Ÿå‹•ç¬¬ä¸€å€‹ Tomcat å®¹å™¨ï¼Œé€£æ¥åˆ° \u0026#39;my_network\u0026#39; docker run -d -p 8080:8080 --network my_network --name tomcat_1 tomcat # å•Ÿå‹•ç¬¬äºŒå€‹ Tomcat å®¹å™¨ï¼Œé€£æ¥åˆ° \u0026#39;my_network\u0026#39; docker run -d -p 8081:8080 --network my_network --name tomcat_2 tomcat ç¾åœ¨ï¼Œtomcat_1 å’Œ tomcat_2 å®¹å™¨éƒ½åœ¨ my_network ä¸­ï¼Œå®ƒå€‘å¯ä»¥é€éå½¼æ­¤çš„å®¹å™¨åç¨±ï¼ˆtomcat_1 å’Œ tomcat_2ï¼‰äº’ç›¸é€šè¨Šï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 # é€²å…¥ tomcat_1 å®¹å™¨å…§éƒ¨ docker exec -it tomcat_1 bash # åœ¨ tomcat_1 å®¹å™¨å…§éƒ¨ ping tomcat_2 ping tomcat_2 å®¹å™¨æ¨¡å¼çš„é™åˆ¶èˆ‡è‡ªè¨‚ç¶²è·¯çš„å„ªå‹¢ æ‚¨åŸå…ˆçš„ç¯„ä¾‹ä¸­ï¼Œå˜—è©¦è®“å…©å€‹ Tomcat å®¹å™¨å…±äº«ç¶²è·¯ï¼Œä½†ç”±æ–¼åŸ è¡çªè€Œå¤±æ•—ï¼š\n1 2 3 4 # å‘ ï¼ˆä¸‹é¢èµ·ä¸èµ·ä¾†å› å…©å° tomcat éƒ½ç”¨ 8080 æ˜ å°„å‡ºå»ï¼‰ # å€Ÿç”¨ tomcat_1 ç¶²è·¯ docker run -d -p 8080:8080 --name tomcat_1 tomcat docker run -d -p 8081:8080 --network container:tomcat_1 --name tomcat_2 tomcat # æœƒå¤±æ•—ï¼Œå› ç‚º tomcat_2 è©¦åœ–ä½¿ç”¨ tomcat_1 çš„ 8080 åŸ  é€™æ˜¯å› ç‚ºåœ¨ container æ¨¡å¼ä¸‹ï¼Œå…©å€‹å®¹å™¨å…±äº«åŒä¸€å€‹ç¶²è·¯å‘½åç©ºé–“ï¼ŒåŒ…æ‹¬åŸ ç©ºé–“ã€‚å¦‚æœ tomcat_1 å·²ç¶“ä½”ç”¨äº† 8080 åŸ ï¼Œé‚£éº¼ tomcat_2 å°±ç„¡æ³•å†ä½¿ç”¨é€™å€‹åŸ ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨è‡ªè¨‚ç¶²è·¯å‰‡æ²’æœ‰é€™å€‹å•é¡Œã€‚æ¯å€‹å®¹å™¨åœ¨è‡ªè¨‚ç¶²è·¯ä¸­ä»ç„¶æ“æœ‰è‡ªå·±çš„ç¨ç«‹ç¶²è·¯å †ç–Šå’ŒåŸ ç©ºé–“ï¼Œåªæ˜¯å®ƒå€‘å¯ä»¥é€éç¶²è·¯åç¨±äº’ç›¸ç™¼ç¾å’Œé€šè¨Šã€‚é€™ä½¿å¾—è‡ªè¨‚ç¶²è·¯æˆç‚ºå¤šå®¹å™¨æ‡‰ç”¨ç¨‹å¼ä¹‹é–“é€šè¨Šçš„æ›´å„ªé›…å’Œå¥å£¯çš„è§£æ±ºæ–¹æ¡ˆã€‚\né€éç†è§£å’Œå–„ç”¨ Docker ç¶²è·¯æ¨¡å¼ï¼Œæ‚¨å¯ä»¥æ›´æœ‰æ•ˆåœ°è¨­è¨ˆå’Œç®¡ç†æ‚¨çš„å®¹å™¨åŒ–æ‡‰ç”¨ç¨‹å¼ã€‚\n","permalink":"https://xinqilin.github.io/post/devops/docker-network/","tags":["Docker","Network","DevOps","Containerization","Bridge","Host"],"title":"Docker ç¶²è·¯æ¨¡å¼è©³è§£ï¼šå®¹å™¨é–“é€šè¨Šèˆ‡å¤–éƒ¨é€£æ¥"},{"content":"æ¦‚è¿° åœ¨è‡ªå‹•åŒ–æ¸¬è©¦å’Œç¶²è·¯çˆ¬èŸ²ç­‰å ´æ™¯ä¸­ï¼Œç¶“å¸¸éœ€è¦å°‡æ‡‰ç”¨ç¨‹å¼èˆ‡ç€è¦½å™¨è‡ªå‹•åŒ–å·¥å…· (å¦‚ Selenium) æ‰“åŒ…åˆ°åŒä¸€å€‹ Docker å®¹å™¨ä¸­ã€‚æ­¤å¤–ï¼Œç‚ºäº†æ”¯æ´ä¸åŒçš„é‹è¡Œç’°å¢ƒï¼ˆä¾‹å¦‚ ARM64 æˆ– x86_64 æ¶æ§‹ï¼Œä»¥åŠ Firefox æˆ– Chrome ç€è¦½å™¨ï¼‰ï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹éˆæ´»çš„å»ºæ§‹æµç¨‹ã€‚\næœ¬æ–‡å°‡æ·±å…¥è§£æä¸€å€‹å¤šéšæ®µ Dockerfileï¼Œå®ƒå±•ç¤ºäº†å¦‚ä½•ï¼š\nå»ºæ§‹ä¸€å€‹åŒ…å« Node.js æ‡‰ç”¨ç¨‹å¼çš„åŸºç¤æ˜ åƒæª”ã€‚ åˆ©ç”¨é€™å€‹åŸºç¤æ˜ åƒæª”ï¼Œç‚ºä¸åŒçš„ CPU æ¶æ§‹å’Œç€è¦½å™¨ç’°å¢ƒå»ºç«‹å¤šå€‹æœ€çµ‚çš„ Selenium æ‡‰ç”¨ç¨‹å¼æ˜ åƒæª”ã€‚ é€éä¸€å€‹é€šç”¨çš„ entrypoint.sh è…³æœ¬ï¼Œåœ¨å®¹å™¨å•Ÿå‹•æ™‚è‡ªå‹•åˆ¤æ–·ç’°å¢ƒä¸¦åŸ·è¡Œå°æ‡‰çš„æ¸¬è©¦ã€‚ Dockerfile è©³è§£ é€™å€‹ Dockerfile æ¡ç”¨äº†å¤šéšæ®µå»ºæ§‹ (Multi-stage Builds) çš„æ–¹å¼ï¼Œä»¥ç¢ºä¿æœ€çµ‚æ˜ åƒæª”çš„è¼•é‡åŒ–å’Œæ¨¡çµ„åŒ–ã€‚\nç¬¬ä¸€éšæ®µï¼šæ‡‰ç”¨ç¨‹å¼å»ºæ§‹ (build éšæ®µ) é€™å€‹éšæ®µè² è²¬æº–å‚™ Node.js ç’°å¢ƒä¸¦æ‰“åŒ…æ‡‰ç”¨ç¨‹å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 FROM ubuntu:22.04 AS build # è¨­å®šç’°å¢ƒè®Šæ•¸ ENV NVM_DIR /opt/nvm # NVM (Node Version Manager) çš„å®‰è£ç›®éŒ„ ENV NODE_VERSION v16.13.2 # æŒ‡å®šè¦å®‰è£çš„ Node.js ç‰ˆæœ¬ ENV APP_DIR /app # æ‡‰ç”¨ç¨‹å¼çš„å·¥ä½œç›®éŒ„ # å»ºç«‹å¿…è¦çš„ç›®éŒ„ RUN [ -d $APP_DIR ] || mkdir -p $APP_DIR RUN [ -d $NVM_DIR ] || mkdir -p $NVM_DIR # æ›´æ–°å¥—ä»¶åˆ—è¡¨ä¸¦å®‰è£ curl (ç”¨æ–¼ä¸‹è¼‰ NVM) RUN apt-get update \u0026amp;\u0026amp; apt-get install curl -y # å®‰è£ NVM å’ŒæŒ‡å®šç‰ˆæœ¬çš„ Node.js # å¾ GitHub ä¸‹è¼‰ NVM å®‰è£è…³æœ¬ RUN curl -o $NVM_DIR/install.sh https://raw.githubusercontent.com/nvm-sh/nvm/master/install.sh # åŸ·è¡Œ NVM å®‰è£è…³æœ¬ RUN /bin/bash $NVM_DIR/install.sh # è¨­å®š PATH ç’°å¢ƒè®Šæ•¸ï¼Œå°‡ Node.js å¯åŸ·è¡Œæª”åŠ å…¥è·¯å¾‘ ENV PATH $NVM_DIR/versions/node/$NODE_VERSION/bin:$PATH # è¤‡è£½æ‡‰ç”¨ç¨‹å¼æª”æ¡ˆ COPY test /app/test # è¤‡è£½ \u0026#39;test\u0026#39; ç›®éŒ„ COPY *.js /app/ # è¤‡è£½æ‰€æœ‰ .js æª”æ¡ˆ COPY *.json /app/ # è¤‡è£½æ‰€æœ‰ .json æª”æ¡ˆ COPY *.sh /app/ # è¤‡è£½æ‰€æœ‰ .sh è…³æœ¬ RUN chmod 0755 /app/*.sh # ç‚ºè…³æœ¬æ·»åŠ åŸ·è¡Œæ¬Šé™ # è¨­å®šå·¥ä½œç›®éŒ„ä¸¦å®‰è£ Node.js ä¾è³´ WORKDIR $APP_DIR RUN npm install ç¬¬äºŒéšæ®µï¼šSelenium ç€è¦½å™¨æ˜ åƒæª”å»ºæ§‹ (å¤šå€‹ FROM éšæ®µ) é€™å€‹ Dockerfile ç‚ºä¸åŒçš„ CPU æ¶æ§‹ (ARM64, x86_64) å’Œç€è¦½å™¨ (Firefox, Chrome) å®šç¾©äº†å¤šå€‹æœ€çµ‚æ˜ åƒæª”ã€‚æ¯å€‹éšæ®µéƒ½å¾ä¸€å€‹é å…ˆå»ºæ§‹å¥½çš„ Selenium æ˜ åƒæª”é–‹å§‹ï¼Œä¸¦å°‡ç¬¬ä¸€éšæ®µå»ºæ§‹å¥½çš„æ‡‰ç”¨ç¨‹å¼è¤‡è£½é€²ä¾†ã€‚\nARM64 æ¶æ§‹ - Firefox ç€è¦½å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 FROM seleniarm/standalone-firefox:latest AS arm64-firefox # è¨­å®šçµ‚ç«¯æ©Ÿå’Œèªè¨€ç’°å¢ƒè®Šæ•¸ ENV TERM=\u0026#34;xterm-color\u0026#34; ENV LANG=\u0026#39;en_US.UTF-8\u0026#39; ENV LANGUAGE=\u0026#39;en_US.UTF-8\u0026#39; # é‡æ–°è¨­å®š NVM å’Œæ‡‰ç”¨ç¨‹å¼ç›®éŒ„ (å› ç‚ºæ˜¯æ–°çš„ FROM éšæ®µ) ENV NVM_DIR /opt/nvm ENV NODE_VERSION v16.13.2 ENV APP_DIR /app # å»ºç«‹ç›®éŒ„ä¸¦èª¿æ•´æ¬Šé™ (ä½¿ç”¨ sudo å’Œ chown æ˜¯å› ç‚ºåŸºç¤æ˜ åƒæª”å¯èƒ½ä»¥é root ç”¨æˆ¶é‹è¡Œ) RUN [ -d $APP_DIR ] || (sudo mkdir -p $APP_DIR \u0026amp;\u0026amp; sudo chown `whoami`:`id -g -n` $APP_DIR) RUN [ -d $NVM_DIR ] || (sudo mkdir -p $NVM_DIR \u0026amp;\u0026amp; sudo chown `whoami`:`id -g -n` $NVM_DIR) # å¾ \u0026#39;build\u0026#39; éšæ®µè¤‡è£½ NVM å®‰è£è…³æœ¬ä¸¦åŸ·è¡Œ COPY --from=build $NVM_DIR/install.sh $NVM_DIR RUN /bin/bash $NVM_DIR/install.sh # è¨­å®š PATH ç’°å¢ƒè®Šæ•¸ ENV PATH $NVM_DIR/versions/node/$NODE_VERSION/bin:$PATH # å¾ \u0026#39;build\u0026#39; éšæ®µè¤‡è£½æ‡‰ç”¨ç¨‹å¼æª”æ¡ˆ COPY --from=build $APP_DIR $APP_DIR # èª¿æ•´æ‡‰ç”¨ç¨‹å¼ç›®éŒ„çš„æ“æœ‰è€…ç‚º \u0026#39;seluser\u0026#39; (Selenium æ˜ åƒæª”çš„é è¨­ç”¨æˆ¶) RUN chown seluser:seluser $APP_DIR # è¨­å®šå·¥ä½œç›®éŒ„ WORKDIR $APP_DIR # å®šç¾©å®¹å™¨å•Ÿå‹•æ™‚åŸ·è¡Œçš„å‘½ä»¤ (å°‡ç”± entrypoint.sh è…³æœ¬è™•ç†) CMD [ \u0026#34;/app/entrypoint.sh\u0026#34; ] ARM64 æ¶æ§‹ - Chrome ç€è¦½å™¨ 1 2 3 FROM seleniarm/standalone-chromium:latest AS arm64-chrome # ... (èˆ‡ arm64-firefox éšæ®µé¡ä¼¼çš„ç’°å¢ƒè®Šæ•¸ã€ç›®éŒ„å»ºç«‹ã€NVM å®‰è£ã€æ‡‰ç”¨ç¨‹å¼è¤‡è£½å’Œæ¬Šé™èª¿æ•´) ... CMD [ \u0026#34;/app/entrypoint.sh\u0026#34; ] x86_64 æ¶æ§‹ - Firefox ç€è¦½å™¨ 1 2 3 FROM selenium/standalone-firefox:latest AS x86_64-firefox # ... (èˆ‡ arm64-firefox éšæ®µé¡ä¼¼çš„ç’°å¢ƒè®Šæ•¸ã€ç›®éŒ„å»ºç«‹ã€NVM å®‰è£ã€æ‡‰ç”¨ç¨‹å¼è¤‡è£½å’Œæ¬Šé™èª¿æ•´) ... CMD [ \u0026#34;/app/entrypoint.sh\u0026#34; ] x86_64 æ¶æ§‹ - Chrome ç€è¦½å™¨ 1 2 3 FROM selenium/standalone-chrome:latest AS x86_64-chrome # ... (èˆ‡ arm64-firefox éšæ®µé¡ä¼¼çš„ç’°å¢ƒè®Šæ•¸ã€ç›®éŒ„å»ºç«‹ã€NVM å®‰è£ã€æ‡‰ç”¨ç¨‹å¼è¤‡è£½å’Œæ¬Šé™èª¿æ•´) ... CMD [ \u0026#34;/app/entrypoint.sh\u0026#34; ] entrypoint.sh è…³æœ¬è©³è§£ é€™å€‹è…³æœ¬æ˜¯å®¹å™¨å•Ÿå‹•æ™‚åŸ·è¡Œçš„å…¥å£é»ï¼Œå®ƒè² è²¬æ ¹æ“šé‹è¡Œç’°å¢ƒå‹•æ…‹åˆ¤æ–·è¦åŸ·è¡Œçš„ npm è…³æœ¬ï¼Œä¸¦ç¢ºä¿ Selenium æœå‹™å·²å•Ÿå‹•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 #!/bin/bash # æ ¹æ“šå®¹å™¨ä¸­å­˜åœ¨çš„ç€è¦½å™¨å¯åŸ·è¡Œæª”ä¾†è¨­å®š SCRIPTS è®Šæ•¸ # å¦‚æœæ‰¾åˆ° firefoxï¼Œå‰‡ SCRIPTS ç‚º \u0026#34;docker-firefox\u0026#34; [ -f /usr/bin/firefox ] \u0026amp;\u0026amp; export SCRIPTS=\u0026#34;docker-firefox\u0026#34; # å¦‚æœæ‰¾åˆ° chromium-browser æˆ– google-chromeï¼Œå‰‡ SCRIPTS ç‚º \u0026#34;docker-chrome\u0026#34; [ -f /usr/bin/chromium-browser ] \u0026amp;\u0026amp; export SCRIPTS=\u0026#34;docker-chrome\u0026#34; [ -f /usr/bin/google-chrome ] \u0026amp;\u0026amp; export SCRIPTS=\u0026#34;docker-chrome\u0026#34; # åˆ¤æ–· CPU æ¶æ§‹ (uname -m æœƒå›å‚³æ©Ÿå™¨ç¡¬é«”åç¨±) uu=`uname -m` echo \u0026#39;uname -m:\u0026#39; $uu if [ \u0026#34;$uu\u0026#34; = \u0026#34;arm64\u0026#34; ] || [ \u0026#34;$uu\u0026#34; = \u0026#34;aarch64\u0026#34; ];then # å¦‚æœæ˜¯ ARM64 æ¶æ§‹ï¼Œå‰‡åœ¨ SCRIPTS å¾Œé¢åŠ ä¸Š \u0026#34;-arm64\u0026#34; export SCRIPTS=\u0026#34;$SCRIPTS-arm64\u0026#34; fi # å•Ÿå‹• Selenium æœå‹™çš„å…¥å£é»è…³æœ¬ (é€šå¸¸ç”±åŸºç¤æ˜ åƒæª”æä¾›) # å°‡æ¨™æº–è¼¸å‡ºå’Œæ¨™æº–éŒ¯èª¤é‡å®šå‘åˆ° /dev/nullï¼Œä½¿å…¶åœ¨èƒŒæ™¯éœé»˜é‹è¡Œ /opt/bin/entry_point.sh \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp; # ç­‰å¾… Selenium æœå‹™å•Ÿå‹• (æª¢æŸ¥ localhost:4444 æ˜¯å¦å¯è¨ªå•) for number in {1..120} # æœ€å¤šç­‰å¾… 120 ç§’ do if curl -s http://localhost:4444; then # -s éœé»˜æ¨¡å¼ï¼Œä¸é¡¯ç¤ºé€²åº¦æˆ–éŒ¯èª¤ break # å¦‚æœæˆåŠŸè¨ªå•ï¼Œå‰‡è·³å‡ºè¿´åœˆ fi echo \u0026#34;Waiting selenium service,\u0026#34; $number # é¡¯ç¤ºç­‰å¾…è¨Šæ¯ sleep 1 # æ¯ç§’æª¢æŸ¥ä¸€æ¬¡ done # å†æ¬¡æª¢æŸ¥ Selenium æœå‹™æ˜¯å¦æˆåŠŸå•Ÿå‹•ï¼Œå¦‚æœæ²’æœ‰å‰‡é€€å‡ºä¸¦å ±éŒ¯ if ! curl -s http://localhost:4444; then echo \u0026#34;Selenium service failed to start.\u0026#34; exit 1 fi # é€²å…¥æ‡‰ç”¨ç¨‹å¼ç›®éŒ„ cd /app # åŸ·è¡Œå°æ‡‰çš„ npm è…³æœ¬ echo \u0026#34;npm run $SCRIPTS\u0026#34; npm run $SCRIPTS æœ€ä½³å¯¦è¸èˆ‡è€ƒé‡ å¤šéšæ®µå»ºæ§‹ï¼šæ­¤ Dockerfile å……åˆ†åˆ©ç”¨äº†å¤šéšæ®µå»ºæ§‹çš„å„ªå‹¢ï¼Œå°‡å»ºæ§‹ç’°å¢ƒèˆ‡é‹è¡Œç’°å¢ƒåˆ†é›¢ï¼Œé¡¯è‘—æ¸›å°äº†æœ€çµ‚æ˜ åƒæª”çš„å¤§å°ï¼Œä¸¦æé«˜äº†å®‰å…¨æ€§ã€‚ è·¨å¹³å°æ”¯æ´ï¼šé€éç‚ºä¸åŒ CPU æ¶æ§‹å’Œç€è¦½å™¨å»ºç«‹ç¨ç«‹çš„éšæ®µï¼Œå¯¦ç¾äº†å–®ä¸€ Dockerfile æ”¯æ´å¤šç¨®é‹è¡Œç’°å¢ƒçš„èƒ½åŠ›ã€‚ æ¬Šé™ç®¡ç†ï¼šåœ¨è¤‡è£½æ‡‰ç”¨ç¨‹å¼æª”æ¡ˆå¾Œï¼Œä½¿ç”¨ chown èª¿æ•´æª”æ¡ˆæ“æœ‰è€…ï¼Œç¢ºä¿æ‡‰ç”¨ç¨‹å¼ä»¥é root ç”¨æˆ¶é‹è¡Œï¼Œé€™æ˜¯ä¸€å€‹é‡è¦çš„å®‰å…¨å¯¦è¸ã€‚ å¥å£¯çš„å•Ÿå‹•è…³æœ¬ï¼šentrypoint.sh è…³æœ¬åŒ…å«äº†ç­‰å¾…å¤–éƒ¨æœå‹™ (Selenium) å•Ÿå‹•çš„é‚è¼¯ï¼Œé€™ä½¿å¾—å®¹å™¨çš„å•Ÿå‹•æ›´åŠ å¥å£¯å’Œå¯é ã€‚ ç’°å¢ƒè®Šæ•¸ï¼šåˆç†ä½¿ç”¨ ENV æŒ‡ä»¤ä¾†ç®¡ç†ç‰ˆæœ¬è™Ÿå’Œè·¯å¾‘ï¼Œæé«˜äº† Dockerfile çš„å¯ç¶­è­·æ€§ã€‚ é€éé€™å€‹è©³ç´°çš„ Dockerfile å’Œå•Ÿå‹•è…³æœ¬ï¼Œæ‚¨å¯ä»¥é«˜æ•ˆåœ°å»ºæ§‹å’Œéƒ¨ç½²è·¨å¹³å°çš„ Selenium è‡ªå‹•åŒ–æ¸¬è©¦æ‡‰ç”¨ç¨‹å¼ã€‚\n","permalink":"https://xinqilin.github.io/post/devops/dockerfile-docker_in_docker/","tags":["Docker","Dockerfile","Multi-stage Build","Selenium","Node.js","DevOps","Cross-platform"],"title":"å¤šéšæ®µ Dockerfileï¼šå»ºæ§‹è·¨å¹³å° Selenium æ‡‰ç”¨ç¨‹å¼æ˜ åƒæª”"},{"content":"æ¦‚è¿° Dockerfile æ˜¯ä¸€å€‹åŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤çš„æ–‡å­—æª”æ¡ˆï¼ŒDocker å¼•æ“æœƒè®€å–é€™äº›æŒ‡ä»¤ï¼Œä¸¦è‡ªå‹•å»ºæ§‹å‡º Docker æ˜ åƒæª” (Image)ã€‚å®ƒå®šç¾©äº†æ˜ åƒæª”çš„å…§å®¹ã€é‹è¡Œç’°å¢ƒä»¥åŠå•Ÿå‹•æ™‚åŸ·è¡Œçš„æŒ‡ä»¤ã€‚ç†è§£ Dockerfile æ˜¯æŒæ¡ Docker å®¹å™¨åŒ–æŠ€è¡“çš„é—œéµä¸€æ­¥ã€‚\nDockerfile æ ¸å¿ƒæŒ‡ä»¤è©³è§£ 1. åŸºç¤æŒ‡ä»¤ FROMï¼šæŒ‡å®šåŸºç¤æ˜ åƒæª”ã€‚Dockerfile çš„ç¬¬ä¸€æ¢æŒ‡ä»¤å¿…é ˆæ˜¯ FROMã€‚\nèªæ³•ï¼šFROM \u0026lt;image\u0026gt;[:\u0026lt;tag\u0026gt;] ç¯„ä¾‹ï¼šFROM ubuntu:18.04 (ä½¿ç”¨ Ubuntu 18.04 ä½œç‚ºåŸºç¤æ˜ åƒæª”) æ³¨æ„ï¼šå¦‚æœæœªæŒ‡å®š tagï¼Œé è¨­ç‚º latestã€‚å»ºè­°æ˜ç¢ºæŒ‡å®šç‰ˆæœ¬ï¼Œä»¥ç¢ºä¿å»ºæ§‹çš„å¯é‡è¤‡æ€§ã€‚ MAINTAINERï¼šæŒ‡å®šæ˜ åƒæª”çš„ç¶­è­·è€…è³‡è¨Šã€‚\nèªæ³•ï¼šMAINTAINER \u0026lt;name\u0026gt; [email] ç¯„ä¾‹ï¼šMAINTAINER Bill.Lin \u0026lt;zzx123bill@gmail.com\u0026gt; æ³¨æ„ï¼šæ­¤æŒ‡ä»¤å·²éæ™‚ï¼Œå»ºè­°ä½¿ç”¨ LABEL æŒ‡ä»¤ä¾†æ›¿ä»£ï¼Œä¾‹å¦‚ LABEL maintainer=\u0026quot;Bill.Lin \u0026lt;zzx123bill@gmail.com\u0026gt;\u0026quot;ã€‚ 2. åŸ·è¡ŒæŒ‡ä»¤ RUNï¼šåœ¨å»ºæ§‹æ˜ åƒæª”æ™‚åŸ·è¡Œå‘½ä»¤ã€‚æ¯å€‹ RUN æŒ‡ä»¤éƒ½æœƒåœ¨æ˜ åƒæª”ä¸­å»ºç«‹ä¸€å€‹æ–°çš„å±¤ (layer)ã€‚\nèªæ³•ï¼š RUN \u0026lt;command\u0026gt; (shell æ¨¡å¼ï¼Œé è¨­ä½¿ç”¨ /bin/sh -c åŸ·è¡Œ) RUN [\u0026quot;executable\u0026quot;, \u0026quot;param1\u0026quot;, \u0026quot;param2\u0026quot;] (exec æ¨¡å¼ï¼Œç›´æ¥åŸ·è¡Œå¯åŸ·è¡Œæª”) ç¯„ä¾‹ (shell æ¨¡å¼)ï¼š 1 2 RUN apt-get update -y \\ \u0026amp;\u0026amp; apt-get install nginx -y æ³¨æ„ï¼šä½¿ç”¨ \u0026amp;\u0026amp; å°‡å¤šå€‹å‘½ä»¤ä¸²è¯èµ·ä¾†ï¼Œå¯ä»¥æ¸›å°‘æ˜ åƒæª”å±¤æ•¸ï¼Œå„ªåŒ–æ˜ åƒæª”å¤§å°ã€‚ ç¯„ä¾‹ (exec æ¨¡å¼)ï¼š 1 2 RUN [\u0026#34;./test.php\u0026#34;, \u0026#34;dev\u0026#34;, \u0026#34;offline\u0026#34;] # ç­‰åŒæ–¼åœ¨å®¹å™¨å…§åŸ·è¡Œ `./test.php dev offline` CMDï¼šè¨­å®šå®¹å™¨å•Ÿå‹•æ™‚é è¨­åŸ·è¡Œçš„å‘½ä»¤ã€‚å¦‚æœ docker run å‘½ä»¤å¾Œå¸¶æœ‰åƒæ•¸ï¼ŒCMD çš„å‘½ä»¤æœƒè¢«è¦†è“‹ã€‚ä¸€å€‹ Dockerfile ä¸­åªèƒ½æœ‰ä¸€å€‹ CMDï¼Œå¤šå€‹ CMD åªæœ‰æœ€å¾Œä¸€å€‹ç”Ÿæ•ˆã€‚\nèªæ³•ï¼š CMD [\u0026quot;executable\u0026quot;, \u0026quot;param1\u0026quot;, \u0026quot;param2\u0026quot;] (exec æ¨¡å¼ï¼Œæ¨è–¦) CMD [\u0026quot;param1\u0026quot;, \u0026quot;param2\u0026quot;] (ä½œç‚º ENTRYPOINT çš„é è¨­åƒæ•¸) CMD command param1 param2 (shell æ¨¡å¼) ç¯„ä¾‹ï¼šCMD [\u0026quot;nginx\u0026quot;, \u0026quot;-g\u0026quot;, \u0026quot;daemon off;\u0026quot;] (å•Ÿå‹• Nginx ä¸¦ä¿æŒåœ¨å‰å°é‹è¡Œ) æ³¨æ„ï¼šCMD æœƒè¢« docker run \u0026lt;image\u0026gt; \u0026lt;command\u0026gt; ä¸­çš„ \u0026lt;command\u0026gt; è¦†è“‹ã€‚ ENTRYPOINTï¼šè¨­å®šå®¹å™¨å•Ÿå‹•æ™‚åŸ·è¡Œçš„å‘½ä»¤ã€‚ENTRYPOINT ä¸æœƒè¢« docker run å¾Œçš„åƒæ•¸è¦†è“‹ï¼Œè€Œæ˜¯å°‡é€™äº›åƒæ•¸ä½œç‚º ENTRYPOINT å‘½ä»¤çš„åƒæ•¸ã€‚\nèªæ³•ï¼šENTRYPOINT [\u0026quot;executable\u0026quot;, \u0026quot;param1\u0026quot;, \u0026quot;param2\u0026quot;] (exec æ¨¡å¼ï¼Œæ¨è–¦) ç¯„ä¾‹ï¼šENTRYPOINT [\u0026quot;docker-entrypoint.sh\u0026quot;] CMD èˆ‡ ENTRYPOINT çµ„åˆä½¿ç”¨ï¼š ç•¶ ENTRYPOINT å’Œ CMD éƒ½ä½¿ç”¨ exec æ¨¡å¼æ™‚ï¼ŒCMD çš„å…§å®¹æœƒä½œç‚º ENTRYPOINT çš„åƒæ•¸ã€‚ 1 2 3 4 FROM nginx ENTRYPOINT [\u0026#34;nginx\u0026#34;, \u0026#34;-c\u0026#34;] CMD [\u0026#34;/etc/nginx/nginx.conf\u0026#34;] # å®¹å™¨å•Ÿå‹•æ™‚å¯¦éš›åŸ·è¡Œï¼šnginx -c /etc/nginx/nginx.conf é€™ç¨®çµ„åˆå¸¸ç”¨æ–¼è¨­å®šå›ºå®šçš„å•Ÿå‹•å‘½ä»¤ï¼ŒåŒæ™‚å…è¨±ä½¿ç”¨è€…é€é CMD æˆ– docker run åƒæ•¸ä¾†æä¾›é è¨­æˆ–è‡ªè¨‚çš„åƒæ•¸ã€‚ 3. ç’°å¢ƒè¨­å®š WORKDIRï¼šè¨­å®šå·¥ä½œç›®éŒ„ã€‚å¾ŒçºŒçš„ RUN, CMD, ENTRYPOINT, COPY, ADD æŒ‡ä»¤éƒ½æœƒåœ¨é€™å€‹ç›®éŒ„ä¸‹åŸ·è¡Œã€‚\nèªæ³•ï¼šWORKDIR /path/to/workdir ç¯„ä¾‹ï¼š 1 2 WORKDIR /app COPY . /app # å°‡å»ºæ§‹ä¸Šä¸‹æ–‡ä¸­çš„æª”æ¡ˆè¤‡è£½åˆ°å®¹å™¨çš„ /app ç›®éŒ„ USERï¼šæŒ‡å®šé‹è¡Œå®¹å™¨æ™‚çš„ç”¨æˆ¶æˆ–ç”¨æˆ¶çµ„ã€‚\nèªæ³•ï¼šUSER \u0026lt;user\u0026gt;[:\u0026lt;group\u0026gt;] ç¯„ä¾‹ï¼šUSER nobody (ä»¥é root ç”¨æˆ¶é‹è¡Œï¼Œæé«˜å®‰å…¨æ€§) æ³¨æ„ï¼šé è¨­ç‚º rootã€‚åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œå»ºè­°ä½¿ç”¨é root ç”¨æˆ¶é‹è¡Œæ‡‰ç”¨ç¨‹å¼ã€‚ VOLUMEï¼šå»ºç«‹ä¸€å€‹æ›è¼‰é»ï¼Œå°‡å®¹å™¨å…§çš„è·¯å¾‘æ¨™è¨˜ç‚ºå¤–éƒ¨æ›è¼‰é»ï¼Œç”¨æ–¼æŒä¹…åŒ–è³‡æ–™æˆ–å…±äº«è³‡æ–™ã€‚\nèªæ³•ï¼šVOLUME [\u0026quot;/data\u0026quot;] ç¯„ä¾‹ï¼šVOLUME /var/lib/mysql (å°‡ MySQL è³‡æ–™ç›®éŒ„æ¨™è¨˜ç‚ºå„²å­˜å·) ARGï¼šå®šç¾©å»ºæ§‹æ™‚çš„è®Šæ•¸ã€‚é€™äº›è®Šæ•¸åªåœ¨ docker build éç¨‹ä¸­æœ‰æ•ˆï¼Œä¸æœƒä¿ç•™åœ¨æœ€çµ‚çš„æ˜ åƒæª”ä¸­ã€‚\nèªæ³•ï¼šARG \u0026lt;name\u0026gt;[=\u0026lt;default value\u0026gt;] ç¯„ä¾‹ï¼š 1 2 ARG VERSION=1.0 FROM myapp:${VERSION} ä½¿ç”¨ï¼šdocker build --build-arg VERSION=2.0 . ENVï¼šè¨­å®šç’°å¢ƒè®Šæ•¸ã€‚é€™äº›è®Šæ•¸æœƒä¿ç•™åœ¨æœ€çµ‚çš„æ˜ åƒæª”ä¸­ï¼Œä¸¦åœ¨å®¹å™¨é‹è¡Œæ™‚å¯ç”¨ã€‚\nèªæ³•ï¼šENV \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; ... ç¯„ä¾‹ï¼š 1 2 ENV MY_PATH /usr/local WORKDIR $MY_PATH # WORKDIR å¯ä»¥ä½¿ç”¨ ENV å®šç¾©çš„è®Šæ•¸ EXPOSEï¼šè²æ˜å®¹å™¨é‹è¡Œæ™‚ç›£è½çš„åŸ ã€‚é€™åªæ˜¯ä¸€å€‹æ–‡ä»¶èªªæ˜ï¼Œä¸¦ä¸æœƒå¯¦éš›ç™¼å¸ƒåŸ ã€‚è¦ç™¼å¸ƒåŸ ï¼Œéœ€è¦åœ¨ docker run æˆ– docker-compose.yml ä¸­ä½¿ç”¨ -p æˆ– portsã€‚\nèªæ³•ï¼šEXPOSE \u0026lt;port\u0026gt; [\u0026lt;port\u0026gt;...] ç¯„ä¾‹ï¼šEXPOSE 8080 (è²æ˜å®¹å™¨æœƒç›£è½ 8080 åŸ ) 4. æª”æ¡ˆæ“ä½œ COPYï¼šå°‡å»ºæ§‹ä¸Šä¸‹æ–‡ä¸­çš„æª”æ¡ˆæˆ–ç›®éŒ„è¤‡è£½åˆ°æ˜ åƒæª”ä¸­ã€‚\nèªæ³•ï¼šCOPY \u0026lt;src\u0026gt;... \u0026lt;dest\u0026gt; ç¯„ä¾‹ï¼šCOPY ./target/mms.war /app/mms.war (å°‡ä¸»æ©Ÿ target ç›®éŒ„ä¸‹çš„ mms.war è¤‡è£½åˆ°å®¹å™¨çš„ /app ç›®éŒ„) æ³¨æ„ï¼šCOPY åªèƒ½è¤‡è£½æœ¬åœ°å»ºæ§‹ä¸Šä¸‹æ–‡ä¸­çš„æª”æ¡ˆã€‚ ADDï¼šèˆ‡ COPY é¡ä¼¼ï¼Œä½† ADD å…·æœ‰é¡å¤–çš„åŠŸèƒ½ï¼š\nå¦‚æœ \u0026lt;src\u0026gt; æ˜¯ä¸€å€‹å£“ç¸®æª” (å¦‚ .tar, .gz, .zip)ï¼Œå®ƒæœƒè‡ªå‹•è§£å£“ç¸®åˆ° \u0026lt;dest\u0026gt;ã€‚ å¦‚æœ \u0026lt;src\u0026gt; æ˜¯ä¸€å€‹ URLï¼Œå®ƒæœƒå¾è©² URL ä¸‹è¼‰æª”æ¡ˆã€‚ èªæ³•ï¼šADD \u0026lt;src\u0026gt;... \u0026lt;dest\u0026gt; ç¯„ä¾‹ï¼šADD https://example.com/app.tar.gz /app/ æ³¨æ„ï¼šç”±æ–¼ ADD çš„è‡ªå‹•è§£å£“ç¸®å’Œ URL ä¸‹è¼‰åŠŸèƒ½å¯èƒ½å°è‡´ä¸ç¢ºå®šæ€§ï¼Œé€šå¸¸å»ºè­°å„ªå…ˆä½¿ç”¨ COPYï¼Œé™¤éæ‚¨æ˜ç¢ºéœ€è¦ ADD çš„ç‰¹æ®ŠåŠŸèƒ½ã€‚ Docker Build æµç¨‹ ä½¿ç”¨ docker build å‘½ä»¤ä¾†å»ºæ§‹ Docker æ˜ åƒæª”ã€‚\nèªæ³•ï¼šdocker build [OPTIONS] PATH | URL | - ç¯„ä¾‹ï¼šdocker build -t my-app:1.0 . -t my-app:1.0ï¼šç‚ºæ˜ åƒæª”æŒ‡å®šåç¨±å’Œæ¨™ç±¤ã€‚ .ï¼šæŒ‡å®šå»ºæ§‹ä¸Šä¸‹æ–‡çš„è·¯å¾‘ã€‚Docker æœƒå°‡æ­¤è·¯å¾‘ä¸‹çš„æ‰€æœ‰æª”æ¡ˆç™¼é€åˆ° Docker Daemonï¼Œä½œç‚ºå»ºæ§‹éç¨‹çš„ä¸Šä¸‹æ–‡ã€‚ ç¯„ä¾‹ï¼šJava Spring Boot æ‡‰ç”¨ç¨‹å¼çš„å¤šéšæ®µå»ºæ§‹ å¤šéšæ®µå»ºæ§‹ (Multi-stage Builds) å…è¨±æ‚¨åœ¨ä¸€å€‹ Dockerfile ä¸­ä½¿ç”¨å¤šå€‹ FROM æŒ‡ä»¤ã€‚æ¯å€‹ FROM æŒ‡ä»¤éƒ½å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŸºç¤æ˜ åƒæª”ï¼Œä¸¦ä¸”æ¯å€‹éšæ®µéƒ½å¯ä»¥ç¨ç«‹åœ°å»ºæ§‹ã€‚æœ€çµ‚çš„æ˜ åƒæª”åªåŒ…å«æ‚¨éœ€è¦çš„æœ€çµ‚ç”¢ç‰©ï¼Œå¤§å¤§æ¸›å°‘äº†æ˜ åƒæª”çš„å¤§å°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # --- ç¬¬ä¸€éšæ®µï¼šå»ºæ§‹æ‡‰ç”¨ç¨‹å¼ --- # ä½¿ç”¨ä¸€å€‹åŒ…å« Java é–‹ç™¼å·¥å…·åŒ… (JDK) çš„æ˜ åƒæª”ä¾†ç·¨è­¯å’Œæ‰“åŒ…æ‡‰ç”¨ç¨‹å¼ FROM openjdk:11-jdk-slim AS build # è¨­å®šå·¥ä½œç›®éŒ„ WORKDIR /app # å°‡ Maven çš„è¨­å®šæª”è¤‡è£½åˆ°å®¹å™¨ä¸­ (å¦‚æœæœ‰çš„è©±) # COPY settings.xml /root/.m2/ # å°‡å°ˆæ¡ˆçš„ pom.xml è¤‡è£½åˆ°å®¹å™¨ä¸­ï¼Œä¸¦ä¸‹è¼‰ä¾è³´ï¼Œåˆ©ç”¨ Docker å±¤å¿«å– COPY pom.xml . RUN mvn dependency:go-offline # å°‡æ‰€æœ‰åŸå§‹ç¢¼è¤‡è£½åˆ°å®¹å™¨ä¸­ COPY src ./src # ç·¨è­¯ä¸¦æ‰“åŒ…æ‡‰ç”¨ç¨‹å¼ï¼Œç”Ÿæˆ JAR æª”æ¡ˆ RUN mvn clean package -DskipTests # --- ç¬¬äºŒéšæ®µï¼šé‹è¡Œæ‡‰ç”¨ç¨‹å¼ --- # ä½¿ç”¨ä¸€å€‹è¼•é‡ç´šçš„ Java é‹è¡Œç’°å¢ƒ (JRE) æ˜ åƒæª”ä¾†é‹è¡Œæ‡‰ç”¨ç¨‹å¼ FROM openjdk:11-jre-slim # è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ŒæŒ‡å®šæ‡‰ç”¨ç¨‹å¼çš„ JAR æª”æ¡ˆè·¯å¾‘ ENV APP_HOME=/app # è¨­å®šå·¥ä½œç›®éŒ„ WORKDIR $APP_HOME # å¾ç¬¬ä¸€éšæ®µè¤‡è£½ç·¨è­¯å¥½çš„ JAR æª”æ¡ˆ COPY --from=build /app/target/*.jar app.jar # æš´éœ²æ‡‰ç”¨ç¨‹å¼ç›£è½çš„åŸ  EXPOSE 8080 # å®šç¾©å®¹å™¨å•Ÿå‹•æ™‚åŸ·è¡Œçš„å‘½ä»¤ ENTRYPOINT [\u0026#34;java\u0026#34;, \u0026#34;-jar\u0026#34;, \u0026#34;app.jar\u0026#34;] é€™å€‹ç¯„ä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¤šéšæ®µå»ºæ§‹ä¾†ï¼š\nåœ¨ç¬¬ä¸€å€‹éšæ®µ (build) ä¸­ç·¨è­¯ Java æ‡‰ç”¨ç¨‹å¼ï¼Œç”Ÿæˆä¸€å€‹ JAR æª”æ¡ˆã€‚ åœ¨ç¬¬äºŒå€‹éšæ®µä¸­ï¼Œåªè¤‡è£½æœ€çµ‚çš„ JAR æª”æ¡ˆåˆ°ä¸€å€‹æ›´å°çš„ JRE åŸºç¤æ˜ åƒæª”ä¸­ã€‚ é€™æ¨£å¯ä»¥é¿å…å°‡ç·¨è­¯å·¥å…·ã€åŸå§‹ç¢¼ç­‰ä¸å¿…è¦çš„å…§å®¹åŒ…å«åœ¨æœ€çµ‚çš„é‹è¡Œæ˜ åƒæª”ä¸­ï¼Œå¾è€Œé¡¯è‘—æ¸›å°æ˜ åƒæª”å¤§å°ï¼Œæé«˜å®‰å…¨æ€§å’Œéƒ¨ç½²æ•ˆç‡ã€‚\né€éç†Ÿç·´æŒæ¡ Dockerfile çš„å„é …æŒ‡ä»¤å’Œæœ€ä½³å¯¦è¸ï¼Œæ‚¨å¯ä»¥æ›´æœ‰æ•ˆåœ°å»ºæ§‹å’Œç®¡ç†æ‚¨çš„ Docker æ˜ åƒæª”ã€‚\n","permalink":"https://xinqilin.github.io/post/devops/dockerfile-basic/","tags":["Docker","Dockerfile","DevOps","Containerization","Image Build"],"title":"Dockerfile åŸºç¤ï¼šå»ºæ§‹ Docker æ˜ åƒæª”çš„æ ¸å¿ƒæŒ‡ä»¤"},{"content":"Instance Level Dependency ä¾è³´ Association é—œè¯ Aggregation èšåˆ Composition çµ„åˆ Class Level Implementation å¯¦ä½œ Inheritance ç¹¼æ‰¿ Dependency 1 2 3 4 è™›ç·šï¼Œç®­é ­æŒ‡å‘ è¢«ä½¿ç”¨è€… A ---\u0026gt; B Association 1 2 3 4 å¯¦ç·šï¼Œç®­é ­æŒ‡å‘ è¢«æ“æœ‰è€… ï¼Œ å¯åœ¨ç®­é ­ä¸Šå¢åŠ  1-many 1-1 é—œè¥¿ A -\u0026gt; B Aggregation 1 2 3 4 5 6 7 8 ç©ºå¿ƒè±å½¢å±è‚¡ç®­é ­ï¼Œç®­é ­æŒ‡å‘ æ•´é«” A \u0026lt;\u0026gt;-\u0026gt; B \u0026lt;\u0026gt;-\u0026gt; C è¦æœ‰A å¿…é ˆè¦æœ‰Bï¼ŒC Composition 1 2 å¯¦å¿ƒè±å½¢å±è‚¡ç®­é ­ï¼Œç®­é ­æŒ‡å‘ æ•´é«” to be continued\u0026hellip;.\n","permalink":"https://xinqilin.github.io/post/architecture/uml/","tags":[],"title":"UML"},{"content":"æ¦‚è¿° Spring Framework çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€æ˜¯ä¾è³´æ³¨å…¥ï¼ˆDependency Injection, DIï¼‰ï¼Œå®ƒå¯¦ç¾äº†æ§åˆ¶åè½‰ï¼ˆInversion of Control, IoCï¼‰çš„è¨­è¨ˆæ¨¡å¼ã€‚æ­£ç¢ºä½¿ç”¨ä¾è³´æ³¨å…¥ä¸åƒ…èƒ½æå‡ç¨‹å¼ç¢¼çš„å¯æ¸¬è©¦æ€§å’Œå¯ç¶­è­·æ€§ï¼Œé‚„èƒ½é™ä½çµ„ä»¶é–“çš„è€¦åˆåº¦ã€‚æœ¬æ–‡å°‡æ·±å…¥æ¢è¨ Spring ä¸­å„ç¨®ä¾è³´æ³¨å…¥æ–¹å¼ï¼Œä¸¦é‡é»èªªæ˜æœ€ä½³å¯¦è¸ã€‚\nç‚ºä»€éº¼ä¸å»ºè­°ä½¿ç”¨ @Autowired Field Injectionï¼Ÿ ç•¶ä½ åœ¨ IntelliJ IDEA ä¸­ä½¿ç”¨ @Autowired é€²è¡Œæ¬„ä½æ³¨å…¥æ™‚ï¼Œæœƒçœ‹åˆ°é€™æ¨£çš„è­¦å‘Šï¼š\n1 2 3 4 Field injection is not recommended Inspection info: Spring Team recommends: \u0026#34;Always use constructor based dependency injection in your beans. Always use assertions for mandatory dependencies\u0026#34;. é€™å€‹è­¦å‘ŠèƒŒå¾Œæœ‰æ·±åˆ»çš„æŠ€è¡“ç†ç”±ï¼Œè®“æˆ‘å€‘é€ä¸€åˆ†æã€‚\nSpring ä¾è³´æ³¨å…¥çš„ä¸‰ç¨®æ–¹å¼ 1. Field Injectionï¼ˆä¸å»ºè­°ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @Service public class OrderService { @Autowired private PaymentService paymentService; // âŒ ä¸å»ºè­° @Autowired private InventoryService inventoryService; // âŒ ä¸å»ºè­° @Autowired private EmailService emailService; // âŒ ä¸å»ºè­° public void processOrder(Order order) { paymentService.processPayment(order); inventoryService.updateStock(order); emailService.sendConfirmation(order); } } Field Injection çš„å•é¡Œï¼š\nå•é¡Œ 1ï¼šé•åå–®ä¸€è·è²¬åŸå‰‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Service public class UserService { @Autowired private UserRepository userRepository; @Autowired private EmailService emailService; @Autowired private SmsService smsService; @Autowired private AuditService auditService; @Autowired private CacheService cacheService; @Autowired private ValidationService validationService; @Autowired private SecurityService securityService; @Autowired private LoggingService loggingService; @Autowired private MetricsService metricsService; @Autowired private ConfigurationService configurationService; // ... é‚„æœ‰æ›´å¤šä¾è³´ // ç•¶ä½ çœ‹åˆ°é€™éº¼å¤šä¾è³´æ™‚ï¼Œæ‡‰è©²é‡æ–°æ€è€ƒé€™å€‹é¡åˆ¥çš„è·è²¬ } å•é¡Œ 2ï¼šç„¡æ³•é€²è¡Œå–®å…ƒæ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 public class OrderServiceTest { @Test public void testProcessOrder() { // âŒ ç„¡æ³•è¼•æ˜“å‰µå»º OrderService å¯¦ä¾‹é€²è¡Œæ¸¬è©¦ OrderService orderService = new OrderService(); // PaymentService ç‚º null! Order order = new Order(); orderService.processOrder(order); // NullPointerException! } } å•é¡Œ 3ï¼šéš±è—çš„ä¾è³´é—œä¿‚ 1 2 3 4 // å¾é€™å€‹å»ºæ§‹å­çœ‹ä¸å‡ºé€™å€‹é¡åˆ¥éœ€è¦ä»€éº¼ä¾è³´ public class OrderService { // ä¾è³´éš±è—åœ¨é¡åˆ¥å…§éƒ¨ï¼Œå¤–éƒ¨ç„¡æ³•å¾—çŸ¥ } å•é¡Œ 4ï¼šå¾ªç’°ä¾è³´ä¸æ˜“ç™¼ç¾ 1 2 3 4 5 6 7 8 9 10 11 @Service public class ServiceA { @Autowired private ServiceB serviceB; // å¾ªç’°ä¾è³´åœ¨é‹è¡Œæ™‚æ‰æœƒç™¼ç¾ } @Service public class ServiceB { @Autowired private ServiceA serviceA; // å¾ªç’°ä¾è³´åœ¨é‹è¡Œæ™‚æ‰æœƒç™¼ç¾ } 2. Setter Injectionï¼ˆæ¢ä»¶æ€§å»ºè­°ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @Service public class OrderService { private PaymentService paymentService; private EmailService emailService; @Autowired public void setPaymentService(PaymentService paymentService) { this.paymentService = paymentService; } @Autowired public void setEmailService(EmailService emailService) { this.emailService = emailService; } public void processOrder(Order order) { if (paymentService != null) { paymentService.processPayment(order); } if (emailService != null) { emailService.sendConfirmation(order); } } } Setter Injection é©ç”¨å ´æ™¯ï¼š\nå¯é¸ä¾è³´ï¼ˆOptional Dependenciesï¼‰ å¾ªç’°ä¾è³´çš„æš«æ™‚è§£æ±ºæ–¹æ¡ˆ éœ€è¦åœ¨é‹è¡Œæ™‚é‡æ–°é…ç½®ä¾è³´ 3. Constructor Injectionï¼ˆå¼·çƒˆå»ºè­°ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Service public class OrderService { private final PaymentService paymentService; private final InventoryService inventoryService; private final EmailService emailService; // âœ… æ¨è–¦ï¼šConstructor Injection public OrderService(PaymentService paymentService, InventoryService inventoryService, EmailService emailService) { this.paymentService = Objects.requireNonNull(paymentService, \u0026#34;PaymentService cannot be null\u0026#34;); this.inventoryService = Objects.requireNonNull(inventoryService, \u0026#34;InventoryService cannot be null\u0026#34;); this.emailService = Objects.requireNonNull(emailService, \u0026#34;EmailService cannot be null\u0026#34;); } public void processOrder(Order order) { paymentService.processPayment(order); inventoryService.updateStock(order); emailService.sendConfirmation(order); } } Constructor Injection çš„å„ªå‹¢ 1. ä¸å¯è®Šæ€§ï¼ˆImmutabilityï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Service public class OrderService { // âœ… final é—œéµå­—ç¢ºä¿ä¾è³´ä¸æœƒè¢«ä¿®æ”¹ private final PaymentService paymentService; private final InventoryService inventoryService; public OrderService(PaymentService paymentService, InventoryService inventoryService) { this.paymentService = paymentService; this.inventoryService = inventoryService; } // ç„¡æ³•æ„å¤–ä¿®æ”¹ä¾è³´é—œä¿‚ } 2. å¼·åˆ¶ä¾è³´æª¢æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Service public class OrderService { private final PaymentService paymentService; public OrderService(PaymentService paymentService) { // âœ… åœ¨ç‰©ä»¶å‰µå»ºæ™‚å°±ç¢ºä¿ä¾è³´å­˜åœ¨ this.paymentService = Objects.requireNonNull(paymentService, \u0026#34;PaymentService is required for OrderService\u0026#34;); } public void processOrder(Order order) { // âœ… ä¿è­‰ paymentService ä¸ç‚º null paymentService.processPayment(order); } } 3. æ˜“æ–¼å–®å…ƒæ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @ExtendWith(MockitoExtension.class) class OrderServiceTest { @Mock private PaymentService paymentService; @Mock private InventoryService inventoryService; @Mock private EmailService emailService; private OrderService orderService; @BeforeEach void setUp() { // âœ… æ˜“æ–¼å‰µå»ºæ¸¬è©¦å¯¦ä¾‹ orderService = new OrderService(paymentService, inventoryService, emailService); } @Test void testProcessOrder() { // Given Order order = new Order(); when(paymentService.processPayment(order)).thenReturn(true); // When orderService.processOrder(order); // Then verify(paymentService).processPayment(order); verify(inventoryService).updateStock(order); verify(emailService).sendConfirmation(order); } } 4. æ˜ç¢ºçš„ä¾è³´é—œä¿‚ 1 2 3 4 5 6 7 8 9 10 11 // âœ… å¾å»ºæ§‹å­å°±èƒ½æ¸…æ¥šçœ‹åˆ°æ‰€æœ‰ä¾è³´ public class OrderService { public OrderService(PaymentService paymentService, InventoryService inventoryService, EmailService emailService, AuditService auditService) { // å¦‚æœå»ºæ§‹å­åƒæ•¸å¤ªå¤šï¼Œèªªæ˜é€™å€‹é¡åˆ¥æ‰¿æ“”äº†å¤ªå¤šè·è²¬ // é€™æ˜¯ä¸€å€‹ç¨‹å¼ç¢¼ç•°å‘³ï¼ˆCode Smellï¼‰ï¼Œæé†’æˆ‘å€‘é‡æ§‹ } } ä½¿ç”¨ Lombok ç°¡åŒ– Constructor Injection åŸºæœ¬ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Service @RequiredArgsConstructor // âœ… Lombok è‡ªå‹•ç”Ÿæˆå»ºæ§‹å­ public class OrderService { private final PaymentService paymentService; private final InventoryService inventoryService; private final EmailService emailService; // Lombok è‡ªå‹•ç”Ÿæˆï¼š // public OrderService(PaymentService paymentService, // InventoryService inventoryService, // EmailService emailService) { // this.paymentService = paymentService; // this.inventoryService = inventoryService; // this.emailService = emailService; // } public void processOrder(Order order) { paymentService.processPayment(order); inventoryService.updateStock(order); emailService.sendConfirmation(order); } } æ··åˆå¿…è¦å’Œå¯é¸ä¾è³´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @Service @RequiredArgsConstructor public class NotificationService { // å¿…è¦ä¾è³´ï¼ˆfinalï¼‰ private final EmailService emailService; private final SmsService smsService; // å¯é¸ä¾è³´ï¼ˆnon-finalï¼‰ private PushNotificationService pushService; private SlackService slackService; @Autowired(required = false) public void setPushNotificationService(PushNotificationService pushService) { this.pushService = pushService; } @Autowired(required = false) public void setSlackService(SlackService slackService) { this.slackService = slackService; } public void sendNotification(String message, User user) { // å¿…è¦æœå‹™ emailService.send(message, user.getEmail()); smsService.send(message, user.getPhone()); // å¯é¸æœå‹™ if (pushService != null) { pushService.send(message, user.getDeviceToken()); } if (slackService != null) { slackService.send(message, user.getSlackChannel()); } } } é€²éšä¾è³´æ³¨å…¥æŠ€å·§ 1. æ¢ä»¶æ€§ä¾è³´æ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @Configuration public class ServiceConfiguration { @Bean @ConditionalOnProperty(name = \u0026#34;payment.provider\u0026#34;, havingValue = \u0026#34;stripe\u0026#34;) public PaymentService stripePaymentService() { return new StripePaymentService(); } @Bean @ConditionalOnProperty(name = \u0026#34;payment.provider\u0026#34;, havingValue = \u0026#34;paypal\u0026#34;) public PaymentService paypalPaymentService() { return new PaypalPaymentService(); } @Bean @ConditionalOnMissingBean(PaymentService.class) public PaymentService defaultPaymentService() { return new DefaultPaymentService(); } } 2. é›†åˆæ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Service @RequiredArgsConstructor public class NotificationService { // âœ… æ³¨å…¥æ‰€æœ‰ NotificationProvider å¯¦ä½œ private final List\u0026lt;NotificationProvider\u0026gt; providers; public void sendNotification(String message, User user) { providers.forEach(provider -\u0026gt; { try { provider.send(message, user); } catch (Exception e) { log.warn(\u0026#34;Failed to send notification via {}: {}\u0026#34;, provider.getClass().getSimpleName(), e.getMessage()); } }); } } // ä¸åŒçš„é€šçŸ¥æä¾›è€… @Component public class EmailNotificationProvider implements NotificationProvider { public void send(String message, User user) { // ç™¼é€éƒµä»¶ } } @Component public class SmsNotificationProvider implements NotificationProvider { public void send(String message, User user) { // ç™¼é€ç°¡è¨Š } } 3. é™å®šç¬¦æ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // ä½¿ç”¨ @Qualifier å€åˆ†ç›¸åŒé¡å‹çš„ Bean @Service @RequiredArgsConstructor public class OrderService { @Qualifier(\u0026#34;primary\u0026#34;) private final PaymentService primaryPaymentService; @Qualifier(\u0026#34;backup\u0026#34;) private final PaymentService backupPaymentService; public void processPayment(Order order) { try { primaryPaymentService.processPayment(order); } catch (PaymentException e) { log.warn(\u0026#34;Primary payment failed, trying backup: {}\u0026#34;, e.getMessage()); backupPaymentService.processPayment(order); } } } @Configuration public class PaymentConfiguration { @Bean @Qualifier(\u0026#34;primary\u0026#34;) public PaymentService primaryPaymentService() { return new StripePaymentService(); } @Bean @Qualifier(\u0026#34;backup\u0026#34;) public PaymentService backupPaymentService() { return new PaypalPaymentService(); } } 4. Profile ç›¸é—œæ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @Configuration public class DatabaseConfiguration { @Bean @Profile(\u0026#34;dev\u0026#34;) public DataSource devDataSource() { return new H2DataSource(); } @Bean @Profile(\u0026#34;prod\u0026#34;) public DataSource prodDataSource() { return new MySQLDataSource(); } @Bean @Profile(\u0026#34;test\u0026#34;) public DataSource testDataSource() { return new TestContainerDataSource(); } } å¸¸è¦‹é™·é˜±èˆ‡è§£æ±ºæ–¹æ¡ˆ 1. å¾ªç’°ä¾è³´å•é¡Œ å•é¡Œç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Service public class OrderService { private final CustomerService customerService; public OrderService(CustomerService customerService) { this.customerService = customerService; } } @Service public class CustomerService { private final OrderService orderService; // âŒ å¾ªç’°ä¾è³´ public CustomerService(OrderService orderService) { this.orderService = orderService; } } è§£æ±ºæ–¹æ¡ˆ 1ï¼šé‡æ–°è¨­è¨ˆæ¶æ§‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // âœ… å¼•å…¥å…±äº«æœå‹™ï¼Œé¿å…å¾ªç’°ä¾è³´ @Service @RequiredArgsConstructor public class OrderService { private final CustomerRepository customerRepository; private final OrderRepository orderRepository; private final OrderValidationService validationService; } @Service @RequiredArgsConstructor public class CustomerService { private final CustomerRepository customerRepository; private final OrderRepository orderRepository; } @Service @RequiredArgsConstructor public class OrderValidationService { private final CustomerRepository customerRepository; private final PaymentService paymentService; } è§£æ±ºæ–¹æ¡ˆ 2ï¼šä½¿ç”¨äº‹ä»¶é©…å‹•æ¶æ§‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @Service @RequiredArgsConstructor public class OrderService { private final ApplicationEventPublisher eventPublisher; private final OrderRepository orderRepository; public void createOrder(Order order) { order = orderRepository.save(order); // âœ… ç™¼å¸ƒäº‹ä»¶è€Œéç›´æ¥èª¿ç”¨ eventPublisher.publishEvent(new OrderCreatedEvent(order)); } } @Service @RequiredArgsConstructor @EventListener public class CustomerService { private final CustomerRepository customerRepository; @EventListener public void handleOrderCreated(OrderCreatedEvent event) { // è™•ç†è¨‚å–®å‰µå»ºäº‹ä»¶ updateCustomerOrderCount(event.getOrder().getCustomerId()); } } 2. å»ºæ§‹å­åƒæ•¸éå¤š å•é¡Œè­˜åˆ¥ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Service public class UserService { // âŒ å»ºæ§‹å­åƒæ•¸éå¤šï¼Œé•å SRP åŸå‰‡ public UserService(UserRepository userRepository, EmailService emailService, SmsService smsService, AuditService auditService, CacheService cacheService, ValidationService validationService, SecurityService securityService, NotificationService notificationService, PaymentService paymentService, ReportService reportService) { // å¤ªå¤šä¾è³´ï¼ } } è§£æ±ºæ–¹æ¡ˆï¼šæ‹†åˆ†æœå‹™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // âœ… æ‹†åˆ†ç‚ºå¤šå€‹å°ˆé–€çš„æœå‹™ @Service @RequiredArgsConstructor public class UserService { private final UserRepository userRepository; private final UserValidationService validationService; private final UserSecurityService securityService; } @Service @RequiredArgsConstructor public class UserNotificationService { private final EmailService emailService; private final SmsService smsService; private final NotificationService notificationService; } @Service @RequiredArgsConstructor public class UserBillingService { private final PaymentService paymentService; private final BillingRepository billingRepository; } 3. å¯é¸ä¾è³´è™•ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @Service @RequiredArgsConstructor public class UserService { private final UserRepository userRepository; private final EmailService emailService; // âœ… å¯é¸ä¾è³´ä½¿ç”¨ Optional private final Optional\u0026lt;SmsService\u0026gt; smsService; public void createUser(User user) { user = userRepository.save(user); // å¿…è¦æœå‹™ emailService.sendWelcomeEmail(user); // å¯é¸æœå‹™ smsService.ifPresent(service -\u0026gt; service.sendWelcomeSms(user.getPhone()) ); } } @Configuration public class ServiceConfiguration { @Bean @ConditionalOnProperty(name = \u0026#34;sms.enabled\u0026#34;, havingValue = \u0026#34;true\u0026#34;) public SmsService smsService() { return new TwilioSmsService(); } } æ•ˆèƒ½è€ƒé‡ 1. å»¶é²åˆå§‹åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 @Service @Lazy // âœ… å»¶é²åˆå§‹åŒ–ï¼Œæ¸›å°‘å•Ÿå‹•æ™‚é–“ @RequiredArgsConstructor public class ReportService { private final DataAnalysisService dataAnalysisService; private final ChartGenerationService chartService; public Report generateReport(String type) { // åªæœ‰åœ¨å¯¦éš›ä½¿ç”¨æ™‚æ‰æœƒåˆå§‹åŒ– return dataAnalysisService.analyze(type); } } 2. åŸå‹ Bean çš„æ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @Service @RequiredArgsConstructor public class OrderProcessorService { private final ApplicationContext applicationContext; public void processOrder(Order order) { // âœ… æ¯æ¬¡éƒ½å‰µå»ºæ–°çš„è™•ç†å™¨å¯¦ä¾‹ OrderProcessor processor = applicationContext.getBean(OrderProcessor.class); processor.process(order); } } @Component @Scope(\u0026#34;prototype\u0026#34;) // åŸå‹ç¯„åœ public class OrderProcessor { public void process(Order order) { // è™•ç†é‚è¼¯ } } 3. Provider æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Service @RequiredArgsConstructor public class OrderService { // âœ… ä½¿ç”¨ Provider å»¶é²ç²å– Bean private final Provider\u0026lt;ExpensiveService\u0026gt; expensiveServiceProvider; public void processSpecialOrder(Order order) { if (order.isSpecial()) { // åªæœ‰åœ¨éœ€è¦æ™‚æ‰ç²å–æ˜‚è²´çš„æœå‹™ ExpensiveService service = expensiveServiceProvider.get(); service.processSpecialOrder(order); } } } æ¸¬è©¦æœ€ä½³å¯¦è¸ 1. ä½¿ç”¨ Constructor Injection çš„æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 @ExtendWith(MockitoExtension.class) class OrderServiceTest { @Mock private PaymentService paymentService; @Mock private InventoryService inventoryService; @Mock private EmailService emailService; private OrderService orderService; @BeforeEach void setUp() { // âœ… æ¸…æ™°çš„æ¸¬è©¦è¨­ç½® orderService = new OrderService(paymentService, inventoryService, emailService); } @Test void shouldProcessOrderSuccessfully() { // Given Order order = TestDataBuilder.createOrder(); when(paymentService.processPayment(order)).thenReturn(PaymentResult.success()); // When OrderResult result = orderService.processOrder(order); // Then assertThat(result.isSuccessful()).isTrue(); verify(paymentService).processPayment(order); verify(inventoryService).updateStock(order); verify(emailService).sendConfirmation(order); } @Test void shouldHandlePaymentFailure() { // Given Order order = TestDataBuilder.createOrder(); when(paymentService.processPayment(order)) .thenThrow(new PaymentException(\u0026#34;Payment failed\u0026#34;)); // When \u0026amp; Then assertThatThrownBy(() -\u0026gt; orderService.processOrder(order)) .isInstanceOf(OrderProcessingException.class) .hasMessageContaining(\u0026#34;Payment failed\u0026#34;); verify(inventoryService, never()).updateStock(order); verify(emailService, never()).sendConfirmation(order); } } 2. Integration Testing 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @SpringBootTest @TestPropertySource(properties = { \u0026#34;spring.datasource.url=jdbc:h2:mem:testdb\u0026#34;, \u0026#34;payment.provider=mock\u0026#34; }) class OrderServiceIntegrationTest { @Autowired private OrderService orderService; @MockBean // âœ… Spring Boot çš„ Mock æ”¯æ´ private EmailService emailService; @Test void shouldProcessOrderEndToEnd() { // Given Order order = TestDataBuilder.createOrder(); // When OrderResult result = orderService.processOrder(order); // Then assertThat(result.isSuccessful()).isTrue(); verify(emailService).sendConfirmation(order); } } Spring Boot ä¸­çš„ä¾è³´æ³¨å…¥ 1. è‡ªå‹•é…ç½®èˆ‡ä¾è³´æ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @SpringBootApplication public class ECommerceApplication { public static void main(String[] args) { SpringApplication.run(ECommerceApplication.class, args); } } // âœ… Spring Boot è‡ªå‹•é…ç½® + Constructor Injection @RestController @RequiredArgsConstructor @RequestMapping(\u0026#34;/api/orders\u0026#34;) public class OrderController { private final OrderService orderService; private final OrderMapper orderMapper; @PostMapping public ResponseEntity\u0026lt;OrderDto\u0026gt; createOrder(@RequestBody CreateOrderRequest request) { Order order = orderMapper.toEntity(request); Order savedOrder = orderService.createOrder(order); OrderDto dto = orderMapper.toDto(savedOrder); return ResponseEntity.ok(dto); } } 2. Configuration Properties 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 @ConfigurationProperties(prefix = \u0026#34;app.order\u0026#34;) @ConstructorBinding // âœ… ä¸å¯è®Šé…ç½®é¡ @RequiredArgsConstructor @Getter public class OrderProperties { private final Duration timeout; private final int maxRetries; private final boolean enableNotifications; private final PaymentConfig payment; @RequiredArgsConstructor @Getter public static class PaymentConfig { private final String provider; private final Duration timeout; private final boolean enableRetry; } } // ä½¿ç”¨é…ç½® @Service @RequiredArgsConstructor public class OrderService { private final OrderProperties properties; private final PaymentService paymentService; public void processOrder(Order order) { try { paymentService.processPayment(order, properties.getPayment().getTimeout()); } catch (PaymentException e) { if (properties.getPayment().isEnableRetry()) { retryPayment(order); } } } } ç›£æ§èˆ‡åµéŒ¯ 1. Bean ä¾è³´é—œä¿‚æª¢æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Component @RequiredArgsConstructor public class DependencyHealthIndicator implements HealthIndicator { private final List\u0026lt;HealthCheckable\u0026gt; healthCheckableServices; @Override public Health health() { Health.Builder builder = Health.up(); for (HealthCheckable service : healthCheckableServices) { try { service.checkHealth(); builder.withDetail(service.getClass().getSimpleName(), \u0026#34;UP\u0026#34;); } catch (Exception e) { builder.withDetail(service.getClass().getSimpleName(), \u0026#34;DOWN: \u0026#34; + e.getMessage()); builder.down(); } } return builder.build(); } } 2. ä¾è³´æ³¨å…¥é™¤éŒ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @EventListener @Component @Slf4j public class ApplicationStartupListener { @EventListener public void handleContextRefresh(ContextRefreshedEvent event) { ApplicationContext context = event.getApplicationContext(); log.info(\u0026#34;=== Spring Context Loaded ===\u0026#34;); log.info(\u0026#34;Total beans: {}\u0026#34;, context.getBeanDefinitionCount()); // åˆ—å‡ºæ‰€æœ‰ Bean String[] beanNames = context.getBeanDefinitionNames(); for (String beanName : beanNames) { Object bean = context.getBean(beanName); log.debug(\u0026#34;Bean: {} -\u0026gt; {}\u0026#34;, beanName, bean.getClass().getName()); } } } ç¸½çµ ä¾è³´æ³¨å…¥æ–¹å¼æ¯”è¼ƒ æ³¨å…¥æ–¹å¼ æ¨è–¦åº¦ å„ªé» ç¼ºé» é©ç”¨å ´æ™¯ Constructor â­â­â­â­â­ ä¸å¯è®Šã€å¼·åˆ¶æª¢æŸ¥ã€æ˜“æ¸¬è©¦ å»ºæ§‹å­å¯èƒ½è®Šé•· é è¨­é¸æ“‡ Setter â­â­â­ éˆæ´»ã€æ”¯æ´å¯é¸ä¾è³´ å¯è®Šã€æ™šæœŸæª¢æŸ¥ å¯é¸ä¾è³´ã€å¾ªç’°ä¾è³´ Field â­ ç°¡æ½” é›£æ¸¬è©¦ã€éš±è—ä¾è³´ã€å¯è®Š é¿å…ä½¿ç”¨ æœ€ä½³å¯¦è¸ç¸½çµ å„ªå…ˆä½¿ç”¨ Constructor Injectionï¼šç¢ºä¿ä¾è³´çš„ä¸å¯è®Šæ€§å’Œå¼·åˆ¶æª¢æŸ¥ ä½¿ç”¨ Lombok @RequiredArgsConstructorï¼šæ¸›å°‘æ¨¡æ¿ç¨‹å¼ç¢¼ é™åˆ¶å»ºæ§‹å­åƒæ•¸æ•¸é‡ï¼šè¶…é 5 å€‹åƒæ•¸è€ƒæ…®é‡æ§‹ ä½¿ç”¨ final é—œéµå­—ï¼šç¢ºä¿ä¾è³´ä¸æœƒè¢«æ„å¤–ä¿®æ”¹ é©ç•¶ä½¿ç”¨ @Qualifierï¼šå€åˆ†ç›¸åŒé¡å‹çš„ Bean è€ƒæ…®å¯é¸ä¾è³´ï¼šä½¿ç”¨ Optional æˆ– Setter Injection é¿å…å¾ªç’°ä¾è³´ï¼šé‡æ–°è¨­è¨ˆæ¶æ§‹æˆ–ä½¿ç”¨äº‹ä»¶é©…å‹• ç·¨å¯«å®Œæ•´çš„æ¸¬è©¦ï¼šåˆ©ç”¨ Constructor Injection çš„å¯æ¸¬è©¦æ€§ é·ç§»ç­–ç•¥ å¦‚æœä½ çš„å°ˆæ¡ˆç›®å‰å¤§é‡ä½¿ç”¨ Field Injectionï¼Œå¯ä»¥æ¡ç”¨æ¼¸é€²å¼é·ç§»ï¼š\næ–°ç¨‹å¼ç¢¼ï¼šç«‹å³æ¡ç”¨ Constructor Injection ç¾æœ‰ç¨‹å¼ç¢¼ï¼šåœ¨ä¿®æ”¹æ™‚é€æ­¥é‡æ§‹ é—œéµæœå‹™ï¼šå„ªå…ˆé‡æ§‹æ ¸å¿ƒæ¥­å‹™é‚è¼¯ å·¥å…·æ”¯æ´ï¼šä½¿ç”¨ IDE çš„è‡ªå‹•é‡æ§‹åŠŸèƒ½ æ­£ç¢ºçš„ä¾è³´æ³¨å…¥ä¸åƒ…æ˜¯æŠ€è¡“æœ€ä½³å¯¦è¸ï¼Œæ›´æ˜¯å»ºç«‹å¯ç¶­è­·ã€å¯æ¸¬è©¦ã€é«˜å“è³ªè»Ÿé«”çš„åŸºç¤ã€‚\nåƒè€ƒè³‡æ–™ Spring Framework Reference Documentation Spring Boot Reference Guide Effective Java by Joshua Bloch Clean Code by Robert Martin Spring in Action by Craig Walls ","permalink":"https://xinqilin.github.io/post/backend/@autowired/","tags":["Java","Spring","DI","IoC","Autowired","Constructor","Best-Practices"],"title":"Spring ä¾è³´æ³¨å…¥å®Œæ•´æŒ‡å—ï¼š@Autowired èˆ‡æœ€ä½³å¯¦è¸"},{"content":"æ¦‚è¿° SOLID æ˜¯ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆå’Œè»Ÿé«”æ¶æ§‹è¨­è¨ˆä¸­äº”å€‹æ ¸å¿ƒè¨­è¨ˆåŸå‰‡çš„ç¸®å¯«ï¼Œç”± Robert C. Martinï¼ˆUncle Bobï¼‰åœ¨ 21 ä¸–ç´€åˆæœŸæå‡ºã€‚é€™äº›åŸå‰‡æ—¨åœ¨è®“è»Ÿé«”è¨­è¨ˆæ›´åŠ å®¹æ˜“ç†è§£ã€éˆæ´»ä¸”å¯ç¶­è­·ã€‚\nSOLID åŸå‰‡ä¸åƒ…é©ç”¨æ–¼ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆï¼Œä¹Ÿæ˜¯ç¾ä»£è»Ÿé«”æ¶æ§‹çš„åŸºçŸ³ï¼Œå¾å¾®æœå‹™è¨­è¨ˆåˆ° Clean Architecture éƒ½æ·±å—å…¶å½±éŸ¿ã€‚\nSOLID åŸå‰‡æ¦‚è¦½ é¦–å­—æ¯ è‹±æ–‡åŸå‰‡åç¨± ä¸­æ–‡åç¨± æ ¸å¿ƒæ¦‚å¿µ S Single Responsibility Principle å–®ä¸€è·è²¬åŸå‰‡ ä¸€å€‹é¡åˆ¥æ‡‰è©²åªæœ‰ä¸€å€‹æ”¹è®Šçš„ç†ç”± O Open/Closed Principle é–‹é–‰åŸå‰‡ å°æ“´å±•é–‹æ”¾ï¼Œå°ä¿®æ”¹å°é–‰ L Liskov Substitution Principle é‡Œæ°æ›¿æ›åŸå‰‡ å­é¡åˆ¥æ‡‰è©²èƒ½å®Œå…¨æ›¿æ›çˆ¶é¡åˆ¥ I Interface Segregation Principle ä»‹é¢éš”é›¢åŸå‰‡ å®¢æˆ¶ç«¯ä¸æ‡‰è©²ä¾è³´å®ƒä¸éœ€è¦çš„ä»‹é¢ D Dependency Inversion Principle ä¾è³´åè½‰åŸå‰‡ ä¾è³´æ–¼æŠ½è±¡è€Œéå…·é«”å¯¦ä½œ 1. Single Responsibility Principle (SRP) - å–®ä¸€è·è²¬åŸå‰‡ å®šç¾© ä¸€å€‹é¡åˆ¥æ‡‰è©²åªæœ‰ä¸€å€‹å¼•èµ·å®ƒè®ŠåŒ–çš„åŸå› \næ ¸å¿ƒæ¦‚å¿µ é«˜å…§èšæ€§ï¼šé¡åˆ¥å…§éƒ¨çš„æ–¹æ³•å’Œå±¬æ€§æ‡‰è©²ç‚ºåŒä¸€å€‹ç›®æ¨™æœå‹™ ä½è€¦åˆæ€§ï¼šæ¸›å°‘é¡åˆ¥ä¹‹é–“çš„ä¾è³´é—œä¿‚ æ˜ç¢ºè²¬ä»»ï¼šæ¯å€‹é¡åˆ¥éƒ½æ‡‰è©²æœ‰æ˜ç¢ºä¸”å–®ä¸€çš„è·è²¬ é•å SRP çš„ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // âŒ é•å SRPï¼šä¸€å€‹é¡åˆ¥æ‰¿æ“”å¤šç¨®è·è²¬ public class User { private String name; private String email; // ç”¨æˆ¶è³‡æ–™é©—è­‰è·è²¬ public boolean validateEmail(String email) { return email.contains(\u0026#34;@\u0026#34;) \u0026amp;\u0026amp; email.contains(\u0026#34;.\u0026#34;); } // ç”¨æˆ¶æŒä¹…åŒ–è·è²¬ public void saveToDatabase() { // è³‡æ–™åº«å­˜å„²é‚è¼¯ System.out.println(\u0026#34;å„²å­˜ç”¨æˆ¶åˆ°è³‡æ–™åº«\u0026#34;); } // ç”¨æˆ¶é€šçŸ¥è·è²¬ public void sendWelcomeEmail() { // éƒµä»¶ç™¼é€é‚è¼¯ System.out.println(\u0026#34;ç™¼é€æ­¡è¿éƒµä»¶\u0026#34;); } // ç”¨æˆ¶å ±è¡¨è·è²¬ public String generateUserReport() { return \u0026#34;ç”¨æˆ¶å ±è¡¨: \u0026#34; + name + \u0026#34; - \u0026#34; + email; } } éµå¾ª SRP çš„é‡æ§‹ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 // âœ… éµå¾ª SRPï¼šè·è²¬åˆ†é›¢ // 1. ç”¨æˆ¶å¯¦é«”é¡åˆ¥ï¼ˆåƒ…è² è²¬ç”¨æˆ¶è³‡æ–™ï¼‰ public class User { private String name; private String email; public User(String name, String email) { this.name = name; this.email = email; } // Getter and Setter methods public String getName() { return name; } public String getEmail() { return email; } public void setName(String name) { this.name = name; } public void setEmail(String email) { this.email = email; } } // 2. ç”¨æˆ¶é©—è­‰æœå‹™ï¼ˆåƒ…è² è²¬é©—è­‰é‚è¼¯ï¼‰ @Service public class UserValidator { public boolean validateEmail(String email) { return email != null \u0026amp;\u0026amp; email.contains(\u0026#34;@\u0026#34;) \u0026amp;\u0026amp; email.contains(\u0026#34;.\u0026#34;) \u0026amp;\u0026amp; email.length() \u0026gt; 5; } public boolean validateName(String name) { return name != null \u0026amp;\u0026amp; name.trim().length() \u0026gt; 0 \u0026amp;\u0026amp; name.length() \u0026lt;= 50; } public ValidationResult validateUser(User user) { ValidationResult result = new ValidationResult(); if (!validateName(user.getName())) { result.addError(\u0026#34;ç”¨æˆ¶åæ ¼å¼ç„¡æ•ˆ\u0026#34;); } if (!validateEmail(user.getEmail())) { result.addError(\u0026#34;éƒµç®±æ ¼å¼ç„¡æ•ˆ\u0026#34;); } return result; } } // 3. ç”¨æˆ¶æŒä¹…åŒ–æœå‹™ï¼ˆåƒ…è² è²¬è³‡æ–™å­˜å–ï¼‰ @Repository public class UserRepository { public void save(User user) { // è³‡æ–™åº«å­˜å„²é‚è¼¯ System.out.println(\u0026#34;å„²å­˜ç”¨æˆ¶åˆ°è³‡æ–™åº«: \u0026#34; + user.getName()); } public User findByEmail(String email) { // æŸ¥è©¢é‚è¼¯ return new User(\u0026#34;æ‰¾åˆ°çš„ç”¨æˆ¶\u0026#34;, email); } public List\u0026lt;User\u0026gt; findAll() { // æŸ¥è©¢æ‰€æœ‰ç”¨æˆ¶ return Arrays.asList(new User(\u0026#34;ç”¨æˆ¶1\u0026#34;, \u0026#34;user1@example.com\u0026#34;)); } } // 4. ç”¨æˆ¶é€šçŸ¥æœå‹™ï¼ˆåƒ…è² è²¬é€šçŸ¥é‚è¼¯ï¼‰ @Service public class UserNotificationService { public void sendWelcomeEmail(User user) { System.out.println(\u0026#34;ç™¼é€æ­¡è¿éƒµä»¶çµ¦: \u0026#34; + user.getEmail()); } public void sendPasswordResetEmail(User user) { System.out.println(\u0026#34;ç™¼é€å¯†ç¢¼é‡è¨­éƒµä»¶çµ¦: \u0026#34; + user.getEmail()); } public void sendAccountActivationEmail(User user) { System.out.println(\u0026#34;ç™¼é€å¸³æˆ¶å•Ÿç”¨éƒµä»¶çµ¦: \u0026#34; + user.getEmail()); } } // 5. ç”¨æˆ¶å ±è¡¨æœå‹™ï¼ˆåƒ…è² è²¬å ±è¡¨ç”Ÿæˆï¼‰ @Service public class UserReportService { public String generateUserReport(User user) { return String.format(\u0026#34;ç”¨æˆ¶å ±è¡¨\\nå§“å: %s\\néƒµç®±: %s\\nç”Ÿæˆæ™‚é–“: %s\u0026#34;, user.getName(), user.getEmail(), LocalDateTime.now()); } public String generateUsersListReport(List\u0026lt;User\u0026gt; users) { StringBuilder report = new StringBuilder(\u0026#34;ç”¨æˆ¶åˆ—è¡¨å ±è¡¨\\n\u0026#34;); users.forEach(user -\u0026gt; report.append(String.format(\u0026#34;- %s (%s)\\n\u0026#34;, user.getName(), user.getEmail())) ); return report.toString(); } } // 6. ç”¨æˆ¶æœå‹™å”èª¿å™¨ï¼ˆçµ„åˆå„ç¨®æœå‹™ï¼‰ @Service public class UserService { private final UserValidator userValidator; private final UserRepository userRepository; private final UserNotificationService notificationService; public UserService(UserValidator userValidator, UserRepository userRepository, UserNotificationService notificationService) { this.userValidator = userValidator; this.userRepository = userRepository; this.notificationService = notificationService; } public Result\u0026lt;User\u0026gt; createUser(String name, String email) { User user = new User(name, email); // é©—è­‰ç”¨æˆ¶è³‡æ–™ ValidationResult validation = userValidator.validateUser(user); if (!validation.isValid()) { return Result.failure(\u0026#34;é©—è­‰å¤±æ•—: \u0026#34; + validation.getErrors()); } // å„²å­˜ç”¨æˆ¶ userRepository.save(user); // ç™¼é€æ­¡è¿éƒµä»¶ notificationService.sendWelcomeEmail(user); return Result.success(user); } } SRP çš„å¥½è™• é™ä½è¤‡é›œåº¦ï¼šæ¯å€‹é¡åˆ¥çš„è²¬ä»»æ˜ç¢ºï¼Œæ˜“æ–¼ç†è§£ æé«˜å¯è®€æ€§ï¼šç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°ï¼ŒåŠŸèƒ½åŠƒåˆ†æ˜ç¢º å¢å¼·å¯ç¶­è­·æ€§ï¼šä¿®æ”¹æŸå€‹åŠŸèƒ½æ™‚ï¼Œåªéœ€è¦é—œæ³¨ç‰¹å®šçš„é¡åˆ¥ æå‡å¯æ¸¬è©¦æ€§ï¼šè·è²¬å–®ä¸€çš„é¡åˆ¥æ›´å®¹æ˜“é€²è¡Œå–®å…ƒæ¸¬è©¦ ä¿ƒé€²é‡ç”¨æ€§ï¼šåŠŸèƒ½ç¨ç«‹çš„é¡åˆ¥å¯ä»¥åœ¨ä¸åŒå ´æ™¯ä¸­é‡è¤‡ä½¿ç”¨ 2. Open/Closed Principle (OCP) - é–‹é–‰åŸå‰‡ å®šç¾© è»Ÿé«”å¯¦é«”ï¼ˆé¡åˆ¥ã€æ¨¡çµ„ã€å‡½æ•¸ç­‰ï¼‰æ‡‰è©²å°æ“´å±•é–‹æ”¾ï¼Œå°ä¿®æ”¹å°é–‰\næ ¸å¿ƒæ¦‚å¿µ å°æ“´å±•é–‹æ”¾ï¼šå¯ä»¥é€éæ–°å¢ç¨‹å¼ç¢¼ä¾†æ“´å±•åŠŸèƒ½ å°ä¿®æ”¹å°é–‰ï¼šä¸æ‡‰è©²ä¿®æ”¹ç¾æœ‰çš„ç¨‹å¼ç¢¼ ç­–ç•¥æ¨¡å¼ï¼šé€éæŠ½è±¡ä»‹é¢å¯¦ç¾ä¸åŒçš„å¯¦ä½œç­–ç•¥ é•å OCP çš„ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // âŒ é•å OCPï¼šæ¯æ¬¡æ–°å¢å½¢ç‹€éƒ½éœ€è¦ä¿®æ”¹è¨ˆç®—å™¨é¡åˆ¥ public class AreaCalculator { public double calculateArea(Object shape) { if (shape instanceof Rectangle) { Rectangle rectangle = (Rectangle) shape; return rectangle.getWidth() * rectangle.getHeight(); } else if (shape instanceof Circle) { Circle circle = (Circle) shape; return Math.PI * circle.getRadius() * circle.getRadius(); } else if (shape instanceof Triangle) { // æ–°å¢ä¸‰è§’å½¢éœ€è¦ä¿®æ”¹æ­¤æ–¹æ³• Triangle triangle = (Triangle) shape; return 0.5 * triangle.getBase() * triangle.getHeight(); } // æ¯æ¬¡æ–°å¢æ–°å½¢ç‹€éƒ½éœ€è¦ä¿®æ”¹é€™è£¡ throw new IllegalArgumentException(\u0026#34;ä¸æ”¯æ´çš„å½¢ç‹€é¡å‹\u0026#34;); } } éµå¾ª OCP çš„é‡æ§‹ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 // âœ… éµå¾ª OCPï¼šå®šç¾©æŠ½è±¡ä»‹é¢ public interface Shape { double calculateArea(); String getShapeType(); } // å…·é«”å¯¦ä½œ - çŸ©å½¢ public class Rectangle implements Shape { private double width; private double height; public Rectangle(double width, double height) { this.width = width; this.height = height; } @Override public double calculateArea() { return width * height; } @Override public String getShapeType() { return \u0026#34;çŸ©å½¢\u0026#34;; } // Getter methods public double getWidth() { return width; } public double getHeight() { return height; } } // å…·é«”å¯¦ä½œ - åœ“å½¢ public class Circle implements Shape { private double radius; public Circle(double radius) { this.radius = radius; } @Override public double calculateArea() { return Math.PI * radius * radius; } @Override public String getShapeType() { return \u0026#34;åœ“å½¢\u0026#34;; } public double getRadius() { return radius; } } // å…·é«”å¯¦ä½œ - ä¸‰è§’å½¢ï¼ˆæ–°å¢æ™‚ç„¡éœ€ä¿®æ”¹ç¾æœ‰ç¨‹å¼ç¢¼ï¼‰ public class Triangle implements Shape { private double base; private double height; public Triangle(double base, double height) { this.base = base; this.height = height; } @Override public double calculateArea() { return 0.5 * base * height; } @Override public String getShapeType() { return \u0026#34;ä¸‰è§’å½¢\u0026#34;; } public double getBase() { return base; } public double getHeight() { return height; } } // æ–°å¢å¤šé‚Šå½¢ï¼ˆç„¡éœ€ä¿®æ”¹ç¾æœ‰ç¨‹å¼ç¢¼ï¼‰ public class Polygon implements Shape { private List\u0026lt;Point\u0026gt; vertices; public Polygon(List\u0026lt;Point\u0026gt; vertices) { this.vertices = vertices; } @Override public double calculateArea() { // ä½¿ç”¨é‹å¸¶å…¬å¼è¨ˆç®—å¤šé‚Šå½¢é¢ç© double area = 0; int n = vertices.size(); for (int i = 0; i \u0026lt; n; i++) { int j = (i + 1) % n; area += vertices.get(i).getX() * vertices.get(j).getY(); area -= vertices.get(j).getX() * vertices.get(i).getY(); } return Math.abs(area) / 2.0; } @Override public String getShapeType() { return \u0026#34;å¤šé‚Šå½¢\u0026#34;; } } // é¢ç©è¨ˆç®—å™¨ï¼ˆç„¡éœ€ä¿®æ”¹ï¼Œæ”¯æ´æ‰€æœ‰ Shape å¯¦ä½œï¼‰ @Service public class AreaCalculator { public double calculateArea(Shape shape) { return shape.calculateArea(); } public List\u0026lt;AreaReport\u0026gt; calculateMultipleAreas(List\u0026lt;Shape\u0026gt; shapes) { return shapes.stream() .map(shape -\u0026gt; new AreaReport( shape.getShapeType(), shape.calculateArea() )) .collect(Collectors.toList()); } public double calculateTotalArea(List\u0026lt;Shape\u0026gt; shapes) { return shapes.stream() .mapToDouble(Shape::calculateArea) .sum(); } } // å½¢ç‹€å·¥å» ï¼ˆæ”¯æ´æ“´å±•æ–°å½¢ç‹€ï¼‰ @Component public class ShapeFactory { public Shape createRectangle(double width, double height) { return new Rectangle(width, height); } public Shape createCircle(double radius) { return new Circle(radius); } public Shape createTriangle(double base, double height) { return new Triangle(base, height); } public Shape createPolygon(List\u0026lt;Point\u0026gt; vertices) { return new Polygon(vertices); } } // ä½¿ç”¨ç¯„ä¾‹ @RestController @RequestMapping(\u0026#34;/shapes\u0026#34;) public class ShapeController { private final AreaCalculator areaCalculator; private final ShapeFactory shapeFactory; public ShapeController(AreaCalculator areaCalculator, ShapeFactory shapeFactory) { this.areaCalculator = areaCalculator; this.shapeFactory = shapeFactory; } @PostMapping(\u0026#34;/rectangle/area\u0026#34;) public AreaResponse calculateRectangleArea(@RequestBody RectangleRequest request) { Shape rectangle = shapeFactory.createRectangle(request.getWidth(), request.getHeight()); double area = areaCalculator.calculateArea(rectangle); return new AreaResponse(rectangle.getShapeType(), area); } @PostMapping(\u0026#34;/circle/area\u0026#34;) public AreaResponse calculateCircleArea(@RequestBody CircleRequest request) { Shape circle = shapeFactory.createCircle(request.getRadius()); double area = areaCalculator.calculateArea(circle); return new AreaResponse(circle.getShapeType(), area); } } é€²éšæ‡‰ç”¨ï¼šç­–ç•¥æ¨¡å¼èˆ‡å·¥å» æ¨¡å¼çµåˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 // æŠ˜æ‰£ç­–ç•¥ä»‹é¢ public interface DiscountStrategy { double calculateDiscount(double originalPrice); String getStrategyName(); } // å…·é«”æŠ˜æ‰£ç­–ç•¥ @Component(\u0026#34;regular\u0026#34;) public class RegularCustomerDiscount implements DiscountStrategy { @Override public double calculateDiscount(double originalPrice) { return originalPrice * 0.05; // 5% æŠ˜æ‰£ } @Override public String getStrategyName() { return \u0026#34;ä¸€èˆ¬å®¢æˆ¶æŠ˜æ‰£\u0026#34;; } } @Component(\u0026#34;vip\u0026#34;) public class VipCustomerDiscount implements DiscountStrategy { @Override public double calculateDiscount(double originalPrice) { return originalPrice * 0.15; // 15% æŠ˜æ‰£ } @Override public String getStrategyName() { return \u0026#34;VIP å®¢æˆ¶æŠ˜æ‰£\u0026#34;; } } @Component(\u0026#34;premium\u0026#34;) public class PremiumCustomerDiscount implements DiscountStrategy { @Override public double calculateDiscount(double originalPrice) { return originalPrice * 0.25; // 25% æŠ˜æ‰£ } @Override public String getStrategyName() { return \u0026#34;å°Šäº«å®¢æˆ¶æŠ˜æ‰£\u0026#34;; } } // æŠ˜æ‰£è¨ˆç®—å™¨ï¼ˆå°ä¿®æ”¹å°é–‰ï¼Œå°æ“´å±•é–‹æ”¾ï¼‰ @Service public class DiscountCalculator { private final Map\u0026lt;String, DiscountStrategy\u0026gt; strategies; public DiscountCalculator(Map\u0026lt;String, DiscountStrategy\u0026gt; strategies) { this.strategies = strategies; } public DiscountResult calculateDiscount(String customerType, double originalPrice) { DiscountStrategy strategy = strategies.get(customerType); if (strategy == null) { throw new IllegalArgumentException(\u0026#34;ä¸æ”¯æ´çš„å®¢æˆ¶é¡å‹: \u0026#34; + customerType); } double discountAmount = strategy.calculateDiscount(originalPrice); double finalPrice = originalPrice - discountAmount; return new DiscountResult( strategy.getStrategyName(), originalPrice, discountAmount, finalPrice ); } } 3. Liskov Substitution Principle (LSP) - é‡Œæ°æ›¿æ›åŸå‰‡ å®šç¾© å­é¡åˆ¥å¿…é ˆèƒ½å¤ æ›¿æ›å…¶çˆ¶é¡åˆ¥ï¼Œè€Œä¸æœƒæ”¹è®Šç¨‹å¼çš„æ­£ç¢ºæ€§\næ ¸å¿ƒæ¦‚å¿µ è¡Œç‚ºç›¸å®¹æ€§ï¼šå­é¡åˆ¥çš„è¡Œç‚ºæ‡‰è©²èˆ‡çˆ¶é¡åˆ¥ä¸€è‡´ å¥‘ç´„ä¿æŒï¼šå­é¡åˆ¥ä¸èƒ½é•åçˆ¶é¡åˆ¥å»ºç«‹çš„å¥‘ç´„ å¼·åŒ–å‰ç½®æ¢ä»¶ï¼šå­é¡åˆ¥ä¸èƒ½å¼·åŒ–å‰ç½®æ¢ä»¶ å¼±åŒ–å¾Œç½®æ¢ä»¶ï¼šå­é¡åˆ¥ä¸èƒ½å¼±åŒ–å¾Œç½®æ¢ä»¶ é•å LSP çš„ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 // âŒ é•å LSPï¼šæ­£æ–¹å½¢ä¿®æ”¹äº†çŸ©å½¢çš„è¡Œç‚ºå¥‘ç´„ public class Rectangle { protected double width; protected double height; public Rectangle(double width, double height) { this.width = width; this.height = height; } public void setWidth(double width) { this.width = width; } public void setHeight(double height) { this.height = height; } public double getWidth() { return width; } public double getHeight() { return height; } public double getArea() { return width * height; } } // âŒ æ­£æ–¹å½¢ç¹¼æ‰¿çŸ©å½¢ï¼Œä½†é•åäº†é‡Œæ°æ›¿æ›åŸå‰‡ public class Square extends Rectangle { public Square(double side) { super(side, side); } // é•åLSPï¼šæ”¹è®Šäº†çˆ¶é¡åˆ¥çš„è¡Œç‚ºå¥‘ç´„ @Override public void setWidth(double width) { this.width = width; this.height = width; // å¼·åˆ¶ä¿æŒæ­£æ–¹å½¢æ€§è³ª } @Override public void setHeight(double height) { this.width = height; // å¼·åˆ¶ä¿æŒæ­£æ–¹å½¢æ€§è³ª this.height = height; } } // æ¸¬è©¦ç¨‹å¼ç¢¼å±•ç¤ºå•é¡Œ public class GeometryTest { public static void testRectangle(Rectangle rectangle) { rectangle.setWidth(4); rectangle.setHeight(5); // æœŸæœ›é¢ç©æ˜¯ 20ï¼Œä½†å¦‚æœå‚³å…¥ Square ç‰©ä»¶ï¼Œé¢ç©æœƒæ˜¯ 25 double expectedArea = 20; double actualArea = rectangle.getArea(); System.out.println(\u0026#34;æœŸæœ›é¢ç©: \u0026#34; + expectedArea); System.out.println(\u0026#34;å¯¦éš›é¢ç©: \u0026#34; + actualArea); System.out.println(\u0026#34;æ¸¬è©¦çµæœ: \u0026#34; + (expectedArea == actualArea ? \u0026#34;é€šé\u0026#34; : \u0026#34;å¤±æ•—\u0026#34;)); } public static void main(String[] args) { Rectangle rectangle = new Rectangle(0, 0); testRectangle(rectangle); // é€šé Rectangle square = new Square(0); testRectangle(square); // å¤±æ•—ï¼é•åäº† LSP } } éµå¾ª LSP çš„é‡æ§‹ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 // âœ… éµå¾ª LSPï¼šé‡æ–°è¨­è¨ˆç¹¼æ‰¿éšå±¤ // æŠ½è±¡åŸºç¤é¡åˆ¥ public abstract class Shape { public abstract double getArea(); public abstract double getPerimeter(); public abstract String getShapeType(); // æ¨¡æ¿æ–¹æ³• public String getShapeInfo() { return String.format(\u0026#34;%s - é¢ç©: %.2f, å‘¨é•·: %.2f\u0026#34;, getShapeType(), getArea(), getPerimeter()); } } // çŸ©å½¢å¯¦ä½œ public class Rectangle extends Shape { private double width; private double height; public Rectangle(double width, double height) { if (width \u0026lt;= 0 || height \u0026lt;= 0) { throw new IllegalArgumentException(\u0026#34;é•·åº¦å’Œå¯¬åº¦å¿…é ˆå¤§æ–¼ 0\u0026#34;); } this.width = width; this.height = height; } @Override public double getArea() { return width * height; } @Override public double getPerimeter() { return 2 * (width + height); } @Override public String getShapeType() { return \u0026#34;çŸ©å½¢\u0026#34;; } // åªæä¾›å®‰å…¨çš„ä¿®æ”¹æ–¹æ³• public Rectangle resize(double newWidth, double newHeight) { return new Rectangle(newWidth, newHeight); } public double getWidth() { return width; } public double getHeight() { return height; } } // æ­£æ–¹å½¢å¯¦ä½œï¼ˆä¸ç¹¼æ‰¿çŸ©å½¢ï¼‰ public class Square extends Shape { private double side; public Square(double side) { if (side \u0026lt;= 0) { throw new IllegalArgumentException(\u0026#34;é‚Šé•·å¿…é ˆå¤§æ–¼ 0\u0026#34;); } this.side = side; } @Override public double getArea() { return side * side; } @Override public double getPerimeter() { return 4 * side; } @Override public String getShapeType() { return \u0026#34;æ­£æ–¹å½¢\u0026#34;; } public Square resize(double newSide) { return new Square(newSide); } public double getSide() { return side; } } // åœ“å½¢å¯¦ä½œ public class Circle extends Shape { private double radius; public Circle(double radius) { if (radius \u0026lt;= 0) { throw new IllegalArgumentException(\u0026#34;åŠå¾‘å¿…é ˆå¤§æ–¼ 0\u0026#34;); } this.radius = radius; } @Override public double getArea() { return Math.PI * radius * radius; } @Override public double getPerimeter() { return 2 * Math.PI * radius; } @Override public String getShapeType() { return \u0026#34;åœ“å½¢\u0026#34;; } public Circle resize(double newRadius) { return new Circle(newRadius); } public double getRadius() { return radius; } } // å¹¾ä½•è¨ˆç®—å™¨ï¼ˆå¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ä»»ä½• Shape å­é¡åˆ¥ï¼‰ @Service public class GeometryCalculator { // å¯ä»¥å®‰å…¨åœ°æ¥å—ä»»ä½• Shape å­é¡åˆ¥ public double calculateArea(Shape shape) { return shape.getArea(); } public double calculatePerimeter(Shape shape) { return shape.getPerimeter(); } public List\u0026lt;ShapeReport\u0026gt; generateShapeReports(List\u0026lt;Shape\u0026gt; shapes) { return shapes.stream() .map(shape -\u0026gt; new ShapeReport( shape.getShapeType(), shape.getArea(), shape.getPerimeter() )) .collect(Collectors.toList()); } public Shape findLargestShape(List\u0026lt;Shape\u0026gt; shapes) { return shapes.stream() .max(Comparator.comparing(Shape::getArea)) .orElseThrow(() -\u0026gt; new IllegalArgumentException(\u0026#34;å½¢ç‹€åˆ—è¡¨ä¸èƒ½ç‚ºç©º\u0026#34;)); } } // æ¸¬è©¦è­‰æ˜ LSP åˆè¦æ€§ @Component public class GeometryTestService { private final GeometryCalculator calculator; public GeometryTestService(GeometryCalculator calculator) { this.calculator = calculator; } public void testShapePolymorphism() { List\u0026lt;Shape\u0026gt; shapes = Arrays.asList( new Rectangle(4, 5), // é¢ç©: 20 new Square(4), // é¢ç©: 16 new Circle(3) // é¢ç©: ~28.27 ); // æ‰€æœ‰å½¢ç‹€éƒ½å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ç›¸åŒçš„æ–¹æ³• shapes.forEach(shape -\u0026gt; { System.out.println(shape.getShapeInfo()); }); // æ‰¾å‡ºæœ€å¤§é¢ç©çš„å½¢ç‹€ Shape largest = calculator.findLargestShape(shapes); System.out.println(\u0026#34;æœ€å¤§å½¢ç‹€: \u0026#34; + largest.getShapeInfo()); } } LSP çš„é€²éšæ‡‰ç”¨ï¼šå¥‘ç´„è¨­è¨ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 // å®šç¾©æ¸…æ¥šçš„å¥‘ç´„ public abstract class Bird { protected String name; protected double weight; public Bird(String name, double weight) { this.name = name; this.weight = weight; } // å¥‘ç´„ï¼šæ‰€æœ‰é³¥é¡éƒ½å¯ä»¥åƒ public abstract void eat(String food); // å¥‘ç´„ï¼šæ‰€æœ‰é³¥é¡éƒ½å¯ä»¥ç§»å‹• public abstract void move(); public String getName() { return name; } public double getWeight() { return weight; } } // å¯é£›è¡Œçš„é³¥é¡ä»‹é¢ public interface Flyable { void fly(); double getMaxFlightHeight(); } // å¯æ¸¸æ³³çš„é³¥é¡ä»‹é¢ public interface Swimmable { void swim(); double getMaxDivingDepth(); } // å…·é«”å¯¦ä½œ - è€é·¹ï¼ˆå¯é£›è¡Œï¼‰ public class Eagle extends Bird implements Flyable { public Eagle(String name, double weight) { super(name, weight); } @Override public void eat(String food) { System.out.println(name + \u0026#34; æ­£åœ¨åƒ \u0026#34; + food); } @Override public void move() { fly(); // è€é·¹ä¸»è¦é€éé£›è¡Œç§»å‹• } @Override public void fly() { System.out.println(name + \u0026#34; æ­£åœ¨é«˜ç©ºé£›ç¿”\u0026#34;); } @Override public double getMaxFlightHeight() { return 3000; // 3000å…¬å°º } } // å…·é«”å¯¦ä½œ - ä¼éµï¼ˆå¯æ¸¸æ³³ï¼Œä¸èƒ½é£›è¡Œï¼‰ public class Penguin extends Bird implements Swimmable { public Penguin(String name, double weight) { super(name, weight); } @Override public void eat(String food) { System.out.println(name + \u0026#34; æ­£åœ¨åƒ \u0026#34; + food); } @Override public void move() { swim(); // ä¼éµä¸»è¦é€éæ¸¸æ³³ç§»å‹• } @Override public void swim() { System.out.println(name + \u0026#34; æ­£åœ¨æ°´ä¸­æ¸¸æ³³\u0026#34;); } @Override public double getMaxDivingDepth() { return 200; // 200å…¬å°º } } // é³¥é¡ç®¡ç†æœå‹™ï¼ˆå®Œå…¨éµå¾ª LSPï¼‰ @Service public class BirdManagementService { // å¯ä»¥å®‰å…¨åœ°è™•ç†ä»»ä½• Bird å­é¡åˆ¥ public void feedBird(Bird bird, String food) { bird.eat(food); } public void moveBird(Bird bird) { bird.move(); } // å°ˆé–€è™•ç†å¯é£›è¡Œçš„é³¥é¡ public void makeFly(Flyable flyableBird) { flyableBird.fly(); System.out.println(\u0026#34;æœ€å¤§é£›è¡Œé«˜åº¦: \u0026#34; + flyableBird.getMaxFlightHeight() + \u0026#34; å…¬å°º\u0026#34;); } // å°ˆé–€è™•ç†å¯æ¸¸æ³³çš„é³¥é¡ public void makeSwim(Swimmable swimmableBird) { swimmableBird.swim(); System.out.println(\u0026#34;æœ€å¤§æ½›æ°´æ·±åº¦: \u0026#34; + swimmableBird.getMaxDivingDepth() + \u0026#34; å…¬å°º\u0026#34;); } } 4. Interface Segregation Principle (ISP) - ä»‹é¢éš”é›¢åŸå‰‡ å®šç¾© ä¸æ‡‰è©²å¼·è¿«å®¢æˆ¶ç«¯ä¾è³´å®ƒå€‘ä¸ä½¿ç”¨çš„ä»‹é¢æ–¹æ³•\næ ¸å¿ƒæ¦‚å¿µ ä»‹é¢æœ€å°åŒ–ï¼šä»‹é¢æ‡‰è©²åªåŒ…å«å®¢æˆ¶ç«¯éœ€è¦çš„æ–¹æ³• è·è²¬åˆ†é›¢ï¼šå¤§ä»‹é¢æ‡‰è©²æ‹†åˆ†æˆå¤šå€‹å°ä»‹é¢ ä¾è³´æœ€å°åŒ–ï¼šé™ä½ä»‹é¢ä¹‹é–“çš„è€¦åˆåº¦ é•å ISP çš„ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 // âŒ é•å ISPï¼šè¬èƒ½ä»‹é¢ï¼Œå¼·è¿«å¯¦ä½œä¸éœ€è¦çš„æ–¹æ³• public interface MediaPlayer { void playAudio(String audioFile); void playVideo(String videoFile); void displaySubtitles(String subtitleFile); void adjustVolume(int volume); void adjustBrightness(int brightness); void recordAudio(); void recordVideo(); void takeScreenshot(); void applyAudioFilter(String filter); void applyVideoFilter(String filter); } // âŒ éŸ³é »æ’­æ”¾å™¨è¢«è¿«å¯¦ä½œä¸éœ€è¦çš„è¦–é »ç›¸é—œæ–¹æ³• public class AudioPlayer implements MediaPlayer { @Override public void playAudio(String audioFile) { System.out.println(\u0026#34;æ’­æ”¾éŸ³é »: \u0026#34; + audioFile); } @Override public void adjustVolume(int volume) { System.out.println(\u0026#34;èª¿æ•´éŸ³é‡åˆ°: \u0026#34; + volume); } @Override public void applyAudioFilter(String filter) { System.out.println(\u0026#34;æ‡‰ç”¨éŸ³é »æ¿¾é¡: \u0026#34; + filter); } // è¢«è¿«å¯¦ä½œä¸éœ€è¦çš„æ–¹æ³• @Override public void playVideo(String videoFile) { throw new UnsupportedOperationException(\u0026#34;éŸ³é »æ’­æ”¾å™¨ä¸æ”¯æ´è¦–é »æ’­æ”¾\u0026#34;); } @Override public void displaySubtitles(String subtitleFile) { throw new UnsupportedOperationException(\u0026#34;éŸ³é »æ’­æ”¾å™¨ä¸æ”¯æ´å­—å¹•\u0026#34;); } @Override public void adjustBrightness(int brightness) { throw new UnsupportedOperationException(\u0026#34;éŸ³é »æ’­æ”¾å™¨ä¸æ”¯æ´äº®åº¦èª¿æ•´\u0026#34;); } @Override public void recordAudio() { throw new UnsupportedOperationException(\u0026#34;æ­¤éŸ³é »æ’­æ”¾å™¨ä¸æ”¯æ´éŒ„éŸ³\u0026#34;); } @Override public void recordVideo() { throw new UnsupportedOperationException(\u0026#34;éŸ³é »æ’­æ”¾å™¨ä¸æ”¯æ´è¦–é »éŒ„è£½\u0026#34;); } @Override public void takeScreenshot() { throw new UnsupportedOperationException(\u0026#34;éŸ³é »æ’­æ”¾å™¨ä¸æ”¯æ´æˆªåœ–\u0026#34;); } @Override public void applyVideoFilter(String filter) { throw new UnsupportedOperationException(\u0026#34;éŸ³é »æ’­æ”¾å™¨ä¸æ”¯æ´è¦–é »æ¿¾é¡\u0026#34;); } } éµå¾ª ISP çš„é‡æ§‹ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 // âœ… éµå¾ª ISPï¼šå°‡å¤§ä»‹é¢æ‹†åˆ†æˆå¤šå€‹è·è²¬æ˜ç¢ºçš„å°ä»‹é¢ // åŸºç¤æ’­æ”¾ä»‹é¢ public interface Playable { void play(String file); void pause(); void stop(); void seek(long position); } // éŸ³é »ç›¸é—œä»‹é¢ public interface AudioPlayable extends Playable { void adjustVolume(int volume); int getVolume(); } // è¦–é »ç›¸é—œä»‹é¢ public interface VideoPlayable extends Playable { void adjustBrightness(int brightness); void adjustContrast(int contrast); int getBrightness(); int getContrast(); } // å­—å¹•æ”¯æ´ä»‹é¢ public interface SubtitleSupport { void loadSubtitles(String subtitleFile); void showSubtitles(boolean show); void adjustSubtitleSize(int size); } // éŒ„éŸ³ä»‹é¢ public interface AudioRecordable { void startAudioRecording(String outputFile); void stopAudioRecording(); boolean isRecording(); } // éŒ„å½±ä»‹é¢ public interface VideoRecordable { void startVideoRecording(String outputFile); void stopVideoRecording(); void takeScreenshot(String outputFile); } // æ¿¾é¡æ”¯æ´ä»‹é¢ public interface AudioFilterSupport { void applyAudioFilter(AudioFilter filter); void removeAudioFilter(); List\u0026lt;AudioFilter\u0026gt; getAvailableAudioFilters(); } public interface VideoFilterSupport { void applyVideoFilter(VideoFilter filter); void removeVideoFilter(); List\u0026lt;VideoFilter\u0026gt; getAvailableVideoFilters(); } // éŸ³é »æ’­æ”¾å™¨å¯¦ä½œï¼ˆåªå¯¦ä½œéœ€è¦çš„ä»‹é¢ï¼‰ @Component public class SimpleAudioPlayer implements AudioPlayable, AudioFilterSupport { private int volume = 50; private boolean isPlaying = false; private AudioFilter currentFilter; @Override public void play(String file) { System.out.println(\u0026#34;æ’­æ”¾éŸ³é »æª”æ¡ˆ: \u0026#34; + file); isPlaying = true; } @Override public void pause() { System.out.println(\u0026#34;æš«åœæ’­æ”¾\u0026#34;); isPlaying = false; } @Override public void stop() { System.out.println(\u0026#34;åœæ­¢æ’­æ”¾\u0026#34;); isPlaying = false; } @Override public void seek(long position) { System.out.println(\u0026#34;è·³è½‰åˆ°ä½ç½®: \u0026#34; + position + \u0026#34; ç§’\u0026#34;); } @Override public void adjustVolume(int volume) { this.volume = Math.max(0, Math.min(100, volume)); System.out.println(\u0026#34;éŸ³é‡èª¿æ•´ç‚º: \u0026#34; + this.volume); } @Override public int getVolume() { return volume; } @Override public void applyAudioFilter(AudioFilter filter) { this.currentFilter = filter; System.out.println(\u0026#34;æ‡‰ç”¨éŸ³é »æ¿¾é¡: \u0026#34; + filter.getName()); } @Override public void removeAudioFilter() { this.currentFilter = null; System.out.println(\u0026#34;ç§»é™¤éŸ³é »æ¿¾é¡\u0026#34;); } @Override public List\u0026lt;AudioFilter\u0026gt; getAvailableAudioFilters() { return Arrays.asList( new AudioFilter(\u0026#34;å›éŸ³\u0026#34;, \u0026#34;echo\u0026#34;), new AudioFilter(\u0026#34;é™å™ª\u0026#34;, \u0026#34;noise_reduction\u0026#34;), new AudioFilter(\u0026#34;ç­‰åŒ–å™¨\u0026#34;, \u0026#34;equalizer\u0026#34;) ); } } // å°ˆæ¥­éŒ„éŸ³æ©Ÿå¯¦ä½œï¼ˆå¯¦ä½œéŒ„éŸ³ç›¸é—œä»‹é¢ï¼‰ @Component public class ProfessionalAudioRecorder implements AudioPlayable, AudioRecordable, AudioFilterSupport { private int volume = 50; private boolean isPlaying = false; private boolean isRecording = false; private String currentRecordingFile; // å¯¦ä½œæ’­æ”¾åŠŸèƒ½ @Override public void play(String file) { if (!isRecording) { System.out.println(\u0026#34;æ’­æ”¾éŸ³é »æª”æ¡ˆ: \u0026#34; + file); isPlaying = true; } else { System.out.println(\u0026#34;éŒ„éŸ³ä¸­ï¼Œç„¡æ³•æ’­æ”¾\u0026#34;); } } @Override public void pause() { System.out.println(\u0026#34;æš«åœæ’­æ”¾\u0026#34;); isPlaying = false; } @Override public void stop() { System.out.println(\u0026#34;åœæ­¢æ’­æ”¾\u0026#34;); isPlaying = false; } @Override public void seek(long position) { System.out.println(\u0026#34;è·³è½‰åˆ°ä½ç½®: \u0026#34; + position + \u0026#34; ç§’\u0026#34;); } @Override public void adjustVolume(int volume) { this.volume = Math.max(0, Math.min(100, volume)); System.out.println(\u0026#34;éŸ³é‡èª¿æ•´ç‚º: \u0026#34; + this.volume); } @Override public int getVolume() { return volume; } // å¯¦ä½œéŒ„éŸ³åŠŸèƒ½ @Override public void startAudioRecording(String outputFile) { if (!isPlaying) { this.currentRecordingFile = outputFile; this.isRecording = true; System.out.println(\u0026#34;é–‹å§‹éŒ„éŸ³åˆ°: \u0026#34; + outputFile); } else { System.out.println(\u0026#34;æ’­æ”¾ä¸­ï¼Œç„¡æ³•éŒ„éŸ³\u0026#34;); } } @Override public void stopAudioRecording() { if (isRecording) { this.isRecording = false; System.out.println(\u0026#34;éŒ„éŸ³å®Œæˆ: \u0026#34; + currentRecordingFile); this.currentRecordingFile = null; } } @Override public boolean isRecording() { return isRecording; } // å¯¦ä½œæ¿¾é¡åŠŸèƒ½ @Override public void applyAudioFilter(AudioFilter filter) { System.out.println(\u0026#34;æ‡‰ç”¨å°ˆæ¥­éŸ³é »æ¿¾é¡: \u0026#34; + filter.getName()); } @Override public void removeAudioFilter() { System.out.println(\u0026#34;ç§»é™¤éŸ³é »æ¿¾é¡\u0026#34;); } @Override public List\u0026lt;AudioFilter\u0026gt; getAvailableAudioFilters() { return Arrays.asList( new AudioFilter(\u0026#34;å›éŸ³\u0026#34;, \u0026#34;echo\u0026#34;), new AudioFilter(\u0026#34;é™å™ª\u0026#34;, \u0026#34;noise_reduction\u0026#34;), new AudioFilter(\u0026#34;ç­‰åŒ–å™¨\u0026#34;, \u0026#34;equalizer\u0026#34;), new AudioFilter(\u0026#34;å£“ç¸®å™¨\u0026#34;, \u0026#34;compressor\u0026#34;), new AudioFilter(\u0026#34;é™åˆ¶å™¨\u0026#34;, \u0026#34;limiter\u0026#34;) ); } } // è¦–é »æ’­æ”¾å™¨å¯¦ä½œï¼ˆå¯¦ä½œè¦–é »ç›¸é—œä»‹é¢ï¼‰ @Component public class VideoPlayer implements VideoPlayable, SubtitleSupport, VideoFilterSupport { private int brightness = 50; private int contrast = 50; private boolean subtitlesVisible = false; private String currentSubtitleFile; @Override public void play(String file) { System.out.println(\u0026#34;æ’­æ”¾è¦–é »æª”æ¡ˆ: \u0026#34; + file); } @Override public void pause() { System.out.println(\u0026#34;æš«åœè¦–é »\u0026#34;); } @Override public void stop() { System.out.println(\u0026#34;åœæ­¢è¦–é »\u0026#34;); } @Override public void seek(long position) { System.out.println(\u0026#34;è·³è½‰åˆ°è¦–é »ä½ç½®: \u0026#34; + position + \u0026#34; ç§’\u0026#34;); } @Override public void adjustBrightness(int brightness) { this.brightness = Math.max(0, Math.min(100, brightness)); System.out.println(\u0026#34;äº®åº¦èª¿æ•´ç‚º: \u0026#34; + this.brightness); } @Override public void adjustContrast(int contrast) { this.contrast = Math.max(0, Math.min(100, contrast)); System.out.println(\u0026#34;å°æ¯”åº¦èª¿æ•´ç‚º: \u0026#34; + this.contrast); } @Override public int getBrightness() { return brightness; } @Override public int getContrast() { return contrast; } // å­—å¹•æ”¯æ´ @Override public void loadSubtitles(String subtitleFile) { this.currentSubtitleFile = subtitleFile; System.out.println(\u0026#34;è¼‰å…¥å­—å¹•æª”æ¡ˆ: \u0026#34; + subtitleFile); } @Override public void showSubtitles(boolean show) { this.subtitlesVisible = show; System.out.println(\u0026#34;å­—å¹•é¡¯ç¤º: \u0026#34; + (show ? \u0026#34;é–‹å•Ÿ\u0026#34; : \u0026#34;é—œé–‰\u0026#34;)); } @Override public void adjustSubtitleSize(int size) { System.out.println(\u0026#34;å­—å¹•å¤§å°èª¿æ•´ç‚º: \u0026#34; + size); } // è¦–é »æ¿¾é¡æ”¯æ´ @Override public void applyVideoFilter(VideoFilter filter) { System.out.println(\u0026#34;æ‡‰ç”¨è¦–é »æ¿¾é¡: \u0026#34; + filter.getName()); } @Override public void removeVideoFilter() { System.out.println(\u0026#34;ç§»é™¤è¦–é »æ¿¾é¡\u0026#34;); } @Override public List\u0026lt;VideoFilter\u0026gt; getAvailableVideoFilters() { return Arrays.asList( new VideoFilter(\u0026#34;æ¨¡ç³Š\u0026#34;, \u0026#34;blur\u0026#34;), new VideoFilter(\u0026#34;éŠ³åŒ–\u0026#34;, \u0026#34;sharpen\u0026#34;), new VideoFilter(\u0026#34;è‰²å½©å¢å¼·\u0026#34;, \u0026#34;color_enhance\u0026#34;) ); } } // åª’é«”ç®¡ç†æœå‹™ï¼ˆä½¿ç”¨ä»‹é¢éš”é›¢çš„å¥½è™•ï¼‰ @Service public class MediaManagementService { // åªè™•ç†æ’­æ”¾åŠŸèƒ½ public void playMedia(Playable player, String file) { player.play(file); } // åªè™•ç†éŸ³é »æ’­æ”¾ public void playAudioWithVolume(AudioPlayable audioPlayer, String file, int volume) { audioPlayer.adjustVolume(volume); audioPlayer.play(file); } // åªè™•ç†éŒ„éŸ³åŠŸèƒ½ public void recordAudio(AudioRecordable recorder, String outputFile) { if (!recorder.isRecording()) { recorder.startAudioRecording(outputFile); } } // åªè™•ç†å­—å¹•åŠŸèƒ½ public void setupSubtitles(SubtitleSupport player, String subtitleFile) { player.loadSubtitles(subtitleFile); player.showSubtitles(true); } } 5. Dependency Inversion Principle (DIP) - ä¾è³´åè½‰åŸå‰‡ å®šç¾© é«˜å±¤æ¨¡çµ„ä¸æ‡‰è©²ä¾è³´ä½å±¤æ¨¡çµ„ï¼Œå…©è€…éƒ½æ‡‰è©²ä¾è³´æ–¼æŠ½è±¡ã€‚æŠ½è±¡ä¸æ‡‰è©²ä¾è³´æ–¼ç´°ç¯€ï¼Œç´°ç¯€æ‡‰è©²ä¾è³´æ–¼æŠ½è±¡ã€‚\næ ¸å¿ƒæ¦‚å¿µ ä¾è³´æ³¨å…¥ï¼šé€éå¤–éƒ¨æ³¨å…¥ä¾è³´è€Œéå…§éƒ¨å‰µå»º æ§åˆ¶åè½‰ï¼šå°‡ä¾è³´é—œä¿‚çš„æ§åˆ¶æ¬Šäº¤çµ¦å¤–éƒ¨å®¹å™¨ æŠ½è±¡ä¾è³´ï¼šä¾è³´æ–¼ä»‹é¢è€Œéå…·é«”å¯¦ä½œ é•å DIP çš„ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 // âŒ é•å DIPï¼šé«˜å±¤æ¨¡çµ„ç›´æ¥ä¾è³´ä½å±¤æ¨¡çµ„çš„å…·é«”å¯¦ä½œ public class MySQLDatabase { public void save(String data) { System.out.println(\u0026#34;å„²å­˜è³‡æ–™åˆ° MySQL: \u0026#34; + data); } public String load(String id) { return \u0026#34;å¾ MySQL è¼‰å…¥è³‡æ–™: \u0026#34; + id; } } public class EmailService { public void sendEmail(String to, String subject, String body) { System.out.println(\u0026#34;ç™¼é€éƒµä»¶åˆ°: \u0026#34; + to); System.out.println(\u0026#34;ä¸»é¡Œ: \u0026#34; + subject); System.out.println(\u0026#34;å…§å®¹: \u0026#34; + body); } } // âŒ UserService ç›´æ¥ä¾è³´å…·é«”å¯¦ä½œï¼Œé›£ä»¥æ¸¬è©¦å’Œæ“´å±• public class UserService { private MySQLDatabase database; // ç›´æ¥ä¾è³´å…·é«”å¯¦ä½œ private EmailService emailService; // ç›´æ¥ä¾è³´å…·é«”å¯¦ä½œ public UserService() { this.database = new MySQLDatabase(); // åœ¨æ§‹é€ å‡½æ•¸ä¸­å‰µå»ºä¾è³´ this.emailService = new EmailService(); // ç¡¬ç·¨ç¢¼ä¾è³´ } public void createUser(String username, String email) { // é©—è­‰é‚è¼¯ if (username == null || username.trim().isEmpty()) { throw new IllegalArgumentException(\u0026#34;ç”¨æˆ¶åä¸èƒ½ç‚ºç©º\u0026#34;); } // å„²å­˜ç”¨æˆ¶ï¼ˆä¾è³´å…·é«”çš„ MySQL å¯¦ä½œï¼‰ String userData = \u0026#34;User: \u0026#34; + username + \u0026#34;, Email: \u0026#34; + email; database.save(userData); // ç™¼é€æ­¡è¿éƒµä»¶ï¼ˆä¾è³´å…·é«”çš„éƒµä»¶æœå‹™å¯¦ä½œï¼‰ emailService.sendEmail(email, \u0026#34;æ­¡è¿\u0026#34;, \u0026#34;æ­¡è¿åŠ å…¥æˆ‘å€‘çš„å¹³å°ï¼\u0026#34;); } public String getUser(String userId) { return database.load(userId); } } éµå¾ª DIP çš„é‡æ§‹ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 // âœ… éµå¾ª DIPï¼šå®šç¾©æŠ½è±¡ä»‹é¢ // è³‡æ–™åº«æŠ½è±¡ä»‹é¢ public interface UserRepository { void save(User user); Optional\u0026lt;User\u0026gt; findById(String id); Optional\u0026lt;User\u0026gt; findByEmail(String email); List\u0026lt;User\u0026gt; findAll(); void delete(String id); } // é€šçŸ¥æœå‹™æŠ½è±¡ä»‹é¢ public interface NotificationService { void sendWelcomeNotification(User user); void sendPasswordResetNotification(User user, String resetToken); void sendAccountActivationNotification(User user, String activationToken); } // ç”¨æˆ¶é©—è­‰æŠ½è±¡ä»‹é¢ public interface UserValidator { ValidationResult validate(User user); boolean isEmailUnique(String email); boolean isUsernameValid(String username); } // å…·é«”å¯¦ä½œ - MySQL è³‡æ–™åº« @Repository public class MySQLUserRepository implements UserRepository { @Override public void save(User user) { System.out.println(\u0026#34;å„²å­˜ç”¨æˆ¶åˆ° MySQL: \u0026#34; + user.getUsername()); // å¯¦éš›çš„è³‡æ–™åº«æ“ä½œé‚è¼¯ } @Override public Optional\u0026lt;User\u0026gt; findById(String id) { System.out.println(\u0026#34;å¾ MySQL æŸ¥æ‰¾ç”¨æˆ¶: \u0026#34; + id); // å¯¦éš›çš„æŸ¥è©¢é‚è¼¯ return Optional.of(new User(id, \u0026#34;user@example.com\u0026#34;)); } @Override public Optional\u0026lt;User\u0026gt; findByEmail(String email) { System.out.println(\u0026#34;å¾ MySQL æ ¹æ“šéƒµç®±æŸ¥æ‰¾ç”¨æˆ¶: \u0026#34; + email); return Optional.empty(); } @Override public List\u0026lt;User\u0026gt; findAll() { System.out.println(\u0026#34;å¾ MySQL æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ¶\u0026#34;); return Arrays.asList(new User(\u0026#34;1\u0026#34;, \u0026#34;user1@example.com\u0026#34;)); } @Override public void delete(String id) { System.out.println(\u0026#34;å¾ MySQL åˆªé™¤ç”¨æˆ¶: \u0026#34; + id); } } // å…·é«”å¯¦ä½œ - MongoDB è³‡æ–™åº«ï¼ˆå¯æ›¿æ›å¯¦ä½œï¼‰ @Repository @Profile(\u0026#34;mongodb\u0026#34;) public class MongoUserRepository implements UserRepository { @Override public void save(User user) { System.out.println(\u0026#34;å„²å­˜ç”¨æˆ¶åˆ° MongoDB: \u0026#34; + user.getUsername()); } @Override public Optional\u0026lt;User\u0026gt; findById(String id) { System.out.println(\u0026#34;å¾ MongoDB æŸ¥æ‰¾ç”¨æˆ¶: \u0026#34; + id); return Optional.of(new User(id, \u0026#34;user@example.com\u0026#34;)); } @Override public Optional\u0026lt;User\u0026gt; findByEmail(String email) { System.out.println(\u0026#34;å¾ MongoDB æ ¹æ“šéƒµç®±æŸ¥æ‰¾ç”¨æˆ¶: \u0026#34; + email); return Optional.empty(); } @Override public List\u0026lt;User\u0026gt; findAll() { System.out.println(\u0026#34;å¾ MongoDB æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ¶\u0026#34;); return Arrays.asList(new User(\u0026#34;1\u0026#34;, \u0026#34;user1@example.com\u0026#34;)); } @Override public void delete(String id) { System.out.println(\u0026#34;å¾ MongoDB åˆªé™¤ç”¨æˆ¶: \u0026#34; + id); } } // å…·é«”å¯¦ä½œ - éƒµä»¶é€šçŸ¥æœå‹™ @Service public class EmailNotificationService implements NotificationService { @Override public void sendWelcomeNotification(User user) { System.out.println(\u0026#34;ç™¼é€æ­¡è¿éƒµä»¶åˆ°: \u0026#34; + user.getEmail()); // å¯¦éš›çš„éƒµä»¶ç™¼é€é‚è¼¯ } @Override public void sendPasswordResetNotification(User user, String resetToken) { System.out.println(\u0026#34;ç™¼é€å¯†ç¢¼é‡è¨­éƒµä»¶åˆ°: \u0026#34; + user.getEmail()); System.out.println(\u0026#34;é‡è¨­ä»¤ç‰Œ: \u0026#34; + resetToken); } @Override public void sendAccountActivationNotification(User user, String activationToken) { System.out.println(\u0026#34;ç™¼é€å¸³æˆ¶å•Ÿç”¨éƒµä»¶åˆ°: \u0026#34; + user.getEmail()); System.out.println(\u0026#34;å•Ÿç”¨ä»¤ç‰Œ: \u0026#34; + activationToken); } } // å…·é«”å¯¦ä½œ - SMS é€šçŸ¥æœå‹™ï¼ˆå¯æ›¿æ›å¯¦ä½œï¼‰ @Service @Profile(\u0026#34;sms\u0026#34;) public class SMSNotificationService implements NotificationService { @Override public void sendWelcomeNotification(User user) { System.out.println(\u0026#34;ç™¼é€æ­¡è¿ SMS åˆ°: \u0026#34; + user.getPhoneNumber()); } @Override public void sendPasswordResetNotification(User user, String resetToken) { System.out.println(\u0026#34;ç™¼é€å¯†ç¢¼é‡è¨­ SMS åˆ°: \u0026#34; + user.getPhoneNumber()); System.out.println(\u0026#34;é‡è¨­ä»£ç¢¼: \u0026#34; + resetToken); } @Override public void sendAccountActivationNotification(User user, String activationToken) { System.out.println(\u0026#34;ç™¼é€å¸³æˆ¶å•Ÿç”¨ SMS åˆ°: \u0026#34; + user.getPhoneNumber()); System.out.println(\u0026#34;å•Ÿç”¨ä»£ç¢¼: \u0026#34; + activationToken); } } // å…·é«”å¯¦ä½œ - ç”¨æˆ¶é©—è­‰å™¨ @Component public class DefaultUserValidator implements UserValidator { private final UserRepository userRepository; public DefaultUserValidator(UserRepository userRepository) { this.userRepository = userRepository; } @Override public ValidationResult validate(User user) { ValidationResult result = new ValidationResult(); if (!isUsernameValid(user.getUsername())) { result.addError(\u0026#34;ç”¨æˆ¶åæ ¼å¼ç„¡æ•ˆ\u0026#34;); } if (!isEmailValid(user.getEmail())) { result.addError(\u0026#34;éƒµç®±æ ¼å¼ç„¡æ•ˆ\u0026#34;); } if (!isEmailUnique(user.getEmail())) { result.addError(\u0026#34;éƒµç®±å·²è¢«ä½¿ç”¨\u0026#34;); } return result; } @Override public boolean isEmailUnique(String email) { return userRepository.findByEmail(email).isEmpty(); } @Override public boolean isUsernameValid(String username) { return username != null \u0026amp;\u0026amp; username.trim().length() \u0026gt;= 3 \u0026amp;\u0026amp; username.trim().length() \u0026lt;= 50 \u0026amp;\u0026amp; username.matches(\u0026#34;^[a-zA-Z0-9_]+$\u0026#34;); } private boolean isEmailValid(String email) { return email != null \u0026amp;\u0026amp; email.contains(\u0026#34;@\u0026#34;) \u0026amp;\u0026amp; email.contains(\u0026#34;.\u0026#34;) \u0026amp;\u0026amp; email.length() \u0026gt; 5; } } // é«˜å±¤æ¨¡çµ„ - ç”¨æˆ¶æœå‹™ï¼ˆä¾è³´æ–¼æŠ½è±¡ï¼‰ @Service public class UserService { private final UserRepository userRepository; private final NotificationService notificationService; private final UserValidator userValidator; // ä¾è³´æ³¨å…¥ï¼šé€éæ§‹é€ å‡½æ•¸æ³¨å…¥ä¾è³´ public UserService(UserRepository userRepository, NotificationService notificationService, UserValidator userValidator) { this.userRepository = userRepository; this.notificationService = notificationService; this.userValidator = userValidator; } public Result\u0026lt;User\u0026gt; createUser(String username, String email) { User user = new User(username, email); // é©—è­‰ç”¨æˆ¶è³‡æ–™ ValidationResult validation = userValidator.validate(user); if (!validation.isValid()) { return Result.failure(\u0026#34;é©—è­‰å¤±æ•—: \u0026#34; + validation.getErrors()); } try { // å„²å­˜ç”¨æˆ¶ userRepository.save(user); // ç™¼é€é€šçŸ¥ notificationService.sendWelcomeNotification(user); return Result.success(user); } catch (Exception e) { return Result.failure(\u0026#34;å‰µå»ºç”¨æˆ¶å¤±æ•—: \u0026#34; + e.getMessage()); } } public Result\u0026lt;User\u0026gt; getUserById(String id) { Optional\u0026lt;User\u0026gt; user = userRepository.findById(id); if (user.isPresent()) { return Result.success(user.get()); } else { return Result.failure(\u0026#34;ç”¨æˆ¶ä¸å­˜åœ¨\u0026#34;); } } public Result\u0026lt;Void\u0026gt; resetPassword(String email) { Optional\u0026lt;User\u0026gt; userOpt = userRepository.findByEmail(email); if (userOpt.isEmpty()) { return Result.failure(\u0026#34;ç”¨æˆ¶ä¸å­˜åœ¨\u0026#34;); } User user = userOpt.get(); String resetToken = generateResetToken(); // å„²å­˜é‡è¨­ä»¤ç‰Œï¼ˆå¯¦éš›æ‡‰è©²å„²å­˜åˆ°è³‡æ–™åº«ï¼‰ // userRepository.saveResetToken(user.getId(), resetToken); // ç™¼é€é‡è¨­é€šçŸ¥ notificationService.sendPasswordResetNotification(user, resetToken); return Result.success(null); } private String generateResetToken() { return \u0026#34;RESET-\u0026#34; + UUID.randomUUID().toString(); } } // é…ç½®é¡åˆ¥ï¼ˆæ§åˆ¶ä¾è³´æ³¨å…¥ï¼‰ @Configuration public class UserServiceConfiguration { @Bean @ConditionalOnProperty(name = \u0026#34;database.type\u0026#34;, havingValue = \u0026#34;mysql\u0026#34;, matchIfMissing = true) public UserRepository mysqlUserRepository() { return new MySQLUserRepository(); } @Bean @ConditionalOnProperty(name = \u0026#34;database.type\u0026#34;, havingValue = \u0026#34;mongodb\u0026#34;) public UserRepository mongoUserRepository() { return new MongoUserRepository(); } @Bean @ConditionalOnProperty(name = \u0026#34;notification.type\u0026#34;, havingValue = \u0026#34;email\u0026#34;, matchIfMissing = true) public NotificationService emailNotificationService() { return new EmailNotificationService(); } @Bean @ConditionalOnProperty(name = \u0026#34;notification.type\u0026#34;, havingValue = \u0026#34;sms\u0026#34;) public NotificationService smsNotificationService() { return new SMSNotificationService(); } } DIP çš„é€²éšæ‡‰ç”¨ï¼šå·¥å» æ¨¡å¼èˆ‡ç­–ç•¥æ¨¡å¼çµåˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 // å ±è¡¨ç”Ÿæˆç­–ç•¥ä»‹é¢ public interface ReportGenerator { String generateReport(List\u0026lt;User\u0026gt; users); String getReportFormat(); } // CSV å ±è¡¨ç”Ÿæˆå™¨ @Component(\u0026#34;csvReportGenerator\u0026#34;) public class CSVReportGenerator implements ReportGenerator { @Override public String generateReport(List\u0026lt;User\u0026gt; users) { StringBuilder csv = new StringBuilder(); csv.append(\u0026#34;ç”¨æˆ¶å,éƒµç®±,å‰µå»ºæ™‚é–“\\n\u0026#34;); users.forEach(user -\u0026gt; csv.append(String.format(\u0026#34;%s,%s,%s\\n\u0026#34;, user.getUsername(), user.getEmail(), user.getCreatedAt())) ); return csv.toString(); } @Override public String getReportFormat() { return \u0026#34;CSV\u0026#34;; } } // JSON å ±è¡¨ç”Ÿæˆå™¨ @Component(\u0026#34;jsonReportGenerator\u0026#34;) public class JSONReportGenerator implements ReportGenerator { private final ObjectMapper objectMapper; public JSONReportGenerator(ObjectMapper objectMapper) { this.objectMapper = objectMapper; } @Override public String generateReport(List\u0026lt;User\u0026gt; users) { try { Map\u0026lt;String, Object\u0026gt; report = new HashMap\u0026lt;\u0026gt;(); report.put(\u0026#34;totalUsers\u0026#34;, users.size()); report.put(\u0026#34;generatedAt\u0026#34;, LocalDateTime.now()); report.put(\u0026#34;users\u0026#34;, users); return objectMapper.writeValueAsString(report); } catch (Exception e) { throw new RuntimeException(\u0026#34;JSON å ±è¡¨ç”Ÿæˆå¤±æ•—\u0026#34;, e); } } @Override public String getReportFormat() { return \u0026#34;JSON\u0026#34;; } } // å ±è¡¨å·¥å»  @Service public class ReportGeneratorFactory { private final Map\u0026lt;String, ReportGenerator\u0026gt; generators; public ReportGeneratorFactory(Map\u0026lt;String, ReportGenerator\u0026gt; generators) { this.generators = generators; } public ReportGenerator getGenerator(String format) { ReportGenerator generator = generators.get(format.toLowerCase() + \u0026#34;ReportGenerator\u0026#34;); if (generator == null) { throw new IllegalArgumentException(\u0026#34;ä¸æ”¯æ´çš„å ±è¡¨æ ¼å¼: \u0026#34; + format); } return generator; } public List\u0026lt;String\u0026gt; getSupportedFormats() { return generators.values().stream() .map(ReportGenerator::getReportFormat) .collect(Collectors.toList()); } } // å ±è¡¨æœå‹™ï¼ˆé«˜å±¤æ¨¡çµ„ï¼Œä¾è³´æ–¼æŠ½è±¡ï¼‰ @Service public class UserReportService { private final UserRepository userRepository; private final ReportGeneratorFactory reportGeneratorFactory; public UserReportService(UserRepository userRepository, ReportGeneratorFactory reportGeneratorFactory) { this.userRepository = userRepository; this.reportGeneratorFactory = reportGeneratorFactory; } public String generateUserReport(String format) { List\u0026lt;User\u0026gt; users = userRepository.findAll(); ReportGenerator generator = reportGeneratorFactory.getGenerator(format); return generator.generateReport(users); } public List\u0026lt;String\u0026gt; getSupportedReportFormats() { return reportGeneratorFactory.getSupportedFormats(); } } ç¸½çµ SOLID åŸå‰‡æ˜¯è»Ÿé«”è¨­è¨ˆçš„åŸºçŸ³ï¼Œå®ƒå€‘ç›¸äº’è£œå……ï¼Œå…±åŒä¿ƒé€²ç¨‹å¼ç¢¼çš„å“è³ªï¼š\næ ¸å¿ƒåƒ¹å€¼ å¯ç¶­è­·æ€§ï¼šæ¯å€‹åŸå‰‡éƒ½æœ‰åŠ©æ–¼é™ä½ç¨‹å¼ç¢¼ä¿®æ”¹çš„è¤‡é›œåº¦ å¯æ“´å±•æ€§ï¼šæ”¯æ´æ–°åŠŸèƒ½çš„å¢åŠ è€Œä¸ç ´å£ç¾æœ‰åŠŸèƒ½ å¯æ¸¬è©¦æ€§ï¼šä¾è³´æ³¨å…¥å’Œä»‹é¢éš”é›¢ä½¿å–®å…ƒæ¸¬è©¦æ›´å®¹æ˜“ å¯é‡ç”¨æ€§ï¼šè·è²¬æ˜ç¢ºçš„é¡åˆ¥å¯ä»¥åœ¨ä¸åŒå ´æ™¯ä¸­é‡è¤‡ä½¿ç”¨ å¯¦è¸å»ºè­° å¾å°è™•é–‹å§‹ï¼šåœ¨æ–°å°ˆæ¡ˆä¸­é€æ­¥æ‡‰ç”¨ SOLID åŸå‰‡ é‡æ§‹ç¾æœ‰ç¨‹å¼ç¢¼ï¼šè­˜åˆ¥é•å SOLID åŸå‰‡çš„ç¨‹å¼ç¢¼ä¸¦é€æ­¥æ”¹é€² ä½¿ç”¨ç¾ä»£æ¡†æ¶ï¼šSpringã€ä¾è³´æ³¨å…¥å®¹å™¨ç­‰å·¥å…·æœ‰åŠ©æ–¼å¯¦è¸ SOLID åŸå‰‡ ç¨‹å¼ç¢¼å¯©æŸ¥ï¼šåœ¨åœ˜éšŠä¸­æ¨å»£ SOLID åŸå‰‡çš„ç†è§£å’Œæ‡‰ç”¨ æŒçºŒå­¸ç¿’ï¼šSOLID åŸå‰‡æ˜¯è»Ÿé«”æ¶æ§‹çš„åŸºç¤ï¼Œéœ€è¦åœ¨å¯¦è¸ä¸­ä¸æ–·æ·±åŒ–ç†è§£ å¸¸è¦‹é™·é˜± éåº¦è¨­è¨ˆï¼šä¸è¦ç‚ºäº†éµå¾ªåŸå‰‡è€Œå¢åŠ ä¸å¿…è¦çš„è¤‡é›œæ€§ æ•™æ¢ä¸»ç¾©ï¼šåŸå‰‡æ˜¯æŒ‡å°è€Œéçµ•å°è¦å‰‡ï¼Œéœ€è¦æ ¹æ“šå…·é«”æƒ…æ³éˆæ´»æ‡‰ç”¨ å¿½ç•¥æ€§èƒ½ï¼šåœ¨è¿½æ±‚è¨­è¨ˆåŸå‰‡çš„åŒæ™‚è¦è€ƒæ…®æ€§èƒ½å½±éŸ¿ ç¼ºä¹æ¼¸é€²æ€§ï¼šä¸è¦è©¦åœ–ä¸€æ¬¡æ€§é‡æ§‹æ•´å€‹ç³»çµ±ï¼Œè¦æ¡ç”¨æ¼¸é€²å¼æ”¹é€² SOLID åŸå‰‡ä¸åƒ…é©ç”¨æ–¼ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆï¼Œåœ¨å¾®æœå‹™æ¶æ§‹ã€å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆç­‰ç¾ä»£è»Ÿé«”æ¶æ§‹ä¸­åŒæ¨£å…·æœ‰æŒ‡å°æ„ç¾©ã€‚æŒæ¡é€™äº›åŸå‰‡å°‡é¡¯è‘—æå‡ä½ çš„è»Ÿé«”è¨­è¨ˆèƒ½åŠ›ã€‚\nåƒè€ƒè³‡æ–™ Clean Code by Robert C. Martin Agile Software Development, Principles, Patterns, and Practices SOLID Principles of Object Oriented Design Spring Framework Documentation ","permalink":"https://xinqilin.github.io/post/architecture/solid/","tags":["SOLID","Design Principles","OOP","Software Architecture","Clean Code","Best Practices"],"title":"SOLID è¨­è¨ˆåŸå‰‡å®Œæ•´æŒ‡å—ï¼šç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆçš„äº”å¤§æ ¸å¿ƒåŸå‰‡"},{"content":"ç­†è¨˜ Vue æœªæ•´ç† version å¥—ä»¶ vetur vue2 snippets webpack -\u0026gt; npm install webpack -g vue -\u0026gt; npm install -g @vue/cli-init chrome: vue plugin\nå¿«é€Ÿé–‹å§‹ vue init webpack \u0026lt;ä½ çš„appåå­—\u0026gt;\nnpm run dev\nmain.js -\u0026gt; è·¯ç”± index.js åœ¨ [router å…§]\n1 2 3 4 5 6 7 8 9 10 export default new Router({ routes:[ { path: \u0026#39;/\u0026#39;, name: \u0026#39;HelloWorld\u0026#39;, component: HelloWorld } ] }) HelloWorld.vue å…§å®¹ åœ¨ [componentså…§]\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; export default { data(){ return name: \u0026#39;Bill\u0026#39; } } \u0026lt;/script\u0026gt; \u0026lt;style\u0026gt;\u0026lt;/style\u0026gt; è·³é \n1 2 3 4 5 6 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;router-link to=\u0026#34;/HelloWorld\u0026#34;\u0026gt;go to hello world\u0026lt;/router-link\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å–®å‘ç¶å®š 1 2 3 4 v-text v-html v-bind:href=\u0026#34;link\u0026#34; vue instance å…§çš„ method çš„ data:{link} (v-bind:href å¯ç¸®å¯«:href) é›™å‘ç¶å®š v-model\nç¶å®šäº‹ä»¶ 1 2 3 4 5 6 7 8 9 10 v-on:click=\u0026#34;num++\u0026#34; = @click v-on é˜²æ­¢äº‹ä»¶å†’æ³¡{ `.stop`: é˜»æ­¢äº‹ä»¶å†’æ³¡å€’çˆ¶å±¤ `.prevent`: é˜»æ­¢é»˜èª(é è¨­) äº‹ä»¶ç™¼ç”Ÿ `.capture`: é˜»æ­¢äº‹ä»¶æ•ç²æ¨¡å¼ `.self`: åªæœ‰è‡ªèº«è§¸ç™¼äº‹ä»¶æ‰åŸ·è¡Œ `.once`: åªåŸ·è¡Œä¸€æ¬¡ } æŒ‰éµä¿®é£¾ç¬¦ v-on:keyup.13 1 2 3 4 5 6 7 8 9 10 11 12 13 13 æ˜¯éµç¢¼ v-on æŒ‰éµä¿®é£¾ç¬¦ æ‡¶äººåŒ…{ `.enter` `.tab` `.delete` `.esc` `.space` `.up` `.down` `.left` `.right` } v-for 1 2 3 4 5 6 7 8 9 10 11 12 13 14 v-for = \u0026#34;user in users\u0026#34; æˆ– v-for=\u0026#34;(user, index) in users\u0026#34; v-for = \u0026#34;(value, key, index) in users\u0026#34; {{value}} {{key}} {{index}} v-for å¢åŠ  :key = \u0026#34;\u0026#34; å¯å¢åŠ æ•ˆç‡ æœ€ä¸»è¦æ˜¯æ˜¯åˆ¥æƒŸä¸€å€¼ :key æ˜¯ v-bindç¸®å¯« v-if è£¡é¢éƒ½å¡«boolean æ•´å€‹æ¨™ç±¤ä¸è¦‹ v-show è£¡é¢éƒ½å¡«boolean æ˜¯ç”¨ display:none å¸¸è·Ÿ v-if ä¸€èµ·ç”¨ v-else-if v-else 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // computed è¨ˆç®—å±¬æ€§ // watch ç›£æ§å±¬æ€§ // filter éæ¿¾å±¬æ€§ -\u0026gt; ä½¿ç”¨ {{user.gender | genderFilter}} new Vue({ el: \u0026#34;#app\u0026#34;, data:{ a:100, b:200 }, computed: { total: function(){ return this.a+this.b } }, watch:{ a: function(newValue, oldValue){ alert(\u0026#34;new: \u0026#34;+newValue+\u0026#34; , old: \u0026#34;+oldValue) if(a\u0026gt;3){ this.msg = \u0026#34;å¤ªå¤š\u0026#34; } } }, filters:{ genderFilter(val){ if(val == 1) return \u0026#34;male\u0026#34; else return \u0026#34;female\u0026#34; } } }) çµ„ä»¶:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 \u0026lt;script\u0026gt; Global çµ„ä»¶: Vue.component(\u0026#34;counter\u0026#34;,{ template: `\u0026lt;button v-on:click = \u0026#34;count++\u0026#34;\u0026gt; {{count}}\u0026lt;/button\u0026gt;` data(){ return { count: 0 } } }); å€åŸŸçµ„ä»¶: const buttonCounter = { template: `\u0026lt;button v-on:click = \u0026#34;count++\u0026#34;\u0026gt; {{count}}\u0026lt;/button\u0026gt;` data(){ return { count: 0 } } } å¾Œ æ”¾å…¥ vue instance components:{}ä¸­ components:{ \u0026#39;button-counter åå­—\u0026#39;: buttonCounter } ``` \u0026lt;button-counter\u0026gt;\u0026lt;/button-counter\u0026gt; ä½¿ç”¨ ``` \u0026lt;/script\u0026gt; lifeCycle 1 2 3 4 5 6 7 8 9 10 11 let app = new Vue(){ el: app, data: { }, beforeCreate: function(){ } // æ”¾ä¸€äº›ç”Ÿå‘½é€±æœŸçš„æ±è¥¿ }; ","permalink":"https://xinqilin.github.io/post/frontend/vue-intro/","tags":[],"title":"Vue Intro"},{"content":"JWT Dependency Inject 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // å…©ç¨® å¼•å…¥ jjwt ï¼Œ version æ”¾ properties å…§æ–¹ä¾¿æ§ç®¡ \u0026lt;properties\u0026gt; \u0026lt;project.build.sourceEncoding\u0026gt;UTF-8\u0026lt;/project.build.sourceEncoding\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;jjwt.version\u0026gt;0.9.0\u0026lt;/jjwt.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${jjwt.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.xml.bind\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jaxb-api\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; // ç¬¬äºŒç¨® \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.11.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt-impl\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.11.2\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt-jackson\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.11.2\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; æµç¨‹: ä½¿ç”¨è€…å¸³å¯†ç™»å…¥ -\u0026gt; é©—è­‰å¾Œ -\u0026gt; å›æ‡‰ token -\u0026gt; å–å¾—token æ”¾å…¥ header ä¸­ æ‰“ API\nmodel Request å¸³å¯†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 public class AuthenticationRequest implements Serializable { private String userName; private String password; public AuthenticationRequest() { } public AuthenticationRequest(String userName, String password) { this.userName = userName; this.password = password; } public String getUserName() { return userName; } public void setUserName(String userName) { this.userName = userName; } public String getPassword() { return password; } public void setPassword(String password) { this.password = password; } } Response å›æ‡‰ token\n1 2 3 4 5 6 7 8 9 10 11 12 13 public class AuthenticationResponse implements Serializable { private final String jwt; public AuthenticationResponse(String jwt) { this.jwt = jwt; } public String getJwt() { return jwt; } } Config 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 @EnableWebSecurity public class MySecurityConfig extends WebSecurityConfigurerAdapter { // å»ºæ§‹å­æ–¹å¼æ³¨å…¥ private final MyUserDetailsService myUserDetailsService; private final JwtRequestFilter jwtRequestFilter; public MySecurityConfig(MyUserDetailsService myUserDetailsService, JwtRequestFilter jwtRequestFilter) { this.myUserDetailsService = myUserDetailsService; this.jwtRequestFilter = jwtRequestFilter; } // AuthenticationManager init åˆ¥çš„åœ°æ–¹æœƒç”¨åˆ° @Override @Bean public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } // /authentication è«‹æ±‚å¯é @Override protected void configure(HttpSecurity http) throws Exception { http.csrf().disable().authorizeRequests() .antMatchers(\u0026#34;/authentication\u0026#34;) .permitAll() .anyRequest() .authenticated() .and() .sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS); http.addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class); } @Override public void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(myUserDetailsService); } @Bean public PasswordEncoder passwordEncoder() { return NoOpPasswordEncoder.getInstance(); } æœ€é‡è¦çš„ JWTUtil 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 @Service public class JwtUtil { private final String SECRET_KEY = \u0026#34;@*$\u0026amp;Secret\u0026amp;\u0026amp;$#\u0026#34;; public String extractUsername(String token) { return extractClaim(token, Claims::getSubject); } public Date extractExpiration(String token) { return extractClaim(token, Claims::getExpiration); } public \u0026lt;T\u0026gt; T extractClaim(String token, Function\u0026lt;Claims, T\u0026gt; claimsResolver) { final Claims claims = extractAllClaims(token); return claimsResolver.apply(claims); } private Claims extractAllClaims(String token) { return Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token).getBody(); } private Boolean isTokenExpired(String token) { return extractExpiration(token).before(new Date()); } public String generateToken(UserDetails userDetails) { Map\u0026lt;String, Object\u0026gt; claims = new HashMap\u0026lt;\u0026gt;(); return createToken(claims, userDetails.getUsername()); } private String createToken(Map\u0026lt;String, Object\u0026gt; claims, String subject) { return Jwts.builder().setClaims(claims).setSubject(subject).setIssuedAt(new Date(System.currentTimeMillis())) .setExpiration(new Date(System.currentTimeMillis() + 1000 * 60 * 60 * 10)) .signWith(SignatureAlgorithm.HS256, SECRET_KEY).compact(); } public Boolean validateToken(String token, UserDetails userDetails) { final String userName = extractUsername(token); return (userName.equals(userDetails.getUsername()) \u0026amp;\u0026amp; !isTokenExpired(token)); } } JWT Filter 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 @Component public class JwtRequestFilter extends OncePerRequestFilter { private final MyUserDetailsService myUserDetailsService; private final JwtUtil jwtUtil; public JwtRequestFilter(MyUserDetailsService myUserDetailsService, JwtUtil jwtUtil) { this.myUserDetailsService = myUserDetailsService; this.jwtUtil = jwtUtil; } @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException { final String authorzationHeader = request.getHeader(\u0026#34;Authorization\u0026#34;); String username = null; String jwt = null; if (authorzationHeader != null \u0026amp;\u0026amp; authorzationHeader.startsWith(\u0026#34;Bearer \u0026#34;)) { jwt = authorzationHeader.substring(7); username = jwtUtil.extractUsername(jwt); } if (username != null \u0026amp;\u0026amp; SecurityContextHolder.getContext().getAuthentication() == null) { UserDetails userDetails = this.myUserDetailsService.loadUserByUsername(username); if (jwtUtil.validateToken(jwt, userDetails)) { UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken( userDetails, null, userDetails.getAuthorities() ); usernamePasswordAuthenticationToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request)); SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken); } } filterChain.doFilter(request, response); } } ç³»çµ±å¯ä»¥å–å¾— User å¸³å¯†çš„ service 1 2 3 4 5 6 7 8 9 10 @Service public class MyUserDetailsService implements UserDetailsService { @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { //implement it in system user module return new User(\u0026#34;Bill\u0026#34;, \u0026#34;billisgood\u0026#34;, new ArrayList\u0026lt;\u0026gt;()); } } JWT Controller 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 @RestController public class JwtController { private final AuthenticationManager authenticationManager; private final MyUserDetailsService myUserDetailsService; private final JwtUtil jwtUtil; public JwtController(AuthenticationManager authenticationManager, MyUserDetailsService myUserDetailsService, JwtUtil jwtUtil) { this.authenticationManager = authenticationManager; this.myUserDetailsService = myUserDetailsService; this.jwtUtil = jwtUtil; } @RequestMapping(value = \u0026#34;/hello\u0026#34;, method = RequestMethod.GET) public ResponseEntity\u0026lt;?\u0026gt; sayHello() { return ResponseEntity.ok().body(\u0026#34;say hello success\u0026#34;); } @RequestMapping(value = \u0026#34;/authentication\u0026#34;, method = RequestMethod.POST) public ResponseEntity\u0026lt;?\u0026gt; createAuthenticationToken(@RequestBody AuthenticationRequest authenticationRequest) throws Exception { try { authenticationManager.authenticate( new UsernamePasswordAuthenticationToken(authenticationRequest.getUserName(), authenticationRequest.getPassword()) ); } catch (BadCredentialsException e) { throw new Exception(\u0026#34;Incorrect username or password\u0026#34;); } final UserDetails userDetails = myUserDetailsService.loadUserByUsername(authenticationRequest.getUserName()); final String jwt = jwtUtil.generateToken(userDetails); return ResponseEntity.ok(new AuthenticationResponse(jwt)); } } ","permalink":"https://xinqilin.github.io/post/backend/jwt/","tags":["JWT","Spring Security","Authentication","Java","Spring Boot","Security"],"title":"JWT èªè­‰æ©Ÿåˆ¶å®Œæ•´å¯¦ä½œï¼šSpring Security æ•´åˆèˆ‡æœ€ä½³å¯¦è¸"},{"content":"æ¦‚è¿° Swaggerï¼ˆç¾ç¨±ç‚º OpenAPIï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„ REST API æ–‡æª”åŒ–å·¥å…·ä¹‹ä¸€ã€‚å®ƒä¸åƒ…èƒ½è‡ªå‹•ç”Ÿæˆç¾è§€çš„ API æ–‡æª”ï¼Œé‚„æä¾›äº’å‹•å¼æ¸¬è©¦ä»‹é¢ï¼Œæ”¯æ´å¤šç¨®ç¨‹å¼èªè¨€çš„å®¢æˆ¶ç«¯ç¨‹å¼ç¢¼ç”Ÿæˆã€‚æœ¬æ–‡å°‡å…¨é¢ä»‹ç´¹å¦‚ä½•åœ¨ Spring Boot å°ˆæ¡ˆä¸­æ•´åˆå’Œä½¿ç”¨ Swaggerï¼Œå¾åŸºç¤é…ç½®åˆ°é€²éšåŠŸèƒ½çš„å®Œæ•´å¯¦æˆ°æŒ‡å—ã€‚\nç‰ˆæœ¬é¸æ“‡èˆ‡ä¾è³´é…ç½® OpenAPI 3.0 vs Swagger 2.0 ç‰¹æ€§ Swagger 2.0 OpenAPI 3.0 è¦ç¯„ç‰ˆæœ¬ è¼ƒèˆŠ æœ€æ–°æ¨™æº– Spring Boot æ”¯æ´ è‰¯å¥½ åŸç”Ÿæ”¯æ´ åŠŸèƒ½è±å¯Œåº¦ åŸºæœ¬åŠŸèƒ½ è±å¯Œç‰¹æ€§ ç¤¾ç¾¤æ´»èºåº¦ ç¶­è­·æ¨¡å¼ ç©æ¥µé–‹ç™¼ æ¨è–¦åº¦ åƒ…é™èˆŠå°ˆæ¡ˆ å¼·çƒˆæ¨è–¦ ç¾ä»£åŒ–ä¾è³´é…ç½®ï¼ˆOpenAPI 3.0ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;!-- æ¨è–¦ï¼šSpringDoc OpenAPI 3 --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springdoc\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springdoc-openapi-starter-webmvc-ui\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- å®‰å…¨æ•´åˆ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springdoc\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springdoc-openapi-security\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- WebFlux æ”¯æ´ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springdoc\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springdoc-openapi-starter-webflux-ui\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å‚³çµ± Swagger 2.0 é…ç½®ï¼ˆåƒ…ä¾›åƒè€ƒï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!-- å‚³çµ±ï¼šSpringfox Swagger 2 --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.springfox\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springfox-swagger2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.springfox\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springfox-swagger-ui\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.springfox\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springfox-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; OpenAPI 3.0 åŸºç¤é…ç½® 1. æ‡‰ç”¨ç¨‹å¼é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # application.yml springdoc: api-docs: path: /api-docs enabled: true swagger-ui: path: /swagger-ui.html enabled: true operations-sorter: method tags-sorter: alpha try-it-out-enabled: true filter: true display-request-duration: true packages-to-scan: com.example.controller paths-to-match: /api/** default-consumes-media-type: application/json default-produces-media-type: application/json # è‡ªè¨‚é…ç½® app: api: title: E-Commerce API description: é›»å•†å¹³å°æ ¸å¿ƒ API æœå‹™ version: 1.0.0 contact: name: API Support Team email: api-support@example.com url: https://example.com/support license: name: Apache 2.0 url: https://www.apache.org/licenses/LICENSE-2.0.html terms-of-service: https://example.com/terms 2. é€²éš OpenAPI é…ç½®é¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 @Configuration @EnableOpenApi public class OpenApiConfiguration { @Value(\u0026#34;${app.api.title}\u0026#34;) private String title; @Value(\u0026#34;${app.api.description}\u0026#34;) private String description; @Value(\u0026#34;${app.api.version}\u0026#34;) private String version; @Bean public OpenAPI customOpenAPI() { return new OpenAPI() .info(createApiInfo()) .servers(createServers()) .security(createSecurityRequirements()) .components(createComponents()); } private Info createApiInfo() { return new Info() .title(title) .description(description) .version(version) .contact(new Contact() .name(\u0026#34;API Support Team\u0026#34;) .email(\u0026#34;api-support@example.com\u0026#34;) .url(\u0026#34;https://example.com/support\u0026#34;)) .license(new License() .name(\u0026#34;Apache 2.0\u0026#34;) .url(\u0026#34;https://www.apache.org/licenses/LICENSE-2.0.html\u0026#34;)) .termsOfService(\u0026#34;https://example.com/terms\u0026#34;); } private List\u0026lt;Server\u0026gt; createServers() { return List.of( new Server() .url(\u0026#34;https://api.example.com\u0026#34;) .description(\u0026#34;Production Server\u0026#34;), new Server() .url(\u0026#34;https://staging-api.example.com\u0026#34;) .description(\u0026#34;Staging Server\u0026#34;), new Server() .url(\u0026#34;http://localhost:8080\u0026#34;) .description(\u0026#34;Development Server\u0026#34;) ); } private List\u0026lt;SecurityRequirement\u0026gt; createSecurityRequirements() { return List.of( new SecurityRequirement().addList(\u0026#34;bearerAuth\u0026#34;), new SecurityRequirement().addList(\u0026#34;apiKey\u0026#34;) ); } private Components createComponents() { return new Components() .addSecuritySchemes(\u0026#34;bearerAuth\u0026#34;, new SecurityScheme() .type(SecurityScheme.Type.HTTP) .scheme(\u0026#34;bearer\u0026#34;) .bearerFormat(\u0026#34;JWT\u0026#34;) .description(\u0026#34;JWT Bearer Token Authentication\u0026#34;)) .addSecuritySchemes(\u0026#34;apiKey\u0026#34;, new SecurityScheme() .type(SecurityScheme.Type.APIKEY) .in(SecurityScheme.In.HEADER) .name(\u0026#34;X-API-Key\u0026#34;) .description(\u0026#34;API Key Authentication\u0026#34;)) .addSchemas(\u0026#34;Error\u0026#34;, createErrorSchema()) .addSchemas(\u0026#34;PageInfo\u0026#34;, createPageInfoSchema()); } private Schema\u0026lt;?\u0026gt; createErrorSchema() { return new Schema\u0026lt;\u0026gt;() .type(\u0026#34;object\u0026#34;) .addProperties(\u0026#34;timestamp\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;string\u0026#34;).format(\u0026#34;date-time\u0026#34;)) .addProperties(\u0026#34;status\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;integer\u0026#34;)) .addProperties(\u0026#34;error\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;string\u0026#34;)) .addProperties(\u0026#34;message\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;string\u0026#34;)) .addProperties(\u0026#34;path\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;string\u0026#34;)); } private Schema\u0026lt;?\u0026gt; createPageInfoSchema() { return new Schema\u0026lt;\u0026gt;() .type(\u0026#34;object\u0026#34;) .addProperties(\u0026#34;page\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;integer\u0026#34;)) .addProperties(\u0026#34;size\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;integer\u0026#34;)) .addProperties(\u0026#34;totalElements\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;integer\u0026#34;)) .addProperties(\u0026#34;totalPages\u0026#34;, new Schema\u0026lt;\u0026gt;().type(\u0026#34;integer\u0026#34;)); } } æ§åˆ¶å™¨è¨»è§£è©³è§£ 1. å®Œæ•´çš„ REST Controller ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 @RestController @RequestMapping(\u0026#34;/api/v1/users\u0026#34;) @Tag(name = \u0026#34;User Management\u0026#34;, description = \u0026#34;ç”¨æˆ¶ç®¡ç†ç›¸é—œ API\u0026#34;) @SecurityRequirement(name = \u0026#34;bearerAuth\u0026#34;) public class UserController { private final UserService userService; public UserController(UserService userService) { this.userService = userService; } @GetMapping @Operation( summary = \u0026#34;ç²å–ç”¨æˆ¶åˆ—è¡¨\u0026#34;, description = \u0026#34;åˆ†é æŸ¥è©¢ç”¨æˆ¶è³‡è¨Šï¼Œæ”¯æ´å¤šç¨®éæ¿¾æ¢ä»¶\u0026#34;, tags = {\u0026#34;User Management\u0026#34;} ) @ApiResponses(value = { @ApiResponse( responseCode = \u0026#34;200\u0026#34;, description = \u0026#34;æˆåŠŸç²å–ç”¨æˆ¶åˆ—è¡¨\u0026#34;, content = @Content( mediaType = \u0026#34;application/json\u0026#34;, schema = @Schema(implementation = PagedUserResponse.class), examples = @ExampleObject( name = \u0026#34;ç”¨æˆ¶åˆ—è¡¨ç¯„ä¾‹\u0026#34;, value = \u0026#34;\u0026#34;\u0026#34; { \u0026#34;content\u0026#34;: [ { \u0026#34;id\u0026#34;: 1, \u0026#34;username\u0026#34;: \u0026#34;john_doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;firstName\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;lastName\u0026#34;: \u0026#34;Doe\u0026#34;, \u0026#34;createdAt\u0026#34;: \u0026#34;2023-01-15T10:30:00Z\u0026#34; } ], \u0026#34;pageable\u0026#34;: { \u0026#34;page\u0026#34;: 0, \u0026#34;size\u0026#34;: 20, \u0026#34;totalElements\u0026#34;: 1, \u0026#34;totalPages\u0026#34;: 1 } } \u0026#34;\u0026#34;\u0026#34; ) ) ), @ApiResponse( responseCode = \u0026#34;400\u0026#34;, description = \u0026#34;è«‹æ±‚åƒæ•¸éŒ¯èª¤\u0026#34;, content = @Content( mediaType = \u0026#34;application/json\u0026#34;, schema = @Schema(implementation = ErrorResponse.class) ) ), @ApiResponse( responseCode = \u0026#34;401\u0026#34;, description = \u0026#34;æœªæˆæ¬Šè¨ªå•\u0026#34;, content = @Content(schema = @Schema(implementation = ErrorResponse.class)) ), @ApiResponse( responseCode = \u0026#34;403\u0026#34;, description = \u0026#34;æ¬Šé™ä¸è¶³\u0026#34;, content = @Content(schema = @Schema(implementation = ErrorResponse.class)) ) }) public ResponseEntity\u0026lt;Page\u0026lt;UserResponse\u0026gt;\u0026gt; getUsers( @Parameter( description = \u0026#34;é ç¢¼ï¼ˆå¾ 0 é–‹å§‹ï¼‰\u0026#34;, example = \u0026#34;0\u0026#34;, schema = @Schema(minimum = \u0026#34;0\u0026#34;, defaultValue = \u0026#34;0\u0026#34;) ) @RequestParam(defaultValue = \u0026#34;0\u0026#34;) @Min(0) int page, @Parameter( description = \u0026#34;æ¯é å¤§å°\u0026#34;, example = \u0026#34;20\u0026#34;, schema = @Schema(minimum = \u0026#34;1\u0026#34;, maximum = \u0026#34;100\u0026#34;, defaultValue = \u0026#34;20\u0026#34;) ) @RequestParam(defaultValue = \u0026#34;20\u0026#34;) @Min(1) @Max(100) int size, @Parameter( description = \u0026#34;æ’åºæ¬„ä½ï¼Œæ ¼å¼ï¼šfield,direction\u0026#34;, example = \u0026#34;createdAt,desc\u0026#34;, array = @ArraySchema(schema = @Schema(type = \u0026#34;string\u0026#34;)) ) @RequestParam(defaultValue = \u0026#34;createdAt,desc\u0026#34;) String[] sort, @Parameter( description = \u0026#34;ç”¨æˆ¶åæœå°‹é—œéµå­—\u0026#34;, example = \u0026#34;john\u0026#34; ) @RequestParam(required = false) String username, @Parameter( description = \u0026#34;éƒµç®±æœå°‹é—œéµå­—\u0026#34;, example = \u0026#34;example.com\u0026#34; ) @RequestParam(required = false) String email, @Parameter( description = \u0026#34;ç”¨æˆ¶ç‹€æ…‹éæ¿¾\u0026#34;, schema = @Schema(allowableValues = {\u0026#34;ACTIVE\u0026#34;, \u0026#34;INACTIVE\u0026#34;, \u0026#34;SUSPENDED\u0026#34;}) ) @RequestParam(required = false) UserStatus status ) { UserSearchCriteria criteria = UserSearchCriteria.builder() .username(username) .email(email) .status(status) .build(); Pageable pageable = createPageable(page, size, sort); Page\u0026lt;UserResponse\u0026gt; users = userService.findUsers(criteria, pageable); return ResponseEntity.ok(users); } @GetMapping(\u0026#34;/{id}\u0026#34;) @Operation( summary = \u0026#34;æ ¹æ“š ID ç²å–ç”¨æˆ¶\u0026#34;, description = \u0026#34;æ ¹æ“šç”¨æˆ¶ ID ç²å–è©³ç´°è³‡è¨Š\u0026#34; ) @ApiResponses(value = { @ApiResponse( responseCode = \u0026#34;200\u0026#34;, description = \u0026#34;æˆåŠŸç²å–ç”¨æˆ¶è³‡è¨Š\u0026#34;, content = @Content( mediaType = \u0026#34;application/json\u0026#34;, schema = @Schema(implementation = UserDetailResponse.class) ) ), @ApiResponse(responseCode = \u0026#34;404\u0026#34;, description = \u0026#34;ç”¨æˆ¶ä¸å­˜åœ¨\u0026#34;) }) public ResponseEntity\u0026lt;UserDetailResponse\u0026gt; getUserById( @Parameter( description = \u0026#34;ç”¨æˆ¶ ID\u0026#34;, required = true, example = \u0026#34;123\u0026#34; ) @PathVariable @Positive Long id ) { UserDetailResponse user = userService.findDetailById(id); return ResponseEntity.ok(user); } @PostMapping @Operation( summary = \u0026#34;å‰µå»ºæ–°ç”¨æˆ¶\u0026#34;, description = \u0026#34;å‰µå»ºæ–°çš„ç”¨æˆ¶å¸³æˆ¶ï¼Œéƒµç®±å¿…é ˆå”¯ä¸€\u0026#34; ) @ApiResponses(value = { @ApiResponse( responseCode = \u0026#34;201\u0026#34;, description = \u0026#34;ç”¨æˆ¶å‰µå»ºæˆåŠŸ\u0026#34;, content = @Content( mediaType = \u0026#34;application/json\u0026#34;, schema = @Schema(implementation = UserResponse.class) ) ), @ApiResponse( responseCode = \u0026#34;400\u0026#34;, description = \u0026#34;è«‹æ±‚è³‡æ–™é©—è­‰å¤±æ•—\u0026#34;, content = @Content( mediaType = \u0026#34;application/json\u0026#34;, schema = @Schema(implementation = ValidationErrorResponse.class) ) ), @ApiResponse( responseCode = \u0026#34;409\u0026#34;, description = \u0026#34;éƒµç®±å·²å­˜åœ¨\u0026#34; ) }) public ResponseEntity\u0026lt;UserResponse\u0026gt; createUser( @io.swagger.v3.oas.annotations.parameters.RequestBody( description = \u0026#34;ç”¨æˆ¶å‰µå»ºè«‹æ±‚\u0026#34;, required = true, content = @Content( mediaType = \u0026#34;application/json\u0026#34;, schema = @Schema(implementation = CreateUserRequest.class), examples = @ExampleObject( name = \u0026#34;ç”¨æˆ¶å‰µå»ºç¯„ä¾‹\u0026#34;, value = \u0026#34;\u0026#34;\u0026#34; { \u0026#34;username\u0026#34;: \u0026#34;john_doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;firstName\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;lastName\u0026#34;: \u0026#34;Doe\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;SecurePassword123!\u0026#34; } \u0026#34;\u0026#34;\u0026#34; ) ) ) @RequestBody @Valid CreateUserRequest request ) { UserResponse user = userService.createUser(request); URI location = URI.create(\u0026#34;/api/v1/users/\u0026#34; + user.getId()); return ResponseEntity.created(location).body(user); } @PutMapping(\u0026#34;/{id}\u0026#34;) @Operation( summary = \u0026#34;æ›´æ–°ç”¨æˆ¶è³‡è¨Š\u0026#34;, description = \u0026#34;æ›´æ–°æŒ‡å®šç”¨æˆ¶çš„åŸºæœ¬è³‡è¨Š\u0026#34; ) public ResponseEntity\u0026lt;UserResponse\u0026gt; updateUser( @PathVariable @Positive Long id, @RequestBody @Valid UpdateUserRequest request ) { UserResponse user = userService.updateUser(id, request); return ResponseEntity.ok(user); } @DeleteMapping(\u0026#34;/{id}\u0026#34;) @Operation( summary = \u0026#34;åˆªé™¤ç”¨æˆ¶\u0026#34;, description = \u0026#34;è»Ÿåˆªé™¤æŒ‡å®šç”¨æˆ¶ï¼ˆæ¨™è¨˜ç‚ºå·²åˆªé™¤ç‹€æ…‹ï¼‰\u0026#34; ) @ApiResponses(value = { @ApiResponse(responseCode = \u0026#34;204\u0026#34;, description = \u0026#34;åˆªé™¤æˆåŠŸ\u0026#34;), @ApiResponse(responseCode = \u0026#34;404\u0026#34;, description = \u0026#34;ç”¨æˆ¶ä¸å­˜åœ¨\u0026#34;), @ApiResponse(responseCode = \u0026#34;409\u0026#34;, description = \u0026#34;ç”¨æˆ¶æœ‰é—œè¯è³‡æ–™ï¼Œç„¡æ³•åˆªé™¤\u0026#34;) }) public ResponseEntity\u0026lt;Void\u0026gt; deleteUser( @PathVariable @Positive Long id ) { userService.deleteUser(id); return ResponseEntity.noContent().build(); } @PostMapping(\u0026#34;/{id}/avatar\u0026#34;) @Operation( summary = \u0026#34;ä¸Šå‚³ç”¨æˆ¶é ­åƒ\u0026#34;, description = \u0026#34;ä¸Šå‚³ç”¨æˆ¶é ­åƒåœ–ç‰‡ï¼Œæ”¯æ´ JPGã€PNG æ ¼å¼\u0026#34; ) @ApiResponses(value = { @ApiResponse( responseCode = \u0026#34;200\u0026#34;, description = \u0026#34;é ­åƒä¸Šå‚³æˆåŠŸ\u0026#34;, content = @Content( mediaType = \u0026#34;application/json\u0026#34;, schema = @Schema(implementation = UploadResponse.class) ) ), @ApiResponse(responseCode = \u0026#34;400\u0026#34;, description = \u0026#34;æª”æ¡ˆæ ¼å¼ä¸æ”¯æ´\u0026#34;), @ApiResponse(responseCode = \u0026#34;413\u0026#34;, description = \u0026#34;æª”æ¡ˆå¤§å°è¶…å‡ºé™åˆ¶\u0026#34;) }) public ResponseEntity\u0026lt;UploadResponse\u0026gt; uploadAvatar( @PathVariable @Positive Long id, @Parameter( description = \u0026#34;é ­åƒåœ–ç‰‡æª”æ¡ˆ\u0026#34;, required = true, content = @Content(mediaType = \u0026#34;multipart/form-data\u0026#34;) ) @RequestParam(\u0026#34;file\u0026#34;) MultipartFile file ) { UploadResponse response = userService.uploadAvatar(id, file); return ResponseEntity.ok(response); } } 2. DTO é¡åˆ¥è¨»è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 @Schema(description = \u0026#34;ç”¨æˆ¶å‰µå»ºè«‹æ±‚\u0026#34;) public class CreateUserRequest { @Schema( description = \u0026#34;ç”¨æˆ¶å\u0026#34;, example = \u0026#34;john_doe\u0026#34;, minLength = 3, maxLength = 50, pattern = \u0026#34;^[a-zA-Z0-9_]+$\u0026#34; ) @NotBlank(message = \u0026#34;ç”¨æˆ¶åä¸èƒ½ç‚ºç©º\u0026#34;) @Size(min = 3, max = 50, message = \u0026#34;ç”¨æˆ¶åé•·åº¦å¿…é ˆåœ¨ 3-50 å­—å…ƒä¹‹é–“\u0026#34;) @Pattern(regexp = \u0026#34;^[a-zA-Z0-9_]+$\u0026#34;, message = \u0026#34;ç”¨æˆ¶ååªèƒ½åŒ…å«å­—æ¯ã€æ•¸å­—å’Œåº•ç·š\u0026#34;) private String username; @Schema( description = \u0026#34;éƒµç®±åœ°å€\u0026#34;, example = \u0026#34;john@example.com\u0026#34;, format = \u0026#34;email\u0026#34; ) @NotBlank(message = \u0026#34;éƒµç®±ä¸èƒ½ç‚ºç©º\u0026#34;) @Email(message = \u0026#34;éƒµç®±æ ¼å¼ä¸æ­£ç¢º\u0026#34;) private String email; @Schema( description = \u0026#34;åå­—\u0026#34;, example = \u0026#34;John\u0026#34;, maxLength = 30 ) @NotBlank(message = \u0026#34;åå­—ä¸èƒ½ç‚ºç©º\u0026#34;) @Size(max = 30, message = \u0026#34;åå­—é•·åº¦ä¸èƒ½è¶…é 30 å­—å…ƒ\u0026#34;) private String firstName; @Schema( description = \u0026#34;å§“æ°\u0026#34;, example = \u0026#34;Doe\u0026#34;, maxLength = 30 ) @NotBlank(message = \u0026#34;å§“æ°ä¸èƒ½ç‚ºç©º\u0026#34;) @Size(max = 30, message = \u0026#34;å§“æ°é•·åº¦ä¸èƒ½è¶…é 30 å­—å…ƒ\u0026#34;) private String lastName; @Schema( description = \u0026#34;å¯†ç¢¼\u0026#34;, example = \u0026#34;SecurePassword123!\u0026#34;, minLength = 8, maxLength = 100, format = \u0026#34;password\u0026#34; ) @NotBlank(message = \u0026#34;å¯†ç¢¼ä¸èƒ½ç‚ºç©º\u0026#34;) @Size(min = 8, max = 100, message = \u0026#34;å¯†ç¢¼é•·åº¦å¿…é ˆåœ¨ 8-100 å­—å…ƒä¹‹é–“\u0026#34;) @Pattern( regexp = \u0026#34;^(?=.*[a-z])(?=.*[A-Z])(?=.*\\\\d)(?=.*[@$!%*?\u0026amp;])[A-Za-z\\\\d@$!%*?\u0026amp;]+$\u0026#34;, message = \u0026#34;å¯†ç¢¼å¿…é ˆåŒ…å«å¤§å°å¯«å­—æ¯ã€æ•¸å­—å’Œç‰¹æ®Šå­—å…ƒ\u0026#34; ) private String password; @Schema( description = \u0026#34;å‡ºç”Ÿæ—¥æœŸ\u0026#34;, example = \u0026#34;1990-01-15\u0026#34;, format = \u0026#34;date\u0026#34; ) @Past(message = \u0026#34;å‡ºç”Ÿæ—¥æœŸå¿…é ˆæ˜¯éå»çš„æ—¥æœŸ\u0026#34;) private LocalDate birthDate; @Schema( description = \u0026#34;ç”¨æˆ¶è§’è‰²\u0026#34;, allowableValues = {\u0026#34;USER\u0026#34;, \u0026#34;ADMIN\u0026#34;, \u0026#34;MODERATOR\u0026#34;}, defaultValue = \u0026#34;USER\u0026#34; ) private UserRole role = UserRole.USER; // Getters and Setters... } @Schema(description = \u0026#34;åˆ†é ç”¨æˆ¶å›æ‡‰\u0026#34;) public class PagedUserResponse { @Schema(description = \u0026#34;ç”¨æˆ¶åˆ—è¡¨\u0026#34;) private List\u0026lt;UserResponse\u0026gt; content; @Schema(description = \u0026#34;åˆ†é è³‡è¨Š\u0026#34;) private PageInfo pageable; // Getters and Setters... } @Schema(description = \u0026#34;ç”¨æˆ¶åŸºæœ¬è³‡è¨Šå›æ‡‰\u0026#34;) public class UserResponse { @Schema(description = \u0026#34;ç”¨æˆ¶ ID\u0026#34;, example = \u0026#34;123\u0026#34;) private Long id; @Schema(description = \u0026#34;ç”¨æˆ¶å\u0026#34;, example = \u0026#34;john_doe\u0026#34;) private String username; @Schema(description = \u0026#34;éƒµç®±\u0026#34;, example = \u0026#34;john@example.com\u0026#34;) private String email; @Schema(description = \u0026#34;å…¨å\u0026#34;, example = \u0026#34;John Doe\u0026#34;) private String fullName; @Schema(description = \u0026#34;é ­åƒ URL\u0026#34;, example = \u0026#34;https://example.com/avatars/123.jpg\u0026#34;) private String avatarUrl; @Schema(description = \u0026#34;ç”¨æˆ¶ç‹€æ…‹\u0026#34;, allowableValues = {\u0026#34;ACTIVE\u0026#34;, \u0026#34;INACTIVE\u0026#34;, \u0026#34;SUSPENDED\u0026#34;}) private UserStatus status; @Schema(description = \u0026#34;å‰µå»ºæ™‚é–“\u0026#34;, format = \u0026#34;date-time\u0026#34;) private LocalDateTime createdAt; @Schema(description = \u0026#34;æœ€å¾Œç™»å…¥æ™‚é–“\u0026#34;, format = \u0026#34;date-time\u0026#34;) private LocalDateTime lastLoginAt; // Getters and Setters... } å®‰å…¨é…ç½®æ•´åˆ 1. JWT Bearer Token æ•´åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 @Configuration @EnableWebSecurity public class SecurityConfiguration { @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { return http .csrf(csrf -\u0026gt; csrf.disable()) .authorizeHttpRequests(auth -\u0026gt; auth // Swagger ç›¸é—œè·¯å¾‘å…¬é–‹ .requestMatchers( \u0026#34;/api-docs/**\u0026#34;, \u0026#34;/swagger-ui/**\u0026#34;, \u0026#34;/swagger-ui.html\u0026#34;, \u0026#34;/webjars/**\u0026#34; ).permitAll() // å…¬é–‹ API .requestMatchers(HttpMethod.POST, \u0026#34;/api/v1/auth/**\u0026#34;).permitAll() .requestMatchers(HttpMethod.GET, \u0026#34;/api/v1/public/**\u0026#34;).permitAll() // éœ€è¦èªè­‰çš„ API .anyRequest().authenticated() ) .oauth2ResourceServer(oauth2 -\u0026gt; oauth2 .jwt(jwt -\u0026gt; jwt.jwtDecoder(jwtDecoder())) ) .sessionManagement(session -\u0026gt; session .sessionCreationPolicy(SessionCreationPolicy.STATELESS) ) .build(); } @Bean public JwtDecoder jwtDecoder() { return NimbusJwtDecoder.withJwkSetUri(\u0026#34;https://your-auth-server/.well-known/jwks.json\u0026#34;) .build(); } } // åœ¨ Controller ä¸­æŒ‡å®šå®‰å…¨éœ€æ±‚ @RestController @RequestMapping(\u0026#34;/api/v1/admin\u0026#34;) @Tag(name = \u0026#34;Admin Management\u0026#34;, description = \u0026#34;ç®¡ç†å“¡å°ˆç”¨ API\u0026#34;) @SecurityRequirement(name = \u0026#34;bearerAuth\u0026#34;) @PreAuthorize(\u0026#34;hasRole(\u0026#39;ADMIN\u0026#39;)\u0026#34;) public class AdminController { @GetMapping(\u0026#34;/users\u0026#34;) @Operation( summary = \u0026#34;ç®¡ç†å“¡æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ¶\u0026#34;, description = \u0026#34;éœ€è¦ ADMIN è§’è‰²æ¬Šé™\u0026#34; ) @PreAuthorize(\u0026#34;hasAuthority(\u0026#39;USER_READ_ALL\u0026#39;)\u0026#34;) public ResponseEntity\u0026lt;Page\u0026lt;UserResponse\u0026gt;\u0026gt; getAllUsersForAdmin( @ParameterObject Pageable pageable ) { // Implementation... return ResponseEntity.ok().build(); } } 2. API Key èªè­‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 @Component public class ApiKeyAuthenticationFilter extends OncePerRequestFilter { private static final String API_KEY_HEADER = \u0026#34;X-API-Key\u0026#34;; private final ApiKeyService apiKeyService; public ApiKeyAuthenticationFilter(ApiKeyService apiKeyService) { this.apiKeyService = apiKeyService; } @Override protected void doFilterInternal( HttpServletRequest request, HttpServletResponse response, FilterChain filterChain ) throws ServletException, IOException { String apiKey = request.getHeader(API_KEY_HEADER); if (apiKey != null \u0026amp;\u0026amp; apiKeyService.isValidApiKey(apiKey)) { ApiKeyDetails details = apiKeyService.getApiKeyDetails(apiKey); ApiKeyAuthenticationToken authentication = new ApiKeyAuthenticationToken(details); SecurityContextHolder.getContext().setAuthentication(authentication); } filterChain.doFilter(request, response); } } // åœ¨ç‰¹å®š Controller ä¸­ä½¿ç”¨ API Key @RestController @RequestMapping(\u0026#34;/api/v1/webhook\u0026#34;) @Tag(name = \u0026#34;Webhook API\u0026#34;, description = \u0026#34;ç¬¬ä¸‰æ–¹ç³»çµ±å›èª¿ API\u0026#34;) @SecurityRequirement(name = \u0026#34;apiKey\u0026#34;) public class WebhookController { @PostMapping(\u0026#34;/payment\u0026#34;) @Operation( summary = \u0026#34;æ”¯ä»˜çµæœå›èª¿\u0026#34;, description = \u0026#34;ç¬¬ä¸‰æ–¹æ”¯ä»˜ç³»çµ±å›èª¿é€šçŸ¥\u0026#34; ) public ResponseEntity\u0026lt;Void\u0026gt; handlePaymentWebhook( @RequestBody PaymentWebhookRequest request ) { // Implementation... return ResponseEntity.ok().build(); } } é€²éšåŠŸèƒ½é…ç½® 1. è‡ªè¨‚æ–‡æª”åˆ†çµ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 @Configuration public class OpenApiGroupConfiguration { @Bean @Primary public GroupedOpenApi publicApi() { return GroupedOpenApi.builder() .group(\u0026#34;public\u0026#34;) .displayName(\u0026#34;Public API\u0026#34;) .pathsToMatch(\u0026#34;/api/v1/public/**\u0026#34;, \u0026#34;/api/v1/auth/**\u0026#34;) .build(); } @Bean public GroupedOpenApi userApi() { return GroupedOpenApi.builder() .group(\u0026#34;user\u0026#34;) .displayName(\u0026#34;User API\u0026#34;) .pathsToMatch(\u0026#34;/api/v1/users/**\u0026#34;, \u0026#34;/api/v1/profile/**\u0026#34;) .addOperationCustomizer((operation, handlerMethod) -\u0026gt; { operation.addSecurityItem(new SecurityRequirement().addList(\u0026#34;bearerAuth\u0026#34;)); return operation; }) .build(); } @Bean public GroupedOpenApi adminApi() { return GroupedOpenApi.builder() .group(\u0026#34;admin\u0026#34;) .displayName(\u0026#34;Admin API\u0026#34;) .pathsToMatch(\u0026#34;/api/v1/admin/**\u0026#34;) .addOperationCustomizer((operation, handlerMethod) -\u0026gt; { operation.addSecurityItem(new SecurityRequirement().addList(\u0026#34;bearerAuth\u0026#34;)); // æ·»åŠ ç®¡ç†å“¡ API çš„é¡å¤–æ¨™ç±¤ operation.addTagsItem(\u0026#34;Admin Only\u0026#34;); return operation; }) .build(); } @Bean public GroupedOpenApi internalApi() { return GroupedOpenApi.builder() .group(\u0026#34;internal\u0026#34;) .displayName(\u0026#34;Internal API\u0026#34;) .pathsToMatch(\u0026#34;/api/internal/**\u0026#34;) .addOperationCustomizer((operation, handlerMethod) -\u0026gt; { operation.addSecurityItem(new SecurityRequirement().addList(\u0026#34;apiKey\u0026#34;)); return operation; }) .build(); } } 2. è‡ªè¨‚æ“ä½œç¬¦è™•ç†å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 @Component public class CustomOperationCustomizer implements OperationCustomizer { @Override public Operation customize(Operation operation, HandlerMethod handlerMethod) { // è‡ªå‹•æ·»åŠ é€šç”¨éŒ¯èª¤å›æ‡‰ addCommonErrorResponses(operation); // ç‚ºåˆ†é ç«¯é»æ·»åŠ é€šç”¨åƒæ•¸ if (isPaginationEndpoint(handlerMethod)) { addPaginationParameters(operation); } // æ·»åŠ è«‹æ±‚è¿½è¹¤è³‡è¨Š addRequestTrackingInfo(operation); return operation; } private void addCommonErrorResponses(Operation operation) { ApiResponses responses = operation.getResponses(); if (responses.get(\u0026#34;400\u0026#34;) == null) { responses.addApiResponse(\u0026#34;400\u0026#34;, new ApiResponse() .description(\u0026#34;è«‹æ±‚åƒæ•¸éŒ¯èª¤\u0026#34;) .content(new Content() .addMediaType(\u0026#34;application/json\u0026#34;, new MediaType() .schema(new Schema\u0026lt;\u0026gt;().$ref(\u0026#34;#/components/schemas/Error\u0026#34;))))); } if (responses.get(\u0026#34;500\u0026#34;) == null) { responses.addApiResponse(\u0026#34;500\u0026#34;, new ApiResponse() .description(\u0026#34;å…§éƒ¨ä¼ºæœå™¨éŒ¯èª¤\u0026#34;) .content(new Content() .addMediaType(\u0026#34;application/json\u0026#34;, new MediaType() .schema(new Schema\u0026lt;\u0026gt;().$ref(\u0026#34;#/components/schemas/Error\u0026#34;))))); } } private boolean isPaginationEndpoint(HandlerMethod handlerMethod) { return Arrays.stream(handlerMethod.getMethodParameters()) .anyMatch(param -\u0026gt; Pageable.class.isAssignableFrom(param.getParameterType())); } private void addPaginationParameters(Operation operation) { if (operation.getParameters() == null) { operation.setParameters(new ArrayList\u0026lt;\u0026gt;()); } // æ·»åŠ é€šç”¨åˆ†é åƒæ•¸ operation.getParameters().add(new Parameter() .name(\u0026#34;page\u0026#34;) .in(ParameterIn.QUERY) .description(\u0026#34;é ç¢¼ï¼ˆå¾ 0 é–‹å§‹ï¼‰\u0026#34;) .schema(new IntegerSchema().minimum(BigDecimal.ZERO)._default(0))); operation.getParameters().add(new Parameter() .name(\u0026#34;size\u0026#34;) .in(ParameterIn.QUERY) .description(\u0026#34;æ¯é å¤§å°\u0026#34;) .schema(new IntegerSchema().minimum(BigDecimal.ONE).maximum(BigDecimal.valueOf(100))._default(20))); } private void addRequestTrackingInfo(Operation operation) { operation.addExtension(\u0026#34;x-request-id\u0026#34;, \u0026#34;è‡ªå‹•ç”Ÿæˆçš„è«‹æ±‚è¿½è¹¤ ID\u0026#34;); operation.addExtension(\u0026#34;x-rate-limit\u0026#34;, \u0026#34;API å‘¼å«é »ç‡é™åˆ¶è³‡è¨Š\u0026#34;); } } 3. è‡ªè¨‚ Schema è™•ç†å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 @Component public class CustomModelConverter implements ModelConverter { @Override public ModelConverterContext resolve( AnnotatedType annotatedType, ModelConverterContext context, Iterator\u0026lt;ModelConverter\u0026gt; chain ) { if (chain.hasNext()) { context = chain.next().resolve(annotatedType, context, chain); } // è‡ªè¨‚æšèˆ‰è™•ç† if (annotatedType.getType() instanceof Class\u0026lt;?\u0026gt; clazz \u0026amp;\u0026amp; clazz.isEnum()) { Schema\u0026lt;?\u0026gt; schema = context.getDefinedModels().get(annotatedType.getType().getTypeName()); if (schema != null) { enhanceEnumSchema(schema, clazz); } } return context; } @SuppressWarnings(\u0026#34;unchecked\u0026#34;) private void enhanceEnumSchema(Schema\u0026lt;?\u0026gt; schema, Class\u0026lt;?\u0026gt; enumClass) { if (enumClass.isEnum()) { Enum\u0026lt;?\u0026gt;[] enumConstants = (Enum\u0026lt;?\u0026gt;[]) enumClass.getEnumConstants(); List\u0026lt;String\u0026gt; enumValues = Arrays.stream(enumConstants) .map(Enum::name) .collect(Collectors.toList()); schema.setEnum(enumValues); // æ·»åŠ æšèˆ‰æè¿° StringBuilder description = new StringBuilder(schema.getDescription() != null ? schema.getDescription() : \u0026#34;\u0026#34;); description.append(\u0026#34;\\n\\nå¯ç”¨å€¼ï¼š\\n\u0026#34;); for (Enum\u0026lt;?\u0026gt; enumConstant : enumConstants) { description.append(\u0026#34;- `\u0026#34;).append(enumConstant.name()).append(\u0026#34;`\u0026#34;); // å¦‚æœæšèˆ‰æœ‰æè¿°æ–¹æ³•ï¼Œæ·»åŠ æè¿° try { Method getDescription = enumClass.getMethod(\u0026#34;getDescription\u0026#34;); Object desc = getDescription.invoke(enumConstant); if (desc != null) { description.append(\u0026#34;: \u0026#34;).append(desc); } } catch (Exception ignored) { // å¿½ç•¥æ²’æœ‰ getDescription æ–¹æ³•çš„æƒ…æ³ } description.append(\u0026#34;\\n\u0026#34;); } schema.setDescription(description.toString()); } } } æ¸¬è©¦æ•´åˆ 1. API æ–‡æª”æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) @TestMethodOrder(OrderAnnotation.class) class OpenApiDocumentationTest { @Autowired private TestRestTemplate restTemplate; @LocalServerPort private int port; @Test @Order(1) void testOpenApiJsonGeneration() { String url = \u0026#34;http://localhost:\u0026#34; + port + \u0026#34;/api-docs\u0026#34;; ResponseEntity\u0026lt;String\u0026gt; response = restTemplate.getForEntity(url, String.class); assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK); assertThat(response.getBody()).isNotNull(); // é©—è­‰ JSON çµæ§‹ DocumentContext context = JsonPath.parse(response.getBody()); assertThat(context.read(\u0026#34;$.openapi\u0026#34;, String.class)).isEqualTo(\u0026#34;3.0.1\u0026#34;); assertThat(context.read(\u0026#34;$.info.title\u0026#34;, String.class)).isNotEmpty(); assertThat(context.read(\u0026#34;$.paths\u0026#34;, Map.class)).isNotEmpty(); } @Test @Order(2) void testSwaggerUiAccess() { String url = \u0026#34;http://localhost:\u0026#34; + port + \u0026#34;/swagger-ui.html\u0026#34;; ResponseEntity\u0026lt;String\u0026gt; response = restTemplate.getForEntity(url, String.class); assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK); assertThat(response.getBody()).contains(\u0026#34;Swagger UI\u0026#34;); } @Test @Order(3) void testApiGroupsGeneration() { String[] groups = {\u0026#34;public\u0026#34;, \u0026#34;user\u0026#34;, \u0026#34;admin\u0026#34;, \u0026#34;internal\u0026#34;}; for (String group : groups) { String url = \u0026#34;http://localhost:\u0026#34; + port + \u0026#34;/api-docs/\u0026#34; + group; ResponseEntity\u0026lt;String\u0026gt; response = restTemplate.getForEntity(url, String.class); assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK); DocumentContext context = JsonPath.parse(response.getBody()); assertThat(context.read(\u0026#34;$.paths\u0026#34;, Map.class)).isNotEmpty(); } } @Test @Order(4) void testSecuritySchemesDefinition() { String url = \u0026#34;http://localhost:\u0026#34; + port + \u0026#34;/api-docs\u0026#34;; ResponseEntity\u0026lt;String\u0026gt; response = restTemplate.getForEntity(url, String.class); DocumentContext context = JsonPath.parse(response.getBody()); // é©—è­‰å®‰å…¨æ–¹æ¡ˆå®šç¾© assertThat(context.read(\u0026#34;$.components.securitySchemes.bearerAuth.type\u0026#34;, String.class)) .isEqualTo(\u0026#34;http\u0026#34;); assertThat(context.read(\u0026#34;$.components.securitySchemes.apiKey.type\u0026#34;, String.class)) .isEqualTo(\u0026#34;apiKey\u0026#34;); } } 2. å¥‘ç´„æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) class ApiContractTest { @Autowired private TestRestTemplate restTemplate; @Autowired private ObjectMapper objectMapper; @LocalServerPort private int port; @Test void testUserApiContract() throws Exception { // ç²å– OpenAPI è¦ç¯„ String openApiJson = getOpenApiJson(); OpenAPIV3Parser parser = new OpenAPIV3Parser(); OpenAPI openAPI = parser.readContents(openApiJson).getOpenAPI(); // æ¸¬è©¦ç”¨æˆ¶å‰µå»ºç«¯é» PathItem userPath = openAPI.getPaths().get(\u0026#34;/api/v1/users\u0026#34;); assertThat(userPath).isNotNull(); Operation postOperation = userPath.getPost(); assertThat(postOperation).isNotNull(); assertThat(postOperation.getSummary()).isEqualTo(\u0026#34;å‰µå»ºæ–°ç”¨æˆ¶\u0026#34;); // é©—è­‰è«‹æ±‚ Schema RequestBody requestBody = postOperation.getRequestBody(); assertThat(requestBody).isNotNull(); Content content = requestBody.getContent(); MediaType mediaType = content.get(\u0026#34;application/json\u0026#34;); assertThat(mediaType).isNotNull(); // é©—è­‰å›æ‡‰ Schema ApiResponse response201 = postOperation.getResponses().get(\u0026#34;201\u0026#34;); assertThat(response201).isNotNull(); assertThat(response201.getDescription()).isEqualTo(\u0026#34;ç”¨æˆ¶å‰µå»ºæˆåŠŸ\u0026#34;); } @Test void testActualApiMatchesContract() throws Exception { // æ ¹æ“šæ–‡æª”æ¸¬è©¦å¯¦éš› API String requestJson = \u0026#34;\u0026#34;\u0026#34; { \u0026#34;username\u0026#34;: \u0026#34;test_user\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;test@example.com\u0026#34;, \u0026#34;firstName\u0026#34;: \u0026#34;Test\u0026#34;, \u0026#34;lastName\u0026#34;: \u0026#34;User\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;TestPassword123!\u0026#34; } \u0026#34;\u0026#34;\u0026#34;; HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_JSON); headers.setBearerAuth(\u0026#34;valid-jwt-token\u0026#34;); HttpEntity\u0026lt;String\u0026gt; request = new HttpEntity\u0026lt;\u0026gt;(requestJson, headers); // å‡è¨­é€™å€‹ç«¯é»åœ¨æ¸¬è©¦ç’°å¢ƒä¸­å¯ç”¨ String url = \u0026#34;http://localhost:\u0026#34; + port + \u0026#34;/api/v1/users\u0026#34;; ResponseEntity\u0026lt;String\u0026gt; response = restTemplate.postForEntity(url, request, String.class); // æ ¹æ“šæ–‡æª”ï¼Œæ‡‰è©²è¿”å› 201 æˆ– 401ï¼ˆå¦‚æœæ²’æœ‰æœ‰æ•ˆ tokenï¼‰ assertThat(response.getStatusCode()) .isIn(HttpStatus.CREATED, HttpStatus.UNAUTHORIZED); } private String getOpenApiJson() { String url = \u0026#34;http://localhost:\u0026#34; + port + \u0026#34;/api-docs\u0026#34;; return restTemplate.getForObject(url, String.class); } } éƒ¨ç½²èˆ‡ CI/CD æ•´åˆ 1. æ–‡æª”ç”Ÿæˆè…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #!/bin/bash # scripts/generate-api-docs.sh set -e echo \u0026#34;ğŸš€ ç”Ÿæˆ API æ–‡æª”...\u0026#34; # å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ echo \u0026#34;å•Ÿå‹• Spring Boot æ‡‰ç”¨ç¨‹å¼...\u0026#34; java -jar target/api-service.jar --server.port=8080 \u0026amp; APP_PID=$! # ç­‰å¾…æ‡‰ç”¨ç¨‹å¼å•Ÿå‹• echo \u0026#34;ç­‰å¾…æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•...\u0026#34; for i in {1..30}; do if curl -s http://localhost:8080/actuator/health \u0026gt; /dev/null; then echo \u0026#34;æ‡‰ç”¨ç¨‹å¼å·²å•Ÿå‹•\u0026#34; break fi sleep 2 done # ç”Ÿæˆ OpenAPI JSON echo \u0026#34;ä¸‹è¼‰ OpenAPI è¦ç¯„...\u0026#34; curl -o docs/openapi.json http://localhost:8080/api-docs # ç”Ÿæˆä¸åŒæ ¼å¼çš„æ–‡æª” echo \u0026#34;ç”Ÿæˆ HTML æ–‡æª”...\u0026#34; npx @redocly/openapi-cli build-docs docs/openapi.json --output docs/api.html echo \u0026#34;ç”Ÿæˆ Markdown æ–‡æª”...\u0026#34; npx widdershins docs/openapi.json -o docs/api.md # ç”Ÿæˆå®¢æˆ¶ç«¯ SDK echo \u0026#34;ç”Ÿæˆå®¢æˆ¶ç«¯ SDK...\u0026#34; mkdir -p generated/java-client npx @openapitools/openapi-generator-cli generate \\ -i docs/openapi.json \\ -g java \\ -o generated/java-client \\ --additional-properties=invokerPackage=com.example.client # åœæ­¢æ‡‰ç”¨ç¨‹å¼ echo \u0026#34;åœæ­¢æ‡‰ç”¨ç¨‹å¼...\u0026#34; kill $APP_PID echo \u0026#34;âœ… API æ–‡æª”ç”Ÿæˆå®Œæˆ\u0026#34; 2. GitHub Actions å·¥ä½œæµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 # .github/workflows/api-docs.yml name: Generate API Documentation on: push: branches: [ main, develop ] pull_request: branches: [ main ] jobs: generate-docs: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up JDK 17 uses: actions/setup-java@v3 with: java-version: \u0026#39;17\u0026#39; distribution: \u0026#39;temurin\u0026#39; - name: Cache Maven dependencies uses: actions/cache@v3 with: path: ~/.m2 key: ${{ runner.os }}-m2-${{ hashFiles(\u0026#39;**/pom.xml\u0026#39;) }} - name: Build application run: mvn clean package -DskipTests - name: Setup Node.js uses: actions/setup-node@v3 with: node-version: \u0026#39;18\u0026#39; - name: Install documentation tools run: | npm install -g @redocly/openapi-cli npm install -g widdershins npm install -g @openapitools/openapi-generator-cli - name: Generate API documentation run: | chmod +x scripts/generate-api-docs.sh ./scripts/generate-api-docs.sh - name: Upload documentation artifacts uses: actions/upload-artifact@v3 with: name: api-documentation path: | docs/ generated/ - name: Deploy to GitHub Pages if: github.ref == \u0026#39;refs/heads/main\u0026#39; uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./docs 3. Docker æ•´åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # Dockerfile.docs FROM openjdk:17-jdk-slim as builder WORKDIR /app COPY . . RUN ./mvnw clean package -DskipTests FROM node:18-alpine as docs-generator WORKDIR /app # å®‰è£æ–‡æª”ç”Ÿæˆå·¥å…· RUN npm install -g @redocly/openapi-cli widdershins @openapitools/openapi-generator-cli # è¤‡è£½æ‡‰ç”¨ç¨‹å¼ COPY --from=builder /app/target/*.jar app.jar # ç”Ÿæˆæ–‡æª”çš„è…³æœ¬ COPY scripts/generate-docs-docker.sh . RUN chmod +x generate-docs-docker.sh EXPOSE 8080 CMD [\u0026#34;./generate-docs-docker.sh\u0026#34;] æ•ˆèƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸ 1. å¤§å‹ API çš„æ–‡æª”å„ªåŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 @Configuration public class OpenApiPerformanceConfiguration { @Bean @ConditionalOnProperty(name = \u0026#34;springdoc.api-docs.enabled\u0026#34;, havingValue = \u0026#34;true\u0026#34;) public OpenApiCustomiser openApiCustomiser() { return openApi -\u0026gt; { // ç§»é™¤ä¸å¿…è¦çš„ Schema removeUnusedSchemas(openApi); // ç°¡åŒ–è¤‡é›œçš„åµŒå¥—å°è±¡ simplifyNestedObjects(openApi); // æ·»åŠ å¿«å–é ­ addCacheHeaders(openApi); }; } private void removeUnusedSchemas(OpenAPI openApi) { if (openApi.getComponents() != null \u0026amp;\u0026amp; openApi.getComponents().getSchemas() != null) { Set\u0026lt;String\u0026gt; usedSchemas = findUsedSchemas(openApi); openApi.getComponents().getSchemas().entrySet() .removeIf(entry -\u0026gt; !usedSchemas.contains(entry.getKey())); } } private Set\u0026lt;String\u0026gt; findUsedSchemas(OpenAPI openApi) { Set\u0026lt;String\u0026gt; usedSchemas = new HashSet\u0026lt;\u0026gt;(); if (openApi.getPaths() != null) { openApi.getPaths().values().forEach(pathItem -\u0026gt; { Stream.of( pathItem.getGet(), pathItem.getPost(), pathItem.getPut(), pathItem.getDelete(), pathItem.getPatch() ).filter(Objects::nonNull) .forEach(operation -\u0026gt; collectUsedSchemas(operation, usedSchemas)); }); } return usedSchemas; } private void collectUsedSchemas(Operation operation, Set\u0026lt;String\u0026gt; usedSchemas) { // å¾è«‹æ±‚é«”æ”¶é›† if (operation.getRequestBody() != null \u0026amp;\u0026amp; operation.getRequestBody().getContent() != null) { operation.getRequestBody().getContent().values() .forEach(mediaType -\u0026gt; collectSchemaRefs(mediaType.getSchema(), usedSchemas)); } // å¾å›æ‡‰æ”¶é›† if (operation.getResponses() != null) { operation.getResponses().values().forEach(response -\u0026gt; { if (response.getContent() != null) { response.getContent().values() .forEach(mediaType -\u0026gt; collectSchemaRefs(mediaType.getSchema(), usedSchemas)); } }); } } private void collectSchemaRefs(Schema\u0026lt;?\u0026gt; schema, Set\u0026lt;String\u0026gt; usedSchemas) { if (schema != null) { if (schema.get$ref() != null) { String schemaName = schema.get$ref().substring(\u0026#34;#/components/schemas/\u0026#34;.length()); usedSchemas.add(schemaName); } // éè¿´è™•ç†åµŒå¥— Schema if (schema.getProperties() != null) { schema.getProperties().values().forEach(prop -\u0026gt; collectSchemaRefs((Schema\u0026lt;?\u0026gt;) prop, usedSchemas)); } } } } 2. å¿«å–ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 @RestController @RequestMapping(\u0026#34;/api-docs\u0026#34;) public class CachedApiDocsController { private final SpringDocConfigProperties springDocConfigProperties; private final ObjectMapper objectMapper; private final Cache\u0026lt;String, String\u0026gt; apiDocsCache; public CachedApiDocsController( SpringDocConfigProperties springDocConfigProperties, ObjectMapper objectMapper ) { this.springDocConfigProperties = springDocConfigProperties; this.objectMapper = objectMapper; this.apiDocsCache = Caffeine.newBuilder() .maximumSize(10) .expireAfterWrite(Duration.ofMinutes(30)) .build(); } @GetMapping( value = \u0026#34;/{group}\u0026#34;, produces = MediaType.APPLICATION_JSON_VALUE ) public ResponseEntity\u0026lt;String\u0026gt; getCachedApiDocs( @PathVariable String group, HttpServletRequest request ) { String cacheKey = group + \u0026#34;_\u0026#34; + getVersionHash(); String cachedDocs = apiDocsCache.get(cacheKey, key -\u0026gt; { // ç”Ÿæˆæ–‡æª”çš„é‚è¼¯ return generateApiDocs(group); }); return ResponseEntity.ok() .cacheControl(CacheControl.maxAge(Duration.ofHours(1))) .eTag(calculateETag(cachedDocs)) .body(cachedDocs); } private String getVersionHash() { // åŸºæ–¼æ‡‰ç”¨ç¨‹å¼ç‰ˆæœ¬å’Œé…ç½®ç”Ÿæˆé›œæ¹Š String version = getClass().getPackage().getImplementationVersion(); return DigestUtils.md5Hex(version != null ? version : \u0026#34;dev\u0026#34;); } private String calculateETag(String content) { return \u0026#34;\\\u0026#34;\u0026#34; + DigestUtils.md5Hex(content) + \u0026#34;\\\u0026#34;\u0026#34;; } } 3. ç’°å¢ƒé…ç½®æœ€ä½³å¯¦è¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # application-dev.yml springdoc: api-docs: enabled: true swagger-ui: enabled: true try-it-out-enabled: true operations-sorter: method tags-sorter: alpha display-request-duration: true doc-expansion: list default-models-expand-depth: 2 # application-prod.yml springdoc: api-docs: enabled: false # ç”Ÿç”¢ç’°å¢ƒé—œé–‰ swagger-ui: enabled: false # ç”Ÿç”¢ç’°å¢ƒé—œé–‰ # application-staging.yml springdoc: api-docs: enabled: true swagger-ui: enabled: true try-it-out-enabled: false # æ¸¬è©¦ç’°å¢ƒç¦æ­¢ç›´æ¥æ¸¬è©¦ ç›£æ§èˆ‡åˆ†æ 1. API ä½¿ç”¨æƒ…æ³è¿½è¹¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 @Component public class ApiUsageTracker { private final MeterRegistry meterRegistry; private final Counter apiCallsCounter; private final Timer apiResponseTimer; public ApiUsageTracker(MeterRegistry meterRegistry) { this.meterRegistry = meterRegistry; this.apiCallsCounter = Counter.builder(\u0026#34;api.calls\u0026#34;) .description(\u0026#34;API å‘¼å«æ¬¡æ•¸\u0026#34;) .register(meterRegistry); this.apiResponseTimer = Timer.builder(\u0026#34;api.response.time\u0026#34;) .description(\u0026#34;API å›æ‡‰æ™‚é–“\u0026#34;) .register(meterRegistry); } @EventListener public void trackApiCall(ApiCallEvent event) { apiCallsCounter .tag(\u0026#34;endpoint\u0026#34;, event.getEndpoint()) .tag(\u0026#34;method\u0026#34;, event.getMethod()) .tag(\u0026#34;status\u0026#34;, String.valueOf(event.getStatusCode())) .increment(); apiResponseTimer .tag(\u0026#34;endpoint\u0026#34;, event.getEndpoint()) .record(event.getResponseTime(), TimeUnit.MILLISECONDS); } } @RestController @RequestMapping(\u0026#34;/api/v1/analytics\u0026#34;) @Tag(name = \u0026#34;API Analytics\u0026#34;, description = \u0026#34;API ä½¿ç”¨æƒ…æ³åˆ†æ\u0026#34;) public class ApiAnalyticsController { private final MeterRegistry meterRegistry; public ApiAnalyticsController(MeterRegistry meterRegistry) { this.meterRegistry = meterRegistry; } @GetMapping(\u0026#34;/metrics\u0026#34;) @Operation(summary = \u0026#34;ç²å– API ä½¿ç”¨çµ±è¨ˆ\u0026#34;) public ResponseEntity\u0026lt;ApiMetrics\u0026gt; getApiMetrics() { Map\u0026lt;String, Double\u0026gt; endpointCalls = new HashMap\u0026lt;\u0026gt;(); Map\u0026lt;String, Double\u0026gt; averageResponseTimes = new HashMap\u0026lt;\u0026gt;(); meterRegistry.getMeters().forEach(meter -\u0026gt; { if (meter instanceof Counter counter \u0026amp;\u0026amp; meter.getId().getName().equals(\u0026#34;api.calls\u0026#34;)) { String endpoint = meter.getId().getTag(\u0026#34;endpoint\u0026#34;); endpointCalls.put(endpoint, counter.count()); } if (meter instanceof Timer timer \u0026amp;\u0026amp; meter.getId().getName().equals(\u0026#34;api.response.time\u0026#34;)) { String endpoint = meter.getId().getTag(\u0026#34;endpoint\u0026#34;); averageResponseTimes.put(endpoint, timer.mean(TimeUnit.MILLISECONDS)); } }); ApiMetrics metrics = new ApiMetrics(endpointCalls, averageResponseTimes); return ResponseEntity.ok(metrics); } } ç¸½çµ Swagger/OpenAPI æ˜¯ç¾ä»£ API é–‹ç™¼çš„å¿…å‚™å·¥å…·ï¼Œæä¾›äº†å¾æ–‡æª”ç”Ÿæˆåˆ°æ¸¬è©¦ã€ç›£æ§çš„å®Œæ•´è§£æ±ºæ–¹æ¡ˆã€‚é€éæœ¬æ–‡çš„æ·±å…¥ä»‹ç´¹ï¼Œæˆ‘å€‘äº†è§£åˆ°ï¼š\næ ¸å¿ƒåƒ¹å€¼ è‡ªå‹•åŒ–æ–‡æª”ï¼šæ¸›å°‘æ‰‹å‹•ç¶­è­·æˆæœ¬ï¼Œç¢ºä¿æ–‡æª”èˆ‡ç¨‹å¼ç¢¼åŒæ­¥ äº’å‹•å¼æ¸¬è©¦ï¼šæä¾›å‹å–„çš„ API æ¸¬è©¦ä»‹é¢ åœ˜éšŠå”ä½œï¼šçµ±ä¸€çš„ API è¦ç¯„ä¿ƒé€²å‰å¾Œç«¯å”ä½œ ç¨‹å¼ç¢¼ç”Ÿæˆï¼šæ”¯æ´å¤šç¨®èªè¨€çš„å®¢æˆ¶ç«¯ SDK è‡ªå‹•ç”Ÿæˆ æœ€ä½³å¯¦è¸è¦é» é¸æ“‡ OpenAPI 3.0ï¼šä½¿ç”¨æœ€æ–°æ¨™æº–å’Œå·¥å…·éˆ å®Œæ•´çš„è¨»è§£ï¼šæä¾›è©³ç´°çš„æè¿°ã€ç¯„ä¾‹å’Œé©—è­‰è¦å‰‡ å®‰å…¨æ•´åˆï¼šæ­£ç¢ºé…ç½®èªè­‰å’Œæˆæ¬Šæ©Ÿåˆ¶ æ•ˆèƒ½å„ªåŒ–ï¼šé©ç•¶çš„å¿«å–å’Œæ–‡æª”åˆ†çµ„ç­–ç•¥ CI/CD æ•´åˆï¼šè‡ªå‹•åŒ–æ–‡æª”ç”Ÿæˆå’Œéƒ¨ç½²æµç¨‹ é€²éšæ‡‰ç”¨ å¥‘ç´„æ¸¬è©¦å’Œ API æ²»ç† å¤šç’°å¢ƒé…ç½®å’Œç‰ˆæœ¬ç®¡ç† ç›£æ§å’Œåˆ†æ API ä½¿ç”¨æƒ…æ³ èˆ‡å¾®æœå‹™æ¶æ§‹çš„æ•´åˆ æ­£ç¢ºå¯¦æ–½ Swagger/OpenAPI ä¸åƒ…èƒ½æå‡é–‹ç™¼æ•ˆç‡ï¼Œé‚„èƒ½å»ºç«‹æ¨™æº–åŒ–çš„ API é–‹ç™¼æµç¨‹ï¼Œç‚ºåœ˜éšŠå¸¶ä¾†é•·æœŸçš„æŠ€è¡“åƒ¹å€¼ã€‚\nåƒè€ƒè³‡æ–™ OpenAPI Specification SpringDoc OpenAPI Spring Boot OpenAPI Integration OpenAPI Generator Swagger UI Configuration ","permalink":"https://xinqilin.github.io/post/backend/swagger2/","tags":["Java","Spring","Swagger","OpenAPI","API","Documentation","SpringBoot","REST"],"title":"Swagger/OpenAPI å®Œæ•´æŒ‡å—ï¼šAPI æ–‡æª”åŒ–èˆ‡æ¸¬è©¦æœ€ä½³å¯¦è¸"},{"content":"RestTemplate ä¸€èˆ¬æ¯”è¼ƒå¸¸ç”¨çš„ rest æœå‹™ï¼Œæœ‰çš„äººè‡ªå·±å…¬å¸å¯èƒ½æœƒ base åœ¨ OKHttp ä¸Š åŒ…ä¸€å±¤ HttpHelper/ HttpUtil ä¹‹é¡çš„æ–¹ä¾¿ä½¿ç”¨ï¼Œä½†åœ¨ä¹‹å‰å…¬å¸ï¼Œæœ‰è‡ªå·±é–‹ç™¼ä¸€å€‹ microservice module æ™‚ ï¼Œæˆ‘ä¸€é–‹å§‹æ˜¯é¸ç”¨ RestTemplateï¼Œé€™é‚Šç´€éŒ„ä¸€ä¸‹ï¼Œæœªä¾†è¦ç”¨æ™‚èƒ½ç›´æ¥éš¨é–‹éš¨ç”¨ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 //config @Configuration public class RestTemplateConfig { @Bean public RestTemplate restTemplate(ClientHttpRequestFactory factory) { return new RestTemplate(factory); } @Bean public ClientHttpRequestFactory simpleClientHttpRequestFactory() { SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory(); factory.setReadTimeout(3000); factory.setConnectTimeout(3000); return factory; } } æ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 private final RestTemplate restTemplate; public XXService(RestTemplate restTemplate) { this.restTemplate = restTemplate; } //==============æˆ‘æ˜¯åˆ†éš”ç·š================ @AuroWired RestTemplate restTemplate; ä½¿ç”¨ exchange 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // ç¬¬ä¸€å€‹ç›´æ¥é–‹é–€è¦‹å±±ï¼Œæœ€å¸¸ç”¨çš„ exchangeï¼Œå…ˆé»é€²å»çœ‹ override æœ‰ç”šéº¼ä¸åŒçš„åƒæ•¸ public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(java.lang.String url, org.springframework.http.HttpMethod method, @org.springframework.lang.Nullable org.springframework.http.HttpEntity\u0026lt;?\u0026gt; requestEntity, java.lang.Class\u0026lt;T\u0026gt; responseType, java.lang.Object... uriVariables) throws org.springframework.web.client.RestClientException { /* compiled code */ } public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(java.lang.String url, org.springframework.http.HttpMethod method, @org.springframework.lang.Nullable org.springframework.http.HttpEntity\u0026lt;?\u0026gt; requestEntity, java.lang.Class\u0026lt;T\u0026gt; responseType, java.util.Map\u0026lt;java.lang.String,?\u0026gt; uriVariables) throws org.springframework.web.client.RestClientException { /* compiled code */ } public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(java.net.URI url, org.springframework.http.HttpMethod method, @org.springframework.lang.Nullable org.springframework.http.HttpEntity\u0026lt;?\u0026gt; requestEntity, java.lang.Class\u0026lt;T\u0026gt; responseType) throws org.springframework.web.client.RestClientException { /* compiled code */ } public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(java.lang.String url, org.springframework.http.HttpMethod method, @org.springframework.lang.Nullable org.springframework.http.HttpEntity\u0026lt;?\u0026gt; requestEntity, org.springframework.core.ParameterizedTypeReference\u0026lt;T\u0026gt; responseType, java.lang.Object... uriVariables) throws org.springframework.web.client.RestClientException { /* compiled code */ } public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(java.lang.String url, org.springframework.http.HttpMethod method, @org.springframework.lang.Nullable org.springframework.http.HttpEntity\u0026lt;?\u0026gt; requestEntity, org.springframework.core.ParameterizedTypeReference\u0026lt;T\u0026gt; responseType, java.util.Map\u0026lt;java.lang.String,?\u0026gt; uriVariables) throws org.springframework.web.client.RestClientException { /* compiled code */ } public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(java.net.URI url, org.springframework.http.HttpMethod method, @org.springframework.lang.Nullable org.springframework.http.HttpEntity\u0026lt;?\u0026gt; requestEntity, org.springframework.core.ParameterizedTypeReference\u0026lt;T\u0026gt; responseType) throws org.springframework.web.client.RestClientException { /* compiled code */ } public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(org.springframework.http.RequestEntity\u0026lt;?\u0026gt; entity, java.lang.Class\u0026lt;T\u0026gt; responseType) throws org.springframework.web.client.RestClientException { /* compiled code */ } public \u0026lt;T\u0026gt; org.springframework.http.ResponseEntity\u0026lt;T\u0026gt; exchange(org.springframework.http.RequestEntity\u0026lt;?\u0026gt; entity, org.springframework.core.ParameterizedTypeReference\u0026lt;T\u0026gt; responseType) throws org.springframework.web.client.RestClientException { /* compiled code */ } //å¤§è‡´ä¸Šä¾†èªªï¼Œå…¶å¯¦æˆ‘è‡ªå·±æœ€å¸¸ç”¨çš„æ˜¯ //å›ä¾†çš„æ˜¯ä¸€å€‹ mapperObject (String url, HttpMethod method, HttpEntity\u0026lt;?\u0026gt; requestEntity, Class\u0026lt;T\u0026gt; responseType) //å›ä¾†çš„æ˜¯ä¸€å€‹ List\u0026lt;mapperObject\u0026gt; (String url, HttpMethod method, HttpEntity\u0026lt;?\u0026gt; requestEntity, ParameterizedTypeReference\u0026lt;T\u0026gt; new ParameterizedTypeReference\u0026lt;List\u0026lt;æ±è¥¿\u0026gt;\u0026gt;\u0026gt;() {}) //é€™å…©å€‹ // exchange å·æ‡¶æ³• //æ²’ç”¨ç‰¹å®š POJO ä½¿ç”¨ JSONObject JSONObject jsonObj = new JSONObject(); jsonObj.put(\u0026#34;start\u0026#34;,1); jsonObj.put(\u0026#34;page\u0026#34;,5); HttpEntity\u0026lt;String\u0026gt; entity = new HttpEntity\u0026lt;\u0026gt;(jsonObj.toString(), headers); ResponseEntity\u0026lt;JSONObject\u0026gt; exchange = restTemplate.exchange(url, HttpMethod.GET, entity, JSONObject.class); System.out.println(exchange.getBody()); get 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // åœ¨ä¾†æ˜¯ Get è«‹æ±‚ ä¸­ æœ€å¸¸ç”¨çš„ ( å¦‚æœä¸ç”¨ exchange çš„è©±) // getForObject() åœ¨è£¡é¢åš ååºåˆ—åŒ–ï¼Œæ‰€ä»¥ä¸å†è‡ªå·±è™•ç† HTTP å›ä¾†çš„ ResponseEntity objectMapper to JavaObjectçš„å‹•ä½œ è€Œ getForEntity() å‰‡è¦è‡ªå·±è™•ç† public \u0026lt;T\u0026gt; T getForObject(String url, Class\u0026lt;T\u0026gt; responseType, Object... uriVariables){} public \u0026lt;T\u0026gt; T getForObject(String url, Class\u0026lt;T\u0026gt; responseType, Map\u0026lt;String, ?\u0026gt; uriVariables) public \u0026lt;T\u0026gt; T getForObject(URI url, Class\u0026lt;T\u0026gt; responseType) public \u0026lt;T\u0026gt; ResponseEntity\u0026lt;T\u0026gt; getForEntity(String url, Class\u0026lt;T\u0026gt; responseType, Object... uriVariables){} public \u0026lt;T\u0026gt; ResponseEntity\u0026lt;T\u0026gt; getForEntity(String url, Class\u0026lt;T\u0026gt; responseType, Map\u0026lt;String, ?\u0026gt; uriVariables){} public \u0026lt;T\u0026gt; ResponseEntity\u0026lt;T\u0026gt; getForEntity(URI url, Class\u0026lt;T\u0026gt; responseType){} //uriVariables æ˜¯ç”¨ä¾†å¸¶åœ¨urlä¸Šçš„åƒæ•¸ç”¨çš„ restTemplate.getForEntity(\u0026#34;http://bill_domain/{1}/{2}\u0026#34;, BillResponse.class,1,5); // Map\u0026lt;String, ?\u0026gt; uriVariables ä½¿ç”¨ Map\u0026lt;String,String\u0026gt; map = new HashMap(); map.put(\u0026#34;start\u0026#34;,\u0026#34;1\u0026#34;); map.put(\u0026#34;page\u0026#34;,\u0026#34;5\u0026#34;); restTemplate.getForObject(\u0026#34;http://bill_domain/{1}/{2}\u0026#34;, BillResponse.class, map); post 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public \u0026lt;T\u0026gt; T postForObject(String url, @Nullable Object request, Class\u0026lt;T\u0026gt; responseType, Object... uriVariables) throws RestClientException {} public \u0026lt;T\u0026gt; T postForObject(String url, @Nullable Object request, Class\u0026lt;T\u0026gt; responseType, Map\u0026lt;String, ?\u0026gt; uriVariables) throws RestClientException {} public \u0026lt;T\u0026gt; T postForObject(URI url, @Nullable Object request, Class\u0026lt;T\u0026gt; responseType) throws RestClientException {} //é€™é‚Šæ²’å•é¡Œè·Ÿä¸Šé¢ä¸€æ¨£ HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED); //é‡é»ä¾†äº† MultiValueMap ??? MultiValueMap\u0026lt;String, String\u0026gt; map= new LinkedMultiValueMap\u0026lt;\u0026gt;(); map.add(\u0026#34;email\u0026#34;, \u0026#34;bill@gmail.com\u0026#34;); HttpEntity\u0026lt;MultiValueMap\u0026lt;String, String\u0026gt;\u0026gt; request = new HttpEntity\u0026lt;\u0026gt;(map, headers); restTemplate.postForEntity( url, request , String.class ); ","permalink":"https://xinqilin.github.io/post/backend/resttemplate/","tags":["Spring","RestTemplate","HTTP Client","Java","Web Service","REST API"],"title":"Spring RestTemplate å®Œæ•´ä½¿ç”¨æŒ‡å—ï¼šHTTP å®¢æˆ¶ç«¯æ“ä½œèˆ‡é…ç½®å¯¦æˆ°"},{"content":"å‰è¨€ åœ¨ç¾ä»£è»Ÿé«”é–‹ç™¼ä¸­ï¼Œè¨­å®šæª”æ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€ç’°ã€‚å¾ Java çš„ Spring Boot æ¡†æ¶ (Spring MVC éå¾€ä½¿ç”¨å¤§é‡çš„ XML)ï¼Œåˆ°æˆ‘ç›®å‰ä½¿ç”¨çš„ Hugo éœæ…‹ç¶²ç«™ç”¢ç”Ÿå™¨ï¼Œéƒ½èƒ½çœ‹åˆ° .propertiesã€.yml æˆ– .toml ç­‰æ ¼å¼çš„èº«å½±ã€‚\né›–ç„¶é€™äº›æ ¼å¼å„æœ‰å„ªå‹¢ï¼Œä½†åœ¨é›²åŸç”Ÿé ˜åŸŸï¼Œç‰¹åˆ¥æ˜¯è¨­å®š Kubernetes (K8s) è³‡æºæ™‚ï¼ŒYAML (YAML Ain\u0026rsquo;t Markup Language) å·²æˆç‚ºäº‹å¯¦ä¸Šçš„æ¨™æº–ã€‚å› æ­¤ï¼ŒæŒæ¡ YAML çš„èªæ³•è‡³é—œé‡è¦ã€‚\næ ¸å¿ƒèªæ³• YAML çš„è¨­è¨ˆç›®æ¨™æ˜¯æ˜“æ–¼äººé¡é–±è®€å’Œæ’°å¯«ã€‚å®ƒçš„èªæ³•ä¸»è¦åŸºæ–¼ç¸®æ’å’Œå¹¾å€‹ç°¡å–®çš„ç¬¦è™Ÿã€‚\nè¨»è§£: ä½¿ç”¨ # è™Ÿæ¨™ç¤ºå–®è¡Œè¨»è§£ã€‚ æ–‡ä»¶é–‹é ­: ä½¿ç”¨ä¸‰å€‹é€£å­—è™Ÿ --- ä½œç‚ºæ–‡ä»¶çš„é–‹å§‹ç¬¦è™Ÿ (é¸ç”¨)ã€‚ éµå€¼å° (Key-Value Pair) YAML çš„åŸºæœ¬çµ„æˆå–®ä½æ˜¯éµå€¼å°ï¼Œæ ¼å¼ç‚º key: value (æ³¨æ„å†’è™Ÿå¾Œé¢éœ€è¦ä¸€å€‹ç©ºæ ¼)ã€‚\n1 apiVersion: v1 éšå±¤/ç‰©ä»¶ (Objects) é€éæ›è¡Œå’Œç¸®æ’ (å»ºè­°ä½¿ç”¨å…©å€‹ç©ºæ ¼) ä¾†è¡¨ç¤ºéšå±¤é—œä¿‚ã€‚é€™åœ¨ JSON ä¸­ç›¸ç•¶æ–¼ä¸€å€‹ç‰©ä»¶ã€‚\nä»¥ä¸‹ç¯„ä¾‹ç­‰åŒæ–¼ spring.datasource.username = \u0026quot;root\u0026quot;ã€‚\n1 2 3 spring: datasource: username: root é™£åˆ—/åˆ—è¡¨ (Arrays/Lists) é™£åˆ—æœ‰å…©ç¨®å¸¸è¦‹çš„è¡¨ç¤ºæ–¹å¼ï¼š\nå¡Šåºåˆ— (Block Sequence): é€éæ›è¡Œã€ç¸®æ’ï¼Œä¸¦åœ¨æ¯å€‹å…ƒç´ å‰åŠ ä¸Š - (é€£å­—è™Ÿ + ç©ºæ ¼) ä¾†è¡¨ç¤ºã€‚é€™ç¨®å½¢å¼æ›´æ˜“è®€ï¼Œä¸”å…ƒç´ å¯ä»¥æ˜¯è¤‡é›œçš„ç‰©ä»¶ã€‚\n1 2 3 args: - \u0026#34;parameter1\u0026#34; - \u0026#34;parameter2\u0026#34; æµåºåˆ— (Flow Sequence): å°‡æ‰€æœ‰å…ƒç´ æ”¾åœ¨æ–¹æ‹¬è™Ÿ [] ä¸­ï¼Œä¸¦ç”¨é€—è™Ÿåˆ†éš”ã€‚é©åˆè¡¨ç¤ºç°¡å–®çš„ä¸€ç¶­é™£åˆ—ã€‚\n1 2 items: [1, 2, 3, 4, 5] args: [\u0026#34;parameter1\u0026#34;, \u0026#34;parameter2\u0026#34;] ç¶œåˆç¯„ä¾‹ è®“æˆ‘å€‘ä¾†çœ‹ä¸€å€‹æ›´å®Œæ•´çš„ç¯„ä¾‹ï¼Œé€™å€‹ç¯„ä¾‹ä¾†è‡ª CloudBees YAML Tutorialã€‚\nYAML æ ¼å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --- doe: \u0026#34;a deer, a female deer\u0026#34; ray: \u0026#34;a drop of golden sun\u0026#34; pi: 3.14159 xmas: true french-hens: 3 calling-birds: - huey - dewey - louie - fred xmas-fifth-day: calling-birds: four french-hens: 3 golden-rings: 5 partridges: count: 1 location: \u0026#34;a pear tree\u0026#34; turtle-doves: two ç­‰æ•ˆçš„ JSON æ ¼å¼ é€™å€‹ YAML çµæ§‹å¯ä»¥å®Œå…¨å°æ‡‰åˆ°ä»¥ä¸‹çš„ JSON ç‰©ä»¶ï¼Œå±•ç¤ºäº†å…¶æ¸…æ™°çš„è³‡æ–™è¡¨é”èƒ½åŠ›ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 { \u0026#34;doe\u0026#34;: \u0026#34;a deer, a female deer\u0026#34;, \u0026#34;ray\u0026#34;: \u0026#34;a drop of golden sun\u0026#34;, \u0026#34;pi\u0026#34;: 3.14159, \u0026#34;xmas\u0026#34;: true, \u0026#34;french-hens\u0026#34;: 3, \u0026#34;calling-birds\u0026#34;: [ \u0026#34;huey\u0026#34;, \u0026#34;dewey\u0026#34;, \u0026#34;louie\u0026#34;, \u0026#34;fred\u0026#34; ], \u0026#34;xmas-fifth-day\u0026#34;: { \u0026#34;calling-birds\u0026#34;: \u0026#34;four\u0026#34;, \u0026#34;french-hens\u0026#34;: 3, \u0026#34;golden-rings\u0026#34;: 5, \u0026#34;partridges\u0026#34;: { \u0026#34;count\u0026#34;: 1, \u0026#34;location\u0026#34;: \u0026#34;a pear tree\u0026#34; }, \u0026#34;turtle-doves\u0026#34;: \u0026#34;two\u0026#34; } } åƒè€ƒè³‡æ–™ CloudBees YAML Tutorial èœé³¥æ•™ç¨‹ - YAML ç°¡ä»‹ ","permalink":"https://xinqilin.github.io/post/tools/yaml/","tags":["YAML","Configuration","Kubernetes","Spring Boot","DevOps"],"title":"YAML èªæ³•å¾å…¥é–€åˆ°å¯¦è¸"},{"content":"MergeSort Time complexity = log n * O(n) = O(n logn)\nMergeSort å¥—ä¸€å¥æŸ¯P è¬›çš„è©±ï¼Œå°å•é¡Œè§£æ±ºäº†ï¼Œå°±æ²’æœ‰å¤§å•é¡Œäº†\nå°‡ n å€‹å€‹æ•¸çš„é™£åˆ—ï¼Œå…ˆå·¦å³å„åˆ‡ä¸€åŠï¼Œä¸€ç›´åˆ‡ï¼Œåˆ‡åˆ°æœ€å°å–®ä½å¾Œï¼Œé–‹å§‹æ‹¿å…©æ¢è¢«åˆ‡çš„å–®ä½åšæ’åºã€åˆä½µ ! åˆä¹…å¿…åˆ†ï¼Œåˆ†ä¹…å¿…åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import java.util.*; public class MergeSort { public static void mergeSort(int[] array) { int[] workArray = new int[array.length]; Sort(array, workArray, 0, array.length - 1); } private static void Sort(int[] array, int[] workArray, int start, int end) { if (start \u0026gt;= end) return; //é¿å…æº¢ä½ start + end å¯èƒ½è¶…å‡ºå» int mid = start + (end - start)/2; Sort(array, workArray, start, mid); Sort(array, workArray, mid+1, end); Merge(array, workArray, start, mid, mid+1, end); } private static void Merge(int[] array, int[] workArray, int leftStart, int leftEnd, int rightStart, int rightEnd) { int leftPtr = leftStart, rightPtr = rightStart, index = leftStart; while (leftPtr \u0026lt;= leftEnd || rightPtr \u0026lt;= rightEnd) { if (leftPtr \u0026lt;= leftEnd \u0026amp;\u0026amp; rightPtr \u0026lt;= rightEnd) { //æœ€å¾Œä¸€æ’ if (array[rightPtr] \u0026lt; array[leftPtr]) workArray[index] = array[rightPtr++]; else workArray[index] = array[leftPtr++]; } else if (leftPtr \u0026lt;= leftEnd){ // å·¦é‚Šæ’åº workArray[index] = array[leftPtr++]; }else{ // å³é‚Šæ’åº workArray[index] = array[rightPtr++]; } ++index; } for (int i = leftStart; i \u0026lt; index; i++) array[i] = workArray[i]; } public static void main(String[] args) { int[] data = new int[10]; for (int i = 0; i \u0026lt; data.length; i++) { data[i] = (int) (Math.random() * 100); } System.out.println(\u0026#34;before: \u0026#34; + Arrays.toString(data)); mergeSort(data); System.out.println(\u0026#34;after: \u0026#34; + Arrays.toString(data)); } } ![MergeSortResult](images/Algorithm/mergeSort/mergeSortResult.png) æ¼”ç®—æ³•åºåˆ—ï¼Œæœƒç”¨ä¾†è¨˜éŒ„ç®—æ³•ï¼Œå†ç”¨è‡ªå·±æˆ–å…¶ä»–äººå¯«çš„ code æˆ‘èƒ½å¸æ”¶çš„åšç´€éŒ„ï¼Œç›®çš„æ˜¯è®“è‡ªå·±èƒ½å¤šçœ‹ï¼Œç„¶å¾ŒèƒŒèµ·ä¾†\n","permalink":"https://xinqilin.github.io/post/algorithm/mergesort/","tags":["Java","Algorithm"],"title":"MergeSort"},{"content":"CQRS (Command Query Responsibility Segregation) Command: å‘½ä»¤ æœƒå°ç³»çµ±ç”¢ç”Ÿã€å½±éŸ¿ã€çš„å‹•ä½œ æ²’æœ‰ã€çµæœã€å›å‚³ Query: æŸ¥è©¢ ä¸æœƒå°ç³»çµ±ç”¢ç”Ÿã€å½±éŸ¿ã€çš„å‹•ä½œ æœƒå›å‚³ã€çµæœã€ CQS åŸå‰‡çš„é™åˆ¶ ç•¶æŸ¥è©¢æ‰€å›å‚³çš„çµæœåªæœ‰çŸ­æš«çš„å­˜åœ¨æ„ç¾©æ™‚ä¾¿ä¸é©ç”¨ =\u0026gt; Queue.poll(), Stack.pop()\nCQS: é©ç”¨æ–¼æ–¹æ³• CQRS: é©ç”¨æ–¼æ¨¡å‹é¡åˆ¥\nEvent Sourcing 1 äº‹ä»¶æºï¼ˆEvent Sourcingï¼‰å¸¸èˆ‡ CQRS ä¸€ä½µæåŠï¼Œæ­¤è¨­è¨ˆæ¨¡å¼çš„ç”¨æ„ï¼Œæ ¹æ“š Martin Fowler çš„èªªæ³•ï¼Œæ˜¯è¦è®“æ‡‰ç”¨ç¨‹å¼èƒ½å¤ å°‡ç•°å‹•è³‡æ–™çš„äº‹ä»¶æŒ‰ç…§ç™¼ç”Ÿçš„æ™‚é–“é †åºå…¨éƒ¨è¨˜éŒ„ä¸‹ä¾†ï¼›å¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘å€‘ä¸åªèƒ½å¤ æŸ¥è©¢éå»ä»»æ„æ™‚é–“é»çš„è³‡æ–™ç‹€æ…‹ï¼Œä¹Ÿèƒ½å¤ é‡ç¾ç‰¹å®šæ™‚é–“ç¯„åœä¹‹é–“æ‰€ç™¼ç”Ÿçš„äº‹ä»¶éç¨‹ã€‚æ¯”å¦‚èªªï¼Œæ¡ç”¨ Event Sourcing çš„éŠ€è¡Œäº¤æ˜“ç³»çµ±å¯ä»¥è®“ä½¿ç”¨è€…å¾—çŸ¥å¸³æˆ¶é¤˜é¡æ˜¯å¦‚ä½•è®Šæˆç›®å‰çš„ç‹€æ…‹çš„ã€‚Event Sourcing å¸¸èˆ‡ CQRS ä¸€èµ·æ­é…é‹ç”¨ï¼Œä½†æ¡ç”¨ CQRS æ¨¡å¼çš„æ‡‰ç”¨ç¨‹å¼ä¸¦ä¸ä¸€å®šéœ€è¦ä½¿ç”¨ Event Sourcingã€‚ reference: huanlintalk\n","permalink":"https://xinqilin.github.io/post/architecture/cqrs/","tags":[],"title":"CQRS"},{"content":"Map Sort by value æœ‰é‘‘æ–¼ Bill ä¸Šä¸Šé€±åœ¨åˆ· LC æ™‚ é¡Œç›®é»æˆ‘!\nå¾ˆç°¡å–®çš„æ’åºå•é¡Œï¼Œé‚£æ™‚æˆ‘çš„æƒ³æ³•æ˜¯å…ˆæƒéä¸€æ¬¡ï¼Œå­˜ Map\u0026lt;String å­—ï¼ŒInteger å­—çš„é•·åº¦\u0026gt; ç„¶å¾Œåœ¨æ’åº Map Value å¾Œ å¾—åˆ°ç­”æ¡ˆ ä½†é‚£æ™‚æˆ‘å¿ƒä¸­æƒ³åˆ°çš„ map value æ’åºè »éº»ç…©çš„ï¼Œé€™é‚Šå…ˆè¨˜éŒ„ä¸€ä¸‹å¾Œä¾†æ¯”è¼ƒä¹¾æ·¨ä¸€é»çš„å¯«æ³•ï¼Œä»¥é˜²ä¹‹å¾Œå¿˜è¨˜\n1 2 3 4 5 6 7 8 // æƒç¬¬ä¸€æ¬¡ Map\u0026lt;String,Integer\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); for(String s: words){ map.put(s, map.getOrDefault(s, 0) + 1); } æ’åºæ–¹æ³•: 1 2 3 4 5 6 7 8 9 List\u0026lt;Map.Entry\u0026lt;String, Integer\u0026gt;\u0026gt; list = new ArrayList(map.entrySet()); Collections.sort(list, new Comparator\u0026lt;Map.Entry\u0026lt;String, Integer\u0026gt;\u0026gt;() { @Override public int compare(Map.Entry\u0026lt;String, Integer\u0026gt; e1, Map.Entry\u0026lt;String, Integer\u0026gt; e2) { return e2.getValue().compareTo(e1.getValue()); } }); é€™å€‹è·Ÿä¸Šé¢çš„å¹¾ä¹ä¸€æ¨£ï¼Œä¸€å€‹æ˜¯ list å­˜ Map.Entry åœ¨æ’åºå™¨ä¸­æ‹¿ Entry å‡ºä¾†æ¯”ï¼Œå¦ä¸€å€‹å­˜ map key ç„¶å¾Œæ¯æ¬¡éƒ½å¾ map æƒä¸€æ¬¡æ‹¿ value å‡ºä¾†æ¯”\n1 2 3 4 5 6 7 8 9 10 List\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(map.keySet()); Collections.sort(list,new Comparator\u0026lt;String\u0026gt;(){ public int compare(String s1, String s2){ int length = map.get(s2) - map.get(s1); if(length != 0) return length; return s1.compareTo(s2); } }); æœ€å¾Œ lambda å¯«æ³•\n1 2 3 4 5 6 List\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(map.keySet()); Collections.sort(list, (s1, s2)-\u0026gt; { return (map.get(s2) == map.get(s1)) ? s1.compareTo(s2) : (map.get(s2)- map.get(s1)); }); ","permalink":"https://xinqilin.github.io/post/backend/map-sort-by-value/","tags":["Java","Map","Sorting","Collections","Stream API","Performance"],"title":"Java Map æŒ‰ Value æ’åºï¼šå¤šç¨®å¯¦ä½œæ–¹å¼èˆ‡æ•ˆèƒ½æ¯”è¼ƒ"},{"content":"Git tag\n1 2 3 4 5 6 7 8 9 git tag deploy/{env_name}/{feature_name} git push origin deploy/{env_name}/{feature_name} git tag -d/--delete deploy/{env_name}/{feature_name} git push origin --delete deploy/{env_name}/{feature_name} git push origin :{tagname} git describe --always HEAD remote info\n1 2 git remote show origin ","permalink":"https://xinqilin.github.io/post/tools/git/","tags":[],"title":"Git"},{"content":"æ¦‚è¿° digï¼ˆDomain Information Groperï¼‰æ˜¯ä¸€å€‹åŠŸèƒ½å¼·å¤§çš„å‘½ä»¤è¡Œ DNS æŸ¥è©¢å·¥å…·ï¼Œç”¨æ–¼åŸ·è¡Œ DNS æŸ¥è©¢ä¸¦é¡¯ç¤ºè©³ç´°çš„æŸ¥è©¢çµæœã€‚å®ƒæ˜¯ç¶²è·¯ç®¡ç†å“¡ã€ç³»çµ±ç®¡ç†å“¡å’Œé–‹ç™¼è€…é€²è¡Œ DNS è¨ºæ–·ã€ç¶²è·¯æ•…éšœæ’é™¤å’ŒåŸŸåè§£æåˆ†æçš„å¿…å‚™å·¥å…·ã€‚\næ ¸å¿ƒç‰¹å¾µ éˆæ´»çš„æŸ¥è©¢é¸é …ï¼šæ”¯æ´å„ç¨® DNS è¨˜éŒ„é¡å‹æŸ¥è©¢ è©³ç´°çš„è¼¸å‡ºè³‡è¨Šï¼šæä¾›å®Œæ•´çš„ DNS éŸ¿æ‡‰è©³æƒ… å¤šç¨®è¼¸å‡ºæ ¼å¼ï¼šæ”¯æ´ç°¡æ½”ã€è©³ç´°å’Œè‡ªè¨‚æ ¼å¼ å¼·å¤§çš„è¨ºæ–·åŠŸèƒ½ï¼šè¿½è¹¤æŸ¥è©¢è·¯å¾‘å’Œæ•ˆèƒ½åˆ†æ è…³æœ¬å‹å¥½ï¼šé©åˆè‡ªå‹•åŒ–å’Œæ‰¹æ¬¡è™•ç† å®‰è£èˆ‡ç’°å¢ƒæº–å‚™ å„ç³»çµ±å®‰è£æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 # Ubuntu/Debian sudo apt-get install dnsutils # CentOS/RHEL/Fedora sudo yum install bind-utils # CentOS 7 åŠä»¥ä¸‹ sudo dnf install bind-utils # Fedora/CentOS 8+ # macOS (é€šå¸¸å·²é è£) brew install bind # é©—è­‰å®‰è£ dig -v åŸºæœ¬èªæ³• 1 dig [@server] [domain] [type] [options] åŸºæœ¬ä½¿ç”¨ ç°¡å–® DNS æŸ¥è©¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åŸºæœ¬æŸ¥è©¢ï¼ˆA è¨˜éŒ„ï¼‰ dig google.com # æŒ‡å®šè¨˜éŒ„é¡å‹ dig google.com A dig google.com AAAA dig google.com MX dig google.com NS dig google.com TXT # ç°¡æ½”è¼¸å‡º dig google.com +short # åªé¡¯ç¤ºç­”æ¡ˆéƒ¨åˆ† dig google.com +noall +answer æŸ¥è©¢çµæœè§£æ æ¨™æº– dig è¼¸å‡ºåŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 dig www.google.com ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.16.1 \u0026lt;\u0026lt;\u0026gt;\u0026gt; www.google.com ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 12345 ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ;; QUESTION SECTION: # æŸ¥è©¢å•é¡Œ ;www.google.com. IN A ;; ANSWER SECTION: # æŸ¥è©¢ç­”æ¡ˆ www.google.com. 299 IN A 142.250.191.68 ;; Query time: 15 msec # æŸ¥è©¢æ™‚é–“ ;; SERVER: 8.8.8.8#53(8.8.8.8) # DNS ä¼ºæœå™¨ ;; WHEN: Mon Jan 08 21:40:50 CST 2024 ;; MSG SIZE rcvd: 59 # éŸ¿æ‡‰å¤§å° DNS è¨˜éŒ„é¡å‹æŸ¥è©¢ A å’Œ AAAA è¨˜éŒ„ 1 2 3 4 5 6 7 8 9 10 # IPv4 åœ°å€è¨˜éŒ„ï¼ˆAï¼‰ dig example.com A dig example.com A +short # IPv6 åœ°å€è¨˜éŒ„ï¼ˆAAAAï¼‰ dig example.com AAAA dig example.com AAAA +short # åŒæ™‚æŸ¥è©¢ A å’Œ AAAA dig example.com A AAAA MX è¨˜éŒ„ï¼ˆéƒµä»¶äº¤æ›ï¼‰ 1 2 3 4 5 6 7 8 9 # æŸ¥è©¢éƒµä»¶ä¼ºæœå™¨ dig google.com MX dig google.com MX +short # æŸ¥è©¢ç‰¹å®šåŸŸåçš„éƒµä»¶é…ç½® dig gmail.com MX +noall +answer # é¡¯ç¤ºå„ªå…ˆç´šå’Œéƒµä»¶ä¼ºæœå™¨ dig yahoo.com MX | grep -E \u0026#34;^[^;].*MX\u0026#34; NS è¨˜éŒ„ï¼ˆåç¨±ä¼ºæœå™¨ï¼‰ 1 2 3 4 5 6 7 8 9 # æŸ¥è©¢åŸŸåä¼ºæœå™¨ dig google.com NS dig google.com NS +short # æŸ¥è©¢æ ¹åŸŸåä¼ºæœå™¨ dig . NS +short # æŸ¥è©¢ç‰¹å®š TLD çš„åç¨±ä¼ºæœå™¨ dig com NS +short TXT è¨˜éŒ„ï¼ˆæ–‡æœ¬è¨˜éŒ„ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 # æŸ¥è©¢ TXT è¨˜éŒ„ dig google.com TXT dig google.com TXT +short # æŸ¥è©¢ SPF è¨˜éŒ„ dig _spf.google.com TXT # æŸ¥è©¢ DKIM è¨˜éŒ„ dig selector1._domainkey.example.com TXT # æŸ¥è©¢ DMARC è¨˜éŒ„ dig _dmarc.example.com TXT SOA è¨˜éŒ„ï¼ˆæˆæ¬Šèµ·å§‹ï¼‰ 1 2 3 4 5 6 # æŸ¥è©¢ SOA è¨˜éŒ„ dig google.com SOA dig google.com SOA +short # è©³ç´° SOA ä¿¡æ¯ dig google.com SOA +noall +answer +multiline CNAME è¨˜éŒ„ï¼ˆåˆ¥åï¼‰ 1 2 3 4 5 6 # æŸ¥è©¢ CNAME è¨˜éŒ„ dig www.github.com CNAME dig www.github.com CNAME +short # è¿½è¹¤ CNAME éˆ dig www.example.com +trace PTR è¨˜éŒ„ï¼ˆåå‘æŸ¥è©¢ï¼‰ 1 2 3 4 5 6 7 8 9 # åå‘ DNS æŸ¥è©¢ dig -x 8.8.8.8 dig -x 8.8.8.8 +short # æ‰‹å‹• PTR æŸ¥è©¢ dig 8.8.8.8.in-addr.arpa PTR # IPv6 åå‘æŸ¥è©¢ dig -x 2001:4860:4860::8888 é€²éšæŸ¥è©¢é¸é … æŒ‡å®š DNS ä¼ºæœå™¨ 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨ Google DNS dig @8.8.8.8 google.com # ä½¿ç”¨ Cloudflare DNS dig @1.1.1.1 google.com # ä½¿ç”¨å¤šå€‹ DNS ä¼ºæœå™¨æ¯”è¼ƒ dig @8.8.8.8 google.com +short dig @1.1.1.1 google.com +short dig @208.67.222.222 google.com +short # OpenDNS æŸ¥è©¢è¿½è¹¤ 1 2 3 4 5 6 7 8 9 10 11 # è¿½è¹¤ DNS è§£æè·¯å¾‘ dig google.com +trace # è¿½è¹¤ç‰¹å®šè¨˜éŒ„é¡å‹ dig google.com MX +trace # ç°¡åŒ–è¿½è¹¤è¼¸å‡º dig google.com +trace +short # è¿½è¹¤ä¸¦é¡¯ç¤ºæ‰€æœ‰æ­¥é©Ÿ dig google.com +trace +additional +all è¼¸å‡ºæ ¼å¼æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 # ç°¡æ½”è¼¸å‡º dig google.com +short dig google.com +noall +answer # å¤šè¡Œæ ¼å¼åŒ–è¼¸å‡º dig google.com SOA +multiline # éš±è—ç‰¹å®šéƒ¨åˆ† dig google.com +nocomments +noquestion +noauthority +noadditional +nostats # è‡ªè¨‚è¼¸å‡ºçµ„åˆ dig google.com +nocmd +noall +answer +multiline ç¶²è·¯è¨ºæ–·èˆ‡æ•…éšœæ’é™¤ DNS æ•ˆèƒ½æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ¸¬é‡æŸ¥è©¢æ™‚é–“ dig google.com | grep \u0026#34;Query time\u0026#34; # æ‰¹æ¬¡æ•ˆèƒ½æ¸¬è©¦ for i in {1..10}; do dig google.com +stats | grep \u0026#34;Query time\u0026#34; done # æ¯”è¼ƒä¸åŒ DNS ä¼ºæœå™¨æ•ˆèƒ½ dns_servers=(\u0026#34;8.8.8.8\u0026#34; \u0026#34;1.1.1.1\u0026#34; \u0026#34;208.67.222.222\u0026#34;) for server in \u0026#34;${dns_servers[@]}\u0026#34;; do echo \u0026#34;Testing $server:\u0026#34; dig @$server google.com +stats | grep \u0026#34;Query time\u0026#34; done DNS å¿«å–åˆ†æ 1 2 3 4 5 6 7 8 # æª¢æŸ¥ TTL å€¼ dig google.com +noall +answer # ç›£æ§ TTL è®ŠåŒ– watch -n 5 \u0026#39;dig google.com +noall +answer\u0026#39; # æª¢æŸ¥å¿«å–ç‹€æ…‹ dig google.com +norecurse åŸŸåå¯ç”¨æ€§æª¢æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æª¢æŸ¥åŸŸåæ˜¯å¦å­˜åœ¨ dig example.com ANY +short # æª¢æŸ¥åŸŸåç‹€æ…‹ dig example.com +short \u0026gt; /dev/null \u0026amp;\u0026amp; echo \u0026#34;Domain exists\u0026#34; || echo \u0026#34;Domain not found\u0026#34; # æ‰¹æ¬¡åŸŸåæª¢æŸ¥ domains=(\u0026#34;google.com\u0026#34; \u0026#34;example.com\u0026#34; \u0026#34;nonexistent-domain-12345.com\u0026#34;) for domain in \u0026#34;${domains[@]}\u0026#34;; do if dig \u0026#34;$domain\u0026#34; +short \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;$domain: EXISTS\u0026#34; else echo \u0026#34;$domain: NOT FOUND\u0026#34; fi done DNSSEC é©—è­‰ 1 2 3 4 5 6 7 8 9 10 11 # æª¢æŸ¥ DNSSEC æ”¯æ´ dig google.com +dnssec +multiline # é©—è­‰ DNSSEC ç°½å dig google.com DNSKEY +dnssec # æª¢æŸ¥ DS è¨˜éŒ„ dig google.com DS +dnssec # é©—è­‰éˆ dig +trace +dnssec google.com å¯¦æˆ°æ‡‰ç”¨å ´æ™¯ 1. éƒµä»¶ä¼ºæœå™¨è¨ºæ–· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # mail_server_check.sh - éƒµä»¶ä¼ºæœå™¨è¨ºæ–·è…³æœ¬ check_mail_server() { local domain=\u0026#34;$1\u0026#34; echo \u0026#34;=== Mail Server Diagnosis for $domain ===\u0026#34; # æª¢æŸ¥ MX è¨˜éŒ„ echo \u0026#34;MX Records:\u0026#34; dig \u0026#34;$domain\u0026#34; MX +noall +answer # æª¢æŸ¥ SPF è¨˜éŒ„ echo -e \u0026#34;\\nSPF Record:\u0026#34; dig \u0026#34;$domain\u0026#34; TXT +short | grep -i spf # æª¢æŸ¥ DMARC è¨˜éŒ„ echo -e \u0026#34;\\nDMARC Record:\u0026#34; dig \u0026#34;_dmarc.$domain\u0026#34; TXT +short # æª¢æŸ¥å¸¸è¦‹ DKIM é¸æ“‡å™¨ echo -e \u0026#34;\\nDKIM Records:\u0026#34; selectors=(\u0026#34;default\u0026#34; \u0026#34;selector1\u0026#34; \u0026#34;selector2\u0026#34; \u0026#34;google\u0026#34; \u0026#34;k1\u0026#34;) for selector in \u0026#34;${selectors[@]}\u0026#34;; do result=$(dig \u0026#34;${selector}._domainkey.$domain\u0026#34; TXT +short 2\u0026gt;/dev/null) if [ -n \u0026#34;$result\u0026#34; ]; then echo \u0026#34;$selector: $result\u0026#34; fi done } # ä½¿ç”¨ç¯„ä¾‹ check_mail_server \u0026#34;gmail.com\u0026#34; 2. ç¶²ç«™å¯ç”¨æ€§ç›£æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #!/bin/bash # website_dns_monitor.sh - ç¶²ç«™ DNS ç›£æ§è…³æœ¬ monitor_website() { local domain=\u0026#34;$1\u0026#34; local log_file=\u0026#34;${2:-dns_monitor.log}\u0026#34; timestamp=$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) # æª¢æŸ¥ A è¨˜éŒ„ a_record=$(dig \u0026#34;$domain\u0026#34; A +short | head -1) # æª¢æŸ¥ AAAA è¨˜éŒ„ aaaa_record=$(dig \u0026#34;$domain\u0026#34; AAAA +short | head -1) # æ¸¬é‡æŸ¥è©¢æ™‚é–“ query_time=$(dig \u0026#34;$domain\u0026#34; | grep \u0026#34;Query time\u0026#34; | awk \u0026#39;{print $4}\u0026#39;) # æª¢æŸ¥ DNS ä¼ºæœå™¨éŸ¿æ‡‰ dns_server=$(dig \u0026#34;$domain\u0026#34; | grep \u0026#34;SERVER:\u0026#34; | awk \u0026#39;{print $2}\u0026#39;) # è¨˜éŒ„çµæœ log_entry=\u0026#34;$timestamp | $domain | A: $a_record | AAAA: $aaaa_record | Time: ${query_time}ms | Server: $dns_server\u0026#34; echo \u0026#34;$log_entry\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; # æª¢æŸ¥ç•°å¸¸ if [ -z \u0026#34;$a_record\u0026#34; ]; then echo \u0026#34;WARNING: No A record found for $domain\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; fi if [ \u0026#34;${query_time:-0}\u0026#34; -gt 1000 ]; then echo \u0026#34;WARNING: Slow DNS response (${query_time}ms) for $domain\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; fi } # ç›£æ§å¤šå€‹ç¶²ç«™ websites=(\u0026#34;google.com\u0026#34; \u0026#34;github.com\u0026#34; \u0026#34;stackoverflow.com\u0026#34;) for site in \u0026#34;${websites[@]}\u0026#34;; do monitor_website \u0026#34;$site\u0026#34; done 3. DNS ä¼ºæœå™¨æ•ˆèƒ½æ¯”è¼ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 #!/bin/bash # dns_performance_test.sh - DNS æ•ˆèƒ½æ¸¬è©¦è…³æœ¬ dns_performance_test() { local domain=\u0026#34;${1:-google.com}\u0026#34; local test_count=\u0026#34;${2:-10}\u0026#34; # DNS ä¼ºæœå™¨åˆ—è¡¨ declare -A dns_servers=( [\u0026#34;Google\u0026#34;]=\u0026#34;8.8.8.8\u0026#34; [\u0026#34;Cloudflare\u0026#34;]=\u0026#34;1.1.1.1\u0026#34; [\u0026#34;OpenDNS\u0026#34;]=\u0026#34;208.67.222.222\u0026#34; [\u0026#34;Quad9\u0026#34;]=\u0026#34;9.9.9.9\u0026#34; ) echo \u0026#34;DNS Performance Test for $domain\u0026#34; echo \u0026#34;==================================\u0026#34; for name in \u0026#34;${!dns_servers[@]}\u0026#34;; do server=\u0026#34;${dns_servers[$name]}\u0026#34; echo -e \u0026#34;\\nTesting $name ($server):\u0026#34; total_time=0 successful_queries=0 for i in $(seq 1 $test_count); do query_time=$(dig @\u0026#34;$server\u0026#34; \u0026#34;$domain\u0026#34; +stats 2\u0026gt;/dev/null | grep \u0026#34;Query time\u0026#34; | awk \u0026#39;{print $4}\u0026#39;) if [ -n \u0026#34;$query_time\u0026#34; ]; then total_time=$((total_time + query_time)) successful_queries=$((successful_queries + 1)) echo -n \u0026#34;.\u0026#34; else echo -n \u0026#34;x\u0026#34; fi done if [ $successful_queries -gt 0 ]; then average_time=$((total_time / successful_queries)) echo -e \u0026#34;\\nAverage: ${average_time}ms (${successful_queries}/${test_count} successful)\u0026#34; else echo -e \u0026#34;\\nFailed: No successful queries\u0026#34; fi done } # åŸ·è¡Œæ¸¬è©¦ dns_performance_test \u0026#34;google.com\u0026#34; 5 4. åŸŸåè®Šæ›´è¿½è¹¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 #!/bin/bash # dns_change_tracker.sh - DNS è®Šæ›´è¿½è¹¤è…³æœ¬ track_dns_changes() { local domain=\u0026#34;$1\u0026#34; local record_type=\u0026#34;${2:-A}\u0026#34; local interval=\u0026#34;${3:-300}\u0026#34; # 5åˆ†é˜ local log_file=\u0026#34;dns_changes_${domain}_${record_type}.log\u0026#34; echo \u0026#34;Tracking DNS changes for $domain ($record_type record)\u0026#34; echo \u0026#34;Log file: $log_file\u0026#34; previous_result=\u0026#34;\u0026#34; while true; do timestamp=$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) current_result=$(dig \u0026#34;$domain\u0026#34; \u0026#34;$record_type\u0026#34; +short | sort | tr \u0026#39;\\n\u0026#39; \u0026#39; \u0026#39;) if [ \u0026#34;$current_result\u0026#34; != \u0026#34;$previous_result\u0026#34; ]; then if [ -n \u0026#34;$previous_result\u0026#34; ]; then echo \u0026#34;$timestamp | CHANGE DETECTED\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; echo \u0026#34;$timestamp | Old: $previous_result\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; echo \u0026#34;$timestamp | New: $current_result\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; echo \u0026#34;$timestamp | ---\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; else echo \u0026#34;$timestamp | Initial: $current_result\u0026#34; | tee -a \u0026#34;$log_file\u0026#34; fi previous_result=\u0026#34;$current_result\u0026#34; else echo \u0026#34;$timestamp | No change: $current_result\u0026#34; fi sleep \u0026#34;$interval\u0026#34; done } # ä½¿ç”¨ç¯„ä¾‹ # track_dns_changes \u0026#34;example.com\u0026#34; \u0026#34;A\u0026#34; 60 5. æ‰¹æ¬¡åŸŸååˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 #!/bin/bash # batch_domain_analysis.sh - æ‰¹æ¬¡åŸŸååˆ†æè…³æœ¬ analyze_domains() { local domain_file=\u0026#34;$1\u0026#34; local output_file=\u0026#34;${2:-domain_analysis_$(date +%Y%m%d_%H%M%S).csv}\u0026#34; # CSV æ¨™é¡Œ echo \u0026#34;Domain,A_Record,MX_Record,NS_Record,TXT_Count,Query_Time_ms,Status\u0026#34; \u0026gt; \u0026#34;$output_file\u0026#34; while IFS= read -r domain; do # è·³éç©ºè¡Œå’Œè¨»è§£ [[ -z \u0026#34;$domain\u0026#34; || \u0026#34;$domain\u0026#34; =~ ^[[:space:]]*# ]] \u0026amp;\u0026amp; continue echo \u0026#34;Analyzing: $domain\u0026#34; # æŸ¥è©¢å„ç¨®è¨˜éŒ„ a_record=$(dig \u0026#34;$domain\u0026#34; A +short | head -1) mx_record=$(dig \u0026#34;$domain\u0026#34; MX +short | head -1 | awk \u0026#39;{print $2}\u0026#39;) ns_record=$(dig \u0026#34;$domain\u0026#34; NS +short | head -1) txt_count=$(dig \u0026#34;$domain\u0026#34; TXT +short | wc -l) # æ¸¬é‡æŸ¥è©¢æ™‚é–“ query_time=$(dig \u0026#34;$domain\u0026#34; | grep \u0026#34;Query time\u0026#34; | awk \u0026#39;{print $4}\u0026#39;) # åˆ¤æ–·ç‹€æ…‹ if [ -n \u0026#34;$a_record\u0026#34; ]; then status=\u0026#34;Active\u0026#34; elif dig \u0026#34;$domain\u0026#34; +short \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then status=\u0026#34;Registered\u0026#34; else status=\u0026#34;Not Found\u0026#34; fi # å¯«å…¥ CSV echo \u0026#34;$domain,$a_record,$mx_record,$ns_record,$txt_count,$query_time,$status\u0026#34; \u0026gt;\u0026gt; \u0026#34;$output_file\u0026#34; done \u0026lt; \u0026#34;$domain_file\u0026#34; echo \u0026#34;Analysis complete. Results saved to: $output_file\u0026#34; } # å»ºç«‹ç¯„ä¾‹åŸŸååˆ—è¡¨ cat \u0026gt; domains.txt \u0026lt;\u0026lt; EOF google.com github.com stackoverflow.com example.com nonexistent-domain-12345.com EOF # åŸ·è¡Œåˆ†æ analyze_domains \u0026#34;domains.txt\u0026#34; é€²éšæŠ€å·§èˆ‡æœ€ä½³åŒ– 1. è‡ªè¨‚æŸ¥è©¢è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #!/bin/bash # dig_wrapper.sh - dig åŒ…è£å™¨è…³æœ¬ # å½©è‰²è¼¸å‡º RED=\u0026#39;\\033[0;31m\u0026#39; GREEN=\u0026#39;\\033[0;32m\u0026#39; YELLOW=\u0026#39;\\033[1;33m\u0026#39; BLUE=\u0026#39;\\033[0;34m\u0026#39; NC=\u0026#39;\\033[0m\u0026#39; # No Color enhanced_dig() { local domain=\u0026#34;$1\u0026#34; local record_type=\u0026#34;${2:-A}\u0026#34; echo -e \u0026#34;${BLUE}=== Enhanced DNS Query: $domain ($record_type) ===${NC}\u0026#34; # åŸºæœ¬æŸ¥è©¢ echo -e \u0026#34;\\n${GREEN}Basic Query:${NC}\u0026#34; dig \u0026#34;$domain\u0026#34; \u0026#34;$record_type\u0026#34; +noall +answer # æŸ¥è©¢æ™‚é–“å’Œä¼ºæœå™¨è³‡è¨Š echo -e \u0026#34;\\n${GREEN}Performance Info:${NC}\u0026#34; dig \u0026#34;$domain\u0026#34; \u0026#34;$record_type\u0026#34; | grep -E \u0026#34;(Query time|SERVER:)\u0026#34; # æ¬Šå¨ä¼ºæœå™¨æŸ¥è©¢ echo -e \u0026#34;\\n${GREEN}Authoritative Servers:${NC}\u0026#34; dig \u0026#34;$domain\u0026#34; NS +short # å¦‚æœæ˜¯ A è¨˜éŒ„ï¼Œä¹Ÿé¡¯ç¤ºåå‘æŸ¥è©¢ if [ \u0026#34;$record_type\u0026#34; = \u0026#34;A\u0026#34; ]; then echo -e \u0026#34;\\n${GREEN}Reverse DNS:${NC}\u0026#34; ip=$(dig \u0026#34;$domain\u0026#34; A +short | head -1) if [ -n \u0026#34;$ip\u0026#34; ]; then dig -x \u0026#34;$ip\u0026#34; +short fi fi } # ä½¿ç”¨ç¯„ä¾‹ enhanced_dig \u0026#34;google.com\u0026#34; \u0026#34;A\u0026#34; 2. DNS å¥åº·æª¢æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 #!/bin/bash # dns_health_check.sh - DNS å¥åº·æª¢æŸ¥è…³æœ¬ dns_health_check() { local domain=\u0026#34;$1\u0026#34; echo \u0026#34;DNS Health Check for: $domain\u0026#34; echo \u0026#34;=============================\u0026#34; # æª¢æŸ¥é …ç›®è¨ˆæ•¸ local total_checks=0 local passed_checks=0 # 1. æª¢æŸ¥ A è¨˜éŒ„ echo -n \u0026#34;Checking A record... \u0026#34; total_checks=$((total_checks + 1)) if dig \u0026#34;$domain\u0026#34; A +short \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;âœ“ PASS\u0026#34; passed_checks=$((passed_checks + 1)) else echo \u0026#34;âœ— FAIL\u0026#34; fi # 2. æª¢æŸ¥ NS è¨˜éŒ„ echo -n \u0026#34;Checking NS records... \u0026#34; total_checks=$((total_checks + 1)) ns_count=$(dig \u0026#34;$domain\u0026#34; NS +short | wc -l) if [ \u0026#34;$ns_count\u0026#34; -ge 2 ]; then echo \u0026#34;âœ“ PASS ($ns_count nameservers)\u0026#34; passed_checks=$((passed_checks + 1)) else echo \u0026#34;âœ— FAIL (only $ns_count nameserver)\u0026#34; fi # 3. æª¢æŸ¥ SOA è¨˜éŒ„ echo -n \u0026#34;Checking SOA record... \u0026#34; total_checks=$((total_checks + 1)) if dig \u0026#34;$domain\u0026#34; SOA +short \u0026gt; /dev/null 2\u0026gt;\u0026amp;1; then echo \u0026#34;âœ“ PASS\u0026#34; passed_checks=$((passed_checks + 1)) else echo \u0026#34;âœ— FAIL\u0026#34; fi # 4. æª¢æŸ¥æŸ¥è©¢æ™‚é–“ echo -n \u0026#34;Checking query performance... \u0026#34; total_checks=$((total_checks + 1)) query_time=$(dig \u0026#34;$domain\u0026#34; | grep \u0026#34;Query time\u0026#34; | awk \u0026#39;{print $4}\u0026#39;) if [ \u0026#34;${query_time:-9999}\u0026#34; -lt 1000 ]; then echo \u0026#34;âœ“ PASS (${query_time}ms)\u0026#34; passed_checks=$((passed_checks + 1)) else echo \u0026#34;âœ— FAIL (${query_time}ms - too slow)\u0026#34; fi # 5. æª¢æŸ¥æ¬Šå¨ä¼ºæœå™¨ä¸€è‡´æ€§ echo -n \u0026#34;Checking authoritative server consistency... \u0026#34; total_checks=$((total_checks + 1)) ns_servers=$(dig \u0026#34;$domain\u0026#34; NS +short) consistent=true if [ -n \u0026#34;$ns_servers\u0026#34; ]; then first_result=$(dig @$(echo \u0026#34;$ns_servers\u0026#34; | head -1) \u0026#34;$domain\u0026#34; A +short | sort) while IFS= read -r server; do current_result=$(dig @\u0026#34;$server\u0026#34; \u0026#34;$domain\u0026#34; A +short | sort) if [ \u0026#34;$current_result\u0026#34; != \u0026#34;$first_result\u0026#34; ]; then consistent=false break fi done \u0026lt;\u0026lt;\u0026lt; \u0026#34;$ns_servers\u0026#34; if $consistent; then echo \u0026#34;âœ“ PASS\u0026#34; passed_checks=$((passed_checks + 1)) else echo \u0026#34;âœ— FAIL (inconsistent results)\u0026#34; fi else echo \u0026#34;âœ— FAIL (no nameservers found)\u0026#34; fi # ç¸½çµ echo echo \u0026#34;Health Check Summary: $passed_checks/$total_checks passed\u0026#34; if [ \u0026#34;$passed_checks\u0026#34; -eq \u0026#34;$total_checks\u0026#34; ]; then echo \u0026#34;Status: âœ“ HEALTHY\u0026#34; return 0 else echo \u0026#34;Status: âœ— ISSUES DETECTED\u0026#34; return 1 fi } # ä½¿ç”¨ç¯„ä¾‹ dns_health_check \u0026#34;google.com\u0026#34; 3. é…ç½®æª”æ¡ˆç®¡ç† å»ºç«‹ ~/.digrc é…ç½®æª”æ¡ˆï¼š\n1 2 3 4 # ~/.digrc - dig é è¨­é…ç½® +noall +answer +time=5 +tries=3 æˆ–ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ï¼š\n1 2 3 4 5 6 7 # åœ¨ ~/.bashrc æˆ– ~/.zshrc ä¸­æ·»åŠ  export DIG_DEFAULT_OPTS=\u0026#34;+short +time=3\u0026#34; # ä½¿ç”¨åˆ¥å alias digs=\u0026#39;dig +short\u0026#39; alias digt=\u0026#39;dig +trace\u0026#39; alias digx=\u0026#39;dig +short +time=1\u0026#39; å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ 1. æŸ¥è©¢è¶…æ™‚å•é¡Œ 1 2 3 4 5 6 7 8 # èª¿æ•´è¶…æ™‚è¨­å®š dig google.com +time=10 +tries=3 # ä½¿ç”¨ TCP æŸ¥è©¢ dig google.com +tcp # æª¢æŸ¥ç¶²è·¯é€£æ¥ dig google.com +trace | grep -E \u0026#34;(SERVFAIL|TIMEOUT)\u0026#34; 2. DNS ä¼ºæœå™¨å•é¡Œ 1 2 3 4 5 6 7 8 # æ¸¬è©¦å¤šå€‹ DNS ä¼ºæœå™¨ dns_test() { local domain=\u0026#34;$1\u0026#34; for server in 8.8.8.8 1.1.1.1 208.67.222.222; do echo \u0026#34;Testing $server:\u0026#34; dig @$server \u0026#34;$domain\u0026#34; +short +time=3 || echo \u0026#34;Failed\u0026#34; done } 3. è¨˜éŒ„è§£æå•é¡Œ 1 2 3 4 5 6 7 8 # æª¢æŸ¥å®Œæ•´çš„è§£æè·¯å¾‘ dig google.com +trace +all # é©—è­‰ DNSSEC dig google.com +dnssec +multiline # æª¢æŸ¥å¿«å–æ±¡æŸ“ dig google.com @8.8.8.8 +norecurse èˆ‡å…¶ä»–å·¥å…·æ•´åˆ 1. èˆ‡ nslookup æ¯”è¼ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # dig æ ¼å¼ dig google.com A +short # nslookup æ ¼å¼ nslookup google.com | grep \u0026#34;Address:\u0026#34; | tail -1 | awk \u0026#39;{print $2}\u0026#39; # è½‰æ›è…³æœ¬ dig2nslookup() { local domain=\u0026#34;$1\u0026#34; echo \u0026#34;Server: $(dig google.com | grep SERVER | awk \u0026#39;{print $2}\u0026#39; | cut -d# -f1)\u0026#34; echo \u0026#34;Address: $(dig google.com | grep SERVER | awk \u0026#39;{print $2}\u0026#39;)\u0026#34; echo echo \u0026#34;Name: $domain\u0026#34; dig \u0026#34;$domain\u0026#34; A +short | while read ip; do echo \u0026#34;Address: $ip\u0026#34; done } 2. èˆ‡ç›£æ§ç³»çµ±æ•´åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # Nagios æª¢æŸ¥è…³æœ¬ check_dns_record() { local domain=\u0026#34;$1\u0026#34; local expected=\u0026#34;$2\u0026#34; local timeout=\u0026#34;${3:-5}\u0026#34; result=$(dig \u0026#34;$domain\u0026#34; A +short +time=\u0026#34;$timeout\u0026#34; 2\u0026gt;/dev/null | head -1) if [ \u0026#34;$result\u0026#34; = \u0026#34;$expected\u0026#34; ]; then echo \u0026#34;OK - DNS record matches: $result\u0026#34; exit 0 elif [ -z \u0026#34;$result\u0026#34; ]; then echo \u0026#34;CRITICAL - No DNS record found\u0026#34; exit 2 else echo \u0026#34;WARNING - DNS record mismatch. Expected: $expected, Got: $result\u0026#34; exit 1 fi } # Prometheus æŒ‡æ¨™ç”Ÿæˆ generate_dns_metrics() { local domain=\u0026#34;$1\u0026#34; query_time=$(dig \u0026#34;$domain\u0026#34; | grep \u0026#34;Query time\u0026#34; | awk \u0026#39;{print $4}\u0026#39;) record_count=$(dig \u0026#34;$domain\u0026#34; A +short | wc -l) echo \u0026#34;dns_query_duration_ms{domain=\\\u0026#34;$domain\\\u0026#34;} $query_time\u0026#34; echo \u0026#34;dns_record_count{domain=\\\u0026#34;$domain\\\u0026#34;,type=\\\u0026#34;A\\\u0026#34;} $record_count\u0026#34; } ç¸½çµ æ ¸å¿ƒå„ªå‹¢ åŠŸèƒ½å®Œæ•´ï¼šæ”¯æ´æ‰€æœ‰ DNS è¨˜éŒ„é¡å‹å’ŒæŸ¥è©¢é¸é … è¼¸å‡ºè©³ç´°ï¼šæä¾›å®Œæ•´çš„ DNS éŸ¿æ‡‰è³‡è¨Š è¨ºæ–·èƒ½åŠ›ï¼šå¼·å¤§çš„ç¶²è·¯æ•…éšœæ’é™¤åŠŸèƒ½ è…³æœ¬å‹å¥½ï¼šé©åˆè‡ªå‹•åŒ–å’Œæ‰¹æ¬¡è™•ç† æ¨™æº–å·¥å…·ï¼šå»£æ³›æ”¯æ´å’Œè‰¯å¥½çš„æ–‡æª” æœ€ä½³å¯¦è¸ é©ç•¶çš„è¶…æ™‚è¨­å®šï¼šé¿å…æŸ¥è©¢æ›èµ· ä½¿ç”¨è¿½è¹¤åŠŸèƒ½ï¼šè¨ºæ–·è¤‡é›œçš„ DNS å•é¡Œ é©—è­‰å¤šå€‹ä¾†æºï¼šæ¯”è¼ƒä¸åŒ DNS ä¼ºæœå™¨çš„çµæœ è¨˜éŒ„å’Œç›£æ§ï¼šå»ºç«‹ DNS è®Šæ›´çš„æ­·å²è¨˜éŒ„ å®‰å…¨è€ƒæ…®ï¼šé©—è­‰ DNSSEC å’Œæª¢æŸ¥ DNS åŠ«æŒ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åŸºæœ¬æŸ¥è©¢ dig domain.com # æ¨™æº–æŸ¥è©¢ dig domain.com +short # ç°¡æ½”è¼¸å‡º dig domain.com +trace # è¿½è¹¤è§£æè·¯å¾‘ # è¨˜éŒ„é¡å‹ dig domain.com A # IPv4 åœ°å€ dig domain.com AAAA # IPv6 åœ°å€ dig domain.com MX # éƒµä»¶äº¤æ› dig domain.com NS # åç¨±ä¼ºæœå™¨ dig domain.com TXT # æ–‡æœ¬è¨˜éŒ„ # é€²éšé¸é … dig @8.8.8.8 domain.com # æŒ‡å®š DNS ä¼ºæœå™¨ dig -x 8.8.8.8 # åå‘æŸ¥è©¢ dig domain.com +dnssec # DNSSEC é©—è­‰ dig domain.com +norecurse # ééæ­¸æŸ¥è©¢ dig æ˜¯ç¶²è·¯ç®¡ç†å’Œ DNS è¨ºæ–·çš„æ ¸å¿ƒå·¥å…·ï¼ŒæŒæ¡å…¶ä½¿ç”¨æŠ€å·§èƒ½å¤ å¤§å¹…æå‡ç¶²è·¯å•é¡Œè¨ºæ–·å’ŒåŸŸåç®¡ç†çš„æ•ˆç‡ã€‚è¨˜ä½ï¼šç†è§£ DNS ç³»çµ±çš„å·¥ä½œåŸç†æ˜¯æœ‰æ•ˆä½¿ç”¨ dig çš„åŸºç¤ã€‚\nåƒè€ƒè³‡æ–™ BIND 9 Administrator Reference Manual RFC 1035 - Domain Names DNS and BIND on IPv6 DNSSEC Guide Linux dig Command Tutorial ","permalink":"https://xinqilin.github.io/post/tools/dig/","tags":["Linux","Dig","DNS","Network","Debugging","System Administration","Command Line"],"title":"Dig å‘½ä»¤å®Œæ•´æŒ‡å—ï¼šDNS æŸ¥è©¢èˆ‡ç¶²è·¯è¨ºæ–·çš„å¼·å¤§å·¥å…·"},{"content":"SFTP å·¥å…· Dependency 1 2 3 // https://mvnrepository.com/artifact/com.jcraft/jsch implementation \u0026#39;com.jcraft:jsch:{version}\u0026#39; å‰µå»ºé€£ç·šå·¥å»  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 import com.jcraft.jsch.Channel; import com.jcraft.jsch.ChannelSftp; import com.jcraft.jsch.JSch; import com.jcraft.jsch.JSchException; import com.jcraft.jsch.Session; import java.util.Properties; import lombok.extern.log4j.Log4j2; import org.springframework.beans.factory.annotation.Value; import org.springframework.stereotype.Component; @Component @Log4j2 public class SFTPConnectionFactory { @Value(\u0026#34;${sftp.domain}\u0026#34;) private String domain; @Value(\u0026#34;${sftp.port}\u0026#34;) private int port; @Value(\u0026#34;${sftp.username}\u0026#34;) private String username; @Value(\u0026#34;${sftp.password}\u0026#34;) private String password; private ChannelSftp client; private Session session; public synchronized ChannelSftp getConnection() { if (client == null || session == null || !client.isConnected() || !session.isConnected()) { log.info(\u0026#34;Connect to {}, port {}, username: {}\u0026#34;, domain, port, username); try { JSch jsch = new JSch(); session = jsch.getSession(username, domain, port); session.setPassword(password); Properties config = new Properties(); config.put(\u0026#34;StrictHostKeyChecking\u0026#34;, \u0026#34;no\u0026#34;); session.setConfig(config); session.connect(); Channel channel = session.openChannel(\u0026#34;sftp\u0026#34;); channel.connect(); client = (ChannelSftp) channel; log.info(\u0026#34;SFTP connect success !\u0026#34;); } catch (JSchException e) { log.error(e, e); } } return client; } public synchronized void disconnect() { if (client != null) { if (client.isConnected()) { client.disconnect(); } } if (session != null) { if (session.isConnected()) { session.disconnect(); } } } } ä¸Šå‚³ , ä¸‹è¼‰ (outputStream), åˆªæª” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 import java.io.BufferedReader; import java.io.File; import java.io.FileInputStream; import java.io.InputStream; import java.io.InputStreamReader; import java.nio.charset.StandardCharsets; import lombok.extern.log4j.Log4j2; import org.springframework.stereotype.Component; @Component @Log4j2 public class SftpUtil { private static final int uploadRetry = 5; private static final int uploadSleep = 100; private final SFTPConnectionFactory sftpConnectionFactory; public SftpUtil(SFTPConnectionFactory sftpConnectionFactory) { this.sftpConnectionFactory = sftpConnectionFactory; } public boolean upload(String basePath, String directory, String filePath) { var isSuccess = false; var sftp = sftpConnectionFactory.getConnection(); if (sftp == null) { throw new RuntimeException(\u0026#34;get connection error\u0026#34;); } try { sftp.cd(basePath); sftp.cd(directory); File file = new File(filePath); sftp.put(new FileInputStream(file), file.getName()); isSuccess = true; } catch (Exception e) { log.error(e, e); } finally { sftpConnectionFactory.disconnect(); } return isSuccess; } public void download(String basePath, String directory, String fileName) { var sftp = sftpConnectionFactory.getConnection(); if (sftp == null) { throw new RuntimeException(\u0026#34;get connection error\u0026#34;); } BufferedReader bufferReader = null; try { sftp.cd(basePath); sftp.cd(directory); InputStream inputStream = sftp.get(fileName); // return byte[] a file // ByteArrayOutputStream buffer = new ByteArrayOutputStream(); // byte[] bytes = new byte[1024]; // int n; // while ((n = inputStream.read(bytes, 0, bytes.length)) != -1) { // buffer.write(bytes, 0, n); // } // buffer.flush(); // return buffer.toByteArray(); // return outputStream // outputStream = new FileOutputStream(fileName); // sftp.get(fileName, outputStream); bufferReader = new BufferedReader(new InputStreamReader(inputStream, StandardCharsets.UTF_8)); var sb = new StringBuilder(); String str; while ((str = bufferReader.readLine()) != null) { sb.append(str); } log.info(sb.toString()); } catch (Exception e) { log.error(e, e); } finally { if (bufferReader != null) { try { bufferReader.close(); } catch (Exception e) { log.error(e, e); } } sftpConnectionFactory.disconnect(); } } public boolean deleteFile(String fileName) throws Exception { var isSuccess = false; var sftp = sftpConnectionFactory.getConnection(); if (sftp == null) { throw new RuntimeException(\u0026#34;get connection error\u0026#34;); } try { sftp.rm(fileName); isSuccess = true; } catch (Exception e) { log.error(e, e); } finally { sftpConnectionFactory.disconnect(); } return isSuccess; } } ","permalink":"https://xinqilin.github.io/post/backend/sftputil/","tags":["SFTP","Spring Boot","File Transfer","JSch","Security","Java"],"title":"Spring Boot SFTP å·¥å…·é¡ï¼šå®‰å…¨æ–‡ä»¶å‚³è¼¸å”è­°å¯¦ä½œèˆ‡æœ€ä½³å¯¦è¸"},{"content":"Specification CriteriaQueryä»‹é¢ï¼š ä»£è¡¨ä¸€å€‹specificçš„é ‚å±¤æŸ¥è©¢ç‰©ä»¶ï¼Œå®ƒåŒ…å«è‘—æŸ¥è©¢çš„å„å€‹éƒ¨åˆ†ï¼Œæ¯”å¦‚ï¼šselect ã€fromã€whereã€group byã€order byç­‰æ³¨æ„ï¼šCriteriaQueryç‰©ä»¶åªå°å¯¦é«”å‹åˆ¥æˆ–åµŒå…¥å¼å‹åˆ¥çš„CriteriaæŸ¥è©¢èµ·ä½œç”¨ã€‚\nRoot: ä»£è¡¨CriteriaæŸ¥è©¢çš„æ ¹ç‰©ä»¶ï¼ŒCriteriaæŸ¥è©¢çš„æŸ¥è©¢æ ¹å®šç¾©äº†å¯¦é«”å‹åˆ¥ï¼Œèƒ½ç‚ºå°‡ä¾†å°èˆªç²å¾—æƒ³è¦çš„çµæœï¼Œå®ƒèˆ‡SQLæŸ¥è©¢ä¸­çš„FROMå­å¥é¡ä¼¼ã€‚ Rootç¯„ä¾‹æ˜¯å‹åˆ¥åŒ–çš„ï¼Œä¸”å®šç¾©äº†æŸ¥è©¢çš„FROMå­å¥ä¸­èƒ½å¤ å‡ºç¾çš„å‹åˆ¥ã€‚rootä»£è¡¨æŸ¥è©¢çš„å¯¦é«”é¡,queryå¯ä»¥å¾ä¸­å¾—åˆ°rootç‰©ä»¶,å‘Šè¨´jpaæŸ¥è©¢å“ªä¸€å€‹å¯¦é«”é¡,é‚„å¯ä»¥æ–°å¢æŸ¥è©¢æ¢ä»¶,é‚„å¯ä»¥çµåˆEntityManagerç‰©ä»¶ å¾—åˆ°æœ€çµ‚æŸ¥è©¢çš„ TypedQueryç‰©ä»¶ã€‚\nCriteriaBuilderä»‹é¢ï¼š ç”¨ä¾†æ§‹å»ºCritiaQueryçš„æ§‹å»ºå™¨ç‰©ä»¶Predicateï¼šä¸€å€‹ç°¡å–®æˆ–è¤‡é›œçš„è¬‚è©å‹åˆ¥ï¼Œå…¶å¯¦å°±ç›¸ç•¶æ–¼æ¢ä»¶æˆ–è€…æ˜¯æ¢ä»¶çµ„åˆã€‚ å¯é€šé EntityManager.getCriteriaBuilder è€Œå¾—ã€‚\n1 2 3 4 5 var spec = Specification.\u0026lt;User\u0026gt;where(null); if (!user.getAccount().isEmpty()) { spec.and((r, q, cb) -\u0026gt; cb.like(r.get(\u0026#34;account\u0026#34;), \u0026#34;\u0026#34; + user.getAccount() + \u0026#34;%\u0026#34;)); } Page 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 private Specification\u0026lt;User\u0026gt; getSpecificationByAccountAndPwd(String account, String pwd) { return (Specification\u0026lt;User\u0026gt;) (root, criteriaQuery, criteriaBuilder) -\u0026gt; { // ç²å–æ¯”è¼ƒçš„å±¬æ€§ Path\u0026lt;Object\u0026gt; compareAccount = root.get(\u0026#34;account\u0026#34;); Path\u0026lt;Object\u0026gt; comparePwd = root.get(\u0026#34;password\u0026#34;); Predicate predicate1 = criteriaBuilder.equal(compareAccount, account); Predicate predicate2 = criteriaBuilder.equal(comparePwd, pwd); // === and === // criteriaBuilder.and(predicate01, predicate02) // === or === // criteriaBuilder.or(predicate01, predicate02) return criteriaBuilder.and(predicate1, predicate2); }; } private Specification\u0026lt;User\u0026gt; getSpecificationByAccountLike() { return (Specification\u0026lt;User\u0026gt;) (root, criteriaQuery, criteriaBuilder) -\u0026gt; { // ç²å–æ¯”è¼ƒçš„å±¬æ€§ Path\u0026lt;Object\u0026gt; compareAccount = root.get(\u0026#34;account\u0026#34;); // æ¨¡ç³Šè¦æ±‚æŒ‡å®šå¼•æ•¸å‹åˆ¥ return criteriaBuilder.like(compareAccount.as(String.class), \u0026#34;%test%\u0026#34;); }; } Pageable pageable = PageRequest.of(pageNum, rowCnt, Sort.Direction.DESC, \u0026#34;id\u0026#34;); Pageable pageable = PageRequest.of(pageNum, rowCnt); Page\u0026lt;User\u0026gt; pageResult = userDao.findAll(getSpecificationByAccountLike(), pageable); // å…¨éƒ¨é æ•¸ System.out.println(\u0026#34;getTotalPages(): \u0026#34; + pageResult.getTotalPages()); // å…¨éƒ¨ç­†æ•¸ System.out.println(\u0026#34;getTotalElements(): \u0026#34; + pageResult.getTotalElements()); // æ¯é ç­†æ•¸ System.out.println(\u0026#34;getSize(): \u0026#34; + pageResult.getSize()); // ç›®å‰é è™Ÿï¼Œ0ç‚ºç¬¬ä¸€é  System.out.println(\u0026#34;getNumber(): \u0026#34; + pageResult.getNumber()); // ç›®å‰é ç­†æ•¸ System.out.println(\u0026#34;getNumberOfElements(): \u0026#34; + pageResult.getNumberOfElements()); //result System.out.println(\u0026#34;getContent(): \u0026#34; + pageResult.getContent()); å°è©¦èº«æ‰‹1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 /** * * * @param ç¬¬å¹¾é  * @param æ¯é æ•¸é‡æœ‰å¹¾å€‹ */ public List\u0026lt;BigInteger\u0026gt; getOrderInfo(@PathVariable(\u0026#34;page\u0026#34;) int page, @PathVariable(\u0026#34;size\u0026#34;) int size){ var custInfo = \u0026#34;bill\u0026#34;; Pageable pageable = PageRequest.of(page, size, Sort.Direction.DESC, \u0026#34;order_id\u0026#34;); Page\u0026lt;OrderMaster\u0026gt; pageOrders = orderMasterRepository.findAll(getSpecialField(custInfo), pageable); log.info(\u0026#34;pageOrders: {}\u0026#34;, pageOrders); System.out.println(\u0026#34;total counts: \u0026#34; + pageOrders.getTotalElements()); System.out.println(\u0026#34;total page: \u0026#34; + pageOrders.getTotalPages()); return pageOrders.getContent().stream().map(OrderMaster::getOrderId).collect(Collectors.toList()); } // Predicate toPredicate(Root\u0026lt;T\u0026gt; root, CriteriaQuery\u0026lt;?\u0026gt; query, CriteriaBuilder cb); private Specification\u0026lt;OrderMaster\u0026gt; getSpecialField(String custInfo) { return (root, criteriaQuery, criteriaBuilder) -\u0026gt; { // Path\u0026lt;Object\u0026gt; comparePwd = root.get(\u0026#34;custInfo\u0026#34;); // Predicate predicate = criteriaBuilder.equal(comparePwd, custInfo); // return criteriaBuilder.and(predicate); return criteriaBuilder.equal(root.get(\u0026#34;custInfo\u0026#34;), custInfo); }; å°è©¦èº«æ‰‹2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 /** * * * @param ç¬¬å¹¾é  * @param æ¯é æ•¸é‡æœ‰å¹¾å€‹ */ public List\u0026lt;BigInteger\u0026gt; getOrderInfo(@PathVariable(\u0026#34;page\u0026#34;) int page, @PathVariable(\u0026#34;size\u0026#34;) int size) { var custInfo = \u0026#34;bill\u0026#34;; Pageable pageable = PageRequest.of(page, size, Sort.Direction.DESC, \u0026#34;order_id\u0026#34;); Page\u0026lt;OrderMaster\u0026gt; pageOrders = orderMasterRepository.findAll((root, criteriaQuery, criteriaBuilder) -\u0026gt; { Path\u0026lt;Object\u0026gt; comparePwd = root.get(\u0026#34;custInfo\u0026#34;); Predicate predicate = criteriaBuilder.equal(comparePwd, erpCustNo); return criteriaBuilder.and(predicate); }, pageable); log.info(\u0026#34;pageOrders: {}\u0026#34;, pageOrders); System.out.println(\u0026#34;total counts: \u0026#34; + pageOrders.getTotalElements()); System.out.println(\u0026#34;total page: \u0026#34; + pageOrders.getTotalPages()); return pageOrders.getContent().stream().map(OrderMaster::getOrderId).collect(Collectors.toList()); } å°è©¦èº«æ‰‹3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 /** * * * @param ç¬¬å¹¾é  * @param æ¯é æ•¸é‡æœ‰å¹¾å€‹ */ public List\u0026lt;BigInteger\u0026gt; getOrderInfo(@PathVariable(\u0026#34;page\u0026#34;) int page, @PathVariable(\u0026#34;size\u0026#34;) int size) { var custInfo = \u0026#34;bill\u0026#34;; Pageable pageable = PageRequest.of(page, size, Sort.Direction.DESC, \u0026#34;order_id\u0026#34;); Specification\u0026lt;OrderMaster\u0026gt; specification = new Specification\u0026lt;OrderMaster\u0026gt;() { @Override public Predicate toPredicate(Root\u0026lt;OrderMaster\u0026gt; root, CriteriaQuery\u0026lt;?\u0026gt; query, CriteriaBuilder criteriaBuilder) { return criteriaBuilder.equal(root.get(\u0026#34;custInfo\u0026#34;), erpCustNo); } }; Page\u0026lt;OrderMaster\u0026gt; pageOrders = orderMasterRepository.findAll(specification, pageable); log.info(\u0026#34;pageOrders: {}\u0026#34;, pageOrders); System.out.println(\u0026#34;total counts: \u0026#34; + pageOrders.getTotalElements()); System.out.println(\u0026#34;total page: \u0026#34; + pageOrders.getTotalPages()); return pageOrders.getContent().stream().map(OrderMaster::getOrderId).collect(Collectors.toList()); } ","permalink":"https://xinqilin.github.io/post/backend/jpapageable/","tags":["Spring Data JPA","Pageable","Pagination","Spring Boot","Database","Performance"],"title":"Spring Data JPA Pageable åˆ†é æŸ¥è©¢ï¼šå®Œæ•´å¯¦ä½œèˆ‡æ•ˆèƒ½å„ªåŒ–æŒ‡å—"},{"content":"Side Project å¸¸ç”¨åŠŸèƒ½ï¼Œç´€éŒ„ï¼Œæ–¹ä¾¿ä»¥å¾Œå¿«é€Ÿ setup ç’°å¢ƒ DI 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 \u0026lt;!-- Lombok--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- Test Swagger with GraphQL --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.springfox\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springfox-swagger2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.9.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.springfox\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springfox-swagger-ui\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.9.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- StringUtil--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.commons\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;commons-lang3\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.11\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- Validate--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.validation\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;validation-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.1.Final\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- JSON --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.fasterxml.jackson.core\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jackson-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.9.8\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.fasterxml.jackson.core\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jackson-databind\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.10.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- logstash --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;net.logstash.logback\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;logstash-logback-encoder\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- guava --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.google.guava\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;guava\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;30.1.1-jre\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; Properties or Yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 server.port = 808x server.servlet.context-path = /name #mysql-8 spring.datasource.username = root spring.datasource.password = mysql spring.datasource.url = jdbc:mysql://localhost:3306/\u0026lt;name\u0026gt;?serverTimezone=Asia/Taipei\u0026amp;useUnicode=true\u0026amp;characterEncoding=utf8\u0026amp;useSSL=false spring.datasource.driver-class-name = com.mysql.cj.jdbc.Driver #JPA spring.jpa.hibernate.ddl-auto = update spring.jpa.show-sql = true 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 server: port: 808x servlet: context-path: /name spring: thymeleaf: cache: false #mysql-8 datasource: driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/\u0026lt;name\u0026gt;?characterEncoding=utf-8\u0026amp;useSSL=false\u0026amp;serverTimezone=Asia/Taipei username: root password: mysql hikari: minimum-idle: 5 maximum-pool-size: 15 idle-timeout: 30000 pool-name: hikariCP connection-timeout: 30000 max-lifetime: 1800000 jpa: hibernate: ddl-auto: update show-sql: true Config Swagger2Config\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /** * @author Bill.Lin */ @Configuration @EnableSwagger2 public class Swagger2Config { @Bean public Docket api() { return new Docket(DocumentationType.SWAGGER_2) .select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.any()) .build(); } } RestTemplateConfig\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Configuration public class RestTemplateConfig { @Bean public RestTemplate restTemplate(ClientHttpRequestFactory factory) { return new RestTemplate(factory); } @Bean public ClientHttpRequestFactory simpleClientHttpRequestFactory() { SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory(); factory.setReadTimeout(3000); factory.setConnectTimeout(3000); return factory; } } docker-compose kafka\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 version: \u0026#39;3\u0026#39; services: zookeeper1: image: wurstmeister/zookeeper ports: - 2181:2181 container_name: zookeeper kafka1: image: wurstmeister/kafka container_name: kafka ports: - 9092:9092 environment: KAFKA_ADVERTISED_HOST_NAME: 192.168.99.100 KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181 KAFKA_CREATE_TOPIC: \u0026#34;bill:1:3\u0026#34; redis: image: redis:\u0026lt;tag\u0026gt; expose: - 6379 ports: - \u0026#34;6379:6379\u0026#34; networks: - default rabbitmq: image: rabbitmq:3-management environment: - RABBITMQ_DEFAULT_USER=rabbitmq - RABBITMQ_DEFAULT_PASS=rabbitmq ports: - \u0026#34;15672:15672\u0026#34; - \u0026#34;5672:5672\u0026#34; networks: - default mysql: image: mysql:5.7 # æˆ– 8 environment: - MYSQL_ROOT_PASSWORD=mysql expose: - 3306 ports: - \u0026#34;3306:3306\u0026#34; networks: - default mongo: image: mongo:4.1 restart: always expose: - 27017 ports: - 27017:27017 environment: MONGO_INITDB_DATABASE: db MONGO_INITDB_ROOT_USERNAME: root MONGO_INITDB_ROOT_PASSWORD: mongo networks: - default mongo-express: image: mongo-express restart: always ports: - 8081:8081 environment: ME_CONFIG_MONGODB_SERVER: mongo ME_CONFIG_MONGODB_ADMINUSERNAME: root ME_CONFIG_MONGODB_ADMINPASSWORD: mongo depends_on: - mongo networks: - default logstash config (resource) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;conversionRule conversionWord=\u0026#34;clr\u0026#34; converterClass=\u0026#34;org.springframework.boot.logging.logback.ColorConverter\u0026#34; /\u0026gt; \u0026lt;conversionRule conversionWord=\u0026#34;wex\u0026#34; converterClass=\u0026#34;org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter\u0026#34; /\u0026gt; \u0026lt;conversionRule conversionWord=\u0026#34;wEx\u0026#34; converterClass=\u0026#34;org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;CONSOLE_LOG_PATTERN\u0026#34; value=\u0026#34;${CONSOLE_LOG_PATTERN:-%clr(%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}\u0026#34;/\u0026gt; \u0026lt;appender name=\u0026#34;STDOUT\u0026#34; class=\u0026#34;ch.qos.logback.core.ConsoleAppender\u0026#34;\u0026gt; \u0026lt;layout class=\u0026#34;ch.qos.logback.classic.PatternLayout\u0026#34;\u0026gt; \u0026lt;pattern\u0026gt;${CONSOLE_LOG_PATTERN}\u0026lt;/pattern\u0026gt; \u0026lt;/layout\u0026gt; \u0026lt;/appender\u0026gt; \u0026lt;logger name=\u0026#34;com.bill.xx\u0026#34; level=\u0026#34;info\u0026#34; /\u0026gt; \u0026lt;root level=\u0026#34;info\u0026#34;\u0026gt; \u0026lt;appender-ref ref=\u0026#34;STDOUT\u0026#34; /\u0026gt; \u0026lt;/root\u0026gt; \u0026lt;property name=\u0026#34;LOGS\u0026#34; value=\u0026#34;./logs\u0026#34; /\u0026gt; \u0026lt;springProfile name=\u0026#34;indev, staging\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;LOGS\u0026#34; value=\u0026#34;IDC ç›®éŒ„\u0026#34; /\u0026gt; \u0026lt;appender name=\u0026#34;RollingFile\u0026#34; class=\u0026#34;ch.qos.logback.core.rolling.RollingFileAppender\u0026#34;\u0026gt; \u0026lt;file\u0026gt;${LOGS}/ma-pos.log\u0026lt;/file\u0026gt; \u0026lt;encoder class=\u0026#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder\u0026#34;\u0026gt; \u0026lt;Pattern\u0026gt;%d %p %C{1.} [%t] %m%n\u0026lt;/Pattern\u0026gt; \u0026lt;/encoder\u0026gt; \u0026lt;rollingPolicy class=\u0026#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy\u0026#34;\u0026gt; \u0026lt;!-- rollover daily and when the file reaches 10 MegaBytes --\u0026gt; \u0026lt;fileNamePattern\u0026gt;${LOGS}/archived/ma-pos-%d{yyyy-MM-dd}.%i.log \u0026lt;/fileNamePattern\u0026gt; \u0026lt;timeBasedFileNamingAndTriggeringPolicy class=\u0026#34;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP\u0026#34;\u0026gt; \u0026lt;maxFileSize\u0026gt;10MB\u0026lt;/maxFileSize\u0026gt; \u0026lt;/timeBasedFileNamingAndTriggeringPolicy\u0026gt; \u0026lt;/rollingPolicy\u0026gt; \u0026lt;/appender\u0026gt; \u0026lt;appender name=\u0026#34;LogstashFile\u0026#34; class=\u0026#34;ch.qos.logback.core.rolling.RollingFileAppender\u0026#34;\u0026gt; \u0026lt;file\u0026gt;${LOGS}/logstash/logstash.log\u0026lt;/file\u0026gt; \u0026lt;rollingPolicy class=\u0026#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy\u0026#34;\u0026gt; \u0026lt;fileNamePattern\u0026gt;${LOGS}/logstash/logstash.%d{yyyy-MM-dd}.log\u0026lt;/fileNamePattern\u0026gt; \u0026lt;maxHistory\u0026gt;7\u0026lt;/maxHistory\u0026gt; \u0026lt;/rollingPolicy\u0026gt; \u0026lt;encoder class=\u0026#34;net.logstash.logback.encoder.LogstashEncoder\u0026#34;/\u0026gt; \u0026lt;/appender\u0026gt; \u0026lt;root level=\u0026#34;info\u0026#34;\u0026gt; \u0026lt;appender-ref ref=\u0026#34;RollingFile\u0026#34; /\u0026gt; \u0026lt;appender-ref ref=\u0026#34;LogstashFile\u0026#34; /\u0026gt; \u0026lt;/root\u0026gt; \u0026lt;/springProfile\u0026gt; \u0026lt;/configuration\u0026gt; Other banner.txt\n1 2 3 4 5 6 7 8 9 10 11 12 13 ,. - Â· - ., \u0026#39; ,.-Â·. ,. \u0026#39; ,. \u0026#39; ,Â·\u0026#39;Â´,.-, ,. -., `\u0026#39;;,\u0026#39; / ;\u0026#39;\\\u0026#39; / \u0026#39;;\\ / \u0026#39;;\\ \\::\\.\u0026#39;Â´ ;\u0026#39;\\::::;:\u0026#39; ,Â·\u0026#39;:\\\u0026#39; ; ;:::\\ ,\u0026#39; ,\u0026#39;::\u0026#39;\\ ,\u0026#39; ,\u0026#39;::\u0026#39;\\ \u0026#39;\\:\u0026#39;; ;:;:Â·\u0026#39;Â´,.Â·\u0026#39;Â´\\::::\u0026#39;; \u0026#39;; ;::::;\u0026#39; ,\u0026#39; ;:::\u0026#39;;\u0026#39; ,\u0026#39; ;:::\u0026#39;;\u0026#39; ,.Â·\u0026#39; ,.Â·:\u0026#39;Â´:::::::\u0026#39;\\;Â·Â´ ; ;::::; \u0026#39;; ,\u0026#39;:::;\u0026#39; \u0026#39;; ,\u0026#39;:::;\u0026#39; \u0026#39;Â·, ,.`\u0026#39; Â·- :;:;Â·\u0026#39;Â´ \u0026#39;; ;\u0026#39;::::; ; ,\u0026#39;:::;\u0026#39; \u0026#39; ; ,\u0026#39;:::;\u0026#39; \u0026#39; ; \u0026#39;;:\\:`*Â·, \u0026#39;`Â·, Â° ; \u0026#39;;:::\u0026#39;; ,\u0026#39; ,\u0026#39;::;\u0026#39; ,\u0026#39; ,\u0026#39;::;\u0026#39; ; ;:;:\u0026#39;-Â·\u0026#39;Â´ ,.Â·\u0026#39;:\\ \u0026#39;; ;::::;\u0026#39; ; \u0026#39;;_:,.-Â·Â´\u0026#39;;\\â€˜ ; \u0026#39;;_:,.-Â·Â´\u0026#39;;\\â€˜ ,Â·\u0026#39;, ,. -~:*\u0026#39;Â´\\:::::\u0026#39;\\â€˜ \\*Â´\\:::;â€˜ \u0026#39;, _,.-Â·\u0026#39;Â´:\\:\\â€˜ \u0026#39;, _,.-Â·\u0026#39;Â´:\\:\\â€˜ \\:\\`\u0026#39;Â´\\:::::::::\u0026#39;\\;:Â·\u0026#39;Â´ \u0026#39;\\::\\:;\u0026#39; \\Â¨:::::::::::\\\u0026#39;; \\Â¨:::::::::::\\\u0026#39;; \u0026#39;\\;\\:::\\;: -~*Â´â€˜ `*Â´â€˜ \u0026#39;\\;::_;:-Â·\u0026#39;Â´â€˜ \u0026#39;\\;::_;:-Â·\u0026#39;Â´â€˜ \u0026#39; \u0026#39;Â¨ \u0026#39;Â¨ ","permalink":"https://xinqilin.github.io/post/backend/sideprojectconfig/","tags":["Project Setup","Configuration","Development","Best Practices","Spring Boot"],"title":"Side Project å°ˆæ¡ˆé…ç½®æœ€ä½³å¯¦è¸ï¼šé–‹ç™¼ç’°å¢ƒè¨­å®šèˆ‡éƒ¨ç½²æµç¨‹"},{"content":"æ¦‚è¿° Spring Framework å»£æ³›ä½¿ç”¨è¨»è§£ï¼ˆAnnotationsï¼‰ä¾†ç°¡åŒ–é…ç½®å’Œæå‡é–‹ç™¼æ•ˆç‡ã€‚å¾ Spring 2.5 é–‹å§‹å¼•å…¥è¨»è§£é©…å‹•é…ç½®ï¼Œåˆ° Spring Boot çš„è‡ªå‹•é…ç½®ï¼Œè¨»è§£å·²æˆç‚ºç¾ä»£ Spring æ‡‰ç”¨ç¨‹å¼é–‹ç™¼çš„æ ¸å¿ƒã€‚æœ¬æ–‡å°‡ç³»çµ±æ€§åœ°æ•´ç† Spring ç”Ÿæ…‹ç³»çµ±ä¸­çš„é‡è¦è¨»è§£ï¼Œä¸¦æä¾›å¯¦ç”¨çš„ç¨‹å¼ç¢¼ç¯„ä¾‹ã€‚\næ ¸å¿ƒå®¹å™¨è¨»è§£ 1. Bean å®šç¾©èˆ‡ç®¡ç† @Component ç³»åˆ— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // é€šç”¨çµ„ä»¶ @Component public class UserValidator { public boolean validate(User user) { return user != null \u0026amp;\u0026amp; user.getEmail() != null; } } // æœå‹™å±¤çµ„ä»¶ @Service public class UserService { @Autowired private UserRepository userRepository; public User findById(Long id) { return userRepository.findById(id).orElse(null); } } // è³‡æ–™å­˜å–å±¤çµ„ä»¶ @Repository public class UserRepositoryImpl implements UserRepository { @PersistenceContext private EntityManager entityManager; @Override public Optional\u0026lt;User\u0026gt; findById(Long id) { User user = entityManager.find(User.class, id); return Optional.ofNullable(user); } } // Web å±¤çµ„ä»¶ @Controller public class UserController { @Autowired private UserService userService; @GetMapping(\u0026#34;/users/{id}\u0026#34;) @ResponseBody public User getUser(@PathVariable Long id) { return userService.findById(id); } } // RESTful API æ§åˆ¶å™¨ @RestController // ç­‰åŒæ–¼ @Controller + @ResponseBody @RequestMapping(\u0026#34;/api/users\u0026#34;) public class UserRestController { @Autowired private UserService userService; @GetMapping(\u0026#34;/{id}\u0026#34;) public User getUser(@PathVariable Long id) { return userService.findById(id); } } @Configuration å’Œ @Bean 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @Configuration @EnableTransactionManagement @ComponentScan(basePackages = \u0026#34;com.example\u0026#34;) public class AppConfiguration { @Bean @Primary // ç•¶æœ‰å¤šå€‹ç›¸åŒé¡å‹çš„ Bean æ™‚ï¼Œå„ªå…ˆä½¿ç”¨é€™å€‹ public DataSource primaryDataSource() { HikariDataSource dataSource = new HikariDataSource(); dataSource.setJdbcUrl(\u0026#34;jdbc:mysql://localhost:3306/primary\u0026#34;); dataSource.setUsername(\u0026#34;user\u0026#34;); dataSource.setPassword(\u0026#34;password\u0026#34;); return dataSource; } @Bean @Qualifier(\u0026#34;secondary\u0026#34;) // ä½¿ç”¨é™å®šç¬¦å€åˆ† public DataSource secondaryDataSource() { HikariDataSource dataSource = new HikariDataSource(); dataSource.setJdbcUrl(\u0026#34;jdbc:mysql://localhost:3306/secondary\u0026#34;); dataSource.setUsername(\u0026#34;user\u0026#34;); dataSource.setPassword(\u0026#34;password\u0026#34;); return dataSource; } @Bean @Scope(\u0026#34;prototype\u0026#34;) // æ¯æ¬¡æ³¨å…¥éƒ½å‰µå»ºæ–°å¯¦ä¾‹ public OrderProcessor orderProcessor() { return new OrderProcessor(); } @Bean @Lazy // å»¶é²åˆå§‹åŒ– public ExpensiveService expensiveService() { return new ExpensiveService(); } } 2. ä¾è³´æ³¨å…¥è¨»è§£ @Autowired å’Œç›¸é—œè¨»è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Service public class OrderService { // å»ºæ§‹å­æ³¨å…¥ï¼ˆæ¨è–¦ï¼‰ private final PaymentService paymentService; private final EmailService emailService; @Autowired public OrderService(PaymentService paymentService, EmailService emailService) { this.paymentService = paymentService; this.emailService = emailService; } // å¯é¸ä¾è³´ @Autowired(required = false) private Optional\u0026lt;SmsService\u0026gt; smsService; // é›†åˆæ³¨å…¥ @Autowired private List\u0026lt;NotificationProvider\u0026gt; notificationProviders; // ä½¿ç”¨é™å®šç¬¦ @Autowired @Qualifier(\u0026#34;primary\u0026#34;) private DataSource primaryDataSource; // JSR-330 æ¨™æº–è¨»è§£ @Inject // ç­‰åŒæ–¼ @Autowired private AuditService auditService; @Named(\u0026#34;cache\u0026#34;) // ç­‰åŒæ–¼ @Qualifier private CacheManager cacheManager; } @Value å±¬æ€§æ³¨å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 @Component public class ConfigurationService { // åŸºæœ¬å±¬æ€§æ³¨å…¥ @Value(\u0026#34;${app.name}\u0026#34;) private String appName; // é è¨­å€¼ @Value(\u0026#34;${app.timeout:30}\u0026#34;) private int timeout; // ç³»çµ±å±¬æ€§ @Value(\u0026#34;#{systemProperties[\u0026#39;user.home\u0026#39;]}\u0026#34;) private String userHome; // SpEL è¡¨é”å¼ @Value(\u0026#34;#{T(java.lang.Math).random() * 100}\u0026#34;) private double randomNumber; // é™£åˆ—æ³¨å…¥ @Value(\u0026#34;${app.allowed-origins}\u0026#34;) private String[] allowedOrigins; // List æ³¨å…¥ @Value(\u0026#34;#{\u0026#39;${app.features}\u0026#39;.split(\u0026#39;,\u0026#39;)}\u0026#34;) private List\u0026lt;String\u0026gt; features; // Map æ³¨å…¥ @Value(\u0026#34;#{${app.database-config}}\u0026#34;) private Map\u0026lt;String, String\u0026gt; databaseConfig; // å»ºæ§‹å­åƒæ•¸æ³¨å…¥ public ConfigurationService(@Value(\u0026#34;${app.version}\u0026#34;) String version) { this.version = version; } } Web ç›¸é—œè¨»è§£ 1. MVC æ§åˆ¶å™¨è¨»è§£ @RequestMapping ç³»åˆ— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 @RestController @RequestMapping(\u0026#34;/api/v1/orders\u0026#34;) @CrossOrigin(origins = \u0026#34;http://localhost:3000\u0026#34;) // CORS è¨­å®š public class OrderController { @Autowired private OrderService orderService; // GET è«‹æ±‚ @GetMapping public Page\u0026lt;Order\u0026gt; getOrders( @RequestParam(defaultValue = \u0026#34;0\u0026#34;) int page, @RequestParam(defaultValue = \u0026#34;20\u0026#34;) int size, @RequestParam(required = false) String status, Pageable pageable) { return orderService.findOrders(status, pageable); } // è·¯å¾‘è®Šæ•¸ @GetMapping(\u0026#34;/{id}\u0026#34;) public ResponseEntity\u0026lt;Order\u0026gt; getOrder(@PathVariable Long id) { return orderService.findById(id) .map(order -\u0026gt; ResponseEntity.ok(order)) .orElse(ResponseEntity.notFound().build()); } // POST è«‹æ±‚ @PostMapping @ResponseStatus(HttpStatus.CREATED) public Order createOrder(@RequestBody @Valid CreateOrderRequest request) { return orderService.createOrder(request); } // PUT è«‹æ±‚ @PutMapping(\u0026#34;/{id}\u0026#34;) public ResponseEntity\u0026lt;Order\u0026gt; updateOrder( @PathVariable Long id, @RequestBody @Valid UpdateOrderRequest request) { return orderService.updateOrder(id, request) .map(order -\u0026gt; ResponseEntity.ok(order)) .orElse(ResponseEntity.notFound().build()); } // DELETE è«‹æ±‚ @DeleteMapping(\u0026#34;/{id}\u0026#34;) @ResponseStatus(HttpStatus.NO_CONTENT) public void deleteOrder(@PathVariable Long id) { orderService.deleteOrder(id); } // æª”æ¡ˆä¸Šå‚³ @PostMapping(\u0026#34;/{id}/attachments\u0026#34;) public ResponseEntity\u0026lt;String\u0026gt; uploadAttachment( @PathVariable Long id, @RequestParam(\u0026#34;file\u0026#34;) MultipartFile file) { String fileUrl = orderService.uploadAttachment(id, file); return ResponseEntity.ok(fileUrl); } // è‡ªè¨‚ HTTP æ–¹æ³• @RequestMapping(value = \u0026#34;/{id}/status\u0026#34;, method = RequestMethod.PATCH) public Order updateOrderStatus( @PathVariable Long id, @RequestBody OrderStatusUpdate statusUpdate) { return orderService.updateStatus(id, statusUpdate); } } åƒæ•¸è™•ç†è¨»è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @RestController public class UserController { // è«‹æ±‚é ­è™•ç† @GetMapping(\u0026#34;/profile\u0026#34;) public UserProfile getProfile( @RequestHeader(\u0026#34;Authorization\u0026#34;) String authToken, @RequestHeader(value = \u0026#34;User-Agent\u0026#34;, required = false) String userAgent) { return userService.getProfile(authToken); } // Cookie è™•ç† @GetMapping(\u0026#34;/preferences\u0026#34;) public UserPreferences getPreferences( @CookieValue(name = \u0026#34;sessionId\u0026#34;, required = false) String sessionId) { return userService.getPreferences(sessionId); } // Session å±¬æ€§ @PostMapping(\u0026#34;/login\u0026#34;) public ResponseEntity\u0026lt;String\u0026gt; login( @RequestBody LoginRequest request, @SessionAttribute(required = false) String captcha, HttpSession session) { if (userService.validateLogin(request, captcha)) { session.setAttribute(\u0026#34;userId\u0026#34;, request.getUsername()); return ResponseEntity.ok(\u0026#34;Login successful\u0026#34;); } return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(\u0026#34;Login failed\u0026#34;); } // Model å±¬æ€§ @ModelAttribute(\u0026#34;commonData\u0026#34;) public CommonData getCommonData() { return new CommonData(); } @GetMapping(\u0026#34;/dashboard\u0026#34;) public String dashboard(@ModelAttribute(\u0026#34;commonData\u0026#34;) CommonData commonData) { return \u0026#34;dashboard\u0026#34;; } } 2. é©—è­‰è¨»è§£ Bean Validation 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 @RestController @Validated // é–‹å•Ÿé©—è­‰ public class UserController { @PostMapping(\u0026#34;/users\u0026#34;) public ResponseEntity\u0026lt;User\u0026gt; createUser(@RequestBody @Valid CreateUserRequest request) { User user = userService.createUser(request); return ResponseEntity.ok(user); } @GetMapping(\u0026#34;/users/{id}\u0026#34;) public User getUser(@PathVariable @Min(1) Long id) { return userService.findById(id); } } // è«‹æ±‚ DTO èˆ‡é©—è­‰ public class CreateUserRequest { @NotBlank(message = \u0026#34;å§“åä¸èƒ½ç‚ºç©º\u0026#34;) @Size(min = 2, max = 50, message = \u0026#34;å§“åé•·åº¦å¿…é ˆåœ¨ 2-50 å­—å…ƒä¹‹é–“\u0026#34;) private String name; @NotBlank(message = \u0026#34;ä¿¡ç®±ä¸èƒ½ç‚ºç©º\u0026#34;) @Email(message = \u0026#34;ä¿¡ç®±æ ¼å¼ä¸æ­£ç¢º\u0026#34;) private String email; @NotNull(message = \u0026#34;å¹´é½¡ä¸èƒ½ç‚ºç©º\u0026#34;) @Min(value = 18, message = \u0026#34;å¹´é½¡å¿…é ˆå¤§æ–¼ç­‰æ–¼ 18\u0026#34;) @Max(value = 120, message = \u0026#34;å¹´é½¡å¿…é ˆå°æ–¼ç­‰æ–¼ 120\u0026#34;) private Integer age; @Pattern(regexp = \u0026#34;^\\\\+?[1-9]\\\\d{1,14}$\u0026#34;, message = \u0026#34;é›»è©±è™Ÿç¢¼æ ¼å¼ä¸æ­£ç¢º\u0026#34;) private String phone; @Valid // å·¢ç‹€ç‰©ä»¶é©—è­‰ private Address address; @NotEmpty(message = \u0026#34;è‡³å°‘è¦æœ‰ä¸€å€‹èˆˆè¶£\u0026#34;) private List\u0026lt;@NotBlank String\u0026gt; interests; // getters and setters... } // è‡ªè¨‚é©—è­‰è¨»è§£ @Target({ElementType.FIELD}) @Retention(RetentionPolicy.RUNTIME) @Constraint(validatedBy = UniqueEmailValidator.class) public @interface UniqueEmail { String message() default \u0026#34;ä¿¡ç®±å·²è¢«ä½¿ç”¨\u0026#34;; Class\u0026lt;?\u0026gt;[] groups() default {}; Class\u0026lt;? extends Payload\u0026gt;[] payload() default {}; } @Component public class UniqueEmailValidator implements ConstraintValidator\u0026lt;UniqueEmail, String\u0026gt; { @Autowired private UserRepository userRepository; @Override public boolean isValid(String email, ConstraintValidatorContext context) { return email == null || !userRepository.existsByEmail(email); } } è³‡æ–™å­˜å–è¨»è§£ 1. JPA å’Œ Hibernate è¨»è§£ å¯¦é«”å®šç¾© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 @Entity @Table(name = \u0026#34;users\u0026#34;, indexes = { @Index(name = \u0026#34;idx_email\u0026#34;, columnList = \u0026#34;email\u0026#34;), @Index(name = \u0026#34;idx_created_at\u0026#34;, columnList = \u0026#34;created_at\u0026#34;) }) @EntityListeners(AuditingEntityListener.class) public class User { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; @Column(name = \u0026#34;full_name\u0026#34;, nullable = false, length = 100) private String name; @Column(unique = true, nullable = false) private String email; @Enumerated(EnumType.STRING) @Column(name = \u0026#34;user_status\u0026#34;) private UserStatus status = UserStatus.ACTIVE; @CreatedDate @Column(name = \u0026#34;created_at\u0026#34;, updatable = false) private LocalDateTime createdAt; @LastModifiedDate @Column(name = \u0026#34;updated_at\u0026#34;) private LocalDateTime updatedAt; @CreatedBy @Column(name = \u0026#34;created_by\u0026#34;, updatable = false) private String createdBy; @LastModifiedBy @Column(name = \u0026#34;updated_by\u0026#34;) private String updatedBy; // ä¸€å°å¤šé—œä¿‚ @OneToMany(mappedBy = \u0026#34;user\u0026#34;, cascade = CascadeType.ALL, orphanRemoval = true) @JsonIgnore private List\u0026lt;Order\u0026gt; orders = new ArrayList\u0026lt;\u0026gt;(); // å¤šå°ä¸€é—œä¿‚ @ManyToOne(fetch = FetchType.LAZY) @JoinColumn(name = \u0026#34;department_id\u0026#34;) private Department department; // å¤šå°å¤šé—œä¿‚ @ManyToMany @JoinTable( name = \u0026#34;user_roles\u0026#34;, joinColumns = @JoinColumn(name = \u0026#34;user_id\u0026#34;), inverseJoinColumns = @JoinColumn(name = \u0026#34;role_id\u0026#34;) ) private Set\u0026lt;Role\u0026gt; roles = new HashSet\u0026lt;\u0026gt;(); // ç‰ˆæœ¬æ§åˆ¶ï¼ˆæ¨‚è§€é–å®šï¼‰ @Version private Long version; // getters and setters... } Repository ä»‹é¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 @Repository public interface UserRepository extends JpaRepository\u0026lt;User, Long\u0026gt;, JpaSpecificationExecutor\u0026lt;User\u0026gt; { // æŸ¥è©¢æ–¹æ³•åç¨±è¦å‰‡ Optional\u0026lt;User\u0026gt; findByEmail(String email); List\u0026lt;User\u0026gt; findByStatusAndCreatedAtAfter(UserStatus status, LocalDateTime date); Page\u0026lt;User\u0026gt; findByNameContainingIgnoreCase(String name, Pageable pageable); // è‡ªè¨‚æŸ¥è©¢ @Query(\u0026#34;SELECT u FROM User u WHERE u.email = ?1 AND u.status = ?2\u0026#34;) Optional\u0026lt;User\u0026gt; findByEmailAndStatus(String email, UserStatus status); // å‘½ååƒæ•¸ @Query(\u0026#34;SELECT u FROM User u WHERE u.name LIKE %:name% ORDER BY u.createdAt DESC\u0026#34;) List\u0026lt;User\u0026gt; findByNameContaining(@Param(\u0026#34;name\u0026#34;) String name); // åŸç”Ÿ SQL @Query(value = \u0026#34;SELECT * FROM users WHERE email = ?1\u0026#34;, nativeQuery = true) User findByEmailNative(String email); // æ›´æ–°æŸ¥è©¢ @Modifying @Query(\u0026#34;UPDATE User u SET u.status = :status WHERE u.id = :id\u0026#34;) int updateUserStatus(@Param(\u0026#34;id\u0026#34;) Long id, @Param(\u0026#34;status\u0026#34;) UserStatus status); // åˆªé™¤æŸ¥è©¢ @Modifying @Query(\u0026#34;DELETE FROM User u WHERE u.status = :status\u0026#34;) void deleteByStatus(@Param(\u0026#34;status\u0026#34;) UserStatus status); // æŠ•å½±æŸ¥è©¢ @Query(\u0026#34;SELECT new com.example.dto.UserSummary(u.id, u.name, u.email) FROM User u\u0026#34;) List\u0026lt;UserSummary\u0026gt; findUserSummaries(); // è¨ˆæ•¸æŸ¥è©¢ long countByStatus(UserStatus status); boolean existsByEmail(String email); } 2. äº¤æ˜“ç®¡ç† @Transactional è¨»è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 @Service @Transactional // é¡åˆ¥å±¤ç´šçš„äº¤æ˜“è¨­å®š public class OrderService { @Autowired private OrderRepository orderRepository; @Autowired private PaymentService paymentService; @Autowired private InventoryService inventoryService; // é è¨­äº¤æ˜“è¨­å®š public Order createOrder(CreateOrderRequest request) { Order order = new Order(request); order = orderRepository.save(order); // é€™äº›æ“ä½œéƒ½åœ¨åŒä¸€å€‹äº¤æ˜“ä¸­ paymentService.processPayment(order); inventoryService.updateStock(order.getItems()); return order; } // å”¯è®€äº¤æ˜“ï¼ˆæ•ˆèƒ½å„ªåŒ–ï¼‰ @Transactional(readOnly = true) public List\u0026lt;Order\u0026gt; findOrdersByUser(Long userId) { return orderRepository.findByUserId(userId); } // æŒ‡å®šå‚³æ’­è¡Œç‚º @Transactional(propagation = Propagation.REQUIRES_NEW) public void logOrderEvent(Long orderId, String event) { // é€™å€‹æ–¹æ³•ç¸½æ˜¯åœ¨æ–°çš„äº¤æ˜“ä¸­åŸ·è¡Œ OrderEvent orderEvent = new OrderEvent(orderId, event); orderEventRepository.save(orderEvent); } // æŒ‡å®šéš”é›¢ç´šåˆ¥ @Transactional(isolation = Isolation.SERIALIZABLE) public void processHighValueOrder(Order order) { // åºåˆ—åŒ–éš”é›¢ç´šåˆ¥ï¼Œé¿å…ä½µç™¼å•é¡Œ processOrder(order); } // ç•°å¸¸å›æ»¾è¨­å®š @Transactional(rollbackFor = {Exception.class}, noRollbackFor = {ValidationException.class}) public void complexOperation() { // é‡åˆ°ä»»ä½• Exception éƒ½å›æ»¾ï¼Œé™¤äº† ValidationException } // è¶…æ™‚è¨­å®š @Transactional(timeout = 30) // 30 ç§’è¶…æ™‚ public void longRunningOperation() { // é•·æ™‚é–“é‹è¡Œçš„æ“ä½œ } // æŒ‡å®šäº¤æ˜“ç®¡ç†å™¨ @Transactional(transactionManager = \u0026#34;secondaryTransactionManager\u0026#34;) public void operationOnSecondaryDatabase() { // ä½¿ç”¨æŒ‡å®šçš„äº¤æ˜“ç®¡ç†å™¨ } } æ’ç¨‹å’ŒéåŒæ­¥è™•ç† 1. æ’ç¨‹ä»»å‹™è¨»è§£ @Scheduled å’Œ @EnableScheduling 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 @Configuration @EnableScheduling public class SchedulingConfig { @Bean public TaskScheduler taskScheduler() { ThreadPoolTaskScheduler scheduler = new ThreadPoolTaskScheduler(); scheduler.setPoolSize(10); scheduler.setThreadNamePrefix(\u0026#34;scheduled-task-\u0026#34;); scheduler.initialize(); return scheduler; } } @Component @Slf4j public class ScheduledTasks { @Autowired private OrderService orderService; @Autowired private EmailService emailService; // å›ºå®šå»¶é²åŸ·è¡Œï¼ˆä¸Šæ¬¡åŸ·è¡Œå®Œæˆå¾Œå¤šä¹…å†åŸ·è¡Œï¼‰ @Scheduled(fixedDelay = 5000) // 5 ç§’ public void processOrders() { log.info(\u0026#34;è™•ç†å¾…è™•ç†è¨‚å–®\u0026#34;); orderService.processePendingOrders(); } // å›ºå®šé »ç‡åŸ·è¡Œï¼ˆå›ºå®šé–“éš”åŸ·è¡Œï¼‰ @Scheduled(fixedRate = 10000) // 10 ç§’ public void heartbeat() { log.info(\u0026#34;ç³»çµ±å¿ƒè·³æª¢æŸ¥\u0026#34;); // ç³»çµ±å¥åº·æª¢æŸ¥é‚è¼¯ } // åˆå§‹å»¶é² @Scheduled(fixedDelay = 30000, initialDelay = 60000) // 1 åˆ†é˜å¾Œé–‹å§‹ï¼Œç„¶å¾Œæ¯ 30 ç§’åŸ·è¡Œ public void cleanupTempFiles() { log.info(\u0026#34;æ¸…ç†æš«å­˜æª”æ¡ˆ\u0026#34;); // æ¸…ç†é‚è¼¯ } // Cron è¡¨é”å¼ - æ¯åˆ†é˜åŸ·è¡Œ @Scheduled(cron = \u0026#34;0 * * * * *\u0026#34;) public void everyMinute() { log.info(\u0026#34;æ¯åˆ†é˜åŸ·è¡Œçš„ä»»å‹™\u0026#34;); } // Cron è¡¨é”å¼ - æ¯å¤©å‡Œæ™¨ 2 é»åŸ·è¡Œ @Scheduled(cron = \u0026#34;0 0 2 * * *\u0026#34;) public void dailyReport() { log.info(\u0026#34;ç”¢ç”Ÿæ¯æ—¥å ±å‘Š\u0026#34;); emailService.sendDailyReport(); } // Cron è¡¨é”å¼ - å·¥ä½œæ—¥ä¸Šåˆ 9 é»åŸ·è¡Œ @Scheduled(cron = \u0026#34;0 0 9 * * MON-FRI\u0026#34;) public void workdayMorningTask() { log.info(\u0026#34;å·¥ä½œæ—¥æ—©æ™¨ä»»å‹™\u0026#34;); } // Cron è¡¨é”å¼ - æ¯æœˆæœ€å¾Œä¸€å¤©åŸ·è¡Œ @Scheduled(cron = \u0026#34;0 0 0 L * *\u0026#34;) public void monthlyTask() { log.info(\u0026#34;æœˆæœ«ä»»å‹™\u0026#34;); } // ä½¿ç”¨é…ç½®å±¬æ€§ @Scheduled(cron = \u0026#34;${app.cleanup.cron:0 0 3 * * *}\u0026#34;) // é è¨­æ¯å¤©å‡Œæ™¨ 3 é» public void configuredTask() { log.info(\u0026#34;å¯é…ç½®çš„æ’ç¨‹ä»»å‹™\u0026#34;); } // æ¢ä»¶æ€§æ’ç¨‹ @Scheduled(fixedDelay = 60000) @ConditionalOnProperty(name = \u0026#34;app.monitoring.enabled\u0026#34;, havingValue = \u0026#34;true\u0026#34;) public void monitoringTask() { log.info(\u0026#34;ç›£æ§ä»»å‹™\u0026#34;); } } Cron è¡¨é”å¼è©³è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 /** * Cron è¡¨é”å¼æ ¼å¼ï¼šç§’ åˆ† æ™‚ æ—¥ æœˆ é€± * * æ¬„ä½èªªæ˜ï¼š * - ç§’ï¼š0-59 * - åˆ†ï¼š0-59 * - æ™‚ï¼š0-23 * - æ—¥ï¼š1-31 * - æœˆï¼š1-12 æˆ– JAN-DEC * - é€±ï¼š0-7 æˆ– SUN-SAT (0 å’Œ 7 éƒ½ä»£è¡¨é€±æ—¥) * * ç‰¹æ®Šå­—ç¬¦ï¼š * * : åŒ¹é…ä»»æ„å€¼ * ? : åªèƒ½ç”¨åœ¨æ—¥å’Œé€±ï¼Œè¡¨ç¤ºä¸æŒ‡å®šå€¼ * - : è¡¨ç¤ºç¯„åœ (ä¾‹å¦‚ï¼š1-5) * , : è¡¨ç¤ºåˆ—èˆ‰ (ä¾‹å¦‚ï¼š1,3,5) * / : è¡¨ç¤ºå¢é‡ (ä¾‹å¦‚ï¼š0/15 è¡¨ç¤ºå¾ 0 é–‹å§‹æ¯ 15 åˆ†é˜) * L : è¡¨ç¤ºæœ€å¾Œ (ä¾‹å¦‚ï¼šL åœ¨æ—¥æ¬„ä½è¡¨ç¤ºè©²æœˆæœ€å¾Œä¸€å¤©) * W : è¡¨ç¤ºå·¥ä½œæ—¥ (ä¾‹å¦‚ï¼š15W è¡¨ç¤ºè·é›¢ 15 è™Ÿæœ€è¿‘çš„å·¥ä½œæ—¥) * # : è¡¨ç¤ºç¬¬å¹¾å€‹é€±å¹¾ (ä¾‹å¦‚ï¼š6#3 è¡¨ç¤ºç¬¬ä¸‰å€‹é€±äº”) */ @Component public class CronExamples { @Scheduled(cron = \u0026#34;0 0 * * * *\u0026#34;) // æ¯å°æ™‚æ•´é»åŸ·è¡Œ public void hourly() {} @Scheduled(cron = \u0026#34;*/10 * * * * *\u0026#34;) // æ¯ 10 ç§’åŸ·è¡Œ public void every10Seconds() {} @Scheduled(cron = \u0026#34;0 0 8-18 * * *\u0026#34;) // æ¯å¤© 8-18 é»æ•´é»åŸ·è¡Œ public void businessHours() {} @Scheduled(cron = \u0026#34;0 0/30 8-18 * * *\u0026#34;) // æ¯å¤© 8-18 é»æ¯åŠå°æ™‚åŸ·è¡Œ public void businessHalfHour() {} @Scheduled(cron = \u0026#34;0 0 9-17 * * MON-FRI\u0026#34;) // å·¥ä½œæ—¥ 9-17 é»æ•´é»åŸ·è¡Œ public void workingHours() {} @Scheduled(cron = \u0026#34;0 0 0 25 12 ?\u0026#34;) // æ¯å¹´è–èª•ç¯€ 00:00 åŸ·è¡Œ public void christmas() {} @Scheduled(cron = \u0026#34;0 0 0 L * *\u0026#34;) // æ¯æœˆæœ€å¾Œä¸€å¤© 00:00 åŸ·è¡Œ public void lastDayOfMonth() {} @Scheduled(cron = \u0026#34;0 0 0 LW * *\u0026#34;) // æ¯æœˆæœ€å¾Œä¸€å€‹å·¥ä½œæ—¥ 00:00 åŸ·è¡Œ public void lastWorkdayOfMonth() {} @Scheduled(cron = \u0026#34;0 0 0 * * 1#1\u0026#34;) // æ¯æœˆç¬¬ä¸€å€‹é€±ä¸€ 00:00 åŸ·è¡Œ public void firstMondayOfMonth() {} } 2. éåŒæ­¥è™•ç†è¨»è§£ @Async å’Œ @EnableAsync 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 @Configuration @EnableAsync public class AsyncConfig implements AsyncConfigurer { @Override @Bean(name = \u0026#34;taskExecutor\u0026#34;) public Executor getAsyncExecutor() { ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(5); executor.setMaxPoolSize(20); executor.setQueueCapacity(100); executor.setThreadNamePrefix(\u0026#34;async-task-\u0026#34;); executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); executor.initialize(); return executor; } @Override public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() { return (ex, method, params) -\u0026gt; { log.error(\u0026#34;éåŒæ­¥æ–¹æ³• {} åŸ·è¡Œç•°å¸¸\u0026#34;, method.getName(), ex); }; } } @Service @Slf4j public class NotificationService { // ç°¡å–®éåŒæ­¥æ–¹æ³• @Async public void sendEmail(String to, String subject, String content) { log.info(\u0026#34;ç™¼é€éƒµä»¶åˆ° {}\u0026#34;, to); // æ¨¡æ“¬éƒµä»¶ç™¼é€ try { Thread.sleep(2000); log.info(\u0026#34;éƒµä»¶ç™¼é€å®Œæˆ\u0026#34;); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } } // è¿”å› CompletableFuture @Async public CompletableFuture\u0026lt;String\u0026gt; sendSms(String phone, String message) { log.info(\u0026#34;ç™¼é€ç°¡è¨Šåˆ° {}\u0026#34;, phone); try { Thread.sleep(1000); return CompletableFuture.completedFuture(\u0026#34;ç°¡è¨Šç™¼é€æˆåŠŸ\u0026#34;); } catch (InterruptedException e) { Thread.currentThread().interrupt(); return CompletableFuture.failedFuture(e); } } // æŒ‡å®šåŸ·è¡Œå™¨ @Async(\u0026#34;taskExecutor\u0026#34;) public CompletableFuture\u0026lt;Boolean\u0026gt; processLargeFile(String filePath) { log.info(\u0026#34;é–‹å§‹è™•ç†å¤§æª”æ¡ˆï¼š{}\u0026#34;, filePath); try { // æ¨¡æ“¬æª”æ¡ˆè™•ç† Thread.sleep(5000); log.info(\u0026#34;æª”æ¡ˆè™•ç†å®Œæˆï¼š{}\u0026#34;, filePath); return CompletableFuture.completedFuture(true); } catch (InterruptedException e) { Thread.currentThread().interrupt(); return CompletableFuture.failedFuture(e); } } // æ‰¹é‡éåŒæ­¥è™•ç† public CompletableFuture\u0026lt;Void\u0026gt; sendBulkNotifications(List\u0026lt;User\u0026gt; users, String message) { List\u0026lt;CompletableFuture\u0026lt;Void\u0026gt;\u0026gt; futures = users.stream() .map(user -\u0026gt; sendNotificationAsync(user, message)) .collect(Collectors.toList()); return CompletableFuture.allOf(futures.toArray(new CompletableFuture[0])); } @Async private CompletableFuture\u0026lt;Void\u0026gt; sendNotificationAsync(User user, String message) { // ç™¼é€é€šçŸ¥é‚è¼¯ return CompletableFuture.completedFuture(null); } } Spring Boot ç‰¹å®šè¨»è§£ 1. è‡ªå‹•é…ç½®è¨»è§£ @SpringBootApplication åˆ†è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // @SpringBootApplication ç­‰åŒæ–¼ä»¥ä¸‹ä¸‰å€‹è¨»è§£çš„çµ„åˆï¼š // @Configuration + @EnableAutoConfiguration + @ComponentScan @SpringBootApplication // ç­‰åŒæ–¼ï¼š // @Configuration // @EnableAutoConfiguration // @ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), // @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) public class Application { public static void main(String[] args) { SpringApplication.run(Application.class, args); } } // è‡ªè¨‚æƒæé…ç½® @SpringBootApplication( scanBasePackages = {\u0026#34;com.example.app\u0026#34;, \u0026#34;com.example.shared\u0026#34;}, exclude = {DataSourceAutoConfiguration.class} // æ’é™¤ç‰¹å®šè‡ªå‹•é…ç½® ) public class CustomApplication { public static void main(String[] args) { SpringApplication.run(CustomApplication.class, args); } } æ¢ä»¶è¨»è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 @Configuration public class ConditionalConfiguration { // ç•¶é¡åˆ¥å­˜åœ¨æ™‚ @Bean @ConditionalOnClass(RedisTemplate.class) public RedisService redisService() { return new RedisService(); } // ç•¶é¡åˆ¥ä¸å­˜åœ¨æ™‚ @Bean @ConditionalOnMissingClass(\u0026#34;com.example.CustomService\u0026#34;) public DefaultService defaultService() { return new DefaultService(); } // ç•¶ Bean å­˜åœ¨æ™‚ @Bean @ConditionalOnBean(DataSource.class) public JdbcTemplate jdbcTemplate(DataSource dataSource) { return new JdbcTemplate(dataSource); } // ç•¶ Bean ä¸å­˜åœ¨æ™‚ @Bean @ConditionalOnMissingBean(EmailService.class) public EmailService mockEmailService() { return new MockEmailService(); } // ç•¶å±¬æ€§å­˜åœ¨ä¸”ç¬¦åˆæ¢ä»¶æ™‚ @Bean @ConditionalOnProperty(name = \u0026#34;app.cache.enabled\u0026#34;, havingValue = \u0026#34;true\u0026#34;, matchIfMissing = false) public CacheManager cacheManager() { return new ConcurrentMapCacheManager(); } // ç•¶ Web æ‡‰ç”¨ç¨‹å¼æ™‚ @Bean @ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET) public WebMvcConfigurer webMvcConfigurer() { return new CustomWebMvcConfigurer(); } // ç•¶é Web æ‡‰ç”¨ç¨‹å¼æ™‚ @Bean @ConditionalOnNotWebApplication public CommandLineRunner commandLineRunner() { return args -\u0026gt; System.out.println(\u0026#34;Non-web application started\u0026#34;); } // ç•¶ç‰¹å®š Profile å•Ÿç”¨æ™‚ @Bean @Profile(\u0026#34;development\u0026#34;) public DataSource devDataSource() { return new H2DataSource(); } @Bean @Profile(\u0026#34;production\u0026#34;) public DataSource prodDataSource() { return new MySQLDataSource(); } // è‡ªè¨‚æ¢ä»¶ @Bean @ConditionalOnCustomCondition public CustomService customService() { return new CustomService(); } } // è‡ªè¨‚æ¢ä»¶å¯¦ä½œ public class CustomCondition implements Condition { @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) { // è‡ªè¨‚æ¢ä»¶é‚è¼¯ String osName = context.getEnvironment().getProperty(\u0026#34;os.name\u0026#34;); return osName != null \u0026amp;\u0026amp; osName.toLowerCase().contains(\u0026#34;windows\u0026#34;); } } @Target({ElementType.TYPE, ElementType.METHOD}) @Retention(RetentionPolicy.RUNTIME) @Conditional(CustomCondition.class) public @interface ConditionalOnCustomCondition { } 2. é…ç½®å±¬æ€§è¨»è§£ @ConfigurationProperties 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 @ConfigurationProperties(prefix = \u0026#34;app\u0026#34;) @Component @Validated @Data public class AppProperties { @NotBlank private String name; @NotBlank private String version; @Valid private Database database = new Database(); @Valid private Cache cache = new Cache(); private List\u0026lt;String\u0026gt; allowedOrigins = new ArrayList\u0026lt;\u0026gt;(); private Map\u0026lt;String, String\u0026gt; headers = new HashMap\u0026lt;\u0026gt;(); @Data public static class Database { @NotBlank private String url; @NotBlank private String username; @NotBlank private String password; @Min(1) @Max(100) private int maxConnections = 10; @DurationMin(seconds = 1) @DurationMax(minutes = 5) private Duration timeout = Duration.ofSeconds(30); } @Data public static class Cache { private boolean enabled = true; @Positive private int maxSize = 1000; @DurationMin(minutes = 1) private Duration ttl = Duration.ofMinutes(10); private CacheType type = CacheType.MEMORY; } public enum CacheType { MEMORY, REDIS, HAZELCAST } } // ä½¿ç”¨é…ç½® @Service @RequiredArgsConstructor public class AppService { private final AppProperties appProperties; public void printConfig() { System.out.println(\u0026#34;App Name: \u0026#34; + appProperties.getName()); System.out.println(\u0026#34;Database URL: \u0026#34; + appProperties.getDatabase().getUrl()); System.out.println(\u0026#34;Cache Enabled: \u0026#34; + appProperties.getCache().isEnabled()); } } å¿«å–è¨»è§£ @EnableCaching å’Œå¿«å–æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 @Configuration @EnableCaching public class CacheConfig { @Bean public CacheManager cacheManager() { ConcurrentMapCacheManager cacheManager = new ConcurrentMapCacheManager(); cacheManager.setAllowNullValues(false); return cacheManager; } } @Service @Slf4j public class UserService { @Autowired private UserRepository userRepository; // å¿«å–çµæœ @Cacheable(value = \u0026#34;users\u0026#34;, key = \u0026#34;#id\u0026#34;) public User findById(Long id) { log.info(\u0026#34;å¾è³‡æ–™åº«è¼‰å…¥ä½¿ç”¨è€…ï¼š{}\u0026#34;, id); return userRepository.findById(id).orElse(null); } // æ¢ä»¶å¿«å– @Cacheable(value = \u0026#34;users\u0026#34;, key = \u0026#34;#email\u0026#34;, condition = \u0026#34;#email.length() \u0026gt; 5\u0026#34;) public User findByEmail(String email) { return userRepository.findByEmail(email).orElse(null); } // å¿«å–å¤šå€‹å€¼ @Cacheable(value = \u0026#34;userProfiles\u0026#34;, key = \u0026#34;#user.id\u0026#34;, unless = \u0026#34;#result.isEmpty()\u0026#34;) public List\u0026lt;UserProfile\u0026gt; getUserProfiles(User user) { return userProfileRepository.findByUserId(user.getId()); } // æ›´æ–°å¿«å– @CachePut(value = \u0026#34;users\u0026#34;, key = \u0026#34;#user.id\u0026#34;) public User updateUser(User user) { log.info(\u0026#34;æ›´æ–°ä½¿ç”¨è€…ä¸¦åˆ·æ–°å¿«å–ï¼š{}\u0026#34;, user.getId()); return userRepository.save(user); } // æ¸…é™¤å¿«å– @CacheEvict(value = \u0026#34;users\u0026#34;, key = \u0026#34;#id\u0026#34;) public void deleteUser(Long id) { log.info(\u0026#34;åˆªé™¤ä½¿ç”¨è€…ä¸¦æ¸…é™¤å¿«å–ï¼š{}\u0026#34;, id); userRepository.deleteById(id); } // æ¸…é™¤æ‰€æœ‰å¿«å– @CacheEvict(value = \u0026#34;users\u0026#34;, allEntries = true) public void clearUserCache() { log.info(\u0026#34;æ¸…é™¤æ‰€æœ‰ä½¿ç”¨è€…å¿«å–\u0026#34;); } // çµ„åˆå¿«å–æ“ä½œ @Caching( cacheable = @Cacheable(value = \u0026#34;users\u0026#34;, key = \u0026#34;#id\u0026#34;), evict = @CacheEvict(value = \u0026#34;userStats\u0026#34;, key = \u0026#34;#id\u0026#34;) ) public User findAndUpdateStats(Long id) { User user = userRepository.findById(id).orElse(null); if (user != null) { updateUserStats(user); } return user; } // è‡ªè¨‚å¿«å–éµç”Ÿæˆå™¨ @Cacheable(value = \u0026#34;userSearch\u0026#34;, keyGenerator = \u0026#34;customKeyGenerator\u0026#34;) public List\u0026lt;User\u0026gt; searchUsers(UserSearchCriteria criteria) { return userRepository.findByCriteria(criteria); } } @Component(\u0026#34;customKeyGenerator\u0026#34;) public class CustomKeyGenerator implements KeyGenerator { @Override public Object generate(Object target, Method method, Object... params) { return method.getName() + \u0026#34;_\u0026#34; + Arrays.toString(params); } } æ¸¬è©¦è¨»è§£ Spring Boot æ¸¬è©¦è¨»è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 // å®Œæ•´çš„ Spring Boot æ¸¬è©¦ @SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) @TestPropertySource(properties = { \u0026#34;spring.datasource.url=jdbc:h2:mem:testdb\u0026#34;, \u0026#34;spring.jpa.hibernate.ddl-auto=create-drop\u0026#34; }) class IntegrationTest { @Autowired private TestRestTemplate restTemplate; @Autowired private UserService userService; @Test void testCreateUser() { CreateUserRequest request = new CreateUserRequest(\u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;); ResponseEntity\u0026lt;User\u0026gt; response = restTemplate.postForEntity(\u0026#34;/api/users\u0026#34;, request, User.class); assertThat(response.getStatusCode()).isEqualTo(HttpStatus.CREATED); assertThat(response.getBody().getName()).isEqualTo(\u0026#34;John\u0026#34;); } } // Web å±¤æ¸¬è©¦ @WebMvcTest(UserController.class) class UserControllerTest { @Autowired private MockMvc mockMvc; @MockBean private UserService userService; @Test void testGetUser() throws Exception { User user = new User(1L, \u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;); when(userService.findById(1L)).thenReturn(user); mockMvc.perform(get(\u0026#34;/api/users/1\u0026#34;)) .andExpect(status().isOk()) .andExpect(jsonPath(\u0026#34;$.name\u0026#34;).value(\u0026#34;John\u0026#34;)) .andExpect(jsonPath(\u0026#34;$.email\u0026#34;).value(\u0026#34;john@example.com\u0026#34;)); } } // è³‡æ–™å±¤æ¸¬è©¦ @DataJpaTest class UserRepositoryTest { @Autowired private TestEntityManager entityManager; @Autowired private UserRepository userRepository; @Test void testFindByEmail() { // Given User user = new User(\u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;); entityManager.persistAndFlush(user); // When Optional\u0026lt;User\u0026gt; found = userRepository.findByEmail(\u0026#34;john@example.com\u0026#34;); // Then assertThat(found).isPresent(); assertThat(found.get().getName()).isEqualTo(\u0026#34;John\u0026#34;); } } // JSON åºåˆ—åŒ–æ¸¬è©¦ @JsonTest class UserJsonTest { @Autowired private JacksonTester\u0026lt;User\u0026gt; json; @Test void testSerialize() throws Exception { User user = new User(1L, \u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;); assertThat(json.write(user)).isEqualToJson(\u0026#34;user.json\u0026#34;); assertThat(json.write(user)).hasJsonPathStringValue(\u0026#34;@.name\u0026#34;); assertThat(json.write(user)).extractingJsonPathStringValue(\u0026#34;@.name\u0026#34;).isEqualTo(\u0026#34;John\u0026#34;); } @Test void testDeserialize() throws Exception { String content = \u0026#34;\u0026#34;\u0026#34; { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34; } \u0026#34;\u0026#34;\u0026#34;; assertThat(json.parse(content)).usingRecursiveComparison() .isEqualTo(new User(1L, \u0026#34;John\u0026#34;, \u0026#34;john@example.com\u0026#34;)); } } äº‹ä»¶è™•ç†è¨»è§£ @EventListener å’Œ @TransactionalEventListener 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 // äº‹ä»¶å®šç¾© public class OrderCreatedEvent { private final Order order; private final LocalDateTime timestamp; public OrderCreatedEvent(Order order) { this.order = order; this.timestamp = LocalDateTime.now(); } // getters... } // äº‹ä»¶ç™¼å¸ƒ @Service @RequiredArgsConstructor public class OrderService { private final OrderRepository orderRepository; private final ApplicationEventPublisher eventPublisher; @Transactional public Order createOrder(CreateOrderRequest request) { Order order = new Order(request); order = orderRepository.save(order); // ç™¼å¸ƒäº‹ä»¶ eventPublisher.publishEvent(new OrderCreatedEvent(order)); return order; } } // äº‹ä»¶ç›£è½ @Component @Slf4j public class OrderEventListener { @Autowired private EmailService emailService; @Autowired private InventoryService inventoryService; // åŸºæœ¬äº‹ä»¶ç›£è½ @EventListener public void handleOrderCreated(OrderCreatedEvent event) { log.info(\u0026#34;è¨‚å–®å‰µå»ºäº‹ä»¶ï¼š{}\u0026#34;, event.getOrder().getId()); } // æ¢ä»¶äº‹ä»¶ç›£è½ @EventListener(condition = \u0026#34;#event.order.amount \u0026gt; 1000\u0026#34;) public void handleHighValueOrder(OrderCreatedEvent event) { log.info(\u0026#34;é«˜åƒ¹å€¼è¨‚å–®å‰µå»ºï¼š{}\u0026#34;, event.getOrder().getId()); // ç‰¹æ®Šè™•ç†é‚è¼¯ } // éåŒæ­¥äº‹ä»¶è™•ç† @EventListener @Async public void sendOrderConfirmationEmail(OrderCreatedEvent event) { log.info(\u0026#34;ç™¼é€è¨‚å–®ç¢ºèªéƒµä»¶ï¼š{}\u0026#34;, event.getOrder().getId()); emailService.sendOrderConfirmation(event.getOrder()); } // äº¤æ˜“äº‹ä»¶ç›£è½ï¼ˆåœ¨äº¤æ˜“æäº¤å¾ŒåŸ·è¡Œï¼‰ @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT) public void updateInventoryAfterOrderCreated(OrderCreatedEvent event) { log.info(\u0026#34;äº¤æ˜“æäº¤å¾Œæ›´æ–°åº«å­˜ï¼š{}\u0026#34;, event.getOrder().getId()); inventoryService.updateStock(event.getOrder().getItems()); } // äº¤æ˜“å›æ»¾æ™‚åŸ·è¡Œ @TransactionalEventListener(phase = TransactionPhase.AFTER_ROLLBACK) public void handleOrderCreationRollback(OrderCreatedEvent event) { log.warn(\u0026#34;è¨‚å–®å‰µå»ºå›æ»¾ï¼š{}\u0026#34;, event.getOrder().getId()); // å›æ»¾è™•ç†é‚è¼¯ } // ç›£è½å¤šç¨®äº‹ä»¶é¡å‹ @EventListener({OrderCreatedEvent.class, OrderUpdatedEvent.class}) public void handleOrderEvents(Object event) { log.info(\u0026#34;è™•ç†è¨‚å–®äº‹ä»¶ï¼š{}\u0026#34;, event.getClass().getSimpleName()); } } ç¸½çµ Spring Framework çš„è¨»è§£ç³»çµ±ç‚ºé–‹ç™¼è€…æä¾›äº†å¼·å¤§ä¸”éˆæ´»çš„é…ç½®æ–¹å¼ã€‚é€éåˆç†ä½¿ç”¨é€™äº›è¨»è§£ï¼Œå¯ä»¥å¤§å¹…ç°¡åŒ–é…ç½®å·¥ä½œä¸¦æå‡é–‹ç™¼æ•ˆç‡ã€‚\næœ€ä½³å¯¦è¸å»ºè­° å„ªå…ˆä½¿ç”¨è¨»è§£é…ç½®ï¼šç›¸æ¯” XML é…ç½®ï¼Œè¨»è§£æ›´ç›´è§€ä¸”æ˜“æ–¼ç¶­è­· çµ„åˆä½¿ç”¨è¨»è§£ï¼šå–„ç”¨ @SpringBootApplication ç­‰çµ„åˆè¨»è§£ é©ç•¶ä½¿ç”¨æ¢ä»¶è¨»è§£ï¼šæ ¹æ“šç’°å¢ƒå‹•æ…‹é…ç½® Bean é©—è­‰é…ç½®å±¬æ€§ï¼šä½¿ç”¨ @Validated ç¢ºä¿é…ç½®æ­£ç¢ºæ€§ åˆç†ä½¿ç”¨å¿«å–ï¼šåœ¨é©ç•¶çš„åœ°æ–¹ä½¿ç”¨å¿«å–æå‡æ•ˆèƒ½ æ¸¬è©¦è¦†è“‹ï¼šä½¿ç”¨å°ˆé–€çš„æ¸¬è©¦è¨»è§£é€²è¡Œå„å±¤æ¸¬è©¦ äº‹ä»¶é©…å‹•è¨­è¨ˆï¼šä½¿ç”¨äº‹ä»¶æ©Ÿåˆ¶é™ä½çµ„ä»¶è€¦åˆåº¦ æ³¨æ„äº‹é … è¨»è§£éè¼‰ï¼šé¿å…åœ¨å–®ä¸€é¡åˆ¥æˆ–æ–¹æ³•ä¸Šä½¿ç”¨éå¤šè¨»è§£ é…ç½®å¤–éƒ¨åŒ–ï¼šæ•æ„Ÿé…ç½®æ‡‰ä½¿ç”¨å¤–éƒ¨å±¬æ€§æª”æ¡ˆ æ•ˆèƒ½è€ƒé‡ï¼šæ³¨æ„ä»£ç†æ¨¡å¼å¯èƒ½å¸¶ä¾†çš„æ•ˆèƒ½å½±éŸ¿ æ¸¬è©¦å‹å–„ï¼šè¨­è¨ˆæ™‚è€ƒæ…®æ¸¬è©¦çš„ä¾¿åˆ©æ€§ æŒæ¡é€™äº›è¨»è§£çš„æ­£ç¢ºä½¿ç”¨æ–¹å¼ï¼Œå°‡èƒ½å¤§å¹…æå‡ Spring æ‡‰ç”¨ç¨‹å¼çš„é–‹ç™¼æ•ˆç‡å’Œç¨‹å¼ç¢¼å“è³ªã€‚\nåƒè€ƒè³‡æ–™ Spring Framework Reference Documentation Spring Boot Reference Guide Spring Data JPA Reference Bean Validation Specification Cron Expression Generator ","permalink":"https://xinqilin.github.io/post/backend/springannotation/","tags":["Java","Spring","Annotation","Spring-Boot","Configuration","Web","Data","Security"],"title":"Spring Framework è¨»è§£å®Œæ•´æŒ‡å—ï¼šå¾åŸºç¤åˆ°é€²éšæ‡‰ç”¨"},{"content":"æ¦‚è¿° AWK æ˜¯ä¸€ç¨®å¼·å¤§çš„æ¨¡å¼æƒæå’Œè™•ç†èªè¨€ï¼Œç”± Alfred Ahoã€Peter Weinberger å’Œ Brian Kernighan æ–¼ 1977 å¹´åœ¨è²çˆ¾å¯¦é©—å®¤é–‹ç™¼ã€‚AWK ç‰¹åˆ¥é©åˆè™•ç†çµæ§‹åŒ–æ–‡æœ¬è³‡æ–™ï¼Œèƒ½å¤ é€²è¡Œè¤‡é›œçš„æ–‡æœ¬åˆ†æã€å ±è¡¨ç”Ÿæˆå’Œè³‡æ–™æå–ã€‚\næ ¸å¿ƒç‰¹å¾µ æ¨¡å¼-å‹•ä½œç¨‹å¼è¨­è¨ˆï¼šåŸºæ–¼æ¨¡å¼åŒ¹é…åŸ·è¡Œç›¸æ‡‰å‹•ä½œ è‡ªå‹•æ¬„ä½åˆ†å‰²ï¼šè‡ªå‹•å°‡è¼¸å…¥è¡Œåˆ†å‰²ç‚ºæ¬„ä½ å¼·å¤§çš„å…§å»ºè®Šæ•¸ï¼šæä¾›è±å¯Œçš„ç’°å¢ƒè³‡è¨Š æ•¸å­¸é‹ç®—èƒ½åŠ›ï¼šæ”¯æ´å®Œæ•´çš„ç®—è¡“å’Œå­—ä¸²æ“ä½œ æ­£è¦è¡¨é”å¼æ”¯æ´ï¼šå¼·å¤§çš„æ¨¡å¼åŒ¹é…åŠŸèƒ½ åŸºæœ¬èªæ³• 1 2 3 awk \u0026#39;pattern { action }\u0026#39; file(s) awk -f script.awk file(s) command | awk \u0026#39;pattern { action }\u0026#39; AWK ç¨‹å¼çµæ§‹ 1 2 3 awk \u0026#39;BEGIN { åˆå§‹åŒ–å‹•ä½œ } pattern { ä¸»è¦è™•ç†å‹•ä½œ } END { çµæŸå‹•ä½œ }\u0026#39; file åŸºæœ¬ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 # åˆ—å°æ•´å€‹æª”æ¡ˆ awk \u0026#39;{print}\u0026#39; file.txt # ç­‰åŒæ–¼ awk \u0026#39;{print $0}\u0026#39; file.txt # åˆ—å°ç‰¹å®šæ¬„ä½ awk \u0026#39;{print $1, $3}\u0026#39; file.txt # åˆ—å°ç¬¬1å’Œç¬¬3æ¬„ä½ # ç°¡å–®éæ¿¾ awk \u0026#39;/pattern/ {print}\u0026#39; file.txt # åˆ—å°åŒ…å« pattern çš„è¡Œ # è¨ˆç®—çµ±è¨ˆ awk \u0026#39;{sum += $1} END {print sum}\u0026#39; file.txt # è¨ˆç®—ç¬¬1æ¬„ä½ç¸½å’Œ æ¬„ä½å’Œè¨˜éŒ„ æ¬„ä½è™•ç† AWK è‡ªå‹•å°‡æ¯è¡Œè¼¸å…¥åˆ†å‰²ç‚ºæ¬„ä½ï¼Œé è¨­åˆ†éš”ç¬¦ç‚ºç©ºç™½å­—å…ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 # æ¬„ä½è®Šæ•¸ $0 # æ•´è¡Œå…§å®¹ $1 # ç¬¬1å€‹æ¬„ä½ $2 # ç¬¬2å€‹æ¬„ä½ $NF # æœ€å¾Œä¸€å€‹æ¬„ä½ $(NF-1) # å€’æ•¸ç¬¬2å€‹æ¬„ä½ # å¯¦éš›ç¯„ä¾‹ echo \u0026#34;apple banana cherry\u0026#34; | awk \u0026#39;{print $2}\u0026#39; # banana echo \u0026#34;1 2 3 4 5\u0026#34; | awk \u0026#39;{print $NF}\u0026#39; # 5 echo \u0026#34;a:b:c:d\u0026#34; | awk -F: \u0026#39;{print $3}\u0026#39; # c è‡ªè¨‚åˆ†éš”ç¬¦ 1 2 3 4 5 6 7 8 # ä½¿ç”¨ -F é¸é … awk -F: \u0026#39;{print $1, $3}\u0026#39; /etc/passwd # ä½¿ç”¨å†’è™Ÿä½œåˆ†éš”ç¬¦ awk -F\u0026#39;,\u0026#39; \u0026#39;{print $2}\u0026#39; data.csv # CSV æª”æ¡ˆè™•ç† awk -F\u0026#39;[,:]\u0026#39; \u0026#39;{print $1, $3}\u0026#39; file.txt # å¤šå€‹åˆ†éš”ç¬¦ # åœ¨ç¨‹å¼ä¸­è¨­å®š awk \u0026#39;BEGIN {FS=\u0026#34;,\u0026#34;} {print $1, $2}\u0026#39; data.csv # åœ¨ BEGIN ä¸­è¨­å®š awk \u0026#39;{FS=\u0026#34;,\u0026#34;} NR\u0026gt;1 {print $1, $2}\u0026#39; data.csv # å‹•æ…‹æ”¹è®Šåˆ†éš”ç¬¦ è¼¸å‡ºæ¬„ä½åˆ†éš”ç¬¦ 1 2 3 4 5 6 7 # è¨­å®šè¼¸å‡ºåˆ†éš”ç¬¦ awk \u0026#39;BEGIN {OFS=\u0026#34;\\t\u0026#34;} {print $1, $2, $3}\u0026#39; file.txt # ä½¿ç”¨ tab åˆ†éš”è¼¸å‡º awk \u0026#39;BEGIN {OFS=\u0026#34; | \u0026#34;} {print $1, $2}\u0026#39; file.txt # ä½¿ç”¨ \u0026#34; | \u0026#34; åˆ†éš” # é‡å»ºè¡Œ awk \u0026#39;{$1=$1; print}\u0026#39; file.txt # é‡æ–°æ ¼å¼åŒ–ç©ºç™½ awk \u0026#39;BEGIN {OFS=\u0026#34;,\u0026#34;} {$1=$1; print}\u0026#39; file.txt # è½‰æ›ç‚º CSV æ ¼å¼ å…§å»ºè®Šæ•¸ æ ¸å¿ƒå…§å»ºè®Šæ•¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # è¨˜éŒ„ç›¸é—œ NR # ç¸½è¨˜éŒ„æ•¸ï¼ˆè¡Œè™Ÿï¼‰ FNR # ç•¶å‰æª”æ¡ˆçš„è¨˜éŒ„æ•¸ NF # ç•¶å‰è¨˜éŒ„çš„æ¬„ä½æ•¸ # åˆ†éš”ç¬¦ç›¸é—œ FS # è¼¸å…¥æ¬„ä½åˆ†éš”ç¬¦ OFS # è¼¸å‡ºæ¬„ä½åˆ†éš”ç¬¦ RS # è¼¸å…¥è¨˜éŒ„åˆ†éš”ç¬¦ ORS # è¼¸å‡ºè¨˜éŒ„åˆ†éš”ç¬¦ # æª”æ¡ˆç›¸é—œ FILENAME # ç•¶å‰è™•ç†çš„æª”æ¡ˆå ARGC # å‘½ä»¤è¡Œåƒæ•¸å€‹æ•¸ ARGV # å‘½ä»¤è¡Œåƒæ•¸é™£åˆ— å¯¦ç”¨ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨ NR æ·»åŠ è¡Œè™Ÿ awk \u0026#39;{print NR, $0}\u0026#39; file.txt # ä½¿ç”¨ NF æª¢æŸ¥æ¬„ä½æ•¸ awk \u0026#39;NF != 3 {print \u0026#34;Line \u0026#34; NR \u0026#34; has \u0026#34; NF \u0026#34; fields\u0026#34;}\u0026#39; file.txt # è™•ç†å¤šå€‹æª”æ¡ˆæ™‚ä½¿ç”¨ FNR awk \u0026#39;{print FILENAME, FNR, $0}\u0026#39; file1.txt file2.txt # ä½¿ç”¨ ARGC å’Œ ARGV awk \u0026#39;BEGIN { print \u0026#34;Total arguments:\u0026#34;, ARGC for (i=0; i\u0026lt;ARGC; i++) print \u0026#34;ARGV[\u0026#34; i \u0026#34;]:\u0026#34;, ARGV[i] }\u0026#39; file1 file2 ç‰¹æ®Šè®Šæ•¸ 1 2 3 4 5 6 7 8 9 10 11 # æ•¸å­—æ ¼å¼ OFMT # æ•¸å­—è¼¸å‡ºæ ¼å¼ï¼ˆé è¨­ \u0026#34;%.6g\u0026#34;ï¼‰ CONVFMT # å­—ä¸²è½‰æ›æ ¼å¼ # æ¨¡å¼åŒ¹é… RSTART # match() å‡½æ•¸åŒ¹é…çš„èµ·å§‹ä½ç½® RLENGTH # match() å‡½æ•¸åŒ¹é…çš„é•·åº¦ # å…¶ä»– SUBSEP # ä¸‹æ¨™åˆ†éš”ç¬¦ï¼ˆç”¨æ–¼å¤šç¶­é™£åˆ—ï¼‰ ENVIRON # ç’°å¢ƒè®Šæ•¸é™£åˆ— æ¨¡å¼åŒ¹é… åŸºæœ¬æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 # æ­£è¦è¡¨é”å¼æ¨¡å¼ awk \u0026#39;/pattern/ {print}\u0026#39; file.txt # åŒ¹é…åŒ…å« pattern çš„è¡Œ awk \u0026#39;/^[0-9]/ {print}\u0026#39; file.txt # åŒ¹é…ä»¥æ•¸å­—é–‹é ­çš„è¡Œ awk \u0026#39;/\\.txt$/ {print}\u0026#39; file.txt # åŒ¹é…ä»¥ .txt çµå°¾çš„è¡Œ # é—œä¿‚è¡¨é”å¼æ¨¡å¼ awk \u0026#39;$1 \u0026gt; 100 {print}\u0026#39; file.txt # ç¬¬1æ¬„ä½ \u0026gt; 100 awk \u0026#39;NF == 5 {print}\u0026#39; file.txt # æœ‰5å€‹æ¬„ä½çš„è¡Œ awk \u0026#39;length($0) \u0026gt; 80 {print}\u0026#39; file.txt # è¡Œé•·åº¦ \u0026gt; 80 # ç¯„åœæ¨¡å¼ awk \u0026#39;/start/,/end/ {print}\u0026#39; file.txt # å¾ start åˆ° end çš„è¡Œ awk \u0026#39;NR==5,NR==10 {print}\u0026#39; file.txt # ç¬¬5åˆ°10è¡Œ é€²éšæ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 # çµ„åˆæ¨¡å¼ awk \u0026#39;/error/ \u0026amp;\u0026amp; $3 \u0026gt; 100 {print}\u0026#39; file.txt # AND æ¢ä»¶ awk \u0026#39;/warn/ || /error/ {print}\u0026#39; file.txt # OR æ¢ä»¶ awk \u0026#39;!/debug/ {print}\u0026#39; file.txt # NOT æ¢ä»¶ # æ¬„ä½æ¨¡å¼åŒ¹é… awk \u0026#39;$2 ~ /pattern/ {print}\u0026#39; file.txt # ç¬¬2æ¬„ä½åŒ¹é… pattern awk \u0026#39;$1 !~ /^[0-9]/ {print}\u0026#39; file.txt # ç¬¬1æ¬„ä½ä¸ä»¥æ•¸å­—é–‹é ­ # è¤‡é›œæ¢ä»¶ awk \u0026#39;$1==\u0026#34;ERROR\u0026#34; \u0026amp;\u0026amp; $3\u0026gt;threshold {count++} END {print count}\u0026#39; file.txt å‹•ä½œå’Œæ§åˆ¶çµæ§‹ åŸºæœ¬å‹•ä½œ 1 2 3 4 5 6 7 8 # åˆ—å°å‹•ä½œ awk \u0026#39;{print}\u0026#39; file.txt # åˆ—å°æ•´è¡Œ awk \u0026#39;{print $1, $2}\u0026#39; file.txt # åˆ—å°ç‰¹å®šæ¬„ä½ awk \u0026#39;{printf \u0026#34;%s: %d\\n\u0026#34;, $1, $2}\u0026#39; file.txt # æ ¼å¼åŒ–åˆ—å° # è³¦å€¼å‹•ä½œ awk \u0026#39;{$1=\u0026#34;NEW\u0026#34;; print}\u0026#39; file.txt # ä¿®æ”¹æ¬„ä½å€¼ awk \u0026#39;{sum += $1} END {print sum}\u0026#39; file.txt # ç´¯åŠ è¨ˆç®— æ§åˆ¶çµæ§‹ if-else èªå¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # åŸºæœ¬ if èªå¥ awk \u0026#39;{ if ($1 \u0026gt; 100) print \u0026#34;Large:\u0026#34;, $0 else print \u0026#34;Small:\u0026#34;, $0 }\u0026#39; file.txt # å¤šé‡æ¢ä»¶ awk \u0026#39;{ if ($1 \u0026gt;= 90) grade = \u0026#34;A\u0026#34; else if ($1 \u0026gt;= 80) grade = \u0026#34;B\u0026#34; else if ($1 \u0026gt;= 70) grade = \u0026#34;C\u0026#34; else grade = \u0026#34;F\u0026#34; print $0, grade }\u0026#39; scores.txt è¿´åœˆçµæ§‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # for è¿´åœˆ awk \u0026#39;{ for (i=1; i\u0026lt;=NF; i++) { print \u0026#34;Field \u0026#34; i \u0026#34;:\u0026#34;, $i } }\u0026#39; file.txt # while è¿´åœˆ awk \u0026#39;{ i = 1 while (i \u0026lt;= NF) { print $i i++ } }\u0026#39; file.txt # for-in è¿´åœˆï¼ˆé™£åˆ—ï¼‰ awk \u0026#39;{ for (i in array) { print i, array[i] } }\u0026#39; file.txt å‡½æ•¸æ‡‰ç”¨ å­—ä¸²å‡½æ•¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # length() - å­—ä¸²é•·åº¦ awk \u0026#39;{print length($0)}\u0026#39; file.txt # æ¯è¡Œé•·åº¦ awk \u0026#39;length($0) \u0026gt; 80\u0026#39; file.txt # é•·åº¦è¶…é80çš„è¡Œ # substr() - å­å­—ä¸² awk \u0026#39;{print substr($1, 1, 3)}\u0026#39; file.txt # ç¬¬1æ¬„ä½å‰3å€‹å­—å…ƒ awk \u0026#39;{print substr($0, 5)}\u0026#39; file.txt # å¾ç¬¬5å€‹å­—å…ƒé–‹å§‹ # index() - æŸ¥æ‰¾ä½ç½® awk \u0026#39;{print index($0, \u0026#34;pattern\u0026#34;)}\u0026#39; file.txt # pattern çš„ä½ç½® # split() - åˆ†å‰²å­—ä¸² awk \u0026#39;{n=split($0, array, \u0026#34;,\u0026#34;); print n}\u0026#39; file.txt # ç”¨é€—è™Ÿåˆ†å‰² # gsub() å’Œ sub() - æ›¿æ› awk \u0026#39;{gsub(/old/, \u0026#34;new\u0026#34;); print}\u0026#39; file.txt # å…¨åŸŸæ›¿æ› awk \u0026#39;{sub(/old/, \u0026#34;new\u0026#34;); print}\u0026#39; file.txt # åªæ›¿æ›ç¬¬ä¸€å€‹ # tolower() å’Œ toupper() - å¤§å°å¯«è½‰æ› awk \u0026#39;{print tolower($0)}\u0026#39; file.txt # è½‰å°å¯« awk \u0026#39;{print toupper($1)}\u0026#39; file.txt # ç¬¬1æ¬„ä½è½‰å¤§å¯« æ•¸å­¸å‡½æ•¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # åŸºæœ¬æ•¸å­¸å‡½æ•¸ awk \u0026#39;{print sqrt($1)}\u0026#39; file.txt # å¹³æ–¹æ ¹ awk \u0026#39;{print int($1)}\u0026#39; file.txt # å–æ•´æ•¸ awk \u0026#39;{print sin($1), cos($1)}\u0026#39; file.txt # ä¸‰è§’å‡½æ•¸ # çµ±è¨ˆå‡½æ•¸ awk \u0026#39;{ sum += $1 count++ } END { print \u0026#34;Average:\u0026#34;, sum/count print \u0026#34;Total:\u0026#34;, sum }\u0026#39; file.txt # æœ€å¤§å€¼å’Œæœ€å°å€¼ awk \u0026#39;{ if (NR==1 || $1 \u0026gt; max) max = $1 if (NR==1 || $1 \u0026lt; min) min = $1 } END { print \u0026#34;Max:\u0026#34;, max, \u0026#34;Min:\u0026#34;, min }\u0026#39; file.txt è‡ªè¨‚å‡½æ•¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å®šç¾©å‡½æ•¸ awk \u0026#39; function factorial(n) { if (n \u0026lt;= 1) return 1 return n * factorial(n-1) } { print $1, factorial($1) }\u0026#39; file.txt # å­—ä¸²è™•ç†å‡½æ•¸ awk \u0026#39; function trim(str) { gsub(/^[ \\t]+|[ \\t]+$/, \u0026#34;\u0026#34;, str) return str } { print trim($0) }\u0026#39; file.txt é™£åˆ—æ‡‰ç”¨ ä¸€ç¶­é™£åˆ— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # åŸºæœ¬é™£åˆ—æ“ä½œ awk \u0026#39;{ arr[NR] = $0 } END { for (i=1; i\u0026lt;=NR; i++) { print i, arr[i] } }\u0026#39; file.txt # é—œè¯é™£åˆ— awk \u0026#39;{ count[$1]++ } END { for (item in count) { print item, count[item] } }\u0026#39; file.txt # é™£åˆ—æ’åº awk \u0026#39;{ arr[NR] = $1 } END { n = asort(arr) # æ’åºå€¼ for (i=1; i\u0026lt;=n; i++) { print arr[i] } }\u0026#39; file.txt å¤šç¶­é™£åˆ— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ä½¿ç”¨ SUBSEP åˆ†éš”å¤šç¶­ç´¢å¼• awk \u0026#39;BEGIN {SUBSEP = \u0026#34;:\u0026#34;} { matrix[$1,$2] = $3 } END { for (key in matrix) { print key, matrix[key] } }\u0026#39; file.txt # äºŒç¶­çµ±è¨ˆ awk \u0026#39;{ sales[$1][$2] += $3 } END { for (region in sales) { for (product in sales[region]) { print region, product, sales[region][product] } } }\u0026#39; sales_data.txt å¯¦æˆ°æ‡‰ç”¨å ´æ™¯ 1. æ—¥èªŒåˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # å­˜å–æ—¥èªŒåˆ†æ awk \u0026#39;{ # çµ±è¨ˆç‹€æ…‹ç¢¼ status[$9]++ # çµ±è¨ˆ IP åœ°å€ ip[$1]++ # è¨ˆç®—ç¸½æµé‡ if ($10 != \u0026#34;-\u0026#34;) bytes += $10 } END { print \u0026#34;=== Status Code Statistics ===\u0026#34; for (code in status) { print code, status[code] } print \u0026#34;\\n=== Top 10 IP Addresses ===\u0026#34; PROCINFO[\u0026#34;sorted_in\u0026#34;] = \u0026#34;@val_num_desc\u0026#34; n = 0 for (addr in ip) { if (++n \u0026lt;= 10) print addr, ip[addr] } print \u0026#34;\\nTotal Bytes:\u0026#34;, bytes }\u0026#39; access.log # éŒ¯èª¤æ—¥èªŒç›£æ§ awk \u0026#39; BEGIN { print \u0026#34;Error Analysis Report\u0026#34; } /ERROR|FATAL/ { split($1, date, \u0026#34;-\u0026#34;) errors[date[1] \u0026#34;-\u0026#34; date[2]]++ error_details[NR] = $0 } END { print \u0026#34;Errors by Month:\u0026#34; for (month in errors) { print month, errors[month] } }\u0026#39; error.log 2. è³‡æ–™è™•ç†å’Œçµ±è¨ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # CSV è³‡æ–™åˆ†æ awk -F, \u0026#39; NR==1 { # è·³éæ¨™é¡Œè¡Œ next } { # éŠ·å”®è³‡æ–™çµ±è¨ˆ total_sales += $3 sales_by_region[$2] += $3 if ($3 \u0026gt; max_sale) { max_sale = $3 max_sale_record = $0 } } END { print \u0026#34;Total Sales: $\u0026#34; total_sales print \u0026#34;Average Sale: $\u0026#34; total_sales/(NR-1) print \u0026#34;Largest Sale: $\u0026#34; max_sale print \u0026#34;Record:\u0026#34;, max_sale_record print \u0026#34;\\nSales by Region:\u0026#34; for (region in sales_by_region) { print region \u0026#34;: $\u0026#34; sales_by_region[region] } }\u0026#39; sales.csv # æˆç¸¾çµ±è¨ˆ awk \u0026#39;{ # è¨ˆç®—æ¯å€‹å­¸ç”Ÿçš„å¹³å‡åˆ† sum = 0 for (i=2; i\u0026lt;=NF; i++) { sum += $i subject_total[i-1] += $i } avg = sum / (NF-1) print $1, avg if (avg \u0026gt;= 90) grade_count[\u0026#34;A\u0026#34;]++ else if (avg \u0026gt;= 80) grade_count[\u0026#34;B\u0026#34;]++ else if (avg \u0026gt;= 70) grade_count[\u0026#34;C\u0026#34;]++ else grade_count[\u0026#34;F\u0026#34;]++ student_count++ } END { print \u0026#34;\\nGrade Distribution:\u0026#34; for (grade in grade_count) { printf \u0026#34;%s: %d (%.1f%%)\\n\u0026#34;, grade, grade_count[grade], grade_count[grade]/student_count*100 } }\u0026#39; grades.txt 3. ç³»çµ±ç›£æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 # ç¨‹åºç›£æ§ ps aux | awk \u0026#39; NR\u0026gt;1 { # è·³éæ¨™é¡Œè¡Œ cpu[$11] += $3 # ä¾ç¨‹å¼åç¨±ç´¯åŠ  CPU ä½¿ç”¨ç‡ mem[$11] += $4 # ä¾ç¨‹å¼åç¨±ç´¯åŠ è¨˜æ†¶é«”ä½¿ç”¨ç‡ proc_count[$11]++ } END { print \u0026#34;Process Resource Usage:\u0026#34; printf \u0026#34;%-20s %s %s %s\\n\u0026#34;, \u0026#34;PROCESS\u0026#34;, \u0026#34;COUNT\u0026#34;, \u0026#34;CPU%\u0026#34;, \u0026#34;MEM%\u0026#34; for (proc in cpu) { printf \u0026#34;%-20s %5d %6.1f %6.1f\\n\u0026#34;, proc, proc_count[proc], cpu[proc], mem[proc] } }\u0026#39; # ç£ç¢Ÿä½¿ç”¨åˆ†æ df -h | awk \u0026#39; NR\u0026gt;1 { # è§£æä½¿ç”¨ç™¾åˆ†æ¯” gsub(/%/, \u0026#34;\u0026#34;, $5) usage = $5 if (usage \u0026gt;= 90) { critical[++crit_count] = $6 \u0026#34; (\u0026#34; usage \u0026#34;%)\u0026#34; } else if (usage \u0026gt;= 80) { warning[++warn_count] = $6 \u0026#34; (\u0026#34; usage \u0026#34;%)\u0026#34; } } END { if (crit_count \u0026gt; 0) { print \u0026#34;CRITICAL: High disk usage detected!\u0026#34; for (i=1; i\u0026lt;=crit_count; i++) { print \u0026#34; \u0026#34; critical[i] } } if (warn_count \u0026gt; 0) { print \u0026#34;WARNING: Moderate disk usage:\u0026#34; for (i=1; i\u0026lt;=warn_count; i++) { print \u0026#34; \u0026#34; warning[i] } } }\u0026#39; 4. æ–‡ä»¶æ ¼å¼è½‰æ› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 # JSON ç°¡å–®ç”Ÿæˆ awk -F, \u0026#39; BEGIN { print \u0026#34;{\u0026#34; } NR\u0026gt;1 { printf \u0026#34; \\\u0026#34;%s\\\u0026#34;: {\\n\u0026#34;, $1 printf \u0026#34; \\\u0026#34;name\\\u0026#34;: \\\u0026#34;%s\\\u0026#34;,\\n\u0026#34;, $2 printf \u0026#34; \\\u0026#34;age\\\u0026#34;: %d,\\n\u0026#34;, $3 printf \u0026#34; \\\u0026#34;city\\\u0026#34;: \\\u0026#34;%s\\\u0026#34;\\n\u0026#34;, $4 printf \u0026#34; }%s\\n\u0026#34;, (NR\u0026lt;total_lines ? \u0026#34;,\u0026#34; : \u0026#34;\u0026#34;) } END { print \u0026#34;}\u0026#34; }\u0026#39; data.csv # HTML è¡¨æ ¼ç”Ÿæˆ awk -F, \u0026#39; BEGIN { print \u0026#34;\u0026lt;table border=\\\u0026#34;1\\\u0026#34;\u0026gt;\u0026#34; } NR==1 { print \u0026#34;\u0026lt;tr\u0026gt;\u0026#34; for (i=1; i\u0026lt;=NF; i++) { print \u0026#34;\u0026lt;th\u0026gt;\u0026#34; $i \u0026#34;\u0026lt;/th\u0026gt;\u0026#34; } print \u0026#34;\u0026lt;/tr\u0026gt;\u0026#34; } NR\u0026gt;1 { print \u0026#34;\u0026lt;tr\u0026gt;\u0026#34; for (i=1; i\u0026lt;=NF; i++) { print \u0026#34;\u0026lt;td\u0026gt;\u0026#34; $i \u0026#34;\u0026lt;/td\u0026gt;\u0026#34; } print \u0026#34;\u0026lt;/tr\u0026gt;\u0026#34; } END { print \u0026#34;\u0026lt;/table\u0026gt;\u0026#34; }\u0026#39; data.csv # é…ç½®æª”è½‰æ› awk \u0026#39; /^[^#]/ \u0026amp;\u0026amp; /=/ { split($0, pair, \u0026#34;=\u0026#34;) key = pair[1] value = pair[2] gsub(/^[ \\t]+|[ \\t]+$/, \u0026#34;\u0026#34;, key) # trim gsub(/^[ \\t]+|[ \\t]+$/, \u0026#34;\u0026#34;, value) print key \u0026#34;: \\\u0026#34;\u0026#34; value \u0026#34;\\\u0026#34;\u0026#34; }\u0026#39; config.ini 5. å ±è¡¨ç”Ÿæˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 # éŠ·å”®å ±è¡¨ awk -F, \u0026#39; BEGIN { print \u0026#34;Sales Report\u0026#34; print \u0026#34;============\u0026#34; total = 0 } NR\u0026gt;1 { date = $1 product = $2 amount = $3 # æŒ‰æ—¥æœŸçµ±è¨ˆ daily_sales[date] += amount # æŒ‰ç”¢å“çµ±è¨ˆ product_sales[product] += amount total += amount } END { print \u0026#34;\\nDaily Sales:\u0026#34; PROCINFO[\u0026#34;sorted_in\u0026#34;] = \u0026#34;@ind_str_asc\u0026#34; for (date in daily_sales) { printf \u0026#34;%-12s: $%8.2f\\n\u0026#34;, date, daily_sales[date] } print \u0026#34;\\nProduct Sales:\u0026#34; PROCINFO[\u0026#34;sorted_in\u0026#34;] = \u0026#34;@val_num_desc\u0026#34; for (product in product_sales) { printf \u0026#34;%-15s: $%8.2f (%4.1f%%)\\n\u0026#34;, product, product_sales[product], product_sales[product]/total*100 } printf \u0026#34;\\nTotal Sales: $%.2f\\n\u0026#34;, total }\u0026#39; sales.csv # ç¶²ç«™æµé‡å ±è¡¨ awk \u0026#39;{ # è§£ææ—¥æœŸæ™‚é–“ gsub(/\\[|\\]/, \u0026#34;\u0026#34;, $4) split($4, datetime, \u0026#34;:\u0026#34;) date = datetime[1] hour = datetime[2] # çµ±è¨ˆ daily_hits[date]++ hourly_hits[hour]++ if ($9 == \u0026#34;404\u0026#34;) not_found++ if ($9 ~ /^[45]/) errors++ total_hits++ } END { print \u0026#34;Website Traffic Report\u0026#34; print \u0026#34;=====================\u0026#34; print \u0026#34;\\nDaily Traffic:\u0026#34; for (date in daily_hits) { printf \u0026#34;%s: %d hits\\n\u0026#34;, date, daily_hits[date] } print \u0026#34;\\nHourly Distribution:\u0026#34; for (h=0; h\u0026lt;24; h++) { printf \u0026#34;%02d:00: %d hits\\n\u0026#34;, h, hourly_hits[h] } printf \u0026#34;\\nError Summary:\\n\u0026#34; printf \u0026#34;404 Errors: %d (%.1f%%)\\n\u0026#34;, not_found, not_found/total_hits*100 printf \u0026#34;5xx Errors: %d (%.1f%%)\\n\u0026#34;, errors, errors/total_hits*100 }\u0026#39; access.log é€²éšæŠ€å·§ 1. å¤šæª”æ¡ˆè™•ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # æ¯”è¼ƒå…©å€‹æª”æ¡ˆ awk \u0026#39; FNR==NR { # è™•ç†ç¬¬ä¸€å€‹æª”æ¡ˆ file1[FNR] = $0 next } { # è™•ç†ç¬¬äºŒå€‹æª”æ¡ˆ if (file1[FNR] != $0) { print \u0026#34;Line \u0026#34; FNR \u0026#34; differs:\u0026#34; print \u0026#34;File1: \u0026#34; file1[FNR] print \u0026#34;File2: \u0026#34; $0 } }\u0026#39; file1.txt file2.txt # åˆä½µæª”æ¡ˆè³‡æ–™ awk \u0026#39; FNR==NR { # ç¬¬ä¸€å€‹æª”æ¡ˆï¼šå»ºç«‹ç´¢å¼• lookup[$1] = $2 next } { # ç¬¬äºŒå€‹æª”æ¡ˆï¼šæŸ¥æ‰¾ä¸¦åˆä½µ if ($1 in lookup) { print $0, lookup[$1] } }\u0026#39; lookup.txt data.txt 2. è¤‡é›œæ–‡æœ¬è§£æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # XML ç°¡å–®è§£æ awk \u0026#39; /\u0026lt;([^\u0026gt;]+)\u0026gt;([^\u0026lt;]*)\u0026lt;\\/\\1\u0026gt;/ { match($0, /\u0026lt;([^\u0026gt;]+)\u0026gt;([^\u0026lt;]*)\u0026lt;\\/\\1\u0026gt;/, arr) print \u0026#34;Tag:\u0026#34;, arr[1], \u0026#34;Content:\u0026#34;, arr[2] }\u0026#39; simple.xml # é…ç½®æª”è§£æ awk \u0026#39; /^\\[.*\\]$/ { # å€æ®µæ¨™é¡Œ gsub(/\\[|\\]/, \u0026#34;\u0026#34;) section = $0 next } /^[^#].*=/ { # éµå€¼å° split($0, kv, \u0026#34;=\u0026#34;) key = kv[1] value = kv[2] gsub(/^[ \\t]+|[ \\t]+$/, \u0026#34;\u0026#34;, key) gsub(/^[ \\t]+|[ \\t]+$/, \u0026#34;\u0026#34;, value) config[section][key] = value } END { for (sect in config) { print \u0026#34;[\u0026#34; sect \u0026#34;]\u0026#34; for (k in config[sect]) { print k \u0026#34; = \u0026#34; config[sect][k] } print \u0026#34;\u0026#34; } }\u0026#39; config.ini 3. æ•ˆèƒ½å„ªåŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # é¿å…é‡è¤‡è¨ˆç®— awk \u0026#39;{ # å¥½çš„åšæ³•ï¼šå„²å­˜è¨ˆç®—çµæœ len = length($0) if (len \u0026gt; max_len) { max_len = len longest_line = $0 } }\u0026#39; file.txt # ä½¿ç”¨é™£åˆ—è€Œéå­—ä¸²é€£æ¥ awk \u0026#39;{ # å¥½çš„åšæ³•ï¼šä½¿ç”¨é™£åˆ— lines[NR] = $0 } END { for (i=NR; i\u0026gt;=1; i--) { print lines[i] } }\u0026#39; file.txt # ææ—©é€€å‡º awk \u0026#39;{ if (found_count \u0026gt;= 10) exit if (/pattern/) { print found_count++ } }\u0026#39; large_file.txt è…³æœ¬æª”æ¡ˆ å»ºç«‹ script.awk æª”æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 #!/usr/bin/awk -f BEGIN { FS = \u0026#34;,\u0026#34; OFS = \u0026#34;\\t\u0026#34; print \u0026#34;Processing CSV file...\u0026#34; } # è·³éç©ºè¡Œ /^$/ { next } # è™•ç†æ¨™é¡Œè¡Œ NR == 1 { print \u0026#34;Headers:\u0026#34;, $0 next } # ä¸»è¦è™•ç†é‚è¼¯ { # è³‡æ–™é©—è­‰ if (NF != 4) { print \u0026#34;Warning: Line \u0026#34; NR \u0026#34; has \u0026#34; NF \u0026#34; fields\u0026#34; \u0026gt; \u0026#34;/dev/stderr\u0026#34; next } # è™•ç†è³‡æ–™ name = $1 age = $2 salary = $3 department = $4 # çµ±è¨ˆ total_salary += salary dept_count[department]++ employee_count++ # è¼¸å‡ºè™•ç†çµæœ print name, age, salary, department } END { print \u0026#34;\\n=== Summary ===\u0026#34; print \u0026#34;Total employees:\u0026#34;, employee_count print \u0026#34;Average salary:\u0026#34;, total_salary/employee_count print \u0026#34;\\nDepartment distribution:\u0026#34; for (dept in dept_count) { printf \u0026#34;%-15s: %d\\n\u0026#34;, dept, dept_count[dept] } } ä½¿ç”¨è…³æœ¬ï¼š\n1 2 3 4 chmod +x script.awk ./script.awk data.csv # æˆ– awk -f script.awk data.csv å¸¸è¦‹éŒ¯èª¤èˆ‡é™¤éŒ¯ 1. å¸¸è¦‹éŒ¯èª¤ 1 2 3 4 5 6 7 8 9 10 # éŒ¯èª¤ï¼šå­—ä¸²æ¯”è¼ƒä½¿ç”¨æ•¸å€¼é‹ç®—å­ awk \u0026#39;$1 \u0026gt; \u0026#34;50\u0026#34;\u0026#39; file.txt # éŒ¯èª¤ï¼šå­—ä¸²æ¯”è¼ƒ awk \u0026#39;$1 + 0 \u0026gt; 50\u0026#39; file.txt # æ­£ç¢ºï¼šå¼·åˆ¶æ•¸å€¼æ¯”è¼ƒ # éŒ¯èª¤ï¼šé™£åˆ—ç´¢å¼•å•é¡Œ awk \u0026#39;{arr[0] = $1}\u0026#39; file.txt # æ³¨æ„ï¼šAWK é™£åˆ—å¾1é–‹å§‹ç¿’æ…£ä½¿ç”¨ # éŒ¯èª¤ï¼šæœªåˆå§‹åŒ–è®Šæ•¸ awk \u0026#39;{sum += $1} END {print sum/count}\u0026#39; file.txt # count æœªåˆå§‹åŒ– awk \u0026#39;{sum += $1; count++} END {print sum/count}\u0026#39; file.txt # æ­£ç¢º 2. é™¤éŒ¯æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ·»åŠ é™¤éŒ¯è¼¸å‡º awk \u0026#39;{ print \u0026#34;Debug: NR=\u0026#34; NR \u0026#34;, NF=\u0026#34; NF \u0026#34;, $0=\u0026#34; $0 \u0026gt; \u0026#34;/dev/stderr\u0026#34; # ä¸»è¦é‚è¼¯ }\u0026#39; file.txt # ä½¿ç”¨æ¢ä»¶é™¤éŒ¯ awk \u0026#39;{ if (debug) print \u0026#34;Processing:\u0026#34;, $0 # ä¸»è¦é‚è¼¯ }\u0026#39; debug=1 file.txt # åˆ†æ­¥é©—è­‰ awk \u0026#39;{print \u0026#34;Line \u0026#34; NR \u0026#34;: \u0026#34; $1}\u0026#39; file.txt | head -5 èˆ‡å…¶ä»–å·¥å…·æ•´åˆ 1. èˆ‡ grep å’Œ sed çµ„åˆ 1 2 3 4 5 # éæ¿¾å¾Œè™•ç† grep \u0026#34;ERROR\u0026#34; log.txt | awk \u0026#39;{print $1, $3}\u0026#39; # å¤šæ­¥è™•ç† cat data.txt | grep -v \u0026#34;^#\u0026#34; | sed \u0026#39;s/,/ /g\u0026#39; | awk \u0026#39;{print $1, $2}\u0026#39; 2. èˆ‡ sort çµ„åˆ 1 2 3 4 5 # æ’åºå¾Œçµ±è¨ˆ awk \u0026#39;{print $1}\u0026#39; file.txt | sort | uniq -c | awk \u0026#39;{print $2, $1}\u0026#39; # ç®¡é“è™•ç† awk \u0026#39;{print $3, $0}\u0026#39; file.txt | sort -nr | awk \u0026#39;{$1=\u0026#34;\u0026#34;; print}\u0026#39; 3. èˆ‡è³‡æ–™åº«æ•´åˆ 1 2 3 4 5 6 7 8 9 10 11 # ç”Ÿæˆ SQL æ’å…¥èªå¥ awk -F, \u0026#39; NR\u0026gt;1 { printf \u0026#34;INSERT INTO users (name, age, city) VALUES (\\\u0026#34;%s\\\u0026#34;, %d, \\\u0026#34;%s\\\u0026#34;);\\n\u0026#34;, $1, $2, $3 }\u0026#39; data.csv # ç”Ÿæˆæ‰¹æ¬¡æ›´æ–°è…³æœ¬ awk \u0026#39;{ print \u0026#34;UPDATE table SET status=1 WHERE id=\u0026#34; $1 \u0026#34;;\u0026#34; }\u0026#39; ids.txt ç¸½çµ æ ¸å¿ƒå„ªå‹¢ å¼·å¤§çš„æ¨¡å¼åŒ¹é…ï¼šæ”¯æ´è¤‡é›œçš„æ­£è¦è¡¨é”å¼ è±å¯Œçš„å…§å»ºåŠŸèƒ½ï¼šå­—ä¸²è™•ç†ã€æ•¸å­¸é‹ç®—ã€é™£åˆ—æ“ä½œ é«˜æ•ˆçš„æ–‡æœ¬è™•ç†ï¼šé©åˆå¤§é‡è³‡æ–™è™•ç† éˆæ´»çš„ç¨‹å¼çµæ§‹ï¼šæ”¯æ´å®Œæ•´çš„ç¨‹å¼è¨­è¨ˆæ¦‚å¿µ æœ€ä½³å¯¦è¸ å–„ç”¨ BEGIN å’Œ ENDï¼šåˆå§‹åŒ–å’Œæ¸…ç†å·¥ä½œ åˆç†ä½¿ç”¨é™£åˆ—ï¼šé¿å…è¨˜æ†¶é«”éåº¦ä½¿ç”¨ æ¨¡å¼åŒ–ç¨‹å¼è¨­è¨ˆï¼šå°‡å¸¸ç”¨é‚è¼¯å°è£ç‚ºå‡½æ•¸ è¼¸å…¥é©—è­‰ï¼šæª¢æŸ¥è³‡æ–™æ ¼å¼å’Œæ¬„ä½æ•¸é‡ éŒ¯èª¤è™•ç†ï¼šé©ç•¶çš„éŒ¯èª¤æª¢æŸ¥å’Œæ¢å¾©æ©Ÿåˆ¶ å­¸ç¿’è·¯å¾‘ 1 2 3 4 5 6 7 8 9 10 11 12 # åŸºç¤éšæ®µ awk \u0026#39;{print $1}\u0026#39; file.txt # æ¬„ä½è™•ç† awk \u0026#39;/pattern/ {print}\u0026#39; file.txt # æ¨¡å¼åŒ¹é… awk \u0026#39;{sum += $1} END {print sum}\u0026#39; file.txt # åŸºæœ¬çµ±è¨ˆ # é€²éšéšæ®µ awk -F, \u0026#39;{arr[$1] += $2} END {for(i in arr) print i, arr[i]}\u0026#39; file.csv # é™£åˆ—æ‡‰ç”¨ awk \u0026#39;function f(x) {return x*x} {print f($1)}\u0026#39; file.txt # è‡ªè¨‚å‡½æ•¸ # å°ˆå®¶éšæ®µ awk \u0026#39;/start/,/end/ {if(/important/) print}\u0026#39; file.txt # è¤‡é›œæ¨¡å¼ awk \u0026#39;BEGIN{PROCINFO[\u0026#34;sorted_in\u0026#34;]=\u0026#34;@val_num_desc\u0026#34;} ...\u0026#39; # é«˜ç´šç‰¹æ€§ AWK æ˜¯æ–‡æœ¬è™•ç†å’Œè³‡æ–™åˆ†æçš„å¼·å¤§å·¥å…·ï¼ŒæŒæ¡å…¶æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨æŠ€å·§ï¼Œèƒ½å¤ å¤§å¹…æå‡è³‡æ–™è™•ç†çš„æ•ˆç‡å’Œæº–ç¢ºæ€§ã€‚è¨˜ä½ï¼šAWK çš„æ ¸å¿ƒåœ¨æ–¼æ¨¡å¼-å‹•ä½œç¨‹å¼è¨­è¨ˆæ€ç¶­ï¼Œå–„ç”¨é€™å€‹ç‰¹æ€§èƒ½å¤ è§£æ±ºè¤‡é›œçš„æ–‡æœ¬è™•ç†å•é¡Œã€‚\nåƒè€ƒè³‡æ–™ GAWK Manual The AWK Programming Language Advanced Bash-Scripting Guide POSIX AWK Specification ","permalink":"https://xinqilin.github.io/post/tools/awk/","tags":["Linux","AWK","Text Processing","Data Analysis","Pattern Scanning","Shell","Unix"],"title":"AWK ç¨‹å¼è¨­è¨ˆå®Œæ•´æŒ‡å—ï¼šLinux æ–‡æœ¬è™•ç†èˆ‡è³‡æ–™åˆ†æåˆ©å™¨"},{"content":"init 1 2 Map\u0026lt;String, Integer\u0026gt; map = new HashMap\u0026lt;String, Integer\u0026gt;(); map.put(\u0026#34;a\u0026#34;, 1); putIfAbsent æœ‰äº†å°±ä¸å¡, æ²’æœ‰å°±å¡ value (ä¸å­˜åœ¨å°±å¡)\n1 2 3 4 map.putIfAbsent(\u0026#34;a\u0026#34;, 2); // return 1 System.out.println(map); // {a=1} map.putIfAbsent(\u0026#34;b\u0026#34;, 3); // return null (å› ä¸å­˜åœ¨æœƒå› null, ä½†æœƒå¡é€² map) System.out.println(map); // {a=1, b=3} compute 1 2 3 4 map.compute(\u0026#34;a\u0026#34;, (k, v) -\u0026gt; v + 1); // return 2 System.out.println(map); // {a=2} map.compute(\u0026#34;b\u0026#34;, (k, v) -\u0026gt; v == null ? 1000 : v + 1); // return 1000 System.out.println(map); // {a=2, b=1000} computeIfAbsent ä¸å­˜åœ¨å°±è¨ˆç®—\n1 2 3 4 map.computeIfAbsent(\u0026#34;a\u0026#34;, k -\u0026gt; 2); // return 1 System.out.println(map); // {a=1} map.computeIfAbsent(\u0026#34;b\u0026#34;, k -\u0026gt; 1000); // return 1000 System.out.println(map); // {a=1, b=1000} computeIfPresent å­˜åœ¨å°±è¨ˆç®—\n1 2 3 4 map.computeIfPresent(\u0026#34;a\u0026#34;, (k, v) -\u0026gt; v + 1); // return 2 System.out.println(map); // {a=2} map.computeIfPresent(\u0026#34;b\u0026#34;, (k, v) -\u0026gt; v == null ? 0 : v + 1); // reutrn null System.out.println(map); // {a=2} ","permalink":"https://xinqilin.github.io/post/backend/mapcompute/","tags":["Java","Map","HashMap","Collections","Data-Structure"],"title":"Java Map è¨ˆç®—æ–¹æ³•è©³è§£ï¼šputIfAbsentã€computeã€computeIfAbsent ä½¿ç”¨æŒ‡å—"},{"content":"æ¦‚è¿° sedï¼ˆStream Editorï¼Œæµç·¨è¼¯å™¨ï¼‰æ˜¯ Unix/Linux ç³»çµ±ä¸­åŠŸèƒ½å¼·å¤§çš„æ–‡æœ¬è™•ç†å·¥å…·ã€‚å®ƒèƒ½å¤ å°æ–‡æœ¬æµé€²è¡Œéäº’å‹•å¼çš„ç·¨è¼¯æ“ä½œï¼ŒåŒ…æ‹¬æœå°‹ã€æ›¿æ›ã€æ’å…¥ã€åˆªé™¤ç­‰åŠŸèƒ½ã€‚ä½œç‚ºç®¡é“è™•ç†çš„é‡è¦å·¥å…·ï¼Œsed åœ¨è‡ªå‹•åŒ–è…³æœ¬å’Œæ‰¹æ¬¡æ–‡æœ¬è™•ç†ä¸­æ‰®æ¼”é—œéµè§’è‰²ã€‚\næ ¸å¿ƒç‰¹å¾µ æµå¼è™•ç†ï¼šé€è¡Œè™•ç†æ–‡æœ¬ï¼Œé©åˆå¤§æª”æ¡ˆæ“ä½œ éäº’å‹•å¼ï¼šå¯åœ¨è…³æœ¬ä¸­è‡ªå‹•åŸ·è¡Œ æ­£è¦è¡¨é”å¼ï¼šæ”¯æ´å¼·å¤§çš„æ¨¡å¼åŒ¹é… åŸåœ°ç·¨è¼¯ï¼šå¯ç›´æ¥ä¿®æ”¹åŸå§‹æª”æ¡ˆ ç®¡é“å‹å¥½ï¼šé©åˆèˆ‡å…¶ä»–å‘½ä»¤çµ„åˆä½¿ç”¨ åŸºæœ¬èªæ³• 1 2 3 sed [é¸é …] \u0026#39;åœ°å€å®šç•Œcommand\u0026#39; file(s) sed [é¸é …] -e \u0026#39;script1\u0026#39; -e \u0026#39;script2\u0026#39; file(s) sed [é¸é …] -f script.sed file(s) å¸¸ç”¨é¸é … 1 2 3 4 5 6 7 -n # å®‰éœæ¨¡å¼ï¼Œä¸è‡ªå‹•åˆ—å°è™•ç†çµæœ -e script # æŒ‡å®šè¦åŸ·è¡Œçš„è…³æœ¬å‘½ä»¤ -f file # å¾æª”æ¡ˆè®€å–è…³æœ¬å‘½ä»¤ -i[suffix] # ç›´æ¥ä¿®æ”¹æª”æ¡ˆï¼ˆå¯é¸å‚™ä»½å¾Œç¶´ï¼‰ -r æˆ– -E # ä½¿ç”¨æ“´å±•æ­£è¦è¡¨é”å¼ -s # å°‡å¤šå€‹æª”æ¡ˆè¦–ç‚ºç¨ç«‹è™•ç† --debug # åµéŒ¯æ¨¡å¼ï¼Œé¡¯ç¤ºåŸ·è¡Œéç¨‹ åŸºæœ¬ç¯„ä¾‹ 1 2 3 4 5 6 7 8 # åŸºæœ¬æ–‡æœ¬æ›¿æ› sed \u0026#39;s/old/new/\u0026#39; file.txt # æ›¿æ›æ¯è¡Œç¬¬ä¸€å€‹åŒ¹é… sed \u0026#39;s/old/new/g\u0026#39; file.txt # æ›¿æ›æ‰€æœ‰åŒ¹é… sed \u0026#39;s/old/new/2\u0026#39; file.txt # æ›¿æ›æ¯è¡Œç¬¬äºŒå€‹åŒ¹é… # ç›´æ¥ä¿®æ”¹æª”æ¡ˆ sed -i \u0026#39;s/old/new/g\u0026#39; file.txt # ç›´æ¥ä¿®æ”¹åŸæª”æ¡ˆ sed -i.bak \u0026#39;s/old/new/g\u0026#39; file.txt # ä¿®æ”¹å‰å…ˆå‚™ä»½ åœ°å€å®šç•Œ åœ°å€å®šç•Œç”¨æ–¼æŒ‡å®š sed å‘½ä»¤ä½œç”¨çš„è¡Œç¯„åœï¼š\nåŸºæœ¬åœ°å€é¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 # è¡Œè™Ÿåœ°å€ sed \u0026#39;3d\u0026#39; file.txt # åˆªé™¤ç¬¬3è¡Œ sed \u0026#39;1,5d\u0026#39; file.txt # åˆªé™¤ç¬¬1åˆ°5è¡Œ sed \u0026#39;3,$d\u0026#39; file.txt # åˆªé™¤ç¬¬3è¡Œåˆ°æª”æ¡ˆçµå°¾ # æ¨¡å¼åœ°å€ sed \u0026#39;/pattern/d\u0026#39; file.txt # åˆªé™¤åŒ…å«patternçš„è¡Œ sed \u0026#39;/start/,/end/d\u0026#39; file.txt # åˆªé™¤å¾startåˆ°endä¹‹é–“çš„è¡Œ # ç‰¹æ®Šåœ°å€ sed \u0026#39;$d\u0026#39; file.txt # åˆªé™¤æœ€å¾Œä¸€è¡Œ sed \u0026#39;0,/pattern/d\u0026#39; file.txt # åˆªé™¤åˆ°ç¬¬ä¸€å€‹åŒ¹é…patternçš„è¡Œ é€²éšåœ°å€å®šç•Œ 1 2 3 4 5 6 7 8 9 10 11 12 # æ­¥é€²åœ°å€ sed -n \u0026#39;1~2p\u0026#39; file.txt # åˆ—å°å¥‡æ•¸è¡Œï¼ˆå¾ç¬¬1è¡Œé–‹å§‹ï¼Œæ¯2è¡Œä¸€æ¬¡ï¼‰ sed -n \u0026#39;2~2p\u0026#39; file.txt # åˆ—å°å¶æ•¸è¡Œ sed -n \u0026#39;1~3p\u0026#39; file.txt # æ¯ä¸‰è¡Œåˆ—å°ä¸€æ¬¡ # åœ°å€å–å sed \u0026#39;3!d\u0026#39; file.txt # åˆªé™¤é™¤ç¬¬3è¡Œå¤–çš„æ‰€æœ‰è¡Œ sed \u0026#39;/pattern/!d\u0026#39; file.txt # åªä¿ç•™åŒ…å«patternçš„è¡Œ # è¤‡é›œåœ°å€çµ„åˆ sed \u0026#39;1,3d; 5,7d\u0026#39; file.txt # åˆªé™¤1-3è¡Œå’Œ5-7è¡Œ sed \u0026#39;/^#/d; /^$/d\u0026#39; file.txt # åˆªé™¤è¨»é‡‹è¡Œå’Œç©ºè¡Œ æ ¸å¿ƒå‘½ä»¤è©³è§£ 1. æ›¿æ›å‘½ä»¤ (s) sed æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼Œèªæ³•ï¼šs/pattern/replacement/flags\nåŸºæœ¬æ›¿æ› 1 2 3 4 5 6 7 8 9 10 # åŸºæœ¬æ›¿æ›èªæ³• sed \u0026#39;s/pattern/replacement/\u0026#39; file.txt # æ›¿æ›æ¯è¡Œç¬¬ä¸€å€‹åŒ¹é… sed \u0026#39;s/pattern/replacement/g\u0026#39; file.txt # å…¨åŸŸæ›¿æ› sed \u0026#39;s/pattern/replacement/2\u0026#39; file.txt # æ›¿æ›ç¬¬äºŒå€‹åŒ¹é… sed \u0026#39;s/pattern/replacement/2g\u0026#39; file.txt # å¾ç¬¬äºŒå€‹é–‹å§‹å…¨éƒ¨æ›¿æ› # ä½¿ç”¨ä¸åŒåˆ†éš”ç¬¦ sed \u0026#39;s#/old/path#/new/path#g\u0026#39; file.txt # ä½¿ç”¨ # ä½œç‚ºåˆ†éš”ç¬¦ sed \u0026#39;s|old|new|g\u0026#39; file.txt # ä½¿ç”¨ | ä½œç‚ºåˆ†éš”ç¬¦ sed \u0026#39;s@old@new@g\u0026#39; file.txt # ä½¿ç”¨ @ ä½œç‚ºåˆ†éš”ç¬¦ é€²éšæ›¿æ›åŠŸèƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¤§å°å¯«è½‰æ› sed \u0026#39;s/.*/\\U\u0026amp;/\u0026#39; file.txt # å…¨éƒ¨è½‰å¤§å¯« sed \u0026#39;s/.*/\\L\u0026amp;/\u0026#39; file.txt # å…¨éƒ¨è½‰å°å¯« sed \u0026#39;s/\\([a-z]\\)/\\U\\1/g\u0026#39; file.txt # æ¯å€‹å­—æ¯è½‰å¤§å¯« sed \u0026#39;s/\\b\\w/\\U\u0026amp;/g\u0026#39; file.txt # å–®è©é¦–å­—æ¯å¤§å¯« # ä½¿ç”¨æ•ç²ç¾¤çµ„ sed \u0026#39;s/\\([0-9]*\\)-\\([0-9]*\\)/\\2-\\1/\u0026#39; file.txt # äº¤æ›æ•¸å­—é †åº sed \u0026#39;s/\\(.*\\): \\(.*\\)/\\2 - \\1/\u0026#39; file.txt # é‡æ–°æ’åˆ—æ ¼å¼ # æ¢ä»¶æ›¿æ› sed \u0026#39;/pattern/s/old/new/g\u0026#39; file.txt # åªåœ¨åŒ…å«patternçš„è¡Œä¸­æ›¿æ› sed \u0026#39;1,10s/old/new/g\u0026#39; file.txt # åªåœ¨ç¬¬1-10è¡Œä¸­æ›¿æ› 2. åˆªé™¤å‘½ä»¤ (d) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åŸºæœ¬åˆªé™¤ sed \u0026#39;3d\u0026#39; file.txt # åˆªé™¤ç¬¬3è¡Œ sed \u0026#39;1,5d\u0026#39; file.txt # åˆªé™¤ç¬¬1-5è¡Œ sed \u0026#39;$d\u0026#39; file.txt # åˆªé™¤æœ€å¾Œä¸€è¡Œ # æ¨¡å¼åˆªé™¤ sed \u0026#39;/pattern/d\u0026#39; file.txt # åˆªé™¤åŒ…å«patternçš„è¡Œ sed \u0026#39;/^$/d\u0026#39; file.txt # åˆªé™¤ç©ºè¡Œ sed \u0026#39;/^#/d\u0026#39; file.txt # åˆªé™¤è¨»é‡‹è¡Œ sed \u0026#39;/^[[:space:]]*$/d\u0026#39; file.txt # åˆªé™¤ç©ºè¡Œå’Œåªæœ‰ç©ºç™½çš„è¡Œ # ç¯„åœåˆªé™¤ sed \u0026#39;/start/,/end/d\u0026#39; file.txt # åˆªé™¤startåˆ°endä¹‹é–“çš„è¡Œ sed \u0026#39;/BEGIN/,/END/d\u0026#39; file.txt # åˆªé™¤BEGINåˆ°ENDå€å¡Š 3. åˆ—å°å‘½ä»¤ (p) 1 2 3 4 5 6 7 8 9 10 11 12 # åŸºæœ¬åˆ—å°ï¼ˆé€šå¸¸èˆ‡-nä¸€èµ·ä½¿ç”¨ï¼‰ sed -n \u0026#39;3p\u0026#39; file.txt # åªåˆ—å°ç¬¬3è¡Œ sed -n \u0026#39;1,5p\u0026#39; file.txt # åªåˆ—å°ç¬¬1-5è¡Œ sed -n \u0026#39;$p\u0026#39; file.txt # åªåˆ—å°æœ€å¾Œä¸€è¡Œ # æ¨¡å¼åˆ—å° sed -n \u0026#39;/pattern/p\u0026#39; file.txt # åªåˆ—å°åŒ…å«patternçš„è¡Œ sed -n \u0026#39;/^#/p\u0026#39; file.txt # åªåˆ—å°è¨»é‡‹è¡Œ # è¤‡è£½åˆ—å° sed \u0026#39;p\u0026#39; file.txt # æ¯è¡Œåˆ—å°å…©æ¬¡ sed \u0026#39;/pattern/p\u0026#39; file.txt # åŒ¹é…è¡Œåˆ—å°å…©æ¬¡ 4. æ’å…¥å’Œé™„åŠ å‘½ä»¤ (i, a, c) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ’å…¥å‘½ä»¤ (i) - åœ¨æŒ‡å®šè¡Œå‰æ’å…¥ sed \u0026#39;3i\\New line before line 3\u0026#39; file.txt # åœ¨ç¬¬3è¡Œå‰æ’å…¥ sed \u0026#39;/pattern/i\\New line\u0026#39; file.txt # åœ¨åŒ¹é…è¡Œå‰æ’å…¥ # é™„åŠ å‘½ä»¤ (a) - åœ¨æŒ‡å®šè¡Œå¾Œé™„åŠ  sed \u0026#39;3a\\New line after line 3\u0026#39; file.txt # åœ¨ç¬¬3è¡Œå¾Œé™„åŠ  sed \u0026#39;/pattern/a\\New line\u0026#39; file.txt # åœ¨åŒ¹é…è¡Œå¾Œé™„åŠ  sed \u0026#39;$a\\Last line\u0026#39; file.txt # åœ¨æª”æ¡ˆæœ«å°¾é™„åŠ  # æ›¿æ›å‘½ä»¤ (c) - æ›¿æ›æ•´è¡Œ sed \u0026#39;3c\\Replacement line\u0026#39; file.txt # æ›¿æ›ç¬¬3è¡Œ sed \u0026#39;/pattern/c\\New content\u0026#39; file.txt # æ›¿æ›åŒ¹é…è¡Œ # å¤šè¡Œæ“ä½œ sed \u0026#39;3i\\Line 1\\nLine 2\\nLine 3\u0026#39; file.txt # æ’å…¥å¤šè¡Œ 5. æª”æ¡ˆæ“ä½œå‘½ä»¤ (r, w) 1 2 3 4 5 6 7 8 # è®€å–æª”æ¡ˆ (r) sed \u0026#39;3r insert.txt\u0026#39; file.txt # åœ¨ç¬¬3è¡Œå¾Œæ’å…¥æª”æ¡ˆå…§å®¹ sed \u0026#39;/pattern/r header.txt\u0026#39; file.txt # åœ¨åŒ¹é…è¡Œå¾Œæ’å…¥æª”æ¡ˆ # å¯«å…¥æª”æ¡ˆ (w) sed -n \u0026#39;1,10w output.txt\u0026#39; file.txt # å°‡ç¬¬1-10è¡Œå¯«å…¥æª”æ¡ˆ sed -n \u0026#39;/pattern/w matches.txt\u0026#39; file.txt # å°‡åŒ¹é…è¡Œå¯«å…¥æª”æ¡ˆ sed \u0026#39;/ERROR/w errors.log\u0026#39; file.txt # å°‡éŒ¯èª¤è¡Œå¯«å…¥æ—¥èªŒ æ­£è¦è¡¨é”å¼é€²éšæ‡‰ç”¨ åŸºæœ¬æ­£è¦è¡¨é”å¼ (BRE) 1 2 3 4 5 6 7 8 9 # åŸºæœ¬å…ƒå­—å…ƒ sed \u0026#39;s/^/\u0026gt; /\u0026#39; file.txt # åœ¨æ¯è¡Œé–‹é ­åŠ ä¸Š \u0026#34;\u0026gt; \u0026#34; sed \u0026#39;s/$/!/\u0026#39; file.txt # åœ¨æ¯è¡Œçµå°¾åŠ ä¸Š \u0026#34;!\u0026#34; sed \u0026#39;s/./X/g\u0026#39; file.txt # å°‡æ¯å€‹å­—å…ƒæ›¿æ›ç‚ºX # å­—å…ƒé¡åˆ¥ sed \u0026#39;s/[0-9]/X/g\u0026#39; file.txt # æ›¿æ›æ‰€æœ‰æ•¸å­— sed \u0026#39;s/[a-zA-Z]/X/g\u0026#39; file.txt # æ›¿æ›æ‰€æœ‰å­—æ¯ sed \u0026#39;s/[[:digit:]]/X/g\u0026#39; file.txt # ä½¿ç”¨POSIXå­—å…ƒé¡åˆ¥ æ“´å±•æ­£è¦è¡¨é”å¼ (ERE) 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨ -E æˆ– -r é¸é … sed -E \u0026#39;s/([0-9]+)-([0-9]+)/\\2-\\1/\u0026#39; file.txt # äº¤æ›é€£å­—è™Ÿåˆ†éš”çš„æ•¸å­— sed -E \u0026#39;s/\\b[a-z]+/\\U\u0026amp;/g\u0026#39; file.txt # å–®è©é¦–å­—æ¯å¤§å¯« sed -E \u0026#39;s/(.*\\.)(jpg|png)/\\1webp/\u0026#39; file.txt # æ”¹è®Šæª”æ¡ˆå‰¯æª”å # é‡è©ä½¿ç”¨ sed -E \u0026#39;s/a+/A/g\u0026#39; file.txt # ä¸€å€‹æˆ–å¤šå€‹a sed -E \u0026#39;s/a?/A/g\u0026#39; file.txt # é›¶å€‹æˆ–ä¸€å€‹a sed -E \u0026#39;s/a{3}/AAA/g\u0026#39; file.txt # æ°å¥½ä¸‰å€‹a sed -E \u0026#39;s/a{2,4}/A/g\u0026#39; file.txt # 2åˆ°4å€‹a å¯¦æˆ°æ‡‰ç”¨å ´æ™¯ 1. æª”æ¡ˆå…§å®¹æ¸…ç† 1 2 3 4 5 6 7 8 9 10 # æ¸…ç†ç©ºè¡Œå’Œè¨»é‡‹ sed \u0026#39;/^$/d; /^#/d\u0026#39; file.txt # åˆªé™¤ç©ºè¡Œå’Œè¨»é‡‹è¡Œ sed \u0026#39;/^[[:space:]]*$/d\u0026#39; file.txt # åˆªé™¤ç©ºè¡Œå’Œåªæœ‰ç©ºç™½çš„è¡Œ sed \u0026#39;s/[[:space:]]*$//\u0026#39; file.txt # åˆªé™¤è¡Œå°¾ç©ºç™½ sed \u0026#39;s/^[[:space:]]*//\u0026#39; file.txt # åˆªé™¤è¡Œé¦–ç©ºç™½ # æ¸…ç†ç‰¹æ®Šå­—å…ƒ sed \u0026#39;s/\\r$//\u0026#39; file.txt # åˆªé™¤Windowsæ›è¡Œç¬¦ sed \u0026#39;s/\\t/ /g\u0026#39; file.txt # å°‡tabæ›¿æ›ç‚ºç©ºæ ¼ sed \u0026#39;s/[[:cntrl:]]//g\u0026#39; file.txt # åˆªé™¤æ§åˆ¶å­—å…ƒ 2. è³‡æ–™æ ¼å¼è½‰æ› 1 2 3 4 5 6 7 8 9 10 11 12 # CSVè™•ç† sed \u0026#39;s/,/\\t/g\u0026#39; data.csv # CSVè½‰TSV sed \u0026#39;s/;/,/g\u0026#39; file.csv # æ›´æ”¹åˆ†éš”ç¬¦ sed \u0026#39;1d\u0026#39; data.csv # åˆªé™¤æ¨™é¡Œè¡Œ # æ—¥æœŸæ ¼å¼è½‰æ› sed -E \u0026#39;s/([0-9]{4})-([0-9]{2})-([0-9]{2})/\\3\\/\\2\\/\\1/g\u0026#39; file.txt # 2023-12-25 -\u0026gt; 25/12/2023 # é›»è©±è™Ÿç¢¼æ ¼å¼åŒ– sed -E \u0026#39;s/([0-9]{3})([0-9]{3})([0-9]{4})/(\\1) \\2-\\3/\u0026#39; file.txt # 1234567890 -\u0026gt; (123) 456-7890 3. ç¨‹å¼ç¢¼è™•ç† 1 2 3 4 5 6 7 8 9 # æ‰¹æ¬¡é‡æ§‹ç¨‹å¼ç¢¼ find . -name \u0026#34;*.java\u0026#34; -exec sed -i \u0026#39;s/oldClassName/newClassName/g\u0026#39; {} \\; # ç§»é™¤åµéŒ¯ç¨‹å¼ç¢¼ sed \u0026#39;/console\\.log/d\u0026#39; script.js # åˆªé™¤console.logè¡Œ sed \u0026#39;/DEBUG/,/END_DEBUG/d\u0026#39; code.c # åˆªé™¤DEBUGå€å¡Š # æ·»åŠ æˆæ¬Šæ¨™é¡Œ sed \u0026#39;1i\\// Copyright 2023 Company Name\u0026#39; *.js # åœ¨æ¯å€‹JSæª”æ¡ˆé–‹é ­æ·»åŠ ç‰ˆæ¬Š 4. æ—¥èªŒåˆ†æ 1 2 3 4 5 6 7 8 9 10 # æå–ç‰¹å®šæ™‚é–“ç¯„åœçš„æ—¥èªŒ sed -n \u0026#39;/2023-12-01/,/2023-12-31/p\u0026#39; access.log # éæ¿¾éŒ¯èª¤æ—¥èªŒ sed -n \u0026#39;/ERROR\\|FATAL/p\u0026#39; application.log # åªé¡¯ç¤ºéŒ¯èª¤å’Œè‡´å‘½éŒ¯èª¤ sed \u0026#39;/INFO\\|DEBUG/d\u0026#39; application.log # éš±è—è³‡è¨Šå’ŒåµéŒ¯è¨Šæ¯ # æ—¥èªŒæ ¼å¼åŒ– sed \u0026#39;s/\\[\\([^]]*\\)\\]/\\1/g\u0026#39; syslog # ç§»é™¤æ–¹æ‹¬è™Ÿ sed -E \u0026#39;s/^([^ ]+) ([^ ]+)/[\\1] \\2:/\u0026#39; log.txt # é‡æ–°æ ¼å¼åŒ–æ™‚é–“æˆ³ 5. è¨­å®šæª”ç®¡ç† 1 2 3 4 5 6 7 8 # ä¿®æ”¹è¨­å®šå€¼ sed -i \u0026#39;s/^port=.*/port=8080/\u0026#39; config.ini # ä¿®æ”¹é€£æ¥åŸ è¨­å®š sed -i \u0026#39;/^#.*debug/s/^#//\u0026#39; config.conf # å–æ¶ˆè¨»é‡‹debugè¨­å®š sed -i \u0026#39;/^debug=/s/false/true/\u0026#39; config.conf # å•Ÿç”¨debugæ¨¡å¼ # æ·»åŠ è¨­å®šé …ç›® sed -i \u0026#39;/\\[database\\]/a\\timeout=30\u0026#39; config.ini # åœ¨[database]æ®µè½å¾Œæ·»åŠ è¨­å®š sed -i \u0026#39;$a\\new_setting=value\u0026#39; config.conf # åœ¨æª”æ¡ˆæœ«å°¾æ·»åŠ è¨­å®š é€²éšæŠ€å·§ 1. å¤šå‘½ä»¤è™•ç† 1 2 3 4 5 6 7 8 # ä½¿ç”¨åˆ†è™Ÿåˆ†éš”å‘½ä»¤ sed \u0026#39;1d; s/old/new/g; $a\\EOF\u0026#39; file.txt # ä½¿ç”¨-eé¸é … sed -e \u0026#39;1d\u0026#39; -e \u0026#39;s/old/new/g\u0026#39; -e \u0026#39;$a\\EOF\u0026#39; file.txt # ä½¿ç”¨å¤§æ‹¬è™Ÿçµ„åˆå‘½ä»¤ sed \u0026#39;/pattern/{s/old/new/; p;}\u0026#39; file.txt 2. æ¢ä»¶è™•ç† 1 2 3 4 5 6 7 8 # åˆ†æ”¯å’Œæ¨™ç±¤ sed \u0026#39;:label; s/\\([0-9]*\\),\\([0-9]\\)/\\1\\2,/; t label\u0026#39; file.txt # ç§»é™¤æ•¸å­—ä¸­çš„é€—è™Ÿ # æ¸¬è©¦å‘½ä»¤ sed \u0026#39;s/old/new/; t end; s/fallback/replacement/; :end\u0026#39; file.txt # è¤‡é›œæ¢ä»¶é‚è¼¯ sed \u0026#39;/pattern1/{s/old/new/; b}; /pattern2/s/old/different/\u0026#39; file.txt 3. ä¿æŒç©ºé–“ (Hold Space) 1 2 3 4 5 6 # åŸºæœ¬ä¿æŒç©ºé–“æ“ä½œ sed -n \u0026#39;1h; 2g; 2p\u0026#39; file.txt # å°‡ç¬¬1è¡Œè¤‡è£½åˆ°ç¬¬2è¡Œä½ç½®é¡¯ç¤º sed -n \u0026#39;1h; 1!H; $!d; x; p\u0026#39; file.txt # åè½‰æª”æ¡ˆè¡Œé †åº # è¤‡é›œçš„ä¿æŒç©ºé–“ç¯„ä¾‹ sed -n \u0026#39;/pattern/{h; n; s/old/new/; H; x; s/\\n/ - /; p;}\u0026#39; file.txt 4. è…³æœ¬æª”æ¡ˆ å»ºç«‹ script.sed æª”æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 # é€™æ˜¯ä¸€å€‹sedè…³æœ¬æª”æ¡ˆ # åˆªé™¤ç©ºè¡Œ /^$/d # åˆªé™¤è¨»é‡‹è¡Œ /^#/d # æ›¿æ›ç‰¹å®šæ¨¡å¼ s/old_pattern/new_pattern/g # åœ¨æª”æ¡ˆæœ«å°¾æ·»åŠ å…§å®¹ $a\\ Processing completed. ä½¿ç”¨è…³æœ¬ï¼š\n1 sed -f script.sed input.txt æ•ˆèƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸ 1. æ•ˆèƒ½å„ªåŒ–æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨quitå‘½ä»¤ææ—©é€€å‡º sed \u0026#39;10q\u0026#39; file.txt # åªè™•ç†å‰10è¡Œå¾Œé€€å‡º sed \u0026#39;/pattern/q\u0026#39; file.txt # æ‰¾åˆ°åŒ¹é…å¾Œç«‹å³é€€å‡º # é¿å…ä¸å¿…è¦çš„è™•ç† sed -n \u0026#39;/pattern/p\u0026#39; file.txt # ä½¿ç”¨-né¿å…è‡ªå‹•åˆ—å° sed \u0026#39;/pattern/!d\u0026#39; file.txt # åªä¿ç•™åŒ¹é…è¡Œ # çµ„åˆå¤šå€‹æ“ä½œ sed \u0026#39;s/old1/new1/g; s/old2/new2/g\u0026#39; file.txt # ä¸€æ¬¡åŸ·è¡Œå¤šå€‹æ›¿æ› 2. è¨˜æ†¶é«”ä½¿ç”¨å„ªåŒ– 1 2 3 4 5 6 # è™•ç†å¤§æª”æ¡ˆæ™‚çš„æ³¨æ„äº‹é … sed \u0026#39;1,1000d\u0026#39; hugefile.txt \u0026gt; output.txt # åˆ†æ®µè™•ç†å¤§æª”æ¡ˆ sed -n \u0026#39;1000,2000p\u0026#39; hugefile.txt # åªè™•ç†ç‰¹å®šç¯„åœ # ä½¿ç”¨ç®¡é“æ¸›å°‘ä¸­é–“æª”æ¡ˆ cat input.txt | sed \u0026#39;s/old/new/g\u0026#39; | sed \u0026#39;/pattern/d\u0026#39; \u0026gt; output.txt 3. éŒ¯èª¤è™•ç† 1 2 3 4 5 6 7 8 9 # å‚™ä»½é‡è¦æª”æ¡ˆ sed -i.backup \u0026#39;s/old/new/g\u0026#39; important.txt # è‡ªå‹•å‚™ä»½ # æ¸¬è©¦å‘½ä»¤ sed \u0026#39;s/old/new/g\u0026#39; file.txt \u0026gt; test_output.txt # å…ˆæ¸¬è©¦è¼¸å‡º diff file.txt test_output.txt # æª¢æŸ¥å·®ç•° # æª¢æŸ¥æª”æ¡ˆå­˜åœ¨ [ -f file.txt ] \u0026amp;\u0026amp; sed -i \u0026#39;s/old/new/g\u0026#39; file.txt å¸¸è¦‹éŒ¯èª¤èˆ‡é™¤éŒ¯ 1. å¸¸è¦‹éŒ¯èª¤ 1 2 3 4 5 6 7 8 9 10 11 # éŒ¯èª¤ï¼šæœªè½‰ç¾©ç‰¹æ®Šå­—å…ƒ sed \u0026#39;s/file.txt/newfile.txt/\u0026#39; file # éŒ¯èª¤ï¼š.åŒ¹é…ä»»æ„å­—å…ƒ sed \u0026#39;s/file\\.txt/newfile.txt/\u0026#39; file # æ­£ç¢ºï¼šè½‰ç¾©.å­—å…ƒ # éŒ¯èª¤ï¼šåœ°å€ç¯„åœå•é¡Œ sed \u0026#39;1,$s/old/new/\u0026#39; file.txt # å¯èƒ½é€ æˆæ··æ·† sed \u0026#39;1,$ s/old/new/\u0026#39; file.txt # æ›´æ¸…æ¥šçš„å¯«æ³• # éŒ¯èª¤ï¼šå¿˜è¨˜åˆ†éš”ç¬¦è½‰ç¾© sed \u0026#39;s/http://old.com/http://new.com/\u0026#39; file # éŒ¯èª¤ï¼šåˆ†éš”ç¬¦è¡çª sed \u0026#39;s#http://old.com#http://new.com#\u0026#39; file # æ­£ç¢ºï¼šä½¿ç”¨ä¸åŒåˆ†éš”ç¬¦ 2. é™¤éŒ¯æŠ€å·§ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨åµéŒ¯æ¨¡å¼ sed --debug \u0026#39;s/old/new/g\u0026#39; file.txt # é€æ­¥æ¸¬è©¦ sed -n \u0026#39;l\u0026#39; file.txt # é¡¯ç¤ºä¸å¯è¦‹å­—å…ƒ sed = file.txt | sed \u0026#39;N; s/\\n/\\t/\u0026#39; # é¡¯ç¤ºè¡Œè™Ÿ # æ¸¬è©¦æ­£è¦è¡¨é”å¼ echo \u0026#34;test string\u0026#34; | sed \u0026#39;s/pattern/replacement/\u0026#39; èˆ‡å…¶ä»–å·¥å…·æ•´åˆ 1. èˆ‡ find çµ„åˆ 1 2 3 4 5 6 # æ‰¹æ¬¡è™•ç†æª”æ¡ˆ find . -name \u0026#34;*.txt\u0026#34; -exec sed -i \u0026#39;s/old/new/g\u0026#39; {} \\; find . -name \u0026#34;*.conf\u0026#34; -exec sed -i \u0026#39;/^#/d\u0026#39; {} \\; # ä½¿ç”¨ xargs æå‡æ•ˆèƒ½ find . -name \u0026#34;*.txt\u0026#34; | xargs sed -i \u0026#39;s/old/new/g\u0026#39; 2. èˆ‡ awk çµ„åˆ 1 2 3 4 5 # sedè™•ç†æ ¼å¼ï¼Œawkè™•ç†é‚è¼¯ sed \u0026#39;s/,/ /g\u0026#39; data.csv | awk \u0026#39;{print $1, $3}\u0026#39; # ç®¡é“çµ„åˆè™•ç† cat log.txt | sed \u0026#39;/ERROR/!d\u0026#39; | awk \u0026#39;{print $1, $4}\u0026#39; 3. èˆ‡ grep çµ„åˆ 1 2 3 4 5 # å…ˆéæ¿¾å†è™•ç† grep \u0026#34;pattern\u0026#34; file.txt | sed \u0026#39;s/old/new/g\u0026#39; # çµ„åˆæ¢ä»¶è™•ç† sed -n \u0026#39;/start/,/end/p\u0026#39; file.txt | grep \u0026#34;important\u0026#34; å¯¦ç”¨è…³æœ¬ç¯„ä¾‹ 1. æ—¥èªŒæ¸…ç†è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/bash # log_cleanup.sh - æ¸…ç†å’Œæ ¼å¼åŒ–æ—¥èªŒæª”æ¡ˆ LOG_FILE=\u0026#34;$1\u0026#34; OUTPUT_FILE=\u0026#34;${LOG_FILE}.clean\u0026#34; sed -e \u0026#39;/^$/d\u0026#39; \\ -e \u0026#39;/^#/d\u0026#39; \\ -e \u0026#39;s/[[:space:]]*$//\u0026#39; \\ -e \u0026#39;s/\\t/ /g\u0026#39; \\ -e \u0026#39;/DEBUG/d\u0026#39; \\ \u0026#34;$LOG_FILE\u0026#34; \u0026gt; \u0026#34;$OUTPUT_FILE\u0026#34; echo \u0026#34;æ¸…ç†å®Œæˆï¼š$OUTPUT_FILE\u0026#34; 2. è¨­å®šæª”æ›´æ–°è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #!/bin/bash # config_update.sh - æ‰¹æ¬¡æ›´æ–°è¨­å®šæª” CONFIG_DIR=\u0026#34;/etc/myapp\u0026#34; BACKUP_DIR=\u0026#34;/etc/myapp/backup\u0026#34; # å‚™ä»½è¨­å®šæª” mkdir -p \u0026#34;$BACKUP_DIR\u0026#34; cp \u0026#34;$CONFIG_DIR\u0026#34;/*.conf \u0026#34;$BACKUP_DIR\u0026#34;/ # æ›´æ–°è¨­å®š find \u0026#34;$CONFIG_DIR\u0026#34; -name \u0026#34;*.conf\u0026#34; -exec sed -i \\ -e \u0026#39;s/^port=.*/port=8080/\u0026#39; \\ -e \u0026#39;s/^debug=false/debug=true/\u0026#39; \\ -e \u0026#39;/^#.*logging/s/^#//\u0026#39; \\ {} \\; echo \u0026#34;è¨­å®šæ›´æ–°å®Œæˆ\u0026#34; 3. ç¨‹å¼ç¢¼é‡æ§‹è…³æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/bash # refactor.sh - æ‰¹æ¬¡é‡æ§‹ç¨‹å¼ç¢¼ OLD_CLASS=\u0026#34;$1\u0026#34; NEW_CLASS=\u0026#34;$2\u0026#34; if [ $# -ne 2 ]; then echo \u0026#34;ç”¨æ³•: $0 \u0026lt;èˆŠé¡åˆ¥å\u0026gt; \u0026lt;æ–°é¡åˆ¥å\u0026gt;\u0026#34; exit 1 fi # æ›´æ–°Javaæª”æ¡ˆ find . -name \u0026#34;*.java\u0026#34; -exec sed -i \\ -e \u0026#34;s/class $OLD_CLASS/class $NEW_CLASS/g\u0026#34; \\ -e \u0026#34;s/new $OLD_CLASS(/new $NEW_CLASS(/g\u0026#34; \\ -e \u0026#34;s/$OLD_CLASS\\.class/$NEW_CLASS.class/g\u0026#34; \\ {} \\; echo \u0026#34;é‡æ§‹å®Œæˆï¼š$OLD_CLASS -\u0026gt; $NEW_CLASS\u0026#34; ç¸½çµ æ ¸å¿ƒå„ªå‹¢ é«˜æ•ˆç‡ï¼šæµå¼è™•ç†ï¼Œè¨˜æ†¶é«”ä½¿ç”¨é‡å° éˆæ´»æ€§ï¼šæ”¯æ´è¤‡é›œçš„æ–‡æœ¬æ“ä½œ è‡ªå‹•åŒ–ï¼šé©åˆè…³æœ¬å’Œæ‰¹æ¬¡è™•ç† æ¨™æº–åŒ–ï¼šè·¨å¹³å°ä¸€è‡´æ€§å¥½ æœ€ä½³å¯¦è¸ æ¸¬è©¦å…ˆè¡Œï¼šé‡è¦æ“ä½œå‰å…ˆæ¸¬è©¦è¼¸å‡º å‚™ä»½é‡è¦æª”æ¡ˆï¼šä½¿ç”¨ -i.backup é¸é … å–„ç”¨æ­£è¦è¡¨é”å¼ï¼šæå‡è™•ç†æ•ˆç‡ çµ„åˆå·¥å…·ï¼šèˆ‡å…¶ä»–å‘½ä»¤å”ä½œä½¿ç”¨ è…³æœ¬åŒ–ï¼šå°‡è¤‡é›œæ“ä½œå°è£ç‚ºè…³æœ¬ å­¸ç¿’å»ºè­° 1 2 3 4 5 6 7 # å¸¸ç”¨æ“ä½œè¨˜æ†¶å£è¨£ sed \u0026#39;s/old/new/g\u0026#39; # æ›¿æ›ï¼šsubstitute sed \u0026#39;3d\u0026#39; # åˆªé™¤ï¼šdelete sed \u0026#39;3p\u0026#39; # åˆ—å°ï¼šprint sed \u0026#39;3a\\text\u0026#39; # é™„åŠ ï¼šappend sed \u0026#39;3i\\text\u0026#39; # æ’å…¥ï¼šinsert sed \u0026#39;3c\\text\u0026#39; # æ”¹è®Šï¼šchange sed æ˜¯æ–‡æœ¬è™•ç†çš„ç‘å£«è»åˆ€ï¼ŒæŒæ¡å…¶æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨æ“ä½œï¼Œèƒ½å¤ å¤§å¹…æå‡ Linux ç³»çµ±ç®¡ç†å’Œè‡ªå‹•åŒ–è…³æœ¬çš„æ•ˆç‡ã€‚è¨˜ä½ï¼šå¯¦å‹™ä¸­æœ€é‡è¦çš„æ˜¯ç†è§£æ¨¡å¼ç©ºé–“çš„æ¦‚å¿µï¼Œä¸¦å–„ç”¨åœ°å€å®šç•Œä¾†ç²¾ç¢ºæ§åˆ¶æ“ä½œç¯„åœã€‚\nåƒè€ƒè³‡æ–™ GNU sed Manual sed \u0026amp; awk by O\u0026rsquo;Reilly Advanced Bash-Scripting Guide Regular Expressions Info ","permalink":"https://xinqilin.github.io/post/tools/sed/","tags":["Linux","Sed","Stream Editor","Text Processing","Regular Expression","Shell","Unix"],"title":"Sed æµç·¨è¼¯å™¨å®Œæ•´æŒ‡å—ï¼šLinux æ–‡æœ¬è™•ç†çš„å¼·å¤§å·¥å…·"},{"content":"Memento ç•¶æˆ‘å€‘æƒ³è¦ä¿å­˜å°è±¡çš„ç‹€æ…‹ä»¥ä¾¿ä»¥å¾Œæ¢å¾©å®ƒæ™‚ï¼Œæˆ‘å€‘ä½¿ç”¨å‚™å¿˜éŒ„è¨­è¨ˆæ¨¡å¼ã€‚å‚™å¿˜éŒ„æ¨¡å¼æœ‰åŠ©æ–¼ä»¥é€™æ¨£ä¸€ç¨®æ–¹å¼å¯¦ç¾é€™ä¸€é»ï¼Œå³å°è±¡çš„å·²ä¿å­˜ç‹€æ…‹æ•¸æ“šåœ¨å°åƒå¤–éƒ¨ç„¡æ³•è¨ªå•ï¼›é€™ä¿è­·äº†å·²ä¿å­˜ç‹€æ…‹æ•¸æ“šçš„å®Œæ•´æ€§ã€‚\nå¯¦ç¾ Memento æ¨¡å¼çš„æƒ³æ³•å§‹æ–¼å…©å€‹å°è±¡â€”â€” Originator å’Œ Caretakerã€‚Originatoræ˜¯éœ€è¦ä¿å­˜å’Œæ¢å¾©ç‹€æ…‹çš„å°è±¡ï¼Œå®ƒä½¿ç”¨ä¸€å€‹å…§éƒ¨é¡ä¾†ä¿å­˜Objectçš„ç‹€æ…‹ã€‚å…§éƒ¨é¡ç¨±ç‚º Memento åŠå…¶ç§æœ‰ï¼Œå› æ­¤ç„¡æ³•å¾å…¶ä»–å°è±¡è¨ªå•ã€‚\nCaretaker æ˜¯å¹«åŠ©é¡ï¼Œè² è²¬é€šé Memento å°è±¡å­˜å„²å’Œæ¢å¾© Originator çš„ç‹€æ…‹ã€‚ç”±æ–¼ Memento å° Originator æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤ Caretaker ç„¡æ³•è¨ªå•å®ƒï¼Œä¸¦ä¸”å®ƒä½œç‚º Object å­˜å„²åœ¨ caretaker ä¸­ã€‚\nç¾å¯¦ç”Ÿæ´»ä¸­æœ€å¥½çš„ä¾‹å­ä¹‹ä¸€æ˜¯ IDE, æˆ‘å€‘å¯ä»¥éš¨æ™‚ä¿å­˜å…¶æ•¸æ“šä¸¦ä½¿ç”¨æ’¤æ¶ˆå°‡å…¶æ¢å¾©åˆ°ä»¥å‰ä¿å­˜çš„ç‹€æ…‹ã€‚\nå¿…é ˆä¿å­˜å°è±¡ç‹€æ…‹ï¼ˆæŸäº›éƒ¨åˆ†ï¼‰çš„å¿«ç…§ï¼Œä»¥ä¾¿ä»¥å¾Œå¯ä»¥å°‡å…¶æ¢å¾©åˆ°è©²ç‹€æ…‹ï¼Œä¸¦ä¸” ç²å–ç‹€æ…‹çš„ç›´æ¥æ¥å£æœƒæš´éœ²å¯¦ç¾ç´°ç¯€ä¸¦ç ´å£å°è±¡çš„å°è£ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/memento/","tags":[],"title":"DesignPattern - Behavioral - Memento"},{"content":"Interpreter ç”¨å®ƒä¾†å®šç¾©ä¸€ç¨®èªè¨€çš„èªæ³•è¡¨ç¤ºï¼Œå®ƒæä¾›äº†ä¸€å€‹è§£é‡‹å™¨ä¾†è™•ç†èªæ³•ã€‚é€™ç¨®æ¨¡å¼çš„æœ€ä½³ç¤ºä¾‹æ˜¯ java ç·¨è­¯å™¨ï¼Œå®ƒå°‡ java æºä»£ç¢¼è§£é‡‹ç‚º JVM å¯ä»¥ç†è§£çš„å­—ç¯€ç¢¼ã€‚google translation ä¹Ÿæ˜¯Interpreter çš„ä¸€å€‹ä¾‹å­ï¼Œå…¶ä¸­è¼¸å…¥å¯ä»¥æ˜¯ä»»ä½•èªè¨€ï¼Œæˆ‘å€‘å¯ä»¥å¾—åˆ°å¦ä¸€ç¨®èªè¨€çš„è§£é‡‹è¼¸å‡ºã€‚\nç‚ºäº† Interpreterï¼Œæˆ‘å€‘éœ€è¦å‰µå»º Interpreter ä¸Šä¸‹æ–‡å¼•æ“ä¾†å®Œæˆè§£é‡‹å·¥ä½œã€‚ç„¶å¾Œï¼Œæˆ‘å€‘éœ€è¦å‰µå»ºä¸åŒçš„ Expression å¯¦ç¾ï¼Œé€™äº›å¯¦ç¾å°‡ä½¿ç”¨è§£é‡‹å™¨ä¸Šä¸‹æ–‡æä¾›çš„åŠŸèƒ½ã€‚æœ€å¾Œï¼Œæˆ‘å€‘éœ€è¦å‰µå»ºå®¢æˆ¶ç«¯ï¼Œè©²å®¢æˆ¶ç«¯å°‡å¾ç”¨æˆ¶é‚£è£¡ç²å–è¼¸å…¥ä¸¦æ±ºå®šä½¿ç”¨å“ªå€‹è¡¨é”å¼ï¼Œç„¶å¾Œç‚ºç”¨æˆ¶ç”Ÿæˆè¼¸å‡ºã€‚\nèªæ³•å¾ˆç°¡å–®ã€‚å°æ–¼å¾©é›œçš„èªæ³•ï¼Œèªæ³•çš„é¡å±¤æ¬¡çµæ§‹è®Šå¾—é¾å¤§ä¸”é›£ä»¥ç®¡ç†ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œè§£æå™¨ç”Ÿæˆå™¨ç­‰å·¥å…·æ˜¯æ›´å¥½çš„é¸æ“‡ã€‚ä»–å€‘å¯ä»¥åœ¨ä¸æ§‹å»ºæŠ½è±¡èªæ³•æ¨¹ (AST) çš„æƒ…æ³ä¸‹è§£é‡‹è¡¨é”å¼ï¼Œé€™ä¹Ÿå¯ä»¥ç¯€çœç©ºé–“å’Œæ™‚é–“ã€‚ æ•ˆç‡ä¸æ˜¯é—œéµå•é¡Œã€‚æœ€æœ‰æ•ˆçš„è§£é‡‹å™¨é€šå¸¸ä¸æ˜¯é€šéç›´æ¥è§£é‡‹è§£ææ¨¹ä¾†å¯¦ç¾ï¼Œè€Œæ˜¯é¦–å…ˆå°‡å®ƒå€‘ç¿»è­¯æˆå¦ä¸€ç¨®å½¢å¼ã€‚ä¾‹å¦‚ï¼Œæ­£å‰‡è¡¨é”å¼ç¶“å¸¸è¢«è½‰æ›ç‚ºç‹€æ…‹æ©Ÿã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥è—‰åŠ©è§£é‡‹å™¨æ¨¡å¼ä¾†å¯¦ç¾ç¿»è­¯å™¨ï¼Œå› æ­¤è©²æ¨¡å¼ä»ç„¶é©ç”¨ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/interpreter/","tags":[],"title":"DesignPattern - Behavioral - Interpreter"},{"content":"Iterator Iterator æ˜¯ä¸€ç¨®è¡Œç‚ºæ¨¡å¼ï¼Œä½¿ç”¨å®ƒä¾†æä¾›ä¸€ç¨®æ¨™æº–çš„æ–¹å¼ä¾†éæ­·ä¸€çµ„å°è±¡ã€‚æˆ‘å€‘åœ¨ Java é›†åˆæ¡†æ¶ä¸­å»£æ³›ä½¿ç”¨ Iteratorï¼Œå…¶ä¸­è¿­ä»£å™¨æ¥å£æä¾›äº†éæ­·é›†åˆçš„æ–¹æ³•ã€‚ è¿­ä»£çš„é‚è¼¯åµŒå…¥åœ¨é›†åˆæœ¬èº«ä¸­ï¼Œå®ƒå¯ä»¥å¹«åŠ©å®¢æˆ¶ç«¯ç¨‹åºè¼•é¬†åœ°å°å…¶é€²è¡Œè¿­ä»£ã€‚Iterator å°è±¡åŒ…å«å…¬å…±æ–¹æ³•ï¼Œä»¥å…è¨±å®¢æˆ¶ç«¯å°åƒåœ¨å®¹å™¨å…§çš„å°è±¡åˆ—è¡¨è¿­ä»£ã€‚\nIterator å®šç¾© interface ç”¨ä¾†è¿­ä»£æˆ–å­˜å–çš„æ¥å£\nConcreteIterator implement Iterator interface tracking the current position in the traversal of the aggregate.\nAggregate å®šç¾©ç”¨æ–¼å‰µå»º Iterator å°è±¡çš„æ¥å£ã€‚\nConcreteAggregate å¯¦ç¾ Iterator å‰µå»ºæ¥å£ä»¥è¿”å›æ­£ç¢ºçš„ ConcreteIterator çš„å¯¦ä¾‹ã€‚\nç•¶æƒ³æä¾›ä¸€ç¨®æ¨™æº–æ–¹æ³•ä¾†è¿­ä»£é›†åˆä½µéš±è—å®¢æˆ¶ç«¯ç¨‹åºçš„å¯¦ç¾é‚è¼¯æ™‚ã€‚ ç•¶æ‚¨éœ€è¦è¨ªå•èšåˆå°è±¡çš„å…§å®¹è€Œä¸æš´éœ²å…¶å…§éƒ¨è¡¨ç¤ºæ™‚ã€‚ æ”¯æŒèšåˆå°è±¡çš„å¤šæ¬¡éæ­·ã€‚ ç‚ºéæ­·ä¸åŒçš„èšåˆçµæ§‹æä¾›çµ±ä¸€çš„æ¥å£ï¼ˆå³æ”¯æŒå¤šæ…‹è¿­ä»£ï¼‰ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/iterator/","tags":[],"title":"DesignPattern - Behavioral - Iterator"},{"content":"Visitor ç•¶å¿…é ˆå°ä¸€çµ„ç›¸ä¼¼é¡å‹çš„å°è±¡åŸ·è¡Œæ“ä½œæ™‚ï¼Œæˆ‘å€‘ä½¿ç”¨è¨ªå•è€…æ¨¡å¼ã€‚å€ŸåŠ© visitor patternï¼Œæˆ‘å€‘å¯ä»¥å°‡æ“ä½œé‚è¼¯å¾å°è±¡è½‰ç§»åˆ°å¦ä¸€å€‹é¡ã€‚ä¾‹å¦‚ï¼Œè€ƒæ…®ä¸€å€‹è³¼ç‰©è»Šï¼Œæˆ‘å€‘å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ ä¸åŒé¡å‹çš„å•†å“ï¼ˆå…ƒç´ ï¼‰ï¼Œç•¶æˆ‘å€‘é»æ“Šçµå¸³æŒ‰éˆ•æ™‚ï¼Œå®ƒæœƒè¨ˆç®—å‡ºæˆ‘å€‘éœ€è¦æ”¯ä»˜çš„ç¸½é‡‘é¡ã€‚ç¾åœ¨ï¼Œæˆ‘å€‘å¯ä»¥åœ¨é …ç›®é¡ä¸­åŒ…å«è¨ˆç®—é‚è¼¯ï¼Œæˆ–è€…æˆ‘å€‘å¯ä»¥ä½¿ç”¨ visitor pattern å°‡æ­¤é‚è¼¯ç§»åˆ°å¦ä¸€å€‹é¡ä¸­ã€‚å› æ­¤ï¼Œä½¿ç”¨ visitor patternï¼Œæˆ‘å€‘å¯ä»¥å°‡é‚è¼¯ç§»åˆ°å¦ä¸€å€‹é¡ã€‚\nvisitor pattern å…è¨±åœ¨ä¸æ›´æ”¹é›†åˆä¸­ä»»ä½•å°è±¡çš„é¡çš„æƒ…æ³ä¸‹å®šç¾©æ“ä½œã€‚ç‚ºæ­¤ï¼Œvisitor pattern å»ºè­°åœ¨ç¨±ç‚º visitoré¡çš„å–®ç¨é¡ä¸­å®šç¾©æ“ä½œã€‚é€™å°‡æ“ä½œèˆ‡å…¶æ“ä½œçš„å°è±¡é›†åˆåˆ†é–‹ã€‚å°æ–¼è¦å®šç¾©çš„æ¯å€‹æ–°æ“ä½œï¼Œéƒ½æœƒå‰µå»ºä¸€å€‹æ–°çš„è¨ªå•è€…é¡ã€‚ç”±æ–¼æ“ä½œå°‡åœ¨ä¸€çµ„å°åƒä¸ŠåŸ·è¡Œï¼Œå› æ­¤è¨ªå•è€…éœ€è¦ä¸€ç¨®è¨ªå•é€™äº›å°è±¡çš„å…¬å…±æˆå“¡çš„æ–¹æ³•ã€‚\nVisitorï¼šç‚ºå°è±¡çµæ§‹ä¸­çš„æ¯å€‹ ConcreteElement é¡è²æ˜ä¸€å€‹è¨ªå•æ“ä½œã€‚æ“ä½œçš„åç¨±å’Œç°½åæ¨™è­˜å‘è¨ªå•è€…ç™¼é€è¨ªå•è«‹æ±‚çš„é¡ã€‚é€™è®“è¨ªå•è€…å¯ä»¥ç¢ºå®šè¢«è¨ªå•å…ƒç´ çš„å…·é«”é¡ã€‚ç„¶å¾Œè¨ªå•è€…å¯ä»¥é€šéå…¶ç‰¹å®šçš„ç•Œé¢ç›´æ¥è¨ªå•è©²å…ƒç´ ã€‚ ConcreteVisitorï¼šå¯¦ç¾è¨ªå•è€…è²æ˜çš„æ¯å€‹æ“ä½œã€‚æ¯å€‹æ“ä½œéƒ½å¯¦ç¾äº†ç‚ºçµæ§‹ä¸­çš„ç›¸æ‡‰å°åƒé¡å®šç¾©çš„ç®—æ³•ç‰‡æ®µã€‚ConcreteVisitor ç‚ºç®—æ³•æä¾›ä¸Šä¸‹æ–‡ä¸¦å­˜å„²å…¶æœ¬åœ°ç‹€æ…‹ã€‚é€™ç¨®ç‹€æ…‹é€šå¸¸æœƒåœ¨çµæ§‹çš„éæ­·éç¨‹ä¸­ç´¯ç©çµæœã€‚ Elementï¼šå®šç¾©ä¸€å€‹æ¥å—è¨ªå•è€…ä½œç‚ºåƒæ•¸çš„æ“ä½œã€‚ ConcreteElementï¼šå¯¦ç¾ä»¥è¨ªå•è€…ç‚ºåƒæ•¸çš„ Accept æ“ä½œã€‚ ObjectStructure:\nå¯ä»¥æšèˆ‰å®ƒçš„å…ƒç´ ã€‚ å¯ä»¥æä¾›é«˜ç´šç•Œé¢ä»¥å…è¨±è¨ªå•è€…è¨ªå•å…¶å…ƒç´ ã€‚ å¯ä»¥æ˜¯çµ„åˆæˆ–é›†åˆï¼Œä¾‹å¦‚åˆ—è¡¨æˆ–é›†åˆã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 public interface ShoppingCartElement { public int accept(ShoppingCartVisitor visitor); } public class Beef implements ShoppingCartElement { private int price; private double weight; // constructor , getter , setter @Override //Notice the implementation of accept() method in concrete classes, //its calling visit() method of Visitor and passing itself as argument. public int accept(ShoppingCartVisitor visitor) { return visitor.visit(this); } } public class Fruit implements ShoppingCartElement { private int pricePerKg; private int weight; private String name; // constructor , getter , setter @Override public int accept(ShoppingCartVisitor visitor) { return visitor.visit(this); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 public interface ShoppingCartVisitor { int visit(Beef book); int visit(Fruit fruit); } public class ShoppingCartVisitorImpl implements ShoppingCartVisitor { @Override public int visit(Beef beef) { var cost = 0; //apply 5$ discount if book price is greater than 50 if(beef.getPrice() \u0026gt; 50){ cost = beef.getPrice() - 5; } else { cost = beef.getPrice(); } log.info(\u0026#34;beef: {}\u0026#34;, beef); return cost; } @Override public int visit(Fruit fruit) { var cost = fruit.getPricePerKg() * fruit.getWeight(); log.info(\u0026#34;cost: \u0026#34; + cost); return cost; } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public static void main(String[] args) { var items = new ShoppingCartElement[]{ new Beef(20, 2.0), new Beef(100, 3.0), new Fruit(10, 2, \u0026#34;Apple\u0026#34;), new Fruit(5, 5, \u0026#34;Banana\u0026#34;) }; int total = calculatePrice(items); log.info(\u0026#34;total: \u0026#34; + total); } private static int calculatePrice(ShoppingCartElement[] items) { var visitor = new ShoppingCartVisitorImpl(); int sum = 0; for(ShoppingCartElement item : items){ sum += item.accept(visitor); } return sum; } ä¸€å€‹å°è±¡çµæ§‹åŒ…å«è¨±å¤šå…·æœ‰ä¸åŒæ¥å£çš„å°åƒé¡ï¼Œä¸¦ä¸”æ‚¨å¸Œæœ›å°é€™äº›å°è±¡åŸ·è¡Œä¾è³´æ–¼å®ƒå€‘çš„å…·é«”é¡çš„æ“ä½œã€‚ ç•¶æˆ‘å€‘éœ€è¦å°å°è±¡çµæ§‹ä¸­çš„å°è±¡åŸ·è¡Œè¨±å¤šä¸åŒä¸”ä¸ç›¸é—œçš„æ“ä½œæ™‚ï¼Œæˆ‘å€‘å¸Œæœ›é¿å…é€™äº›æ“ä½œ \u0026ldquo;æ±¡æŸ“\u0026rdquo; å®ƒå€‘çš„ classã€‚è¨ªå•è€…å…è¨±æ‚¨é€šéåœ¨ä¸€å€‹é¡ä¸­å®šç¾©ç›¸é—œæ“ä½œä¾†å°‡å®ƒå€‘ä¿æŒåœ¨ä¸€èµ·ã€‚ç•¶æˆ‘å€‘éœ€è¦èˆ‡è¨±å¤šæ‡‰ç”¨ç¨‹åºå…±äº«å°è±¡çµæ§‹æ™‚ï¼Œä½¿ç”¨è¨ªå•è€…å°‡æ“ä½œæ”¾åœ¨é‚£äº›éœ€è¦å®ƒå€‘çš„æ‡‰ç”¨ç¨‹åºä¸­ã€‚ å®šç¾©å°è±¡çµæ§‹çš„é¡å¾ˆå°‘æ›´æ”¹ï¼Œä½†æ‚¨ç¶“å¸¸å¸Œæœ›åœ¨è©²çµæ§‹ä¸Šå®šç¾©æ–°æ“ä½œã€‚ä½†æ˜¯ï¼Œæ›´æ”¹å°è±¡çµæ§‹é¡éœ€è¦é‡æ–°å®šç¾©æ‰€æœ‰è¨ªå•è€…çš„æ¥å£ï¼Œé€™å¯èƒ½æ˜¯æ˜‚è²´çš„ã€‚å¦‚æœå°è±¡çµæ§‹é¡ç¶“å¸¸æ›´æ”¹ï¼Œé‚£éº¼æœ€å¥½åœ¨é€™äº›é¡ä¸­å®šç¾©æ“ä½œã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/visitor/","tags":[],"title":"DesignPattern - Behavioral - Visitor"},{"content":"State ç•¶å°åƒåœ¨å…¶å…§éƒ¨ç‹€æ…‹æ”¹è®Šæ™‚æ”¹è®Šå…¶è¡Œç‚ºæ™‚ï¼Œæˆ‘å€‘ä½¿ç”¨ç‹€æ…‹è¨­è¨ˆæ¨¡å¼ã€‚æˆ‘å€‘å¯ä»¥å°‡å°è±¡çš„ç‹€æ…‹å®šç¾©ç‚ºå…¶åœ¨ä»»ä½•çµ¦å®šæ™‚é–“é»çš„ç¢ºåˆ‡æ¢ä»¶ï¼Œå…·é«”å–æ±ºæ–¼å…¶å±¬æ€§æˆ–å±¬æ€§çš„å€¼ã€‚ä¸€å€‹é¡å¯¦ç¾çš„ä¸€çµ„æ–¹æ³•æ§‹æˆäº†å®ƒçš„å¯¦ä¾‹çš„è¡Œç‚ºã€‚æ¯ç•¶å…¶å±¬æ€§å€¼ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œæˆ‘å€‘å°±èªªå°è±¡çš„ç‹€æ…‹ç™¼ç”Ÿäº†è®ŠåŒ–ã€‚\né¦–æ¬¡å‰µå»º Context å°è±¡æ™‚ï¼Œå®ƒæœƒä½¿ç”¨å…¶åˆå§‹ State å°åƒå°å…¶è‡ªèº«é€²è¡Œåˆå§‹åŒ–ã€‚æ­¤ State å°è±¡æˆç‚ºä¸Šä¸‹æ–‡çš„ç•¶å‰ State å°è±¡ã€‚é€šéç”¨æ–°çš„ State å°è±¡æ›¿æ›ç•¶å‰çš„ State å°è±¡ï¼Œä¸Šä¸‹æ–‡è½‰æ›åˆ°æ–°çš„ç‹€æ…‹ã€‚ç•¶æ‡‰ç”¨ç¨‹åºå°è±¡èª¿ç”¨ Context æ–¹æ³•ï¼ˆè¡Œç‚ºï¼‰æ™‚ï¼Œå®ƒæœƒå°‡æ–¹æ³•èª¿ç”¨è½‰ç™¼åˆ°å…¶ç•¶å‰çš„ State å°è±¡ã€‚\nä¸Šä¸‹æ–‡ï¼šå®šç¾©å®¢æˆ¶æ„Ÿèˆˆè¶£çš„æ¥å£ã€‚æ­¤å¤–ï¼Œå®ƒç¶­è­·äº†ä¸€å€‹å®šç¾©ç•¶å‰ç‹€æ…‹çš„ ConcreteState å­é¡çš„å¯¦ä¾‹ã€‚ Stateï¼š å®šç¾©ä¸€å€‹æ¥å£ï¼Œç”¨æ–¼å°è£èˆ‡ Context çš„ç‰¹å®šç‹€æ…‹ç›¸é—œçš„è¡Œç‚ºã€‚ ConcreteState å­é¡ï¼šæ¯å€‹å­é¡å¯¦ç¾èˆ‡ä¸Šä¸‹æ–‡ç‹€æ…‹ç›¸é—œè¯çš„è¡Œç‚ºã€‚ åœ¨ç‹€æ…‹æ¨¡å¼ä¸­ï¼Œæˆ‘å€‘æœ‰ä¸€å€‹ Context é¡ï¼Œä¸¦ä¸”é€™å€‹é¡æœ‰ä¸€å€‹å°å…·é«”ç‹€æ…‹å¯¦ä¾‹çš„ç‹€æ…‹å¼•ç”¨ã€‚State æ¥å£è²æ˜äº†è¡¨ç¤ºç‰¹å®šç‹€æ…‹è¡Œç‚ºçš„ç‰¹å®šæ–¹æ³•ã€‚å…·é«”åœ‹å®¶å¯¦æ–½é€™äº›è¡Œç‚ºã€‚é€šéæ”¹è®Šä¸Šä¸‹æ–‡çš„å…·é«”ç‹€æ…‹ï¼Œæˆ‘å€‘æ”¹è®Šäº†å®ƒçš„è¡Œç‚ºã€‚æœ¬è³ªä¸Šï¼Œåœ¨ç‹€æ…‹æ¨¡å¼ä¸­ï¼Œä¸€å€‹é¡ï¼ˆä¸Šä¸‹æ–‡ï¼‰æ‡‰è©²æ ¹æ“šå…¶ç‹€æ…‹è¡¨ç¾å¾—åƒä¸åŒçš„é¡ã€‚ç‹€æ…‹æ¨¡å¼é¿å…ä½¿ç”¨ switch å’Œ if èªå¥ä¾†æ”¹è®Šè¡Œç‚ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public interface MacState { public void getState(); } public class Lighting implements MacState { @Override public void getState() { System.out.println(\u0026#34;mac bright!\u0026#34;); } } public class Close implements MacState { @Override public void getState() { System.out.println(\u0026#34;Mac is shut down\u0026#34;); } } 1 2 3 4 5 6 7 8 9 10 11 public class MacContext implements MacState { private MacState macState; // constructor , setter , getter public void getState(){ macState.getState(); } } 1 2 3 4 5 6 7 8 9 10 11 public static void main(String[] args) { var ctx = new MacContext(new Lighting()); ctx.getState(); ctx.getState(); ctx.setMacState(new Close()); ctx.getState(); ctx.getState(); ctx.getState(); } ç‹€æ…‹æ¨¡å¼çš„å¥½è™•ä¹‹ä¸€æ˜¯å¤šæ…‹è¡Œç‚ºçš„å¯¦ç¾ï¼Œé€™æ˜¯æ¸…æ™°å¯è¦‹çš„ã€‚å› æ­¤ï¼Œå‡ºéŒ¯çš„å¯èƒ½æ€§è¼ƒå°ã€‚æ­¤å¤–ï¼Œå¾ˆå®¹æ˜“ç‚ºå…¶ä»–è¡Œç‚ºæ·»åŠ æ›´å¤šç‹€æ…‹ï¼Œä½¿å…¶æ›´åŠ å¥å£¯ã€æ˜“æ–¼ç¶­è­·å’Œéˆæ´»ã€‚æ­¤å¤–ï¼Œåœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œç‹€æ…‹æ¨¡å¼æœ‰åŠ©æ–¼é¿å… if-else æˆ– switch-case æ¢ä»¶é‚è¼¯ã€‚\nç•¶å°è±¡çš„è¡Œç‚ºå–æ±ºæ–¼å…¶ç‹€æ…‹æ™‚ï¼Œå®ƒå¿…é ˆåœ¨é‹è¡Œæ™‚æ ¹æ“šå…¶ç‹€æ…‹æ”¹è®Šå…¶è¡Œç‚ºã€‚ ç•¶æ“ä½œå…·æœ‰ä¾è³´æ–¼å°è±¡ç‹€æ…‹çš„å¤§å‹ã€å¤šéƒ¨åˆ†æ¢ä»¶èªå¥æ™‚ã€‚é€™ç¨®ç‹€æ…‹é€šå¸¸ç”±ä¸€å€‹æˆ–å¤šå€‹æšèˆ‰å¸¸é‡è¡¨ç¤ºã€‚é€šå¸¸ï¼Œå¤šå€‹æ“ä½œå°‡åŒ…å«ç›¸åŒçš„æ¢ä»¶çµæ§‹ã€‚ç‹€æ…‹æ¨¡å¼å°‡æ¢ä»¶çš„æ¯å€‹åˆ†æ”¯æ”¾åœ¨ä¸€å€‹å–®ç¨çš„é¡ä¸­ã€‚ é€™è®“æˆ‘å€‘å¯ä»¥å°‡å°è±¡çš„ç‹€æ…‹è¦–ç‚ºä¸€å€‹å¯ä»¥ç¨ç«‹æ–¼å…¶ä»–å°åƒè®ŠåŒ–çš„å°è±¡ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/state/","tags":[],"title":"DesignPattern - Behavioral - State"},{"content":"Command Command Pattern æ˜¯ä¸€ç¨®è¡Œç‚ºå°è±¡è¨­è¨ˆæ¨¡å¼ã€‚åœ¨ Command Pattern ä¸­ï¼Œå‘½ä»¤æ¥å£è²æ˜äº†ç”¨æ–¼åŸ·è¡Œç‰¹å®šæ“ä½œçš„æ–¹æ³•ã€‚å…·é«”çš„ Command é¡å¯¦ç¾äº† Command interface çš„ execute()æ–¹æ³•ï¼Œé€™å€‹execute()æ–¹æ³•èª¿ç”¨äº†å…·é«” Command é¡æ‰€åŒ…å«çš„ Receiver é¡çš„ç›¸æ‡‰å‹•ä½œæ–¹æ³•ã€‚æ­¤å¤–ï¼ŒReceiver é¡åŸ·è¡Œç‰¹å®šçš„æ“ä½œã€‚ä½†æ˜¯ï¼Œå®¢æˆ¶ç«¯é¡è² è²¬å‰µå»ºå…·é«”å‘½ä»¤ä¸¦è¨­ç½®å…·é«”å‘½ä»¤çš„æ¥æ”¶è€…ã€‚æ­¤å¤–ï¼ŒInvoker é¡åŒ…å«å° Command çš„å¼•ç”¨ï¼Œä¸¦å…·æœ‰åŸ·è¡Œ Command çš„æ–¹æ³•ã€‚\nåœ¨å‘½ä»¤æ¨¡å¼ä¸­ï¼Œèª¿ç”¨è€…èˆ‡æ¥æ”¶è€…åŸ·è¡Œçš„å‹•ä½œåˆ†é›¢ã€‚èª¿ç”¨è€…ä¸çŸ¥é“æ¥æ”¶è€…ã€‚èª¿ç”¨è€…èª¿ç”¨å‘½ä»¤ï¼Œå‘½ä»¤åŸ·è¡Œæ¥æ”¶è€…çš„é©ç•¶å‹•ä½œã€‚å› æ­¤ï¼Œèª¿ç”¨è€…å¯ä»¥åœ¨ä¸çŸ¥é“è¦åŸ·è¡Œçš„å‹•ä½œçš„ç´°ç¯€çš„æƒ…æ³ä¸‹èª¿ç”¨å‘½ä»¤ã€‚æ­¤å¤–ï¼Œé€™ç¨®è§£è€¦æ„å‘³è‘—å°æ¥æ”¶è€…å‹•ä½œçš„æ›´æ”¹ä¸æœƒç›´æ¥å½±éŸ¿å‹•ä½œçš„èª¿ç”¨ã€‚\næˆ‘å€‘ç”šè‡³å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¨¡å¼ä¾†åŸ·è¡Œâ€œæ’¤æ¶ˆâ€åŠŸèƒ½ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼ŒCommand æ¥å£æ‡‰è©²åŒ…å«ä¸€å€‹æ–¹æ³•ï¼Œä¾‹å¦‚ unexecuted() æ–¹æ³•ã€‚\nä¸ç”¨èªªï¼Œå®ƒé‚„å¹«åŠ©æˆ‘å€‘åœ¨è«‹æ±‚-éŸ¿æ‡‰æ¨¡å‹ä¸­å¯¦ç¾æ¾è€¦åˆã€‚ç°¡è€Œè¨€ä¹‹ï¼Œè«‹æ±‚è¢«ç™¼é€çµ¦èª¿ç”¨è€…ï¼Œèª¿ç”¨è€…å°‡å…¶å‚³éçµ¦å°è£çš„ å‘½ä»¤å°è±¡ã€‚å‘½ä»¤å°è±¡å°‡è«‹æ±‚å‚³éçµ¦ Receiverçš„é©ç•¶æ–¹æ³•ä»¥åŸ·è¡Œç‰¹å®šæ“ä½œã€‚å®¢æˆ¶ç«¯ç¨‹åºå‰µå»ºæ¥æ”¶å™¨å°è±¡ï¼Œç„¶å¾Œå°‡å…¶é™„åŠ åˆ°å‘½ä»¤ã€‚ç„¶å¾Œï¼Œå®ƒå‰µå»ºèª¿ç”¨ç¨‹åºå°è±¡ä¸¦é™„åŠ å‘½ä»¤å°åƒä»¥åŸ·è¡Œæ“ä½œã€‚ç¾åœ¨ï¼Œç•¶å®¢æˆ¶ç«¯ç¨‹åºåŸ·è¡Œå‹•ä½œæ™‚ï¼Œå®ƒæœƒæ ¹æ“šå‘½ä»¤å’Œæ¥æ”¶å™¨å°è±¡é€²è¡Œè™•ç†ã€‚\nCommandæ˜¯ä¸€å€‹å¸¶æœ‰ execute() æ–¹æ³•çš„æ¥å£ã€‚å®ƒæ˜¯å¥‘ç´„çš„æ ¸å¿ƒã€‚ Client å‰µå»ºä¸€å€‹å‘½ä»¤å¯¦ç¾çš„å¯¦ä¾‹ä¸¦å°‡å…¶èˆ‡æ¥æ”¶å™¨ç›¸é—œè¯ã€‚ InvokeræŒ‡ç¤ºå‘½ä»¤åŸ·è¡Œæ“ä½œã€‚ å‘½ä»¤å¯¦ç¾çš„å¯¦ä¾‹åœ¨æ¥æ”¶è€…å’Œå‹•ä½œä¹‹é–“å‰µå»ºä¸€å€‹ç¶å®šã€‚ Receiver æ˜¯çŸ¥é“åŸ·è¡Œæ“ä½œçš„å¯¦éš›æ­¥é©Ÿçš„å°è±¡ã€‚ä»»ä½•é¡éƒ½å¯ä»¥ä½œç‚ºæ¥æ”¶è€…ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 // command pattern èµ·æ‰‹å¼ public interface Command { public void execute(); } public class Homework { public void writeHomework(){ System.out.println(\u0026#34;write HW right now!\u0026#34;); } } // Receiver public class HomeworkCommand implements Command { Homework homework; public HomeworkCommand(Homework homework) { this.homework = homework; } @Override public void execute() { homework.writeHomework(); } } // Receiver public class ClassmateCommand implements Command { Classmate classmate; public ClassmateCommand(Classmate classmate) { this.classmate = classmate; } @Override public void execute() { classmate.writeHomeworkTogether(); } } // Invoker public class Invoker { Command command; public Invoker(Command command) { this.command = command; } public void setCommand(Command command) { this.command = command; } public void invoke() { command.execute(); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public static void main(String[] args) { var homework = new Homework(); // receiver Command homeworkCommand = new HomeworkCommand(homework); // concrete command var classmate = new Classmate(); // receiver Command classmateCommand = new ClassmateCommand(classmate); // concrete command Invoker invoker = new Invoker(); // invoker invoker.setCommand(homeworkCommand); invoker.invoke(); invoker.setCommand(classmateCommand); invoker.invoke(); } é€šéè¦åŸ·è¡Œçš„æ“ä½œåƒæ•¸åŒ–å°è±¡ã€‚ åœç¹åŸºæ–¼åŸèªæ“ä½œçš„é«˜ç´šæ“ä½œæ§‹å»ºç³»çµ±ã€‚é€™ç¨®çµæ§‹åœ¨æ”¯æŒäº‹å‹™çš„ä¿¡æ¯ç³»çµ±ä¸­å¾ˆå¸¸è¦‹ã€‚æ­¤å¤–ï¼Œå‘½ä»¤æ¨¡å¼æä¾›äº†ä¸€ç¨®å°äº‹å‹™å»ºæ¨¡çš„æ–¹æ³•ã€‚å‘½ä»¤æœ‰ä¸€å€‹é€šç”¨æ¥å£ï¼Œè®“æ‚¨ä»¥ç›¸åŒçš„æ–¹å¼èª¿ç”¨æ‰€æœ‰äº‹å‹™ã€‚è©²æ¨¡å¼é‚„ä½¿å¾—ä½¿ç”¨æ–°äº‹å‹™æ“´å±•ç³»çµ±è®Šå¾—å®¹æ˜“ã€‚ å‘½ä»¤çš„åŸ·è¡Œæ“ä½œå¯ä»¥å­˜å„²ç‹€æ…‹ä»¥åœ¨å‘½ä»¤æœ¬èº«ä¸­åè½‰å…¶æ•ˆæœã€‚Command æ¥å£å¿…é ˆæœ‰ä¸€å€‹æ·»åŠ çš„ Un-execute æ“ä½œï¼Œå®ƒå¯ä»¥é€†è½‰å…ˆå‰èª¿ç”¨ Execute çš„æ•ˆæœã€‚æˆ‘å€‘å¯ä»¥å°‡åŸ·è¡Œçš„å‘½ä»¤å­˜å„²åœ¨æ­·å²åˆ—è¡¨ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘å€‘å¯ä»¥é€šéåˆ†åˆ¥èª¿ç”¨ Un-execute å’Œ Execute ä¾†å›éæ­·é€™å€‹åˆ—è¡¨ä¾†å¯¦ç¾ç„¡é™ç´šåˆ¥çš„æ’¤æ¶ˆå’Œé‡åšã€‚å®ƒä¹Ÿæ”¯æŒæ’¤æ¶ˆã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/command/","tags":[],"title":"DesignPattern - Behavioral - Command"},{"content":"Strategy ç•¶å­˜åœ¨ä¸€çµ„ç›¸é—œç®—æ³•ä¸¦ä¸”å®¢æˆ¶ç«¯å°è±¡éœ€è¦èƒ½å¤ å¾è©²çµ„ä¸­å‹•æ…‹æŒ‘é¸é©åˆå…¶ç•¶å‰éœ€æ±‚çš„ç®—æ³•æ™‚ï¼Œç­–ç•¥è¨­è¨ˆæ¨¡å¼å¾ˆæœ‰ç”¨ã€‚ç­–ç•¥æ¨¡å¼å»ºè­°å°‡æ¯å€‹ç®—æ³•çš„å¯¦ç¾ä¿ç•™åœ¨ä¸€å€‹å–®ç¨çš„é¡ä¸­ã€‚å°è£åœ¨å–®ç¨é¡ä¸­çš„æ¯å€‹æ­¤é¡ç®—æ³•ç¨±ç‚ºç­–ç•¥ã€‚ä½¿ç”¨ Strategy å°è±¡çš„å°è±¡é€šå¸¸ç¨±ç‚ºä¸Šä¸‹æ–‡å°è±¡ã€‚\nç•¶æˆ‘å€‘ç‚ºç‰¹å®šä»»å‹™æœ‰å¤šç¨®ç®—æ³•ä¸¦ä¸”å®¢æˆ¶ç«¯æ±ºå®šåœ¨é‹è¡Œæ™‚ä½¿ç”¨çš„å¯¦éš›å¯¦ç¾æ™‚ï¼Œæˆ‘å€‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚ç­–ç•¥æ¨¡å¼ä¹Ÿç¨±ç‚ºç­–ç•¥æ¨¡å¼ã€‚æˆ‘å€‘å®šç¾©äº†å¤šç¨®ç®—æ³•ï¼Œä¸¦è®“å®¢æˆ¶ç«¯æ‡‰ç”¨ç¨‹åºå‚³éç®—æ³•ä»¥ç”¨ä½œåƒæ•¸ã€‚ä¾‹å¦‚ï¼Œæ­¤æ¨¡å¼çš„æœ€ä½³ç¤ºä¾‹ä¹‹ä¸€æ˜¯ Collections.sort () æ–¹æ³•ï¼Œè©²æ–¹æ³•æ¡ç”¨ Comparator åƒæ•¸ã€‚åŸºæ–¼ Comparator æ¥å£çš„ä¸åŒå¯¦ç¾ï¼Œå°åƒä»¥ä¸åŒçš„æ–¹å¼æ’åºã€‚\nç­–ç•¥æ¨¡å¼æ˜¯æˆ‘å€‘å¯ä»¥ä½¿ç”¨çµ„åˆä½œç‚ºå­åˆ†é¡çš„æ›¿ä»£æ–¹æ³•çš„ä¸€ç¨®æ–¹å¼ã€‚ç­–ç•¥æ¨¡å¼ä¸æ˜¯é€šéå­é¡è¦†è“‹çˆ¶é¡ä¸­çš„æ–¹æ³•ä¾†æä¾›ä¸åŒçš„è¡Œç‚ºï¼Œè€Œæ˜¯å…è¨±å°‡ä¸åŒçš„è¡Œç‚ºæ”¾ç½®åœ¨å…±äº«å…¬å…±ç­–ç•¥æ¥å£çš„å…·é«”ç­–ç•¥é¡ä¸­ã€‚Context å°è±¡åŒ…å«å° Strategy çš„å¼•ç”¨ã€‚é€šéæ”¹è®Šä¸Šä¸‹æ–‡çš„ç­–ç•¥ï¼Œæˆ‘å€‘å¯ä»¥ç²å¾—ä¸åŒçš„è¡Œç‚ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 public interface CreditCardStrategy { public void pay(BigDecimal money); } public class CTBC implements CreditCardStrategy { @Override public void pay(BigDecimal money) { System.out.println(\u0026#34;CTBC pay\u0026#34;); } } public class MEGA implements CreditCardStrategy { @Override public void pay(BigDecimal money) { System.out.println(\u0026#34;MEGA pay\u0026#34;); } } public class NCCC implements CreditCardStrategy { @Override public void pay(BigDecimal money) { System.out.println(\u0026#34;NCCC pay\u0026#34;); } } // base public class Context { private CreditCardStrategy strategy; public Context(CreditCardStrategy strategy){ this.strategy = strategy; } public void apply(BigDecimal money){ strategy.pay(money); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 public static void main(String[] args) { var money = new BigDecimal(\u0026#34;100\u0026#34;); // DI æ³¨å…¥ ï¼ˆconstructor or setterï¼‰ Context ctx = new Context(new CTBC()); ctx.pay(money); // change strategy ctx = new Context(new MEGA()); ctx.apu(money); } ç‚ºç­–ç•¥æä¾›äº†ä¸€ç¨®ä½¿ç”¨å¤šç¨®è¡Œç‚ºä¹‹ä¸€é…ç½®é¡çš„æ–¹æ³•ã€‚ ç®—æ³•ä½¿ç”¨å®¢æˆ¶ä¸æ‡‰è©²çŸ¥é“çš„æ•¸æ“šã€‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼ä¾†é¿å…æš´éœ²è¤‡é›œçš„ã€ç‰¹å®šæ–¼ç®—æ³•çš„æ•¸æ“šçµæ§‹ã€‚ ï¼ˆå°è£æ™‚åšçš„ç´°ç¯€ï¼‰ ä¸€å€‹é¡å®šç¾©äº†è¨±å¤šè¡Œç‚ºï¼Œé€™äº›è¡Œç‚ºåœ¨å…¶æ“ä½œä¸­è¡¨ç¾ç‚ºå¤šå€‹æ¢ä»¶èªå¥ã€‚å°‡ç›¸é—œçš„æ¢ä»¶åˆ†æ”¯ç§»åˆ°å®ƒå€‘è‡ªå·±çš„ Strategy é¡ä¸­ï¼Œè€Œä¸æ˜¯è¨±å¤šæ¢ä»¶ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/strategy/","tags":[],"title":"DesignPattern - Behavioral - Strategy"},{"content":"Observer (pub-sub) åœ¨è§€å¯Ÿè€…è¨­è¨ˆæ¨¡å¼ä¸­ï¼Œå¤šå€‹è§€å¯Ÿè€…å°è±¡å‘ä¸€å€‹ä¸»é¡Œè¨»å†Šä»¥ç²å–é€šçŸ¥ä¸­çš„ä»»ä½•æ›´æ”¹ã€‚ç•¶ä¸»é¡Œçš„ç‹€æ…‹ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œå®ƒæœƒé€šçŸ¥è§€å¯Ÿè€…ã€‚ç›£è½æˆ–è§€å¯Ÿè®ŠåŒ–çš„å°è±¡ç¨±ç‚ºè§€å¯Ÿè€…ï¼Œè¢«è§€å¯Ÿçš„å°è±¡ç¨±ç‚ºä¸»é«”ã€‚\nä¸»é¡Œç‚ºè§€å¯Ÿè€…æä¾›äº†ä¸€å€‹æ¥å£ï¼Œå¯ä»¥åœ¨ä¸»é¡Œä¸­è¨»å†Šå’Œè¨»éŠ·è‡ªå·±ã€‚ ä¸»é¡ŒçŸ¥é“å®ƒçš„è¨‚é–±è€…æ˜¯èª°ã€‚ å¤šå€‹è§€å¯Ÿè€…å¯ä»¥è¨‚é–±é€šçŸ¥ã€‚ ä¸»é¡Œç™¼å¸ƒé€šçŸ¥ã€‚ ä¸»é¡Œåªæ˜¯ç™¼é€é€šçŸ¥èªªç‹€æ…‹å·²æ›´æ”¹ã€‚å®ƒä¸å‚³éä»»ä½•ç‹€æ…‹ä¿¡æ¯ã€‚ ä¸€æ—¦æ”¶åˆ°ä¾†è‡ªä¸»é¡Œçš„é€šçŸ¥ï¼Œè§€å¯Ÿè€…å°±æœƒèª¿ç”¨ä¸»é¡Œä¸¦ç²å–æ›´æ”¹çš„æ•¸æ“šã€‚\nSubjectï¼Œ è¨»å†Šè§€å¯Ÿè€…ã€‚å°è±¡ä½¿ç”¨æ­¤æ¥å£è¨»å†Šç‚ºè§€å¯Ÿè€…ï¼Œä¹Ÿå¯ä»¥å°‡è‡ªå·±å¾è§€å¯Ÿè€…ä¸­ç§»é™¤ã€‚ Observerç‚ºå°è±¡å®šç¾©äº†ä¸€å€‹æ›´æ–°æ¥å£ï¼Œé€™äº›æ¥å£æ‡‰è©²è¢«é€šçŸ¥ä¸»é¡Œçš„è®ŠåŒ–ã€‚ä½†æ˜¯ï¼Œæ‰€æœ‰çš„è§€å¯Ÿè€…éƒ½éœ€è¦å¯¦ç¾ Observer æ¥å£ã€‚è©²æ¥å£æœ‰ä¸€å€‹æ–¹æ³• update()ï¼Œç•¶ Subject çš„ç‹€æ…‹ç™¼ç”Ÿè®ŠåŒ–æ™‚æœƒèª¿ç”¨è©²æ–¹æ³•ã€‚ ConcreteSubjectï¼Œå°‡æ„Ÿèˆˆè¶£çš„ç‹€æ…‹å­˜å„²åˆ° ConcreteObserver å°è±¡ã€‚ç•¶å®ƒçš„ç‹€æ…‹æ”¹è®Šæ™‚ï¼Œå®ƒæœƒå‘å®ƒçš„è§€å¯Ÿè€…ç™¼é€ä¸€å€‹é€šçŸ¥ã€‚æ­¤å¤–ï¼Œä¸€å€‹å…·é«”çš„ä¸»é¡Œç¸½æ˜¯å¯¦ç¾ä¸»é¡Œæ¥å£ã€‚æˆ‘å€‘ä½¿ç”¨ * notifyObservers() æ–¹æ³•åœ¨ç‹€æ…‹ç™¼ç”Ÿè®ŠåŒ–æ™‚æ›´æ–°æ‰€æœ‰ç•¶å‰çš„è§€å¯Ÿè€…ã€‚ ConcreateObserver ç¶­è­·å° ConcreteSubject å°è±¡çš„å¼•ç”¨ä¸¦å¯¦ç¾ Observer æ¥å£ã€‚æ¯å€‹è§€å¯Ÿè€…è¨»å†Šä¸€å€‹å…·é«”çš„ä¸»é¡Œä»¥æ¥æ”¶æ›´æ–°ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 public interface Subject { public void registerObserver(Observer observer); public void notifyObserver(); public void unregisterObserver(Observer observer); public Object getUpdate(); } public interface Observer { public void update(); public void setSubject(Subject sub); } //Concrete Subject public class Blog implements Subject { List\u0026lt;Observer\u0026gt; observersList; private boolean stateChange; public Blog() { this.observersList = new ArrayList(); stateChange = false; } @Override public void registerObserver(Observer observer) { observersList.add(observer); } @Override public void notifyObserver() { if (stateChange) { for(Observer observer : observersList) { observer.update(); System.out.println(\u0026#34;Observer notified !\u0026#34;); } } } @Override public void unregisterObserver(Observer observer) { observersList.remove(observer); } @Override public Object getUpdate() { Object changedState = null; // should have logic to send the state change to querying observer if (stateChange) { changedState = \u0026#34;Observer Design Pattern\u0026#34;; } return changedState; } public void postNewArticle() { stateChange = true; notifyObserver(); } } //Concrete Observer public class User implements Observer { private String article; private Subject blog; @Override public void update() { System.out.println(\u0026#34;State change reported by Subject.\u0026#34;); article = (String) blog.getUpdate(); } @Override public void setSubject(Subject blog) { this.blog = blog; article = \u0026#34;No New Article!\u0026#34;; } public String getArticle() { return article; } } 1 2 3 4 5 6 7 8 9 10 11 12 13 public static void main(String[] args) { Blog blog = new Blog(); User user1 = new User(); User user2 = new User(); blog.registerObserver(user1); blog.registerObserver(user2); user1.setSubject(blog); user2.setSubject(blog); System.out.println(user1.getArticle()); blog.postNewArticle(); System.out.println(user1.getArticle()); } ç•¶ä¸€å€‹æŠ½åƒæœ‰å…©å€‹æ–¹é¢æ™‚ï¼Œä¸€å€‹ä¾è³´æ–¼å¦ä¸€å€‹ã€‚å°‡é€™äº›æ–¹é¢å°è£åœ¨å–®ç¨çš„å°åƒä¸­å¯ä»¥è®“æ‚¨ç¨ç«‹åœ°æ”¹è®Šå’Œé‡ç”¨å®ƒå€‘ã€‚ ç•¶å°ä¸€å€‹å°è±¡çš„æ›´æ”¹éœ€è¦æ›´æ”¹å…¶ä»–å°è±¡æ™‚ï¼Œæ‚¨ä¸çŸ¥é“éœ€è¦æ›´æ”¹å¤šå°‘å€‹å°è±¡ï¼Ÿ ç•¶ä¸€å€‹å°è±¡æ‡‰è©²èƒ½å¤ é€šçŸ¥å…¶ä»–å°è±¡è€Œä¸å‡è¨­é€™äº›å°åƒæ˜¯èª°ã€‚æ›å¥è©±èªªï¼Œæ‚¨ä¸å¸Œæœ›é€™äº›å°è±¡ç·Šå¯†è€¦åˆã€‚ reference: https://javatechonline.com/behavioral-design-patterns-in-java/#Template_Method_Design_Pattern\n","permalink":"https://xinqilin.github.io/post/architecture/observer/","tags":[],"title":"DesignPattern - Behavioral - Observer"},{"content":"Chain Of Responsibility ç•¶æœ‰å¤šå€‹å°è±¡å¯ä»¥è™•ç†æˆ–æ»¿è¶³å®¢æˆ¶ç«¯è«‹æ±‚æ™‚ï¼Œè²¬ä»»éˆæ¨¡å¼å»ºè­°çµ¦é€™äº›å°åƒä¸­çš„æ¯ä¸€å€‹ä»¥æŸç¨®é †åºè™•ç†è«‹æ±‚çš„æ©Ÿæœƒã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹æ‡‰ç”¨è©²æ¨¡å¼ï¼Œé€™äº›æ½›åœ¨çš„è™•ç†ç¨‹åºä¸­çš„æ¯ä¸€å€‹éƒ½å¯ä»¥ä»¥éˆçš„å½¢å¼æ’åˆ—ï¼Œæ¯å€‹å°åƒéƒ½å…·æœ‰å°éˆä¸­ä¸‹ä¸€å€‹å°è±¡çš„å¼•ç”¨ã€‚éˆä¸­çš„ç¬¬ä¸€å€‹å°è±¡æ¥æ”¶è«‹æ±‚ä¸¦æ±ºå®šè™•ç†è«‹æ±‚æˆ–å°‡å…¶å‚³éçµ¦éˆä¸­çš„ä¸‹ä¸€å€‹å°è±¡ã€‚è«‹æ±‚ä¸€å€‹æ¥ä¸€å€‹åœ°æµééˆä¸­çš„æ‰€æœ‰å°è±¡ï¼Œç›´åˆ°è«‹æ±‚è¢«éˆä¸­çš„ä¸€å€‹è™•ç†ç¨‹åºè™•ç†æˆ–è«‹æ±‚åˆ°é”éˆçš„æœ«ç«¯è€Œæ²’æœ‰å¾—åˆ°è™•ç†ã€‚\né¡¯ç„¶ï¼Œè²¬ä»»éˆæ¨¡å¼ç”¨æ–¼åœ¨è»Ÿä»¶è¨­è¨ˆä¸­å¯¦ç¾é¬†æ•£è€¦åˆï¼Œå…¶ä¸­ä¾†è‡ªå®¢æˆ¶ç«¯çš„è«‹æ±‚è¢«å‚³éåˆ°å°è±¡éˆä»¥è™•ç†å®ƒå€‘ã€‚ç„¶å¾Œéˆä¸­çš„å°è±¡å°‡è‡ªè¡Œæ±ºå®šèª°å°‡è™•ç†è«‹æ±‚ä»¥åŠæ˜¯å¦éœ€è¦å°‡è«‹æ±‚ç™¼é€åˆ°éˆä¸­çš„ä¸‹ä¸€å€‹å°è±¡ã€‚\nå¤šå€‹é¡åˆ¥ç¹¼æ‰¿æˆ–å¯¦ä½œæŠ½è±¡, ä¸¦ä½¿ç”¨, å¯¦ä½œä¸­ä¸æ˜¯è‡ªå·±çš„å°± next ä¸‹å», æ˜¯è‡ªå·±çš„å°± action 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 // This\u0026#39;s the request object. public class Number { private int number; public int getNumber() { return number; } public Number(int num){ number=num; } } // interface that acts as a chain link. public interface Chain { public void setNext(Chain nextInChain); public void process(Number request); } public class PositiveNumberProcessor implements Chain { private Chain nextInChain; @Override public void setNext(Chain c) { nextInChain = c; } @Override public void process(Number request) { if (request.getNumber() \u0026gt; 0) { System.out.println(\u0026#34;PositiveNumberProcessor : \u0026#34; + request.getNumber()); } else { nextInChain.process(request); } } } public class NegativeNumberProcessor implements Chain { private Chain nextInChain; @Override public void setNext(Chain c) { nextInChain = c; } @Override public void process(Number request) { if (request.getNumber() \u0026lt; 0) { System.out.println(\u0026#34;NegativeNumberProcessor : \u0026#34; + request.getNumber()); } else { nextInChain.process(request); } } } public class ZeroProcessor implements Chain { private Chain nextInChain; @Override public void setNext(Chain c) { nextInChain = c; } @Override public void process(Number request) { if (request.getNumber() == 0) { System.out.println(\u0026#34;ZeroProcessor : \u0026#34; + request.getNumber()); } else { nextInChain.process(request); } } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public static void main(String[] args) { // Chain c1 = new NegativeNumberProcessor(); // Chain c2 = new ZeroProcessor(); // Chain c3 = new PositiveNumberProcessor(); // c1.setNext(c2); // c2.setNext(c3); // chain Chain c = new Chain(new NegativeNumberProcessor(new ZeroProcessor(new PositiveNumberProcessor()))) //calling chain of responsibility c1.process(new Number(99)); c1.process(new Number(-30)); c1.process(new Number(0)); c1.process(new Number(100)); } å¤šå€‹å°è±¡å¯ä»¥è™•ç†ä¸€å€‹è«‹æ±‚ï¼Œä¸¦ä¸”è™•ç†ç¨‹åºæ˜¯å…ˆé©—æœªçŸ¥çš„ã€‚æ‡‰è‡ªå‹•ç¢ºå®šè™•ç†ç¨‹åºã€‚ æ‚¨æƒ³å‘å¤šå€‹å°è±¡ä¹‹ä¸€ç™¼å‡ºè«‹æ±‚ï¼Œè€Œä¸æ˜ç¢ºæŒ‡å®šæ¥æ”¶è€…ã€‚ æ‡‰è©²å‹•æ…‹æŒ‡å®šå¯ä»¥è™•ç†è«‹æ±‚çš„å°è±¡é›†ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/chainofresponsibility/","tags":[],"title":"DesignPattern - Behavioral - Chain Of Responsibility"},{"content":"Mediator Mediator é€šéé˜»æ­¢å°è±¡é¡¯å¼åœ°ç›¸äº’å¼•ç”¨ä¾†ä¿ƒé€²é¬†æ•£è€¦åˆï¼Œä¸¦ä¸”å®ƒå…è¨±æ‚¨ç¨ç«‹åœ°æ”¹è®Šå®ƒå€‘çš„äº¤äº’ã€‚ æˆ‘å€‘ä½¿ç”¨ä¸­ä»‹è€…è¨­è¨ˆæ¨¡å¼åœ¨ç³»çµ±ä¸­çš„ä¸åŒå°è±¡ä¹‹é–“æä¾›é›†ä¸­çš„é€šä¿¡åª’ä»‹ã€‚\nä¸­ä»‹è€…æ¨¡å¼å°ˆæ³¨æ–¼åœ¨å°è±¡ä¹‹é–“æä¾›ä¸€å€‹ä¸­ä»‹è€…é€²è¡Œäº’å‹•ï¼Œä¸¦å¹«åŠ©å¯¦ç¾å°è±¡ä¹‹é–“çš„ä¸Ÿå¤±è€¦åˆã€‚å°åƒè¦æ±‚ä¸­ä»‹è€…ä»£è¡¨å®ƒå€‘é€²è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯ç›´æ¥ç›¸äº’äº¤äº’ã€‚å®ƒå°è‡´å¯é‡ç”¨æ€§å’Œé¬†æ•£è€¦åˆã€‚æ­¤å¤–ï¼Œå®ƒå°è£äº†å°è±¡ä¹‹é–“çš„äº¤äº’ï¼Œä½¿å®ƒå€‘ç›¸äº’ç¨ç«‹ã€‚é€™ä¹Ÿå…è¨±ä»–å€‘é€šéå¯¦ç¾ä¸åŒçš„ä¸­ä»‹ä»¥å®Œå…¨ä¸åŒçš„æ–¹å¼æ”¹è®Šèˆ‡å…¶ä»–å°è±¡çš„äº¤äº’ã€‚èª¿è§£å™¨æœ‰åŠ©æ–¼é™ä½é¡çš„è¤‡é›œæ€§ã€‚æ­¤å¤–ï¼Œæ¯å€‹å°åƒä¸å†éœ€è¦è©³ç´°äº†è§£å¦‚ä½•èˆ‡å…¶ä»–å°è±¡äº¤äº’ã€‚å°è±¡ä¹‹é–“çš„è€¦åˆå¾ç·Šç·»åƒµç¡¬åˆ°é¬†æ•£å„ªé›…ã€‚ ä¸­ä»‹è€…è¨­è¨ˆæ¨¡å¼åœ¨å¤šå€‹å°è±¡ç›¸äº’äº¤äº’çš„ä¼æ¥­æ‡‰ç”¨ç¨‹åºä¸­éå¸¸æœ‰ç”¨ã€‚å¦‚æœå°è±¡ç›´æ¥ç›¸äº’äº¤äº’ï¼Œç³»çµ±çµ„ä»¶å°±æœƒç›¸äº’ç·Šå¯†è€¦åˆã€‚å®ƒå€‘é‚„ä½¿å¯ç¶­è­·æ€§æˆæœ¬æ›´é«˜ï¼Œä¸¦ä¸”ä¸èƒ½éˆæ´»åœ°è¼•é¬†æ“´å±•ã€‚\nä¾‹å¦‚ï¼Œç©ºä¸­äº¤é€šç®¡åˆ¶å“¡æ˜¯èª¿è§£å“¡æ¨¡å¼çš„ä¸€å€‹å¾ˆå¥½çš„ä¾‹å­ï¼Œå…¶ä¸­æ©Ÿå ´æ§åˆ¶å®¤å……ç•¶ä¸åŒèˆªç­ä¹‹é–“é€šä¿¡çš„èª¿è§£å“¡ã€‚ä¸­ä»‹ä½œç‚ºå°è±¡ä¹‹é–“çš„è·¯ç”±å™¨å·¥ä½œï¼Œå®ƒå¯ä»¥æœ‰è‡ªå·±çš„é‚è¼¯ä¾†æä¾›é€šä¿¡æ–¹å¼ã€‚\nMediator: å®šç¾©ä¸€å€‹èˆ‡åŒäº‹å°è±¡é€šä¿¡çš„ interface ConcreteMediator: é€šéå”èª¿ Colleague å°è±¡ä¾†å¯¦ç¾å”ä½œè¡Œç‚ºã€‚å®ƒé‚„äº†è§£ä¸¦ç¶­è­·å…¶åŒäº‹ã€‚ Colleague Classes: æ¯å€‹ Colleague class éƒ½çŸ¥é“å®ƒçš„ Mediator å°è±¡ã€‚æ¯ä½åŒäº‹åœ¨æœ¬æ‡‰èˆ‡å¦ä¸€ä½åŒäº‹æºé€šæ™‚éƒ½æœƒèˆ‡å…¶èª¿è§£å“¡æºé€šã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 public interface IMediator { public void talk(); public void fight(); public void registerA(ColleagueA a); public void registerB(ColleagueB b); } public class ConcreteMediator implements IMediator { ColleagueA talk; ColleagueB fight; @Override public void talk() { System.out.println(\u0026#34;Mediator is talking\u0026#34;); } @Override public void fight() { System.out.println(\u0026#34;Mediator is fighting\u0026#34;); } @Override public void registerA(ColleagueA a) { this.talk = a; } @Override public void registerB(ColleagueB b) { this.fight = b; } } // =========== public abstract class Colleague { IMediator mediator; public abstract void doSomething(); } public class ColleagueA extends Colleague { public ColleagueA(IMediator mediator) { this.mediator = mediator; this.mediator.registerA(this); } @Override public void doSomething() { this.mediator.talk(); } } public class ColleagueB extends Colleague { public ColleagueB(IMediator mediator) { this.mediator = mediator; this.mediator.registerB(this); } @Override public void doSomething() { this.mediator.fight(); } } 1 2 3 4 5 6 7 8 9 10 public static void main(String[] args) { IMediator mediator = new ConcreteMediator(); ColleagueA talkColleague= new ColleagueA(mediator); talkColleague.doSomething(); ColleagueB fightColleague = new ColleagueB(mediator); fightColleague.doSomething(); } ä¸€çµ„å°åƒä»¥å®šç¾©æ˜ç¢ºä½†è¤‡é›œçš„æ–¹å¼é€²è¡Œäº’å‹•ã€‚ç”±æ­¤ç”¢ç”Ÿçš„ç›¸äº’ä¾è³´æ˜¯éçµæ§‹åŒ–çš„ä¸¦ä¸”é›£ä»¥ç†è§£ã€‚ é‡ç”¨ä¸€å€‹å°åƒå¾ˆå›°é›£ï¼Œå› ç‚ºå®ƒå¼•ç”¨äº†è¨±å¤šå…¶ä»–å°è±¡ä¸¦èˆ‡ä¹‹äº’å‹•ã€‚ åˆ†ä½ˆåœ¨å¤šå€‹é¡ä¹‹é–“çš„è¡Œç‚ºæ‡‰è©²æ˜¯å¯å®šåˆ¶çš„ï¼Œç„¡éœ€å¤§é‡å­é¡åŒ–ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/mediator/","tags":[],"title":"DesignPattern - Behavioral - Mediator"},{"content":"Template Method Template Method pattern å®šç¾©äº†æ“ä½œä¸­ç®—æ³•çš„éª¨æ¶ï¼Œå°‡ä¸€äº›æ­¥é©Ÿæ¨é²åˆ°å­é¡ã€‚ Template Methodè®“å­é¡åœ¨ä¸æ”¹è®Šç®—æ³•çµæ§‹çš„æƒ…æ³ä¸‹é‡æ–°å®šç¾©ç®—æ³•çš„æŸäº›æ­¥é©Ÿã€‚ å¯ä»¥åœ¨æœ‰ç®—æ³•çš„æƒ…æ³ä¸‹ä½¿ç”¨Template Method patternï¼Œå…¶ä¸­ä¸€äº›æ­¥é©Ÿå¯ä»¥ä»¥å¤šç¨®ä¸åŒçš„æ–¹å¼å¯¦ç¾ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼ŒTemplate Method pattern å»ºè­°å°‡ç®—æ³•çš„å¤§ç¶±ä¿ç•™åœ¨ä¸€å€‹å–®ç¨çš„æ–¹æ³•ä¸­ï¼Œè©²æ–¹æ³•ç¨±ç‚ºé¡ä¸­çš„Templateæ–¹æ³•ã€‚æˆ‘å€‘å¯ä»¥å°‡å…¶ç¨±ç‚ºTemplateé¡ï¼Œå°‡ç®—æ³•çš„è®Šé«”éƒ¨åˆ†ï¼ˆå¯ä»¥ä»¥å¤šç¨®ä¸åŒæ–¹å¼å¯¦ç¾çš„æ­¥é©Ÿï¼‰çš„å…·é«”å¯¦ç¾ç•™çµ¦è©²é¡çš„ä¸åŒå­é¡ã€‚\nTemplate é¡ä¸å¿…å°‡å¯¦ç¾å®Œå…¨ç•™çµ¦å®ƒçš„å­é¡ã€‚ç›¸åï¼Œä½œç‚ºæä¾›ç®—æ³•å¤§ç¶±çš„ä¸€éƒ¨åˆ†ï¼ŒTemplate é¡é‚„å¯ä»¥æä¾›ä¸€äº›å¯¦ç¾ï¼Œæˆ‘å€‘å¯ä»¥èªç‚ºé€™äº›å¯¦ç¾åœ¨ä¸åŒçš„å¯¦ç¾ä¸­æ˜¯ä¸è®Šçš„ã€‚å¦‚æœåˆé©ï¼Œå®ƒç”šè‡³å¯ä»¥ç‚ºå¯è®Šéƒ¨åˆ†æä¾›é»˜èªå¯¦ç¾ã€‚æˆ‘å€‘åªåœ¨ä¸åŒçš„å­é¡ä¸­å¯¦ç¾ç‰¹å®šçš„ç´°ç¯€ã€‚é€™ç¨®é¡å‹çš„å¯¦ç¾æ¶ˆé™¤äº†é‡è¤‡ä»£ç¢¼çš„éœ€è¦ï¼Œé€™æ„å‘³è‘—è¦ç·¨å¯«çš„ä»£ç¢¼é‡æœ€å°‘ã€‚\nå¤§å¤šæ•¸éƒ½æ˜¯å­é¡åˆ¥å‘¼å«çˆ¶é¡åˆ¥æ–¹æ³•, ä½†åœ¨Template Methodä¸­ï¼Œçˆ¶é¡åˆ¥ Template èª¿ç”¨å­é¡çš„æ–¹æ³• =\u0026gt; å¥½èŠå¡¢åŸå‰‡â€”â€” \u0026ldquo;Donâ€™t call us, weâ€™ll call you.\u0026rdquo; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 public abstract class OrderTemplate { // å®šç¾©æ˜¯å¦è¦è¦†å¯« public abstract boolean hook(){ return true; // æ˜¯å¦è¤‡å¯« } // åªé–‹æ”¾ overwrite çµ¦æœƒè®Šçš„ public abstract void doSelect(); public abstract void doPayment(); public abstract void doDelivery(); // æ¨£æ¿ä¸­ä¸è®Šçš„ ï¼ˆé‡è¤‡çš„ï¼‰ public final void doPack(){ System.out.println(\u0026#34;Gift wrap done.\u0026#34;); } public final void processOrder() { doSelect(); doPayment(); doPack(); doDelivery(); } } public class PhysicalStoreOrder extends OrderTemplate { @Override public void doSelect() { System.out.println(\u0026#34;David buy it \u0026#34;); } @Override public void doPayment() { System.out.println(\u0026#34;David pay it by credit card\u0026#34;); } @Override public void doDelivery() { System.out.println(\u0026#34;David call Paul to delivery\u0026#34;); } } public class OnlineOrder extends OrderTemplate { @Override public void doSelect() { System.out.println(\u0026#34;select item on website\u0026#34;); System.out.println(\u0026#34;add to cart\u0026#34;); } @Override public void doPayment() { System.out.println(\u0026#34;Online pay\u0026#34;); } @Override public void doDelivery() { System.out.println(\u0026#34;write the address\u0026#34;); System.out.println(\u0026#34;pay delivery fee online\u0026#34;); } } 1 2 3 4 5 6 7 8 public static void main(String[] args) { var online = new OnlineOrder(); online.processOrder(); var store = new StoreOrder(); store.processOrder(); } æ¸›å°‘è¤‡è£½è²¼ä¸Šï¼ˆå¯«é‡è¤‡codeï¼‰ çš„æ©Ÿæœƒ ä¸€æ¬¡å¯¦ç¾ç®—æ³•çš„ä¸è®Šéƒ¨åˆ†ä¸¦å°‡å…¶ç•™çµ¦å­é¡ä¾†å¯¦ç¾å¯ä»¥è®ŠåŒ–çš„è¡Œç‚ºã€‚ ç•¶å­é¡ä¹‹é–“çš„å…±åŒè¡Œç‚ºæ‡‰è©²åœ¨ä¸€å€‹å…±åŒçš„é¡ä¸­è¢«åˆ†è§£å’Œæœ¬åœ°åŒ–ä»¥é¿å…ä»£ç¢¼é‡è¤‡æ™‚ã€‚æ‡‰è©²å…ˆè­˜åˆ¥ç¾æœ‰ code ä¸­çš„å·®ç•°ï¼Œç„¶å¾Œå€åˆ†æ–°æ“ä½œä¸­çš„å·®ç•°ã€‚æœ€å¾Œï¼Œç”¨èª¿ç”¨é€™äº›æ–°æ“ä½œä¹‹ä¸€çš„æ¨¡æ¿æ–¹æ³•æ›¿æ›ä¸åŒçš„ä»£ç¢¼ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/templatemethod/","tags":[],"title":"DesignPattern - Behavioral - Template Method"},{"content":"Decorator Decorator çš„ä¸»è¦ç›®çš„æ˜¯å‹•æ…‹åœ°ç‚ºå°è±¡é™„åŠ é¡å¤–çš„è·è²¬ã€‚Decorator ç‚ºæ“´å±•åŠŸèƒ½æä¾›äº†ä¸€ç¨®éˆæ´»çš„æ›¿ä»£å­é¡çš„æ–¹æ³•ã€‚\nç•¶æˆ‘å€‘éœ€è¦å‹•æ…‹æ“´å±•å°è±¡çš„åŠŸèƒ½è€Œç„¡éœ€æ›´æ”¹åŸå§‹é¡æºæˆ–ä½¿ç”¨ç¹¼æ‰¿æ™‚ï¼ŒDecorator ç‚ºæˆ‘å€‘æä¾›äº†ä¾¿åˆ©ã€‚é€™æ˜¯é€šéåœ¨å¯¦éš›å°è±¡å‘¨åœå‰µå»ºä¸€å€‹ç¨±ç‚ºè£é£¾å™¨çš„å°è±¡åŒ…è£å™¨ä¾†å¯¦ç¾çš„ã€‚\nDecorator å°è±¡èˆ‡åº•å±¤å°è±¡å…·æœ‰ç›¸åŒçš„æ¥å£ã€‚é€™å…è¨±å®¢æˆ¶ç«¯å°åƒä»¥èˆ‡åº•å±¤å¯¦éš›å°è±¡å®Œå…¨ç›¸åŒçš„æ–¹å¼èˆ‡è£é£¾å™¨å°è±¡äº¤äº’ã€‚Decorator å°è±¡åŒ…å«å°å¯¦éš›å°è±¡çš„å¼•ç”¨ã€‚Decorator å°è±¡æ¥æ”¶ä¾†è‡ªå®¢æˆ¶ç«¯çš„æ‰€æœ‰è«‹æ±‚ï¼ˆèª¿ç”¨ï¼‰ã€‚åéä¾†ï¼Œå®ƒå°‡é€™äº›èª¿ç”¨è½‰ç™¼åˆ°åº•å±¤å°è±¡ã€‚Decorator å°åƒåœ¨å°‡è«‹æ±‚è½‰ç™¼åˆ°åº•å±¤å°è±¡ä¹‹å‰æˆ–ä¹‹å¾Œæ·»åŠ äº†ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚é€™ç¢ºä¿äº†é™„åŠ åŠŸèƒ½å¯ä»¥åœ¨é‹è¡Œæ™‚å¾å¤–éƒ¨æ·»åŠ åˆ°çµ¦å®šå°è±¡ï¼Œè€Œç„¡éœ€ä¿®æ”¹å…¶çµæ§‹ã€‚\nä½¿ç”¨ç¹¼æ‰¿æˆ–çµ„åˆä¾†æ“´å±•å°è±¡çš„è¡Œç‚ºï¼Œä½†é€™æ˜¯åœ¨ç·¨è­¯æ™‚å®Œæˆçš„ï¼Œå®ƒé©ç”¨æ–¼é¡çš„æ‰€æœ‰å¯¦ä¾‹ã€‚ä¸èƒ½åœ¨é‹è¡Œæ™‚æ·»åŠ ä»»ä½•æ–°åŠŸèƒ½æˆ–åˆªé™¤ä»»ä½•ç¾æœ‰è¡Œç‚ºâ€”â€”é€™å°±æ˜¯è£é£¾å™¨æ¨¡å¼å‡ºç¾çš„æ™‚å€™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 public interface Pc { public String buyPc(); } public class SimplePc implements Pc { @Override public String buyPc() { return \u0026#34;spend 1000\u0026#34;; } } // è£é£¾å™¨é¡å¯¦ç¾äº†çµ„ä»¶æ¥å£ï¼Œå®ƒèˆ‡çµ„ä»¶æ¥å£å…·æœ‰HAS-Aé—œä¿‚ã€‚ // å­è£é£¾å™¨é¡æ‡‰è©²å¯ä»¥è¨ªå•çµ„ä»¶è®Šé‡ï¼Œå› æ­¤ä¿è­·é€™å€‹è®Šé‡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ IcecreamDecorator é¡å°‡åœ¨æˆ‘å€‘çš„ä¾‹å­ä¸­ç”¨ä½œè£é£¾å™¨ã€‚ public class PcDecorator implements Pc { protected Pc specialPc; public PcDecorator(Pc specialPc){ this.specialPc = specialPc; } @Override public String buyPc() { return specialPc.buyPc(); } } public class UsaDecorator extends PcDecorator { public UsaDecorator(Pc specialPc) { super(specialPc); } public String buyPc(){ return specialPc.buyPc() + addFee(); } private String addFee() { return \u0026#34; + 2000\u0026#34;; } } // åœ¨è£é£¾ä¸€å±¤ public class TaiwanDecorator extends PcDecorator { public TaiwanDecorator(Pc specialPc) { super(specialPc); } public String buyPc(){ return specialPc.buyPc() + addFee(); } private String addFee() { return \u0026#34; + 5000\u0026#34;; } } 1 2 3 4 5 public static void main(String[] args) { Pc pc = new TaiwanDecorator(new UsaDecorator(new SimplePc())); System.out.println(pc.buyPc()); } å‹•æ…‹ä¸”é€æ˜åœ°å‘å–®å€‹å°è±¡æ·»åŠ è·è²¬ï¼Œå³ä¸å½±éŸ¿å…¶ä»–å°è±¡ã€‚ å°æ–¼å¯ä»¥æ’¤å›çš„è²¬ä»»ã€‚ ç•¶é€šéå­åˆ†é¡æ“´å±•æ˜¯ä¸åˆ‡å¯¦éš›çš„ã€‚æœ‰æ™‚å¤§é‡çš„ç¨ç«‹æ“´å±•æ˜¯å¯èƒ½çš„ï¼Œä¸¦ä¸”æœƒç”¢ç”Ÿå¤§é‡çš„å­é¡ä¾†æ”¯æŒæ¯ç¨®çµ„åˆã€‚æˆ–è€…ä¸€å€‹é¡å®šç¾©å¯èƒ½è¢«éš±è—æˆ–ä¸èƒ½ç”¨æ–¼å­åˆ†é¡ã€‚ ç•¶é¸æ“‡çš„æ•¸é‡æ›´å¤šæ™‚ï¼Œå®ƒå¾ˆå®¹æ˜“ç¶­è­·å’Œæ“´å±•ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/decorator/","tags":[],"title":"DesignPattern - Structural - Decorator"},{"content":"Bridge åœ¨æ¥å£å’Œå¯¦ç¾ä¸­éƒ½æœ‰æ¥å£å±¤æ¬¡çµæ§‹æ™‚ï¼Œä½¿ç”¨ Bridge è¨­è¨ˆæ¨¡å¼å°‡æ¥å£èˆ‡å¯¦ç¾åˆ†é›¢ï¼Œä¸¦å°å®¢æˆ¶ç«¯ç¨‹åºéš±è—å¯¦ç¾ç´°ç¯€ã€‚\næ ¹æ“š GoF æ©‹çš„è¨­è¨ˆæ¨¡å¼æ˜¯ï¼šå°‡æŠ½è±¡èˆ‡å…¶å¯¦ç¾åˆ†é›¢ï¼Œä»¥ä¾¿å…©è€…å¯ä»¥ç¨ç«‹è®ŠåŒ–ã€‚\nå°‡æŠ½è±¡åŠå…¶å¯¦ç¾åˆ†é–‹ï¼Œä¸¦ç‚ºæŠ½è±¡å’Œå¯¦ç¾è€…é–‹ç™¼å–®ç¨çš„ç¹¼æ‰¿çµæ§‹ã€‚æŠ½åƒæ˜¯æ¥å£æˆ–æŠ½åƒé¡ï¼ŒåŒæ¨£å¯¦ç¾è€…æ˜¯æ¥å£æˆ–æŠ½åƒé¡ã€‚æŠ½è±¡åŒ…å«å°å¯¦ç¾è€…çš„å¼•ç”¨ã€‚æŠ½è±¡çš„å­©å­è¢«ç¨±ç‚ºç²¾ç…‰æŠ½è±¡ï¼Œå¯¦ç¾è€…çš„å­©å­æ˜¯å…·é«”çš„å¯¦ç¾è€…ã€‚ç”±æ–¼æˆ‘å€‘å¯ä»¥åœ¨æŠ½åƒä¸­æ›´æ”¹å°å¯¦ç¾è€…çš„å¼•ç”¨ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥åœ¨é‹è¡Œæ™‚æ›´æ”¹æŠ½è±¡çš„å¯¦ç¾è€…ã€‚ä½†æ˜¯ï¼Œå°å¯¦ç¾è€…çš„æ›´æ”¹ä¸æœƒå½±éŸ¿å®¢æˆ¶ç«¯ä»£ç¢¼ã€‚\nBridge çš„ç›®çš„æ˜¯å°‡æŠ½è±¡å’Œå¯¦ç¾æ”¾å…¥å…©å€‹ä¸åŒçš„é¡å±¤æ¬¡çµæ§‹ä¸­ï¼Œä»¥ä¾¿å…©è€…éƒ½å¯ä»¥ç¨ç«‹æ“´å±•ã€‚ Bridge å¹«åŠ©å…©å€‹ä¸å…¼å®¹çš„ é¡ä¸€èµ·å·¥ä½œã€‚ä½†æ˜¯ Bridge é€šéå‰µå»ºå…©å€‹ä¸åŒçš„å±¤æ¬¡çµæ§‹ä¾†åˆ†é›¢æŠ½è±¡å’Œå¯¦ç¾ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 /** * abstraction in Bridge pattern * */ public abstract class Vehicle { protected VehicleType type1; protected VehicleType type2; public Vehicle(VehicleType type1, VehicleType type2) { this.type1 = type1; this.type2 = type2; } abstract public void purchase(); } /** * Implementor for Bridge pattern * */ public interface VehicleType { abstract public void book(); } /** * Refine abstraction 1 in Bridge pattern */ public class Car extends Vehicle { public Car(VehicleType type1, VehicleType type2) { super(type1, type2); } @Override public void purchase() { System.out.print(\u0026#34;Car\u0026#34;); type1.book(); type2.book(); } } /** * Refine abstraction 2 in Bridge pattern */ public class Bike extends Vehicle { public Bike(VehicleType type1, VehicleType type2) { super(type1, type2); } @Override public void purchase() { System.out.print(\u0026#34;Bike\u0026#34;); type1.book(); type2.book(); } } /** * Concrete implementation 1 for Bridge pattern * */ public class NewVehicle implements VehicleType { @Override public void book() { System.out.print(\u0026#34; : New Vehicle\u0026#34;); } } /** * Concrete implementation 2 for Bridge pattern * */ public class OldVehicle implements VehicleType { @Override public void book() { System.out.println(\u0026#34; : Old Vehicle\u0026#34;); } } 1 2 3 4 5 6 7 8 9 public static void main(String[] args) { Vehicle vehicle1= new Car(new NewVehicle(),new OldVehicle()); vehicle1.purchase(); Bike vehicle2 = new Bike(new NewVehicle(),new OldVehicle()); vehicle2.purchase(); } å¤šå€‹å¯¦ç¾æ™‚æœ€å¥½ä½¿ç”¨ã€‚ éœ€è¦åœ¨é‹è¡Œæ™‚åˆ‡æ›å¯¦ç¾æ™‚æ‡‰è©²ä½¿ç”¨ã€‚ å¦‚æœæŠ½è±¡çš„å¯¦ç¾æœ‰ä¿®æ”¹ï¼Œå®¢æˆ¶ç«¯ä¸æ‡‰è©²å—åˆ°å½±éŸ¿ã€‚ å‰µå»ºå…©å€‹ä¸åŒçš„å±¤æ¬¡çµæ§‹ã€‚ä¸€å€‹ç”¨æ–¼æŠ½è±¡ï¼Œå¦ä¸€å€‹ç”¨æ–¼å¯¦ç¾ã€‚ é€šéæ¶ˆé™¤æŠ½è±¡å’Œå¯¦ç¾ä¹‹é–“çš„ä¾è³´é—œä¿‚ä¾†é¿å…æ°¸ä¹…ç¶å®š, å‰µå»ºäº†ä¸€å€‹åœ¨æŠ½è±¡å’Œå¯¦ç¾ä¹‹é–“å”èª¿çš„æ©‹æ¨‘ã€‚ æŠ½è±¡å’Œå¯¦ç¾å¯ä»¥åˆ†é–‹æ“´å±•ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/bridge/","tags":[],"title":"DesignPattern - Structural - Bridge"},{"content":"Facade ç‚ºå­ç³»çµ±ä¸­çš„ä¸€çµ„ interface æä¾›çµ±ä¸€çš„å…¥å£ã€‚Facade Pattern å®šç¾©äº†ä¸€å€‹æ›´é«˜ç´šåˆ¥çš„æ¥å£ï¼Œä½¿å­ç³»çµ±æ›´æ˜“æ–¼ä½¿ç”¨ Facade ä¸¦æ²’æœ‰å°è£å­ç³»çµ±é¡æˆ–æ¥å£ï¼›å®ƒåªæ˜¯ç‚ºå…¶åŠŸèƒ½æä¾›äº†ä¸€å€‹ç°¡åŒ–çš„ç•Œé¢ã€‚ æ­¤å¤–ï¼Œå®¢æˆ¶ç«¯å¯ä»¥ç›´æ¥è¨ªå•é€™äº›é¡ã€‚å®ƒä»ç„¶ç‚ºå¯èƒ½éœ€è¦å®ƒçš„å®¢æˆ¶å…¬é–‹ç³»çµ±çš„å…¨éƒ¨åŠŸèƒ½ã€‚ç°¡è€Œè¨€ä¹‹ï¼Œå®ƒåªæ˜¯ç‚ºå­ç³»çµ±çš„è¤‡é›œæ¥å£æä¾›äº†ä¸€å±¤ï¼Œä½¿å…¶æ›´æ˜“æ–¼ä½¿ç”¨ã€‚\nå¤–è§€è¨­è¨ˆæ¨¡å¼æ˜¯ä¿ƒé€²é¬†æ•£è€¦åˆçš„å…¶ä»–è¨­è¨ˆæ¨¡å¼ä¹‹ä¸€ã€‚å®ƒå¼·èª¿äº†è¨­è¨ˆä¸­æœ€é‡è¦çš„ä¸€å€‹æ–¹é¢ï¼Œå³æŠ½è±¡ã€‚é€šééš±è—å®ƒèƒŒå¾Œçš„è¤‡é›œæ€§ä¸¦æš´éœ²ä¸€å€‹ç°¡å–®çš„æ¥å£ï¼Œå®ƒå¯¦ç¾äº†æŠ½è±¡ã€‚ Facade å’Œ Adapter ä¸€æ¨£å¯ä»¥å°è£å¤šå€‹é¡ï¼Œä½†æ˜¯ Facade ä½¿ç”¨æ¥å£ä¾†ç°¡åŒ–è¤‡é›œæ¥å£çš„ä½¿ç”¨ï¼Œè€Œ Adapter ç”¨æ–¼å°‡æ¥å£è½‰æ›ç‚ºå®¢æˆ¶ç«¯æœŸæœ›çš„æ¥å£ã€‚ åœ¨æŠ½è±¡æ–¹é¢ï¼Œä¸­ä»‹è€…è¨­è¨ˆæ¨¡å¼å¯èƒ½çœ‹èµ·ä¾†èˆ‡å¤–è§€è¨­è¨ˆæ¨¡å¼éå¸¸ç›¸ä¼¼ã€‚Mediator ä»¥é¡ä¼¼æ–¼å¤–è§€æ¨¡å¼çš„æ–¹å¼æŠ½è±¡å­ç³»çµ±çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œåœ¨ä¸­ä»‹è€…æ¨¡å¼çš„å¯¦ç¾ä¸­ï¼Œå­ç³»çµ±æˆ–å°ç­‰é»çš„çµ„ä»¶éƒ½çŸ¥é“ä¸­ä»‹è€…ä¸¦èˆ‡ä¹‹äº¤äº’ã€‚ä½†æ˜¯åœ¨å¤–è§€æ¨¡å¼çš„æƒ…æ³ä¸‹ï¼Œå­ç³»çµ±ä¸çŸ¥é“å¤–è§€çš„å­˜åœ¨ã€‚åªæœ‰å¤–è§€èˆ‡å­ç³»çµ±å°è©±ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 public class Service1 { public int doSth(int x) { // è¤‡é›œçš„æ¥­å‹™é‚è¼¯... return x + x; } } public class Service2 { public int doSth2(int x, int y) { // è¤‡é›œçš„æ¥­å‹™é‚è¼¯... return x + y; } } public class Service3 { public int doSth3(int x, int y, double z) { // è¤‡é›œçš„æ¥­å‹™é‚è¼¯... return x + y + Integer.parseInt(z); } } public class Facade { public int sum(int x) { Service1 s = new Service1(); return s.doSth(x + 1); } public int cut(int x) { Service1 s = new Service1(); Service2 s2 = new Service2(); return s.doSth(x) + s3.doSth(x, 0); } public int multiply(int x) { return Service3.doSth3(x, 2, 3.0); } } 1 2 3 4 5 6 7 8 public static void main(String[] args) { Facade facade = new Facade(); int x = 3; System.out.println(\u0026#34;Cube of \u0026#34; + x + \u0026#34;:\u0026#34; + facade.sum(100)); System.out.println(\u0026#34;Cube of \u0026#34; + x + \u0026#34; times 2:\u0026#34; + facade.cut(100)); System.out.println(x + \u0026#34; multiply class1 \u0026amp; class2 :\u0026#34; + facade.multiply(100)); } å­ç³»çµ±æ¥å£ä¸çŸ¥é“ Facadeï¼Œå®ƒå€‘ä¸æ‡‰è©²æœ‰ä»»ä½• Facade æ¥å£çš„å¼•ç”¨ã€‚ å­ç³»çµ±å¯ä»¥ç›¸äº’ä¾è³´ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œå¤–è§€å¯ä»¥å……ç•¶å”èª¿å™¨ä¸¦è§£è€¦å­ç³»çµ±ä¹‹é–“çš„ä¾è³´é—œä¿‚ã€‚ å¤–è§€æ¨¡å¼æ›´åƒæ˜¯å®¢æˆ¶ç«¯æ‡‰ç”¨ç¨‹åºçš„åŠ©æ‰‹ï¼›å®ƒä¸æœƒå°å®¢æˆ¶ç«¯éš±è—å­ç³»çµ±æ¥å£ã€‚æ˜¯å¦ä½¿ç”¨ Facade å®Œå…¨å–æ±ºæ–¼å®¢æˆ¶ç«¯ä»£ç¢¼ã€‚ å¤–è§€æ¨¡å¼å¯ä»¥æ‡‰ç”¨æ–¼ä»»ä½•é–‹ç™¼é»ï¼Œé€šå¸¸æ˜¯åœ¨æ¥å£æ•¸é‡å¢åŠ å’Œç³»çµ±è®Šå¾—è¤‡é›œæ™‚ã€‚ å¤–è§€æ¨¡å¼æ‡‰è©²æ‡‰ç”¨æ–¼é¡ä¼¼é¡å‹çš„æ¥å£ï¼›å®ƒçš„ç›®çš„æ˜¯æä¾›ä¸€å€‹æ¥å£è€Œä¸æ˜¯å¤šå€‹æ¥å£ä¾†å®Œæˆé¡ä¼¼çš„å·¥ä½œã€‚ å¯ä»¥ä½¿ç”¨å¸¶æœ‰ Facade çš„å·¥å» æ¨¡å¼ä¾†ç‚ºå®¢æˆ¶ç«¯ç³»çµ±æä¾›æ›´å¥½çš„æ¥å£ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/facade/","tags":[],"title":"DesignPattern - Structural - Facade"},{"content":"Flyweight Flyweight ä¸­ï¼Œæˆ‘å€‘é‡è¤‡ä½¿ç”¨å°è±¡ï¼Œè€Œä¸æ˜¯å‰µå»ºå¤§é‡ç›¸ä¼¼çš„å°è±¡ã€‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨å®ƒä¾†æ¸›å°‘å…§å­˜éœ€æ±‚å’Œå¯¦ä¾‹åŒ–æ™‚é–“ä»¥åŠç›¸é—œæˆæœ¬ã€‚\nåœ¨æˆ‘å€‘æ‡‰ç”¨ Flyweight ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦è€ƒæ…®ä»¥ä¸‹å› ç´ ï¼š\nå¦‚æœæ‡‰ç”¨ç¨‹åºä¸­æ‰€éœ€çš„å°åƒæ•¸é‡å·¨å¤§ã€‚ å¦‚æœå°è±¡å‰µå»ºä½”ç”¨å¤§é‡å…§å­˜ä¸¦ä¸”ä¹Ÿå¯èƒ½å¾ˆè€—æ™‚ã€‚ å¤ªå¤šçš„å°è±¡æœƒé™ä½æ‡‰ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚é¡¯ç„¶ï¼Œå¤ªå¤šçš„å°è±¡å¯èƒ½æœƒæ¶ˆè€—æ›´å¤§çš„å…§å­˜ã€‚æ­¤å¤–ï¼Œå®ƒå€‘å¯èƒ½æœƒé™ä½æ‡‰ç”¨ç¨‹åºçš„é€Ÿåº¦ï¼Œç”šè‡³å¯èƒ½å°è‡´å…§å­˜ä¸è¶³å•é¡Œã€‚ åœ¨æ‡‰ç”¨ç¨‹åºä¸­æ§åˆ¶å®ƒã€‚ç•¶æˆ‘å€‘æœ‰å¾ˆå¤šç›¸ä¼¼çš„å°è±¡ä¸¦ä¸”æ± ä¸­çš„å…©å€‹å°è±¡ä¹‹é–“æ²’æœ‰å¤ªå¤šå·®ç•°æ™‚ï¼Œå°¤å…¶å¦‚æ­¤ã€‚ æœ‰æ™‚ï¼Œæ‡‰ç”¨ç¨‹åºä¸­çš„å°è±¡å¯èƒ½å…·æœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§ä¸¦ä¸”å±¬æ–¼ç›¸ä¼¼é¡å‹ï¼ˆæ­¤è™•çš„ç›¸ä¼¼é¡å‹æ„å‘³è‘—å®ƒå€‘çš„å¤§å¤šæ•¸å±¬æ€§å…·æœ‰ç›¸ä¼¼çš„å€¼ï¼Œä¸¦ä¸”åªæœ‰å°‘æ•¸å±¬æ€§å€¼ä¸åŒï¼‰ã€‚å¦‚æœå®ƒå€‘ä¹Ÿæ˜¯è¦å‰µå»ºçš„é‡ç‰©ï¼Œæ‡‰ç”¨ç¨‹åºé–‹ç™¼äººå“¡æ‡‰è©²æ§åˆ¶å®ƒå€‘ã€‚å¦å‰‡ï¼Œå®ƒå€‘å¯èƒ½æœƒæ¶ˆè€—å¤§é‡å…§å­˜ä¸¦æœ€çµ‚æ¸›æ…¢æ•´å€‹æ‡‰ç”¨ç¨‹åºçš„é€Ÿåº¦ã€‚\nFlyweight æ—¨åœ¨æ§åˆ¶æ­¤é¡å°è±¡çš„å‰µå»ºï¼Œä¸¦ç‚ºæ‚¨æä¾›åŸºæœ¬çš„ç·©å­˜æ©Ÿåˆ¶ã€‚å®ƒå…è¨±æ‚¨ç‚ºæ¯ç¨®é¡å‹å‰µå»ºä¸€å€‹å°è±¡ï¼ˆæ­¤è™•çš„é¡å‹å› è©²å°è±¡çš„å±¬æ€§è€Œç•°ï¼‰ï¼Œå¦‚æœæ‚¨è«‹æ±‚å…·æœ‰ç›¸åŒå±¬æ€§çš„å°è±¡ï¼ˆå·²å‰µå»ºï¼‰ï¼Œå®ƒå°‡è¿”å›ç›¸åŒçš„å°è±¡è€Œä¸æ˜¯å‰µå»ºä¸€å€‹æ–°çš„å°è±¡ä¸€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 public interface Msg { public void show(String msg); } public class EmergentMsg implements Msg { private String key; EmergentMsg(String key) { this.key = key; System.out.println(\u0026#34;send \u0026#34; + key + \u0026#34; emergent msg\u0026#34;); } public void show(String msg) { System.out.println(msg); } } public class MsgFactory { private static MsgFactory FACTORY = new MsgFactory(); private static Map\u0026lt;String, Msg\u0026gt; msgs = new HashMap\u0026lt;\u0026gt;(); public static MsgFactory getInstance() { // çœ‹è¦ä¸è¦ double lock check return FACTORY; } public Msg getMsg(String key) { Msg msg = (Msg)msgs.get(key); if (msg != null) { System.out.println(\u0026#34;msg \u0026#34; + key + \u0026#34; exist\u0026#34;); } else { msg = new EmergentMsg(key); msgs.put(key, msg); } return msg; } } æœ‰é»åƒè³‡æºé‡è¤‡ä½¿ç”¨ maybe, service locator pattern !?\n","permalink":"https://xinqilin.github.io/post/architecture/flyweight/","tags":[],"title":"DesignPattern - Structural - Flyweight"},{"content":"Proxy Proxy pattern ç‚ºå¦ä¸€å€‹å°è±¡ create a representative object that controls access to another objectã€‚ äº‹å¯¦ä¸Šï¼ŒProxy pattern æ˜¯ç”¨ä¾†å‰µå»ºä¸€å€‹ä»£è¡¨å°è±¡ä¾†æ§åˆ¶å°å¦ä¸€å€‹å°è±¡çš„è¨ªå•ã€‚æˆæœ¬é«˜æˆ–éœ€è¦ä¿è­·ä»¥è‡³æ–¼å­˜å–æ¶ˆè²»è¼ƒå¤§ã€‚\næ§åˆ¶å°å°è±¡çš„è¨ªå•çš„ä¸€å€‹åŸå› æ˜¯å°‡å…¶å‰µå»ºå’Œåˆå§‹åŒ–çš„å…¨éƒ¨æˆæœ¬æ¨é²åˆ°æˆ‘å€‘çœŸæ­£éœ€è¦ä½¿ç”¨å®ƒæ™‚ã€‚å¦ä¸€å€‹åŸå› å¯èƒ½æ˜¯å……ç•¶ä½æ–¼ä¸åŒ JVM ä¸­çš„å°è±¡çš„æœ¬åœ°ä»£è¡¨ã€‚æ­¤å¤–ï¼Œä»£ç†åœ¨æ§åˆ¶å°åŸå§‹å°è±¡çš„è¨ªå•æ–¹é¢éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯ç•¶å°è±¡æ‡‰è©²å…·æœ‰ä¸åŒçš„è¨ªå•æ¬Šé™æ™‚ã€‚\nåœ¨ä»£ç†è¨­è¨ˆæ¨¡å¼ä¸­ï¼Œå®¢æˆ¶ç«¯ä¸ç›´æ¥èˆ‡åŸå§‹å°åƒå°è©±ï¼Œå®ƒå°‡èª¿ç”¨å§”è¨—çµ¦ä»£ç†å°è±¡ï¼Œä»£ç†å°è±¡èª¿ç”¨åŸå§‹å°è±¡çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œé‡è¦çš„ä¸€é»æ˜¯å®¢æˆ¶ç«¯ä¸çŸ¥é“ä»£ç†ã€‚ä»£ç†å……ç•¶å®¢æˆ¶ç«¯çš„åŸå§‹å°è±¡ã€‚ä½†æ˜¯é€™ç¨®æ–¹æ³•æœ‰å¾ˆå¤šè®Šé«”ï¼Œæˆ‘å€‘å¾ˆå¿«å°±æœƒçœ‹åˆ°ã€‚\nä»£ç†æ¨¡å¼æœ‰ä¸‰ç¨®ä¸»è¦è®Šé«”ï¼š\nproxy ç‚ºä¸åŒ remote address çš„å°è±¡æä¾› local access (è·³æ¿)ã€‚ A virtual proxy creates expensive objects on demand. ä¿è­·ä»£ç†æ§åˆ¶å°åŸå§‹å°è±¡çš„è¨ªå•ã€‚ç•¶å°è±¡æ‡‰è©²å…·æœ‰ä¸åŒçš„è¨ªå•æ¬Šé™æ™‚ï¼Œä¿è­·ä»£ç†å¾ˆæœ‰ç”¨ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 public class User { String userName; String password; // Getter, Setter, Constructor } public interface IFolder { public void performOperations(); } public class Folder implements IFolder { @Override public void performOperations() { // è¨ªå• folder ä¸¦åŸ·è¡Œå„ç¨®æ“ä½œ System.out.println(\u0026#34;execute sth in folder\u0026#34;); } } public class FolderProxy implements IFolder { Folder folder; User user; public FolderProxy(User user){ this.user = user; } @Override public void performOperations() { if ((\u0026#34;dev\u0026#34;).equals(user.getUserName()) \u0026amp;\u0026amp; (\u0026#34;dev\u0026#34;).equals(user.getPassword())) { folder = new Folder(); folder.performOperations(); } else { System.out.println(\u0026#34;can\u0026#39;t access this folder\u0026#34;); } } } 1 2 3 4 5 6 7 8 9 10 11 12 13 public static void main(String[] args) { var user = new User(\u0026#34;dev\u0026#34;, \u0026#34;dev\u0026#34;); FolderProxy folderProxy = new FolderProxy(user); folderProxy.performOperations(); System.out.println(\u0026#34;------------------------------------\u0026#34;); // if we give wrong userName and Password var userWrong = new User(\u0026#34;staging\u0026#34;, \u0026#34;staging\u0026#34;); FolderProxy folderProxyWrong = new FolderProxy(userWrong); folderProxyWrong.performOperations(); } æœ‰ä¸€å€‹ç¾æœ‰çš„é¡ï¼Œå®ƒçš„æ¥å£èˆ‡æ‚¨éœ€è¦çš„ä¸åŒ¹é…ã€‚ æƒ³å‰µå»ºä¸€å€‹å¯é‡ç”¨çš„é¡ï¼Œå®ƒèˆ‡ä¸ç›¸é—œæˆ–ä¸å¯é è¦‹çš„é¡ï¼ˆå³ä¸ä¸€å®šå…·æœ‰å…¼å®¹æ¥å£çš„é¡ï¼‰å”ä½œã€‚ æœ‰å¹¾å€‹ç¾æœ‰çš„å­é¡å¯ä¾›ä½¿ç”¨ï¼Œä½†é€šéå°æ¯å€‹å­é¡é€²è¡Œå­é¡åŒ–ä¾†èª¿æ•´å®ƒå€‘çš„æ¥å£æ˜¯ä¸åˆ‡å¯¦éš›çš„ã€‚å°è±¡ adapter å¯ä»¥é©é…å…¶çˆ¶é¡çš„æ¥å£ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/proxy/","tags":[],"title":"DesignPattern - Structural - Proxy"},{"content":"Composite Composite è®“å®¢æˆ¶å¯ä»¥çµ±ä¸€è™•ç†å–®å€‹å°è±¡å’Œå°è±¡çš„çµ„åˆï¼Œé€™å°±æ˜¯ Composite Pattern çš„æ„åœ–ã€‚ åœ¨å¾©åˆæ¨¡å¼ä¸­ï¼Œå­˜åœ¨ä¸€å€‹æ¨¹çµæ§‹ï¼Œå¯ä»¥åœ¨è‘‰å­å’Œç¯€é»ä¸ŠåŸ·è¡Œç›¸åŒçš„æ“ä½œã€‚æ¨¹ä¸­çš„ç¯€é»æ˜¯å¯ä»¥æœ‰å­©å­çš„é¡ã€‚ç¯€é»é¡æ˜¯â€œè¤‡åˆâ€é¡ã€‚æ¨¹ä¸Šçš„è‘‰å­æ˜¯æ²’æœ‰å­©å­çš„â€œåŸå§‹â€é¡ã€‚ çµ„åˆçš„å­ç¯€é»å¯ä»¥æ˜¯è‘‰å­æˆ–å…¶ä»–çµ„åˆã€‚ è‘‰é¡å’Œå¾©åˆé¡å…±äº«ä¸€å€‹é€šç”¨çš„ \u0026ldquo;Composite\u0026rdquo; interfaceï¼Œè©²æ¥å£å®šç¾©äº†å¯ä»¥åœ¨è‘‰å’Œå¾©åˆä¸ŠåŸ·è¡Œçš„é€šç”¨æ“ä½œã€‚ç•¶å°çµ„åˆåŸ·è¡Œæ“ä½œæ™‚ï¼Œå°‡å°çµ„åˆçš„æ‰€æœ‰å­ç¯€é»åŸ·è¡Œæ­¤æ“ä½œï¼Œç„¡è«–å®ƒå€‘æ˜¯è‘‰å­é‚„æ˜¯çµ„åˆã€‚å› æ­¤ï¼Œè¤‡åˆæ¨¡å¼å¯ç”¨æ–¼å°çµ„æˆæ¨¹çš„å°è±¡åŸ·è¡Œå¸¸è¦‹æ“ä½œã€‚\nBase Component: æ˜¯çµ„åˆä¸­æ‰€æœ‰å°è±¡çš„æ¥å£ã€‚å®¢æˆ¶ç«¯ç¨‹åºä½¿ç”¨åŸºæœ¬çµ„ä»¶ä¾†è™•ç†çµ„åˆä¸­çš„å°è±¡ã€‚æ­¤å¤–ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€å€‹ interface æˆ– abstract classï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å°è±¡å…±æœ‰çš„ä¸€äº›æ–¹æ³•ã€‚ Leaf: å®šç¾©çµ„åˆä¸­å…ƒç´ çš„è¡Œç‚ºã€‚å®ƒæ˜¯çµ„åˆçš„æ§‹å»ºå¡Šä¸¦å¯¦ç¾åŸºæœ¬çµ„ä»¶ã€‚é›–ç„¶ï¼Œå®ƒæ²’æœ‰å°å…¶ä»–çµ„ä»¶çš„å¼•ç”¨ã€‚ Composite: å®ƒç”±è‘‰å…ƒç´ çµ„æˆï¼Œä¸¦åœ¨åŸºæœ¬çµ„ä»¶ä¸­å¯¦ç¾æ“ä½œã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 /** * Manager(Composite) * Developer(Leaf) * Employee(Component) */ public interface Employee { public void add(Employee emp); public void remove(Employee emp); public Employee getChild(int i); public String getName(); public double getSalary(); public void print(); } // ç¾åœ¨æˆ‘å€‘å°‡å‰µå»º Manager (Composite)ã€‚é€™è£¡çš„é—œéµé»æ˜¯æ‰€æœ‰é€šç”¨æ–¹æ³•éƒ½å°‡å…¶æ“ä½œå§”è¨—çµ¦å­å°è±¡ã€‚å®ƒå…·æœ‰è¨ªå•å’Œä¿®æ”¹å…¶å­ç´šçš„æ–¹æ³•ã€‚ public class Manager implements Employee { private String name; private double salary; public Manager(String name, double salary) { this.name = name; this.salary = salary; } var employees = new ArrayList\u0026lt;Employee\u0026gt;(); @Override public void add(Employee emp) { employees.add(emp); } @Override public void remove(Employee emp) { employees.remove(emp); } @Override public Employee getChild(int i) { return employees.get(i); } @Override public String getName() { return name; } @Override public double getSalary() { return salary; } @Override public void print() { System.out.println(\u0026#34;Name = \u0026#34; + getName()); System.out.println(\u0026#34;Salary = \u0026#34; + getSalary()); System.out.println(\u0026#34;-------------\u0026#34;); Iterator\u0026lt;Employee\u0026gt; empIterator = employees.iterator(); while(empIterator.hasNext()){ var emp = empIterator.next(); emp.print(); } } } public class Manager implements Employee { private String name; private double salary; public Manager(String name, double salary) { this.name = name; this.salary = salary; } var employees = new ArrayList\u0026lt;Employee\u0026gt;(); @Override public void add(Employee emp) { employees.add(emp); } @Override public void remove(Employee emp) { employees.remove(emp); } @Override public Employee getChild(int i) { return employees.get(i); } @Override public String getName() { return name; } @Override public double getSalary() { return salary; } @Override public void print() { System.out.println(\u0026#34;Name = \u0026#34; + getName()); System.out.println(\u0026#34;Salary = \u0026#34; + getSalary()); System.out.println(\u0026#34;-------------\u0026#34;); Iterator\u0026lt;Employee\u0026gt; empIterator = employees.iterator(); while(empIterator.hasNext()){ Employee emp= empIterator.next(); emp.print(); } } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public class CompositePatternTest { public static void main(String[] args) { Employee emp1 = new Developer(\u0026#34;Bill\u0026#34;, 10000); Employee emp2 = new Developer(\u0026#34;David\u0026#34;, 15000); Employee manager1 = new Manager(\u0026#34;Paul\u0026#34;, 25000); manager1.add(emp1); manager1.add(emp2); Employee emp3 = new Developer(\u0026#34;Lag\u0026#34;, 20000); Manager generalManager = new Manager(\u0026#34;Howard\u0026#34;, 50000); generalManager.add(emp3); generalManager.add(manager1); generalManager.print(); } } ç•¶æˆ‘å€‘æƒ³è¦è¡¨ç¤ºå°è±¡çš„éƒ¨åˆ†æ•´é«”å±¤æ¬¡çµæ§‹æ™‚ã€‚ ç•¶æˆ‘å€‘å¸Œæœ›å®¢æˆ¶èƒ½å¤ å¿½ç•¥å°è±¡çµ„åˆå’Œå–®å€‹å°è±¡ä¹‹é–“çš„å·®ç•°æ™‚ã€‚å®¢æˆ¶ç«¯å°‡çµ±ä¸€å°å¾…è¤‡åˆçµæ§‹ä¸­çš„æ‰€æœ‰å°è±¡ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/composite/","tags":[],"title":"DesignPattern - Structural - Composite"},{"content":"Adapter å°‡ä¸€å€‹é¡åˆ¥çš„ä»‹é¢ è½‰æ›æˆå¦ä¸€å€‹é¡åˆ¥çš„ä»‹é¢ä¾›å®¢æˆ¶ä½¿ç”¨ è®“ä»‹é¢ä¸ç›¸å®¹çš„é¡åˆ¥å¯ä»¥åˆä½œ\næœ‰æ™‚ï¼Œå¯èƒ½æœƒå‡ºç¾å…©å€‹å°åƒä¸é©åˆåœ¨ä¸€èµ·çš„æƒ…æ³ï¼Œæˆ–è€…åœ¨ä»£ç¢¼ä¸­æ›´æ”¹ç¬¬ 3 æ–¹ API æ™‚ï¼Œå¯èƒ½æœƒå‡ºç¾é€™ç¨®æƒ…æ³ã€‚ é¡¯ç„¶ï¼Œé€™æ˜¯ç”±æ–¼å…©å€‹ä¸é©åˆåœ¨ä¸€èµ·çš„å°è±¡çš„æ¥å£ä¸å…¼å®¹é€ æˆçš„ã€‚\næ­£å¦‚é©é…å™¨ä¸€è©æ‰€æš—ç¤ºçš„é‚£æ¨£ï¼Œé©é…å™¨è¨­è¨ˆæ¨¡å¼ æ˜¯ ä½¿å…©å€‹ä¸ç›¸é—œçš„æ¥å£å”åŒå·¥ä½œçš„çµæ§‹è¨­è¨ˆæ¨¡å¼ä¹‹ä¸€ã€‚æ­¤å¤–ï¼Œé€£æ¥é€™äº›ä¸ç›¸é—œæ¥å£çš„å°è±¡ç¨±ç‚ºé©é…å™¨ï¼Œå°±åƒä¸­ä»‹ä¸€æ¨£ã€‚\nåœ¨é©é…å™¨æ¨¡å¼ä¸­ï¼Œä¸€å€‹åŒ…è£é¡ï¼ˆadapterï¼‰ç”¨æ–¼å°‡è«‹æ±‚å¾å®ƒè½‰æ›åˆ°å¦ä¸€å€‹é¡ï¼ˆadopteeï¼‰ã€‚å¯¦éš›ä¸Šï¼Œé©é…å™¨æä¾›äº†èˆ‡è¢«æ”¶é¤Šè€…ä¸ç›´æ¥æä¾›çš„ç‰¹å®šäº¤äº’ã€‚\né©é…å™¨æ¨¡å¼å¯ä»¥æ¡ç”¨å…©ç¨®å½¢å¼ï¼šç¹¼æ‰¿æˆ–çµ„åˆå½¢å¼ã€‚åœ¨ç¬¬ä¸€ç¨®å½¢å¼ä¸­ï¼Œâ€œé¡é©é…å™¨â€åˆ©ç”¨ç¹¼æ‰¿ã€‚é¡é©é…å™¨æ“´å±•äº†è¢«æ”¶é¤Šé¡ä¸¦å°‡æ‰€éœ€çš„æ–¹æ³•æ·»åŠ åˆ°é©é…å™¨ä¸­ã€‚ é€™äº›æ–¹æ³•å¯ä»¥åœ¨æ¥å£ï¼ˆå³â€œç›®æ¨™â€æ¥å£ï¼‰ä¸­è²æ˜ã€‚ä½†æ˜¯ï¼Œåœ¨ç¬¬äºŒç¨®å½¢å¼ä¸­ï¼›\u0026ldquo;å°è±¡ adapter\u0026rdquo; åˆ©ç”¨çµ„åˆã€‚å°è±¡ adapter åŒ…å«è¢«æ”¶é¤Šè€…ä¸¦å¯¦ç¾ç›®æ¨™æ¥å£ä»¥èˆ‡è¢«æ”¶é¤Šè€…äº¤äº’ã€‚\nClient: ä½ ä½¿ç”¨Targetä»‹é¢ Target: å®šç¾© User æ‰€å‘¼å«çš„ interface Adaptor(core): å°‡ Adaptee è½‰æ›æˆè¦ç”¨çš„ä»‹é¢ Adaptee: éœ€è¦è¢«è½‰æ›çš„ä»‹é¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 public class Apple { public void getAppleColor(String color){ System.out.println(\u0026#34;Apple color is : \u0026#34; +color); } } public class Orange { public void getOrangeColor(String color){ System.out.println(\u0026#34;Orange color is : \u0026#34; +color); } } public class AppleAdapter extends Apple { //The purpose of the sample problem is to adapt an orange as an apple. private Orange orange; // This is the main logic of Adapter pattern public AppleAdapter(Orange orange){ this.orange = orange; } public void getColor(String color){ orange.getOrangeColor(color); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 public class AdapterPatternTest { public static void main(String[] args) { Apple apple = new Apple(); apple.getAppleColor(\u0026#34;green\u0026#34;); Orange orange = new Orange(); AppleAdapter adapter = new AppleAdapter(orange); adapter.getAppleColor(\u0026#34;red\u0026#34;); } } æœ‰ä¸€å€‹ç¾æœ‰çš„é¡ï¼Œå®ƒçš„æ¥å£èˆ‡éœ€è¦çš„ä¸åŒ¹é…ã€‚ æƒ³è¦å‰µå»ºä¸€å€‹å¯é‡ç”¨çš„é¡ï¼Œå®ƒèˆ‡ä¸ç›¸é—œæˆ–ä¸å¯é è¦‹çš„é¡ï¼ˆå³ä¸ä¸€å®šå…·æœ‰å…¼å®¹æ¥å£çš„é¡ï¼‰å”ä½œã€‚ æœ‰å¹¾å€‹ç¾æœ‰çš„å­é¡å¯ä¾›ä½¿ç”¨ï¼Œä½†é€šéå°æ¯å€‹å­é¡é€²è¡Œå­é¡åŒ–ä¾†èª¿æ•´å®ƒå€‘çš„æ¥å£æ˜¯ä¸åˆ‡å¯¦éš›çš„ã€‚å°è±¡é©é…å™¨å¯ä»¥é©é…å…¶çˆ¶é¡çš„æ¥å£ã€‚ more sample Adapter æ¨¡å¼å°‡ Adaptee é¡åˆ¥çš„ specificRequest() æ–¹æ³•åŒ…è£æˆ Target æ¥å£çš„ request() æ–¹æ³•ã€‚\nClient é¡åˆ¥å¯ä»¥é€šéå‘¼å« Target æ¥å£çš„ request() æ–¹æ³•ä¾†ç™¼é€è«‹æ±‚ï¼Œè€Œä¸ç”¨çŸ¥é“åº•å±¤ä½¿ç”¨çš„æ˜¯ Adaptee é¡åˆ¥çš„ specificRequest() æ–¹æ³•ã€‚\né€šéä½¿ç”¨ Adapter æ¨¡å¼ï¼Œæˆ‘å€‘å¯ä»¥è®“ä¸å…¼å®¹çš„é¡åˆ¥ä¸€èµ·å·¥ä½œï¼Œé€™å°æ–¼åœ¨ç¾æœ‰ç³»çµ±ä¸­åŠ å…¥æ–°åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // Target interface public interface Target { void request(); } // Adaptee class public class Adaptee { public void specificRequest() { // Perform some specific request } } // Adapter class public class Adapter implements Target { private Adaptee adaptee; public Adapter(Adaptee adaptee) { this.adaptee = adaptee; } @Override public void request() { adaptee.specificRequest(); } } // Client public class Client { public void makeRequest(Target target) { target.request(); } } // Usage Adaptee adaptee = new Adaptee(); Target target = new Adapter(adaptee); Client client = new Client(); client.makeRequest(target); ","permalink":"https://xinqilin.github.io/post/architecture/adapter/","tags":[],"title":"DesignPattern - Structural - Adapter"},{"content":"Prototype ä¸€ç¨®å°è±¡å‰µå»ºæ©Ÿåˆ¶ã€‚\nå‡è¨­æœ‰ä¸€å€‹å¾ DB åŠ è¼‰æ•¸æ“šçš„å°è±¡ã€‚ç¾åœ¨ï¼Œæˆ‘å€‘éœ€è¦åœ¨ç¨‹åºä¸­å¤šæ¬¡ä¿®æ”¹é€™äº›æ•¸æ“šã€‚å› æ­¤ï¼Œä½¿ç”¨ new é—œéµå­—å‰µå»ºå°è±¡ä¸¦å†æ¬¡å¾æ•¸æ“šåº«ä¸­åŠ è¼‰æ‰€æœ‰æ•¸æ“šä¸¦ä¸æ˜¯ä¸€å€‹å¥½ä¸»æ„ã€‚å› æ­¤ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯å°‡ç¾æœ‰å°è±¡ clone ç‚ºæ–°å°è±¡ï¼Œç„¶å¾Œé€²è¡Œæ•¸æ“šæ“ä½œã€‚\nä½†æ˜¯ï¼ŒåŸå‹è¨­è¨ˆæ¨¡å¼è¦æ±‚æ‚¨æ­£åœ¨å¾©åˆ¶çš„å°è±¡æ‡‰æä¾›è¤‡è£½åŠŸèƒ½ã€‚é¡¯ç„¶ï¼Œå®ƒä¸æ‡‰è©²ç”±ä»»ä½•å…¶ä»–é¡ä¾†å®Œæˆã€‚ä½†æ˜¯ï¼Œæ˜¯ä½¿ç”¨ Object å±¬æ€§çš„æ·ºæ‹·è²é‚„æ˜¯æ·±æ‹·è²å–æ±ºæ–¼éœ€æ±‚ï¼Œé€™æ˜¯ä¸€å€‹è¨­è¨ˆæ±ºå®šã€‚\nä¾‹å¦‚ï¼Œè®“æˆ‘å€‘çœ‹çœ‹é€™æœ‰ä»€éº¼ç”¨è™•ã€‚å¦‚æœå‰µå»ºåŸå§‹å°è±¡æ™‚ä½¿ç”¨çš„è³‡æºï¼ˆä¾‹å¦‚æ•¸æ“šæµï¼‰åœ¨éœ€è¦å°è±¡å…‹éš†æ™‚å¯èƒ½ä¸å¯ç”¨ã€‚å¦ä¸€å€‹ä¾‹å­æ˜¯ï¼Œå¦‚æœåŸå§‹å°è±¡å‰µå»ºæ¶‰åŠå¤§é‡æ™‚é–“æŠ•å…¥ï¼Œä¾‹å¦‚å¾æ•¸æ“šåº«æˆ–é€šéç¶²çµ¡è®€å–æ•¸æ“šã€‚\nobject clone åˆ©ç”¨ clone() æ–¹æ³•å’Œ implements Cloneable interfaceã€‚é»˜èªæƒ…æ³ä¸‹ï¼Œclone() åŸ·è¡Œæ·ºæ‹·è²ã€‚æ­¤å¤–ï¼ŒSerializable å¯ç”¨æ–¼ç°¡åŒ–æ·±åº¦è¤‡è£½ã€‚ BTW, å¯ä»¥å¯¦ç¾è‡ªå·±çš„åŸå‹æ¨¡å¼ã€‚ç‚ºæ­¤ï¼Œå‰µå»ºä¸€å€‹å…·æœ‰ doClone () æ–¹æ³•çš„ Prototype æ¥å£ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class Pc implements Cloneable { private String keyboard; private String mouse; private String screen; public Pc() { keyboard = \u0026#34;æ©Ÿæ¢°\u0026#34;; mouse = \u0026#34;ç¾…æŠ€\u0026#34;; screen = \u0026#34;Dell\u0026#34;; } public Pc clone(){ return new Pc(); } public void makeAmericaStyle(){ keyboard = \u0026#34;Magic Keyboard\u0026#34;; mouse = \u0026#34;Apple Mouse\u0026#34;; screen = \u0026#34;Apple Screen\u0026#34;; } public String getMouse(){ return mouse; } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class PrototypeTest { public Bike getUSAPc(Pc basicPc){ pc.makeAmericaStyle(); return basicBike; } public static void main(String[] args) { Pc pc = new Pc(); Pc basicPc = pc.clone(); PrototypeTest prototype = new PrototypeTest(); Pc americaPc = prototype.getUSAPc(basicPc); System.out.println(\u0026#34;overwrite method \u0026#34; + americaPc.getMouse()); System.out.println(\u0026#34;all attribute\u0026#34; + americaPc.toString()); } } ç•¶åœ¨é‹è¡Œæ™‚æŒ‡å®šè¦å¯¦ä¾‹åŒ–çš„é¡æ™‚ï¼Œä¾‹å¦‚ï¼Œé€šéå‹•æ…‹åŠ è¼‰ é¿å…å»ºç«‹èˆ‡ç”¢å“é¡å±¤æ¬¡çµæ§‹å¹³è¡Œçš„å·¥å» é¡å±¤æ¬¡çµæ§‹ ç•¶é¡çš„å¯¦ä¾‹å¯ä»¥å…·æœ‰åƒ…æœ‰çš„å¹¾ç¨®ä¸åŒç‹€æ…‹çµ„åˆä¹‹ä¸€æ™‚ã€‚ä½†æ˜¯ï¼Œå®‰è£ç›¸æ‡‰æ•¸é‡çš„åŸå‹ä¸¦å…‹éš†å®ƒå€‘å¯èƒ½æ›´æ–¹ä¾¿ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ä½¿ç”¨é©ç•¶çš„ç‹€æ…‹æ‰‹å‹•å¯¦ä¾‹åŒ–é¡ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/prototype/","tags":[],"title":"DesignPattern - Basic - Prototype"},{"content":"Builder å°è±¡æ§‹é€ çš„ç´°ç¯€ï¼Œå¯¦ä¾‹åŒ–å’Œåˆå§‹åŒ–æ§‹æˆå°è±¡çš„çµ„ä»¶ï¼Œéƒ½ä¿å­˜åœ¨å°åƒä¸­ï¼Œé€šå¸¸ä½œç‚ºå…¶æ§‹é€ å‡½æ•¸çš„ä¸€éƒ¨åˆ†ã€‚é€™ç¨®é¡å‹çš„è¨­è¨ˆå°‡å°è±¡æ§‹é€ éç¨‹èˆ‡æ§‹æˆå°è±¡çš„çµ„ä»¶ç·Šå¯†è¯ç¹«åœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œåªè¦æ§‹é€ å°åƒç°¡å–®ï¼Œå°è±¡æ§‹é€ éç¨‹æ˜ç¢ºï¼Œä¸¦ä¸”ç¸½æ˜¯ç”¢ç”Ÿå°è±¡çš„ç›¸åŒè¡¨ç¤ºï¼Œé€™ç¨®æ–¹æ³•å°±é©ç”¨ã€‚\næ­¤å¤–ï¼Œç•¶è¢«å‰µå»ºçš„å°åƒå¾ˆè¤‡é›œä¸¦ä¸”æ§‹æˆå°è±¡å‰µå»ºéç¨‹çš„ä¸€ç³»åˆ—æ­¥é©Ÿå¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å¯¦ç¾æ™‚ï¼Œé€™ç¨®è¨­è¨ˆå¯èƒ½ç„¡æ•ˆã€‚å› æ­¤ï¼Œç”¢ç”Ÿå°è±¡çš„ä¸åŒè¡¨ç¤ºã€‚å› ç‚ºæ§‹é€ éç¨‹çš„ä¸åŒå¯¦ç¾éƒ½ä¿å­˜åœ¨å°åƒä¸­ï¼Œæ‰€ä»¥å°è±¡å¯èƒ½è®Šå¾—é¾å¤§ï¼ˆæ§‹é€ è†¨è„¹ï¼‰ä¸¦ä¸”æ¨¡å¡ŠåŒ–ç¨‹åº¦è¼ƒä½ã€‚éš¨å¾Œï¼Œæ·»åŠ æ–°å¯¦ç¾æˆ–æ›´æ”¹ç¾æœ‰å¯¦ç¾éœ€è¦æ›´æ”¹ç¾æœ‰ä»£ç¢¼ã€‚\nBuilder çš„ç›®çš„æ˜¯å°‡å¾©é›œå°è±¡çš„æ§‹é€ èˆ‡å…¶è¡¨ç¤ºåˆ†é›¢ï¼Œä»¥ä¾¿ç›¸åŒçš„æ§‹é€ éç¨‹å¯ä»¥å‰µå»ºä¸åŒçš„è¡¨ç¤ºã€‚é€™ç¨®é¡å‹çš„åˆ†é›¢æ¸›å°äº†å°è±¡çš„å¤§å°ã€‚è©²è¨­è¨ˆè®Šå¾—æ›´åŠ æ¨¡å¡ŠåŒ–ï¼Œæ¯å€‹å¯¦ç¾éƒ½åŒ…å«åœ¨ä¸åŒçš„æ§‹å»ºå™¨å°åƒä¸­ã€‚å› æ­¤ï¼Œæ·»åŠ ä¸€å€‹æ–°çš„å¯¦ç¾ï¼ˆå³æ·»åŠ ä¸€å€‹æ–°çš„æ§‹å»ºå™¨ï¼‰è®Šå¾—æ›´å®¹æ˜“äº†ã€‚æ­¤å¤–ï¼Œå°è±¡æ§‹é€ éç¨‹è®Šå¾—ç¨ç«‹æ–¼æ§‹æˆå°è±¡çš„çµ„ä»¶ã€‚é€™æä¾›äº†å°å°è±¡æ§‹é€ éç¨‹çš„æ›´å¤šæ§åˆ¶ã€‚\nå®ƒæŒ‡å®šäº†ä¸€å€‹æŠ½è±¡æ¥å£ï¼Œç”¨æ–¼å‰µå»º Product å°è±¡çš„å„å€‹éƒ¨åˆ†ã€‚æ§‹å»ºå™¨æ¨¡å¼å»ºè­°å°‡æ§‹å»ºé‚è¼¯å¾å°åƒé¡ç§»åˆ°ä¸€å€‹å–®ç¨çš„é¡ï¼Œç¨±ç‚ºæ§‹å»ºå™¨é¡ã€‚ä½†æ˜¯ï¼Œå¯ä»¥æœ‰å¤šå€‹é€™æ¨£çš„æ§‹å»ºå™¨é¡ï¼Œæ¯å€‹æ§‹å»ºå™¨é¡å°æ–¼æ§‹å»ºå°è±¡çš„ä¸€ç³»åˆ—æ­¥é©Ÿéƒ½æœ‰ä¸åŒçš„å¯¦ç¾ã€‚æ­¤å¤–ï¼Œæ¯å€‹æ§‹å»ºå™¨å¯¦ç¾éƒ½æœƒå°è‡´å°è±¡çš„ä¸åŒè¡¨ç¤ºã€‚\nConcreteBuilder é€šéå¯¦ç¾ Builder æ¥å£ä¾†æ§‹é€ å’Œçµ„è£ç”¢å“çš„å„å€‹éƒ¨åˆ†ã€‚ å®šç¾©ä¸¦è·Ÿè¸ªå®ƒå‰µå»ºçš„è¡¨ç¤ºã€‚ æä¾›ç”¨æ–¼æª¢ç´¢ç”¢å“çš„æ¥å£ã€‚ Director å®ƒä½¿ç”¨ Builder æ¥å£æ§‹é€ ä¸€å€‹å°è±¡ã€‚Builder æ¨¡å¼å»ºè­°ä½¿ç”¨ç¨±ç‚º Director çš„å°ˆç”¨å°è±¡ï¼Œå®ƒè² è²¬èª¿ç”¨æ§‹å»ºæœ€çµ‚å°è±¡æ‰€éœ€çš„ä¸åŒæ§‹å»ºå™¨æ–¹æ³•ã€‚æ­¤å¤–ï¼Œä¸åŒçš„å®¢æˆ¶ç«¯å°è±¡å¯ä»¥åˆ©ç”¨ Director å°è±¡ä¾†å‰µå»ºæ‰€éœ€çš„å°è±¡ã€‚ä¸€æ—¦æ§‹é€ äº†å°è±¡ï¼Œå®¢æˆ¶ç«¯å°è±¡å°±å¯ä»¥ç›´æ¥å‘æ§‹é€ å™¨è«‹æ±‚å®Œæ•´æ§‹é€ çš„å°è±¡ã€‚ç‚ºäº†æ–¹ä¾¿é€™å€‹éç¨‹ï¼Œå¯ä»¥åœ¨å…¬å…±Builderæ¥å£ä¸­è²æ˜ä¸€å€‹æ–°æ–¹æ³•getObject()ï¼Œç”±ä¸åŒçš„å…·é«”builderå¯¦ç¾ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 public interface PcBuilder { public void buildKeyboard(); public void buildMouse(); public void buildScreen(); public Pc getPc(); } public class Pc { private String keyboard; private String mouse; private String screen; // Getter / Setter / toString method } public class AcerPcBuilder implements PcBuilder { Pc pc; public AcerPcBuilder(){ pc = new Pc(); } @Override public void buildKeyboard() { pc.setKeyboard(\u0026#34;Acer keyyyyyyyyy\u0026#34;); } @Override public void buildMouse() { pc.setMouse(\u0026#34;Acer micky mouse\u0026#34;); } @Override public void buildScreen() { pc.setScreen(\u0026#34;Acer 24 inch screen\u0026#34;); } @Override public Pc getPc() { return pc; } } Director\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class PcDirector { private PcDirector pcDirector = null; public PcDirector(PcBuilder pcBuilder) { this.pcBuilder = pcBuilder; } public void constructPc() { pcBuilder.buildKeyboard(); pcBuilder.buildMouse(); pcBuilder.buildScreen(); } public Meal getPc(){ return pcBuilder.getPc(); } } 1 2 3 4 5 6 7 8 9 10 public static void main(String[] args) { PcBuilder acerPcBuilder = new AcerPcBuilder(); PcDirector pcDirector = new PcDirector(acerPcBuilder); pcDirector.constructPc(); Pc pc = pcDirector.getPc(); log.info(\u0026#34;acer pc builder ~\u0026#34;); } å…¶ä»–ç‰ˆæœ¬ Builder æœ‰ä¸€å€‹å…·æœ‰ä¸€é•·ä¸²å±¬æ€§çš„å°è±¡ã€‚é€™äº›å±¬æ€§ä¸­çš„å¤§å¤šæ•¸éƒ½æ˜¯å¯é¸çš„ã€‚ ç”¨æˆ¶ä¸æ˜¯ç›´æ¥å‰µå»ºæ‰€éœ€çš„å°è±¡ï¼Œè€Œæ˜¯èª¿ç”¨å…·æœ‰æ‰€æœ‰å¿…éœ€åƒæ•¸çš„æ§‹é€ å‡½æ•¸ä¸¦ç²å–æ§‹å»ºå™¨å°è±¡ã€‚ç„¶å¾Œï¼Œç”¨æˆ¶åœ¨æ§‹å»ºå™¨å°åƒä¸Šèª¿ç”¨é¡ä¼¼ setter çš„æ–¹æ³•ä¾†è¨­ç½®æ¯å€‹æ„Ÿèˆˆè¶£çš„å¯é¸åƒæ•¸ã€‚æœ€å¾Œï¼Œç”¨æˆ¶èª¿ç”¨ç„¡åƒæ•¸æ§‹å»ºæ–¹æ³•ä¾†ç”Ÿæˆå°è±¡ã€‚\néœ€è¦å‰µå»ºä¸€å€‹éœæ…‹é¡ï¼Œç„¶å¾Œå°‡æ‰€æœ‰åƒæ•¸å¾å¤–éƒ¨é¡è¤‡è£½åˆ° Builder é¡ã€‚ æ¥ä¸‹ä¾†ï¼ŒBuilder é¡æ‡‰è©²æœ‰ä¸€å€‹å…¬å…±æ§‹é€ å‡½æ•¸ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å¿…éœ€çš„å±¬æ€§ä½œç‚ºåƒæ•¸ã€‚ Builder é¡æ‡‰è©²å…·æœ‰è¨­ç½®å¯é¸åƒæ•¸çš„æ–¹æ³•ï¼Œä¸¦ä¸”åœ¨è¨­ç½®å¯é¸å±¬æ€§å¾Œå®ƒæ‡‰è©²è¿”å›ç›¸åŒçš„ Builder å°è±¡ã€‚ æœ€å¾Œï¼Œæˆ‘å€‘éœ€è¦åœ¨æ§‹å»ºå™¨é¡ä¸­æä¾›ä¸€å€‹ build() æ–¹æ³•ï¼Œè©²æ–¹æ³•å°‡è¿”å›å®¢æˆ¶ç«¯ç¨‹åºæ‰€éœ€çš„ Objectã€‚ ç‚ºäº†åšåˆ°é€™ä¸€é»ï¼Œéœ€è¦åœ¨ Class ä¸­æœ‰ä¸€å€‹ä»¥ Builder é¡ä½œç‚ºåƒæ•¸çš„ç§æœ‰æ§‹é€ å‡½æ•¸ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 public class Pc{ private final String keyboard; private final String mouse; private final String screen; private final int screenCount; private final double price; // in real case, you should use BigDecimal XD public static class Builder { private String keyboard; private String mouse; private String screen; private int screenCount; private double price; //builder methods for setter public Builder keyboard(String keyboard){this.keyboard = keyboard; return this; } public Builder mouse(String mouse){this.butter = cup; return this; } public Builder screen(String screen){this.eggs = number; return this; } public Builder screenCount(int screenCount){this.vanila = spoon; return this; } public Builder price(double price){this.flour = cup; return this; } // already build object public Pc build() { return new Pc(this); } } //private constructor to enforce object creation through builder private Pc(Builder builder) { this.keyboard = builder.keyboard; this.mouse = builder.mouse; this.screen = builder.screen; this.screenCount = builder.screenCount; this.price = builder.price; } } 1 2 3 4 5 6 7 8 public static void main(String[] args) { Pc pc = new Pc.Builder().keyboard(\u0026#34;æ©Ÿæ¢°éµç›¤\u0026#34;).mouse(\u0026#34;ç¾…æŠ€\u0026#34;).screen(\u0026#34;Dell\u0026#34;).build(); log.info(\u0026#34;pc: {}\u0026#34;, pc); } ä½•æ™‚å‰µå»ºè¤‡é›œå°è±¡çš„ç®—æ³•æ‡‰è©²ç¨ç«‹æ–¼æ§‹æˆå°è±¡çš„éƒ¨åˆ†ä»¥åŠå®ƒå€‘çš„çµ„è£æ–¹å¼ã€‚ ç•¶æ§‹é€ éç¨‹å¿…é ˆå…è¨±æ§‹é€ å°è±¡çš„ä¸åŒè¡¨ç¤ºæ™‚ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/builder/","tags":[],"title":"DesignPattern  - Basic - Builder"},{"content":"Factory ä¸€å€‹å…·æœ‰å¤šå€‹å­é¡çš„çˆ¶é¡åˆ¥ä¸¦ä¸”åŸºæ–¼è¼¸å…¥ï¼Œæˆ‘å€‘éœ€è¦è¿”å›å…¶ä¸­ä¸€å€‹å­é¡æ™‚ï¼Œä½¿ç”¨å·¥å» è¨­è¨ˆæ¨¡å¼ã€‚é€™ç¨®æ¨¡å¼å°‡é¡å¾å®¢æˆ¶ç«¯ç¨‹åºå¯¦ä¾‹åŒ–åˆ°å·¥å» é¡çš„è²¬ä»»ã€‚ å·¥å» æ¨¡å¼ä¸­çš„è¶…é¡å¯ä»¥æ˜¯ interfaceï¼Œä¹Ÿå¯ä»¥æ˜¯ abstract classï¼Œä¹Ÿå¯ä»¥æ˜¯æ™®é€šçš„ Java classã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 public interface ICellPhone { public void open(); public void close(); public void call(); } public class ApplePhone implements ICellPhone { @Override public void open() { System.out.println(\u0026#34;apple open\u0026#34;); } @Override public void close() { System.out.println(\u0026#34;apple close\u0026#34;); } @Override public void call() { System.out.println(\u0026#34;apple phone call David\u0026#34;); } } public class SamsungPhone implements ICellPhone { @Override public void open() { // ... } @Override public void close() { // ... } @Override public void call() { // ... } } Factory\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class CellPhoneFactory { public CellPhoneFactory(){ } ICellPhone createCellPhone(String type){ ICellPhone cellPhone = null; if(\u0026#34;apple\u0026#34;.equalsIgnoreCase(type)){ cellPhone = new ApplePhone(); System.out.println(\u0026#34;apple cell phone created\u0026#34;); }else if(\u0026#34;samsung\u0026#34;.equalsIgnoreCase(type)){ cellPhone = new SamsungPhone(); System.out.println(\u0026#34;three start cell phone created\u0026#34;); } return cellPhone; } } 1 2 3 4 5 6 7 8 9 10 public static void main(String[] args) { var factory = new CellPhoneFactory(); ApplePhone apple = (ApplePhone)factory.createCellPhone(\u0026#34;apple\u0026#34;); len.open(); SamsungPhone threeStarts = (SamsungPhone)factory.createCellPhone(\u0026#34;samsung\u0026#34;); sam.close(); } å°ç¯€\nå·¥å» æ¨¡å¼ç‚ºæ¥å£è€Œä¸æ˜¯å¯¦ç¾æä¾›äº†ä¸€ç¨®ä»£ç¢¼æ–¹æ³•ã€‚ å·¥å» æ¨¡å¼å¾å®¢æˆ¶ç«¯ä»£ç¢¼ä¸­åˆªé™¤äº†å¯¦éš›å¯¦ç¾é¡çš„å¯¦ä¾‹åŒ–ï¼Œä½¿å…¶æ›´å¥å£¯ã€è€¦åˆæ›´å°‘ä¸”æ˜“æ–¼æ“´å±•ã€‚ä¾‹å¦‚ï¼Œæˆ‘å€‘å¯ä»¥å¾ˆå®¹æ˜“åœ°æ›´æ”¹é¡çš„å¯¦ç¾ï¼Œå› ç‚ºå®¢æˆ¶ç«¯ä¸çŸ¥é“å®ƒã€‚ å·¥å» æ¨¡å¼é‚„é€šéç¹¼æ‰¿åœ¨å¯¦ç¾é¡å’Œå®¢æˆ¶ç«¯é¡ä¹‹é–“æä¾›æŠ½è±¡ã€‚ Abstract Factory å¹¾ä¹é¡ä¼¼æ–¼ å·¥å» æ¨¡å¼ï¼Œé™¤äº†å®ƒæ›´åƒå·¥å» çš„å·¥å» ã€‚ ä¸€å€‹ Factory é¡ï¼Œå®ƒæ ¹æ“šæä¾›çš„è¼¸å…¥è¿”å›ä¸åŒçš„å­é¡ã€‚é€šå¸¸ï¼Œå·¥å» é¡ä½¿ç”¨ if-else æˆ– switch-case èªå¥ä¾†å¯¦ç¾é€™ä¸€é»ã€‚ ä½†æ˜¯ï¼Œåœ¨æŠ½è±¡å·¥å» æ¨¡å¼ä¸­ï¼Œæ“ºè„«äº† if-else å¡Šï¼Œä¸¦ç‚ºæ¯å€‹å­é¡å‰µå»ºäº†ä¸€å€‹å·¥å» é¡ï¼Œç„¶å¾Œæ˜¯ä¸€å€‹æŠ½è±¡å·¥å» é¡ï¼Œè©²é¡å°‡æ ¹æ“šè¼¸å…¥å·¥å» é¡è¿”å›å­é¡ã€‚\nå¯¦éš›ä¸Šï¼ŒæŠ½è±¡å·¥å» å°±æ˜¯è¿”å›å·¥å» çš„å·¥å» ã€‚ç‚ºä»€éº¼é€™å€‹æŠ½è±¡å±¤æœ‰ç”¨ï¼Ÿæ™®é€šå·¥å» å¯ç”¨æ–¼å‰µå»ºç›¸é—œå°è±¡é›†ã€‚æŠ½è±¡å·¥å» è¿”å›å·¥å» ã€‚å› æ­¤ï¼ŒæŠ½è±¡å·¥å» ç”¨æ–¼è¿”å›å¯ç”¨æ–¼å‰µå»ºç›¸é—œå°è±¡é›†çš„å·¥å» ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public interface ICellPhoneFactory { ICellPhoneFactory createPhone(String type); } // æŠ½è±¡å·¥å»  =\u0026gt; ç”Ÿç”¢å·¥å»  public class CellPhoneFactory implements ICellPhoneFactory { @Override ICellPhoneFactory createPhone(String type){ ICellPhoneFactory cellPhoneFactory = null; if(\u0026#34;apple\u0026#34;.equalsIgnoreCase(type)){ cellPhoneFactory = new AppleCellPhoneFactory(); System.out.println(\u0026#34;apple factory created\u0026#34;); }else if(\u0026#34;samsung\u0026#34;.equalsIgnoreCase(type)){ cellPhoneFactory = new AppleCellPhoneFactory(); System.out.println(\u0026#34;three start factory created\u0026#34;); } return cellPhone; } } 1 2 3 4 5 6 7 public class AppleCellPhoneFactory extends CellPhoneFactory { AppleCellPhone createApplePhone(){ return new AppleCellPhone(); } } 1 2 3 4 5 6 7 8 9 10 public class AbstractFactoryTest { public static void main(String[] args) { CellPhoneFactory factory = new CellPhoneFactory(); AppleCellPhoneFactory apple = (AppleCellPhoneFactory)factory.createPhone(\u0026#34;apple\u0026#34;); AppleCellPhone apple = (AppleCellPhone)apple.createApplePhone(); apple.call(); } } æŠ½è±¡å·¥å» æ¨¡å¼é‚„æä¾›äº†ä¸€ç¨®ç‚ºæ¥å£è€Œä¸æ˜¯å¯¦ç¾ç·¨å¯«ä»£ç¢¼çš„æ–¹æ³•ã€‚ å·¥å» æ¨¡å¼æ˜¯ \u0026ldquo;å·¥å» ä¸­çš„å·¥å» \u0026rdquo;ï¼Œå¯ä»¥è¼•é¬†æ“´å±•ä»¥å®¹ç´æ›´å¤šç”¢å“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ å¦ä¸€å€‹å­é¡ \u0026ldquo;HTC\u0026rdquo; å’Œå·¥å»  \u0026ldquo;TwCellPhoneFactory\u0026rdquo;ã€‚ æŠ½è±¡å·¥å» æ¨¡å¼æ˜¯å¼·å¤§çš„ï¼Œå®ƒæ¶ˆé™¤äº†èˆ‡å·¥å» æ¨¡å¼ä¸åŒçš„æ¢ä»¶é‚è¼¯ã€‚ ","permalink":"https://xinqilin.github.io/post/architecture/factory/","tags":[],"title":"DesignPattern - Basic - Factory"},{"content":"æ¦‚è¿° Singletonï¼ˆå–®ä¾‹æ¨¡å¼ï¼‰æ˜¯æœ€å¸¸è¦‹çš„å‰µå»ºå‹è¨­è¨ˆæ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒç¢ºä¿ä¸€å€‹é¡åˆ¥åœ¨æ•´å€‹æ‡‰ç”¨ç¨‹å¼ç”Ÿå‘½é€±æœŸä¸­åªæœ‰ä¸€å€‹å¯¦ä¾‹å­˜åœ¨ï¼Œä¸¦æä¾›å…¨åŸŸè¨ªå•é»ã€‚é€™å€‹æ¨¡å¼å»£æ³›æ‡‰ç”¨æ–¼è³‡æ–™åº«é€£ç·šæ± ã€æ—¥å¿—è¨˜éŒ„å™¨ã€å¿«å–ç®¡ç†å™¨ã€è¨­å®šç®¡ç†å™¨ç­‰å ´æ™¯ã€‚\nå–®ä¾‹æ¨¡å¼çš„æ ¸å¿ƒç‰¹å¾µ å”¯ä¸€å¯¦ä¾‹ï¼šç¢ºä¿é¡åˆ¥åªæœ‰ä¸€å€‹å¯¦ä¾‹ å…¨åŸŸè¨ªå•ï¼šæä¾›å…¨åŸŸè¨ªå•è©²å¯¦ä¾‹çš„æ–¹æ³• è‡ªæˆ‘å¯¦ä¾‹åŒ–ï¼šé¡åˆ¥è‡ªå·±è² è²¬å‰µå»ºå’Œç®¡ç†å¯¦ä¾‹ å»¶é²åˆå§‹åŒ–ï¼šé€šå¸¸åœ¨é¦–æ¬¡éœ€è¦æ™‚æ‰å‰µå»ºå¯¦ä¾‹ å‚³çµ±å¯¦ä½œæ–¹å¼ 1. é¤“æ¼¢å¼ï¼ˆEager Initializationï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 /** * é¤“æ¼¢å¼å–®ä¾‹ - é¡åˆ¥è¼‰å…¥æ™‚ç«‹å³å‰µå»ºå¯¦ä¾‹ * å„ªé»ï¼šåŸ·è¡Œç·’å®‰å…¨ã€å¯¦ä½œç°¡å–® * ç¼ºé»ï¼šä¸ç®¡æ˜¯å¦ä½¿ç”¨éƒ½æœƒå‰µå»ºå¯¦ä¾‹ï¼Œå¯èƒ½é€ æˆè³‡æºæµªè²» */ public class EagerSingleton { // åœ¨é¡åˆ¥è¼‰å…¥æ™‚å°±å‰µå»ºå¯¦ä¾‹ private static final EagerSingleton INSTANCE = new EagerSingleton(); // ç§æœ‰å»ºæ§‹å­é˜²æ­¢å¤–éƒ¨å¯¦ä¾‹åŒ– private EagerSingleton() { // é˜²æ­¢åå°„æ”»æ“Š if (INSTANCE != null) { throw new IllegalStateException(\u0026#34;å–®ä¾‹å·²å­˜åœ¨ï¼Œä¸èƒ½å‰µå»ºæ–°å¯¦ä¾‹\u0026#34;); } System.out.println(\u0026#34;EagerSingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } public static EagerSingleton getInstance() { return INSTANCE; } // æ¥­å‹™æ–¹æ³•ç¯„ä¾‹ public void doSomething() { System.out.println(\u0026#34;åŸ·è¡Œ EagerSingleton æ¥­å‹™é‚è¼¯\u0026#34;); } // é˜²æ­¢å…‹éš†æ”»æ“Š @Override protected Object clone() throws CloneNotSupportedException { throw new CloneNotSupportedException(\u0026#34;å–®ä¾‹ä¸æ”¯æ´å…‹éš†\u0026#34;); } // é˜²æ­¢åºåˆ—åŒ–æ”»æ“Š private Object readResolve() { return INSTANCE; } } 2. æ‡¶æ¼¢å¼ï¼ˆLazy Initializationï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /** * æ‡¶æ¼¢å¼å–®ä¾‹ - å»¶é²å‰µå»ºå¯¦ä¾‹ * å•é¡Œï¼šåŸ·è¡Œç·’ä¸å®‰å…¨ */ public class LazySingleton { private static LazySingleton instance; private LazySingleton() { System.out.println(\u0026#34;LazySingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } // âŒ åŸ·è¡Œç·’ä¸å®‰å…¨çš„å¯¦ä½œ public static LazySingleton getInstance() { if (instance == null) { instance = new LazySingleton(); } return instance; } } 3. åŸ·è¡Œç·’å®‰å…¨çš„æ‡¶æ¼¢å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /** * åŸ·è¡Œç·’å®‰å…¨çš„æ‡¶æ¼¢å¼å–®ä¾‹ * å„ªé»ï¼šåŸ·è¡Œç·’å®‰å…¨ã€å»¶é²åˆå§‹åŒ– * ç¼ºé»ï¼šæ€§èƒ½é–‹éŠ·å¤§ï¼ˆæ¯æ¬¡è¨ªå•éƒ½éœ€è¦åŒæ­¥ï¼‰ */ public class ThreadSafeLazySingleton { private static ThreadSafeLazySingleton instance; private ThreadSafeLazySingleton() { System.out.println(\u0026#34;ThreadSafeLazySingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } // âŒ æ€§èƒ½è¼ƒå·®çš„åŒæ­¥æ–¹æ³• public static synchronized ThreadSafeLazySingleton getInstance() { if (instance == null) { instance = new ThreadSafeLazySingleton(); } return instance; } } æ¨è–¦çš„ç¾ä»£åŒ–å¯¦ä½œæ–¹å¼ 1. Double-Checked Lockingï¼ˆé›™é‡æª¢æŸ¥é–å®šï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 /** * é›™é‡æª¢æŸ¥é–å®šå–®ä¾‹ * å„ªé»ï¼šåŸ·è¡Œç·’å®‰å…¨ã€æ€§èƒ½å¥½ã€å»¶é²åˆå§‹åŒ– * æ¨è–¦ï¼šç¾ä»£ Java æ‡‰ç”¨çš„æ¨™æº–å¯¦ä½œ */ public class DoubleCheckedSingleton { // volatile é—œéµå­—ç¢ºä¿å¯è¦‹æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åº private static volatile DoubleCheckedSingleton instance; private DoubleCheckedSingleton() { // é˜²æ­¢åå°„æ”»æ“Š if (instance != null) { throw new IllegalStateException(\u0026#34;å–®ä¾‹å·²å­˜åœ¨ï¼Œä¸èƒ½å‰µå»ºæ–°å¯¦ä¾‹\u0026#34;); } // æ¨¡æ“¬è¤‡é›œçš„åˆå§‹åŒ–éç¨‹ try { Thread.sleep(100); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } System.out.println(\u0026#34;DoubleCheckedSingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } public static DoubleCheckedSingleton getInstance() { // ç¬¬ä¸€æ¬¡æª¢æŸ¥ï¼šé¿å…ä¸å¿…è¦çš„åŒæ­¥ if (instance == null) { synchronized (DoubleCheckedSingleton.class) { // ç¬¬äºŒæ¬¡æª¢æŸ¥ï¼šç¢ºä¿åªå‰µå»ºä¸€å€‹å¯¦ä¾‹ if (instance == null) { instance = new DoubleCheckedSingleton(); } } } return instance; } public void performOperation() { System.out.println(\u0026#34;åŸ·è¡Œ DoubleCheckedSingleton æ“ä½œ\u0026#34;); } // é˜²æ­¢å…‹éš†æ”»æ“Š @Override protected Object clone() throws CloneNotSupportedException { throw new CloneNotSupportedException(\u0026#34;å–®ä¾‹ä¸æ”¯æ´å…‹éš†\u0026#34;); } // é˜²æ­¢åºåˆ—åŒ–æ”»æ“Š private Object readResolve() { return instance; } } 2. éœæ…‹å…§éƒ¨é¡åˆ¥ï¼ˆInitialization-on-demand Holderï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 /** * éœæ…‹å…§éƒ¨é¡åˆ¥å–®ä¾‹ * å„ªé»ï¼šåŸ·è¡Œç·’å®‰å…¨ã€å»¶é²åˆå§‹åŒ–ã€æ€§èƒ½æœ€ä½³ã€ç¨‹å¼ç¢¼ç°¡æ½” * æ¨è–¦ï¼šæœ€å„ªé›…çš„å¯¦ä½œæ–¹å¼ */ public class StaticHolderSingleton { private StaticHolderSingleton() { System.out.println(\u0026#34;StaticHolderSingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } // éœæ…‹å…§éƒ¨é¡åˆ¥ï¼Œåªæœ‰åœ¨è¢«å¼•ç”¨æ™‚æ‰æœƒè¼‰å…¥ private static class SingletonHolder { private static final StaticHolderSingleton INSTANCE = new StaticHolderSingleton(); } public static StaticHolderSingleton getInstance() { return SingletonHolder.INSTANCE; } public void executeTask() { System.out.println(\u0026#34;åŸ·è¡Œ StaticHolderSingleton ä»»å‹™\u0026#34;); } } 3. æšèˆ‰å–®ä¾‹ï¼ˆæ¨è–¦ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 /** * æšèˆ‰å–®ä¾‹ * å„ªé»ï¼šåŸ·è¡Œç·’å®‰å…¨ã€é˜²æ­¢åå°„å’Œåºåˆ—åŒ–æ”»æ“Šã€ç¨‹å¼ç¢¼æœ€ç°¡æ½” * æ¨è–¦ï¼šJoshua Bloch æ¨è–¦çš„æœ€ä½³å¯¦ä½œæ–¹å¼ */ public enum EnumSingleton { INSTANCE; // å¯¦ä¾‹è®Šæ•¸ private String data; // å»ºæ§‹å­ï¼ˆæšèˆ‰çš„å»ºæ§‹å­ç¸½æ˜¯ç§æœ‰çš„ï¼‰ EnumSingleton() { this.data = \u0026#34;EnumSingleton åˆå§‹åŒ–è³‡æ–™\u0026#34;; System.out.println(\u0026#34;EnumSingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } // æ¥­å‹™æ–¹æ³• public void setData(String data) { this.data = data; } public String getData() { return data; } public void processData() { System.out.println(\u0026#34;è™•ç†è³‡æ–™: \u0026#34; + data); } // å¯ä»¥å¯¦ä½œä»‹é¢ public void performAction() { System.out.println(\u0026#34;åŸ·è¡Œ EnumSingleton å‹•ä½œ\u0026#34;); } } // ä½¿ç”¨ç¯„ä¾‹ class EnumSingletonExample { public static void main(String[] args) { EnumSingleton singleton = EnumSingleton.INSTANCE; singleton.setData(\u0026#34;æ›´æ–°çš„è³‡æ–™\u0026#34;); singleton.processData(); } } å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹ 1. è³‡æ–™åº«é€£ç·šç®¡ç†å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 /** * è³‡æ–™åº«é€£ç·šç®¡ç†å™¨å–®ä¾‹ * ä½¿ç”¨éœæ…‹å…§éƒ¨é¡åˆ¥å¯¦ä½œ */ public class DatabaseManager { private final HikariDataSource dataSource; private DatabaseManager() { // åˆå§‹åŒ–é€£ç·šæ± é…ç½® HikariConfig config = new HikariConfig(); config.setJdbcUrl(\u0026#34;jdbc:mysql://localhost:3306/mydb\u0026#34;); config.setUsername(\u0026#34;user\u0026#34;); config.setPassword(\u0026#34;password\u0026#34;); config.setMaximumPoolSize(20); config.setMinimumIdle(5); config.setConnectionTimeout(30000); config.setIdleTimeout(600000); config.setMaxLifetime(1800000); this.dataSource = new HikariDataSource(config); System.out.println(\u0026#34;è³‡æ–™åº«é€£ç·šæ± åˆå§‹åŒ–å®Œæˆ\u0026#34;); } private static class Holder { private static final DatabaseManager INSTANCE = new DatabaseManager(); } public static DatabaseManager getInstance() { return Holder.INSTANCE; } public Connection getConnection() throws SQLException { return dataSource.getConnection(); } public void closeDataSource() { if (dataSource != null \u0026amp;\u0026amp; !dataSource.isClosed()) { dataSource.close(); System.out.println(\u0026#34;è³‡æ–™åº«é€£ç·šæ± å·²é—œé–‰\u0026#34;); } } // JVM é—œé–‰æ™‚æ¸…ç†è³‡æº static { Runtime.getRuntime().addShutdownHook(new Thread(() -\u0026gt; { DatabaseManager.getInstance().closeDataSource(); })); } } 2. æ‡‰ç”¨ç¨‹å¼è¨­å®šç®¡ç†å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 /** * æ‡‰ç”¨ç¨‹å¼è¨­å®šç®¡ç†å™¨ * ä½¿ç”¨æšèˆ‰å¯¦ä½œï¼Œæ”¯æ´å‹•æ…‹è¨­å®šæ›´æ–° */ public enum ConfigurationManager { INSTANCE; private final Properties properties; private final Map\u0026lt;String, Object\u0026gt; runtimeConfig; private final ReadWriteLock lock; ConfigurationManager() { this.properties = new Properties(); this.runtimeConfig = new ConcurrentHashMap\u0026lt;\u0026gt;(); this.lock = new ReentrantReadWriteLock(); loadConfiguration(); } private void loadConfiguration() { try (InputStream input = getClass().getClassLoader() .getResourceAsStream(\u0026#34;application.properties\u0026#34;)) { if (input != null) { properties.load(input); System.out.println(\u0026#34;è¨­å®šæª”è¼‰å…¥å®Œæˆ\u0026#34;); } else { System.out.println(\u0026#34;æ‰¾ä¸åˆ°è¨­å®šæª”ï¼Œä½¿ç”¨é è¨­è¨­å®š\u0026#34;); loadDefaultConfiguration(); } } catch (IOException e) { System.err.println(\u0026#34;è¼‰å…¥è¨­å®šæª”å¤±æ•—: \u0026#34; + e.getMessage()); loadDefaultConfiguration(); } } private void loadDefaultConfiguration() { properties.setProperty(\u0026#34;app.name\u0026#34;, \u0026#34;MyApplication\u0026#34;); properties.setProperty(\u0026#34;app.version\u0026#34;, \u0026#34;1.0.0\u0026#34;); properties.setProperty(\u0026#34;app.environment\u0026#34;, \u0026#34;development\u0026#34;); properties.setProperty(\u0026#34;database.pool.max\u0026#34;, \u0026#34;20\u0026#34;); properties.setProperty(\u0026#34;cache.ttl\u0026#34;, \u0026#34;3600\u0026#34;); } public String getProperty(String key) { lock.readLock().lock(); try { return properties.getProperty(key); } finally { lock.readLock().unlock(); } } public String getProperty(String key, String defaultValue) { lock.readLock().lock(); try { return properties.getProperty(key, defaultValue); } finally { lock.readLock().unlock(); } } public void setProperty(String key, String value) { lock.writeLock().lock(); try { properties.setProperty(key, value); System.out.println(\u0026#34;è¨­å®šå·²æ›´æ–°: \u0026#34; + key + \u0026#34; = \u0026#34; + value); } finally { lock.writeLock().unlock(); } } public int getIntProperty(String key, int defaultValue) { try { String value = getProperty(key); return value != null ? Integer.parseInt(value) : defaultValue; } catch (NumberFormatException e) { return defaultValue; } } public boolean getBooleanProperty(String key, boolean defaultValue) { String value = getProperty(key); return value != null ? Boolean.parseBoolean(value) : defaultValue; } // åŸ·è¡Œæ™‚è¨­å®šï¼ˆä¸æœƒæŒä¹…åŒ–ï¼‰ public void setRuntimeConfig(String key, Object value) { runtimeConfig.put(key, value); } @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public \u0026lt;T\u0026gt; T getRuntimeConfig(String key, Class\u0026lt;T\u0026gt; type, T defaultValue) { Object value = runtimeConfig.get(key); return type.isInstance(value) ? (T) value : defaultValue; } public void reloadConfiguration() { lock.writeLock().lock(); try { properties.clear(); loadConfiguration(); System.out.println(\u0026#34;è¨­å®šå·²é‡æ–°è¼‰å…¥\u0026#34;); } finally { lock.writeLock().unlock(); } } public Map\u0026lt;String, String\u0026gt; getAllProperties() { lock.readLock().lock(); try { Map\u0026lt;String, String\u0026gt; result = new HashMap\u0026lt;\u0026gt;(); for (String key : properties.stringPropertyNames()) { result.put(key, properties.getProperty(key)); } return result; } finally { lock.readLock().unlock(); } } } 3. æ—¥å¿—ç®¡ç†å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 /** * è‡ªè¨‚æ—¥å¿—ç®¡ç†å™¨å–®ä¾‹ * ä½¿ç”¨é›™é‡æª¢æŸ¥é–å®šå¯¦ä½œ */ public class LoggerManager { private static volatile LoggerManager instance; private final Map\u0026lt;String, Logger\u0026gt; loggers; private final String logLevel; private final boolean enableConsoleOutput; private final String logFilePath; private LoggerManager() { this.loggers = new ConcurrentHashMap\u0026lt;\u0026gt;(); // å¾è¨­å®šç®¡ç†å™¨ç²å–è¨­å®š ConfigurationManager config = ConfigurationManager.INSTANCE; this.logLevel = config.getProperty(\u0026#34;log.level\u0026#34;, \u0026#34;INFO\u0026#34;); this.enableConsoleOutput = config.getBooleanProperty(\u0026#34;log.console.enabled\u0026#34;, true); this.logFilePath = config.getProperty(\u0026#34;log.file.path\u0026#34;, \u0026#34;logs/application.log\u0026#34;); initializeLoggers(); System.out.println(\u0026#34;æ—¥å¿—ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ\u0026#34;); } public static LoggerManager getInstance() { if (instance == null) { synchronized (LoggerManager.class) { if (instance == null) { instance = new LoggerManager(); } } } return instance; } private void initializeLoggers() { // åˆå§‹åŒ–é è¨­æ—¥å¿—è¨˜éŒ„å™¨ createLogger(\u0026#34;DEFAULT\u0026#34;); createLogger(\u0026#34;DATABASE\u0026#34;); createLogger(\u0026#34;SECURITY\u0026#34;); createLogger(\u0026#34;PERFORMANCE\u0026#34;); } public Logger getLogger(String name) { return loggers.computeIfAbsent(name, this::createLogger); } private Logger createLogger(String name) { Logger logger = LoggerFactory.getLogger(name); // é€™è£¡å¯ä»¥æ ¹æ“šéœ€è¦é…ç½® logger çš„ appender å’Œ level // å¯¦éš›æ‡‰ç”¨ä¸­é€šå¸¸ä½¿ç”¨ logback.xml æˆ– log4j2.xml é…ç½® System.out.println(\u0026#34;å‰µå»º Logger: \u0026#34; + name); return logger; } public void logInfo(String loggerName, String message) { getLogger(loggerName).info(message); } public void logError(String loggerName, String message, Throwable throwable) { getLogger(loggerName).error(message, throwable); } public void logDebug(String loggerName, String message) { getLogger(loggerName).debug(message); } public void logWarn(String loggerName, String message) { getLogger(loggerName).warn(message); } // ç²å–æ‰€æœ‰ logger çš„çµ±è¨ˆè³‡è¨Š public Map\u0026lt;String, String\u0026gt; getLoggerStats() { Map\u0026lt;String, String\u0026gt; stats = new HashMap\u0026lt;\u0026gt;(); stats.put(\u0026#34;totalLoggers\u0026#34;, String.valueOf(loggers.size())); stats.put(\u0026#34;logLevel\u0026#34;, logLevel); stats.put(\u0026#34;consoleOutput\u0026#34;, String.valueOf(enableConsoleOutput)); stats.put(\u0026#34;logFilePath\u0026#34;, logFilePath); return stats; } } Spring æ¡†æ¶ä¸­çš„å–®ä¾‹æ¨¡å¼ 1. Spring Bean çš„å–®ä¾‹ä½œç”¨åŸŸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 /** * Spring ä¸­çš„å–®ä¾‹ Bean * Spring é è¨­ä½¿ç”¨å–®ä¾‹ä½œç”¨åŸŸç®¡ç† Bean */ @Component @Scope(ConfigurableBeanFactory.SCOPE_SINGLETON) // é è¨­å€¼ï¼Œå¯çœç•¥ public class SpringSingletonService { private final String instanceId; private final LocalDateTime createdAt; public SpringSingletonService() { this.instanceId = UUID.randomUUID().toString(); this.createdAt = LocalDateTime.now(); System.out.println(\u0026#34;SpringSingletonService å¯¦ä¾‹å‰µå»º: \u0026#34; + instanceId); } public String getInstanceInfo() { return String.format(\u0026#34;å¯¦ä¾‹ID: %s, å‰µå»ºæ™‚é–“: %s\u0026#34;, instanceId, createdAt); } @PostConstruct private void init() { System.out.println(\u0026#34;SpringSingletonService åˆå§‹åŒ–å®Œæˆ\u0026#34;); } @PreDestroy private void destroy() { System.out.println(\u0026#34;SpringSingletonService éŠ·æ¯€: \u0026#34; + instanceId); } } /** * ä½¿ç”¨ @Configuration å’Œ @Bean è¨»è§£å‰µå»ºå–®ä¾‹ */ @Configuration public class SingletonBeanConfiguration { @Bean @Scope(ConfigurableBeanFactory.SCOPE_SINGLETON) public CacheManager cacheManager() { return new ConcurrentMapCacheManager(\u0026#34;users\u0026#34;, \u0026#34;products\u0026#34;, \u0026#34;orders\u0026#34;); } @Bean public TaskExecutor taskExecutor() { ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.setCorePoolSize(5); executor.setMaxPoolSize(20); executor.setQueueCapacity(100); executor.setThreadNamePrefix(\u0026#34;App-\u0026#34;); executor.initialize(); return executor; } } 2. Spring Boot ä¸­çš„å–®ä¾‹æœå‹™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 /** * Spring Boot ä¸­çš„å–®ä¾‹æœå‹™ç¯„ä¾‹ */ @Service public class UserService { private final UserRepository userRepository; private final CacheManager cacheManager; private final String serviceId; public UserService(UserRepository userRepository, CacheManager cacheManager) { this.userRepository = userRepository; this.cacheManager = cacheManager; this.serviceId = UUID.randomUUID().toString(); System.out.println(\u0026#34;UserService å–®ä¾‹å‰µå»º: \u0026#34; + serviceId); } @Cacheable(\u0026#34;users\u0026#34;) public User findById(Long id) { System.out.println(\u0026#34;å¾è³‡æ–™åº«è¼‰å…¥ç”¨æˆ¶: \u0026#34; + id); return userRepository.findById(id).orElse(null); } @CacheEvict(value = \u0026#34;users\u0026#34;, key = \u0026#34;#user.id\u0026#34;) public User save(User user) { return userRepository.save(user); } public String getServiceInfo() { return \u0026#34;UserService å¯¦ä¾‹ID: \u0026#34; + serviceId; } } å–®ä¾‹æ¨¡å¼çš„æ½›åœ¨å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ 1. åå°„æ”»æ“Šé˜²è­· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 /** * é˜²ç¯„åå°„æ”»æ“Šçš„å–®ä¾‹å¯¦ä½œ */ public class ReflectionSafeSingleton { private static volatile ReflectionSafeSingleton instance; private static boolean instanceCreated = false; private ReflectionSafeSingleton() { synchronized (ReflectionSafeSingleton.class) { if (instanceCreated) { throw new IllegalStateException(\u0026#34;å–®ä¾‹å·²å­˜åœ¨ï¼Œç¦æ­¢é€éåå°„å‰µå»ºæ–°å¯¦ä¾‹\u0026#34;); } instanceCreated = true; } System.out.println(\u0026#34;ReflectionSafeSingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } public static ReflectionSafeSingleton getInstance() { if (instance == null) { synchronized (ReflectionSafeSingleton.class) { if (instance == null) { instance = new ReflectionSafeSingleton(); } } } return instance; } } // æ¸¬è©¦åå°„æ”»æ“Š class ReflectionAttackTest { public static void main(String[] args) { try { ReflectionSafeSingleton singleton1 = ReflectionSafeSingleton.getInstance(); Constructor\u0026lt;ReflectionSafeSingleton\u0026gt; constructor = ReflectionSafeSingleton.class.getDeclaredConstructor(); constructor.setAccessible(true); // é€™è£¡æœƒæ‹‹å‡º IllegalStateException ReflectionSafeSingleton singleton2 = constructor.newInstance(); } catch (Exception e) { System.out.println(\u0026#34;åå°„æ”»æ“Šè¢«é˜»æ­¢: \u0026#34; + e.getMessage()); } } } 2. åºåˆ—åŒ–æ”»æ“Šé˜²è­· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 /** * é˜²ç¯„åºåˆ—åŒ–æ”»æ“Šçš„å–®ä¾‹å¯¦ä½œ */ public class SerializationSafeSingleton implements Serializable { private static final long serialVersionUID = 1L; private static volatile SerializationSafeSingleton instance; private SerializationSafeSingleton() { System.out.println(\u0026#34;SerializationSafeSingleton å¯¦ä¾‹å‰µå»º\u0026#34;); } public static SerializationSafeSingleton getInstance() { if (instance == null) { synchronized (SerializationSafeSingleton.class) { if (instance == null) { instance = new SerializationSafeSingleton(); } } } return instance; } // é˜²æ­¢åºåˆ—åŒ–æ”»æ“Šçš„é—œéµæ–¹æ³• private Object readResolve() { return getInstance(); } // å¯é¸ï¼šè‡ªè¨‚åºåˆ—åŒ–é‚è¼¯ private void writeObject(ObjectOutputStream out) throws IOException { out.defaultWriteObject(); } private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException { in.defaultReadObject(); } } 3. å¤šåŸ·è¡Œç·’æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 /** * å¤šåŸ·è¡Œç·’ç’°å¢ƒä¸‹çš„å–®ä¾‹æ¸¬è©¦ */ public class SingletonThreadTest { public static void main(String[] args) throws InterruptedException { final int threadCount = 1000; final CountDownLatch startLatch = new CountDownLatch(1); final CountDownLatch endLatch = new CountDownLatch(threadCount); final Set\u0026lt;Integer\u0026gt; instanceHashCodes = ConcurrentHashMap.newKeySet(); // å‰µå»ºå¤šå€‹åŸ·è¡Œç·’åŒæ™‚ç²å–å–®ä¾‹ for (int i = 0; i \u0026lt; threadCount; i++) { new Thread(() -\u0026gt; { try { startLatch.await(); // ç­‰å¾…é–‹å§‹ä¿¡è™Ÿ // æ¸¬è©¦ä¸åŒçš„å–®ä¾‹å¯¦ä½œ DoubleCheckedSingleton instance1 = DoubleCheckedSingleton.getInstance(); StaticHolderSingleton instance2 = StaticHolderSingleton.getInstance(); EnumSingleton instance3 = EnumSingleton.INSTANCE; instanceHashCodes.add(System.identityHashCode(instance1)); instanceHashCodes.add(System.identityHashCode(instance2)); instanceHashCodes.add(System.identityHashCode(instance3)); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } finally { endLatch.countDown(); } }).start(); } System.out.println(\u0026#34;é–‹å§‹å¤šåŸ·è¡Œç·’å–®ä¾‹æ¸¬è©¦...\u0026#34;); startLatch.countDown(); // ç™¼å‡ºé–‹å§‹ä¿¡è™Ÿ endLatch.await(); // ç­‰å¾…æ‰€æœ‰åŸ·è¡Œç·’å®Œæˆ System.out.println(\u0026#34;æ¸¬è©¦å®Œæˆ\u0026#34;); System.out.println(\u0026#34;DoubleCheckedSingleton ä¸åŒå¯¦ä¾‹æ•¸é‡: \u0026#34; + (instanceHashCodes.size() \u0026gt;= 3 ? \u0026#34;3 å€‹ï¼ˆæ­£å¸¸ï¼‰\u0026#34; : \u0026#34;ç•°å¸¸\u0026#34;)); } } å–®ä¾‹æ¨¡å¼çš„æ•ˆèƒ½æ¯”è¼ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 /** * ä¸åŒå–®ä¾‹å¯¦ä½œçš„æ•ˆèƒ½æ¸¬è©¦ */ public class SingletonPerformanceTest { private static final int ITERATIONS = 10_000_000; public static void main(String[] args) { // é ç†± JVM warmUp(); // æ¸¬è©¦ä¸åŒå¯¦ä½œçš„æ•ˆèƒ½ testEagerSingleton(); testDoubleCheckedSingleton(); testStaticHolderSingleton(); testEnumSingleton(); } private static void warmUp() { for (int i = 0; i \u0026lt; 100_000; i++) { EagerSingleton.getInstance(); DoubleCheckedSingleton.getInstance(); StaticHolderSingleton.getInstance(); EnumSingleton.INSTANCE.getData(); } } private static void testEagerSingleton() { long startTime = System.nanoTime(); for (int i = 0; i \u0026lt; ITERATIONS; i++) { EagerSingleton.getInstance(); } long endTime = System.nanoTime(); System.out.printf(\u0026#34;EagerSingleton: %.2f ms%n\u0026#34;, (endTime - startTime) / 1_000_000.0); } private static void testDoubleCheckedSingleton() { long startTime = System.nanoTime(); for (int i = 0; i \u0026lt; ITERATIONS; i++) { DoubleCheckedSingleton.getInstance(); } long endTime = System.nanoTime(); System.out.printf(\u0026#34;DoubleCheckedSingleton: %.2f ms%n\u0026#34;, (endTime - startTime) / 1_000_000.0); } private static void testStaticHolderSingleton() { long startTime = System.nanoTime(); for (int i = 0; i \u0026lt; ITERATIONS; i++) { StaticHolderSingleton.getInstance(); } long endTime = System.nanoTime(); System.out.printf(\u0026#34;StaticHolderSingleton: %.2f ms%n\u0026#34;, (endTime - startTime) / 1_000_000.0); } private static void testEnumSingleton() { long startTime = System.nanoTime(); for (int i = 0; i \u0026lt; ITERATIONS; i++) { EnumSingleton.INSTANCE.getData(); } long endTime = System.nanoTime(); System.out.printf(\u0026#34;EnumSingleton: %.2f ms%n\u0026#34;, (endTime - startTime) / 1_000_000.0); } } ç¸½çµèˆ‡æœ€ä½³å¯¦è¸ æ¨è–¦çš„å¯¦ä½œæ–¹å¼ æšèˆ‰å–®ä¾‹ï¼šé©åˆå¤§å¤šæ•¸æƒ…æ³ï¼Œæœ€å®‰å…¨ã€æœ€ç°¡æ½” éœæ…‹å…§éƒ¨é¡åˆ¥ï¼šé©åˆéœ€è¦å»¶é²åˆå§‹åŒ–çš„å ´æ™¯ é›™é‡æª¢æŸ¥é–å®šï¼šé©åˆè¤‡é›œåˆå§‹åŒ–é‚è¼¯çš„å ´æ™¯ é¸æ“‡æŒ‡å— å ´æ™¯ æ¨è–¦å¯¦ä½œ åŸå›  ä¸€èˆ¬ç”¨é€” æšèˆ‰å–®ä¾‹ æœ€å®‰å…¨ã€æœ€ç°¡æ½” Spring æ‡‰ç”¨ Spring Bean æ¡†æ¶ç®¡ç†ç”Ÿå‘½é€±æœŸ å»¶é²åˆå§‹åŒ– éœæ…‹å…§éƒ¨é¡åˆ¥ æ€§èƒ½æœ€ä½³ã€åŸ·è¡Œç·’å®‰å…¨ è¤‡é›œåˆå§‹åŒ– é›™é‡æª¢æŸ¥é–å®š éˆæ´»æ€§é«˜ ç°¡å–®å ´æ™¯ é¤“æ¼¢å¼ å¯¦ä½œç°¡å–® æ³¨æ„äº‹é … é¿å…éåº¦ä½¿ç”¨ï¼šå–®ä¾‹æœƒå¢åŠ ç¨‹å¼ç¢¼çš„è€¦åˆåº¦ è€ƒæ…®æ¸¬è©¦æ€§ï¼šå–®ä¾‹å¯èƒ½å½±éŸ¿å–®å…ƒæ¸¬è©¦çš„ç¨ç«‹æ€§ åŸ·è¡Œç·’å®‰å…¨ï¼šç¢ºä¿åœ¨å¤šåŸ·è¡Œç·’ç’°å¢ƒä¸‹çš„æ­£ç¢ºæ€§ è³‡æºæ¸…ç†ï¼šé©ç•¶æ™‚å€™é‡‹æ”¾å–®ä¾‹æŒæœ‰çš„è³‡æº åºåˆ—åŒ–è€ƒæ…®ï¼šå¯¦ä½œ readResolve() æ–¹æ³•é˜²æ­¢åºåˆ—åŒ–æ”»æ“Š ç¾ä»£æ›¿ä»£æ–¹æ¡ˆ åœ¨ç¾ä»£æ‡‰ç”¨é–‹ç™¼ä¸­ï¼Œå¯ä»¥è€ƒæ…®ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š\nä¾è³´æ³¨å…¥å®¹å™¨ï¼šå¦‚ Spring IoC å®¹å™¨ éœæ…‹å·¥å» æ–¹æ³•ï¼šæä¾›æ›´å¥½çš„æ¸¬è©¦æ€§ Builder æ¨¡å¼ï¼šé©åˆè¤‡é›œå°è±¡çš„å‰µå»º Registry æ¨¡å¼ï¼šç®¡ç†å¤šå€‹ç›¸é—œçš„å–®ä¾‹ å–®ä¾‹æ¨¡å¼é›–ç„¶ç°¡å–®ï¼Œä½†åœ¨å¯¦éš›æ‡‰ç”¨ä¸­éœ€è¦è¬¹æ…è€ƒæ…®å…¶é©ç”¨æ€§å’Œå¯¦ä½œæ–¹å¼ã€‚é¸æ“‡åˆé©çš„å¯¦ä½œæ–¹æ¡ˆèƒ½å¤ ç¢ºä¿ç¨‹å¼ç¢¼çš„å¥å£¯æ€§å’Œå¯ç¶­è­·æ€§ã€‚\nåƒè€ƒè³‡æ–™ Effective Java by Joshua Bloch Design Patterns: Elements of Reusable Object-Oriented Software Java Concurrency in Practice Spring Framework Documentation ","permalink":"https://xinqilin.github.io/post/architecture/singleton/","tags":["Design Pattern","Singleton","Java","Thread Safety","Best Practices","Creational Pattern"],"title":"Singleton è¨­è¨ˆæ¨¡å¼å®Œæ•´æŒ‡å—ï¼šå–®ä¾‹å¯¦ä½œèˆ‡ç¾ä»£åŒ–æœ€ä½³å¯¦è¸"}]