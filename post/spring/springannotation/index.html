<!doctype html><html lang=zh-tw><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Spring Annotation - Bill.Lin's Notes</title><meta name=description content="技術筆記與開發心得分享"><link rel=stylesheet href=https://xinqilin.github.io/css/style.min.css><link rel=icon type=image/x-icon href=/favicon.ico><meta property="og:title" content="Spring Annotation"><meta property="og:description" content="技術筆記與開發心得分享"><meta property="og:type" content="article"><meta property="og:url" content="https://xinqilin.github.io/post/spring/springannotation/"></head><body><div class=container><header class=header><nav class=nav><div class=nav-brand><a href=https://xinqilin.github.io/ class=nav-title>Bill.Lin's Notes</a></div><ul class=nav-menu><li class=nav-item><a href=https://xinqilin.github.io/ class=nav-link>Me</a></li><li class=nav-item><a href=/posts/ class="nav-link posts">Posts</a></li><li class=nav-item><a href=/categories/ class="nav-link categories">Categories</a></li></ul></nav></header><main class=main-content><article class=post><header class=post-header><h1 class=post-title>Spring Annotation</h1><div class=post-meta><div class=post-info><time class=post-date>2019年09月05日</time>
<span class=post-author>by Bill.Lin</span>
<span class=reading-time>4 分鐘閱讀</span></div><div class=post-categories><a href=/categories/backend class=category-link>Backend</a></div></div></header><div class=post-content><h3 id=spring-常用-annotation-筆記>Spring 常用 annotation 筆記</h3><h3 id=cron>Cron</h3><pre tabindex=0><code>
@EnableScheduling
@Scheduled

cron屬性
second、minute、hour、day of month (日)、month、day of week(星期幾)
0 * * * * MON-FRI (周一到週五 每分鐘)
* * * * * MON-FRI (周一到週五每秒)
0,1,2,3,4 * * * * * MON-FRI (枚舉，０－４秒)
0-4 * * * * * MON-FRI (直接，０－４秒)
0/4 * * * * * MON-FRI (0秒啟動，每4秒執行一次)


    秒：可出現”, – * /”四個字元，有效範圍為0-59的整數  

    分：可出現”, – * /”四個字元，有效範圍為0-59的整數  

    時：可出現”, – * /”四個字元，有效範圍為0-23的整數  

    每月第幾天：可出現”, – * / ? L W C”八個字元，有效範圍為0-31的整數  

    月：可出現”, – * /”四個字元，有效範圍為1-12的整數或JAN-DEC  

    星期：可出現”, – * / ? L C #”四個字元，有效範圍為0-7的整數或SUN-SAT兩個範圍。0,1 都是星期日 1-6 星期一到六
    
    
    * : 表示匹配該域的任意值，比如在秒*, 就表示每秒都會觸發事件。；

    ? : 只能用在每月第幾天和星期兩個域。表示不指定值，當2個子表示式其中之一被指定了值以後，為了避免衝突，需要將另一個子表示式的值設為“?”；

    – : 表示範圍，例如在分域使用5-20，表示從5分到20分鐘每分鐘觸發一次  

    / : 表示起始時間開始觸發，然後每隔固定時間觸發一次，例如在分域使用5/20,則意味著5分，25分，45分，分別觸發一次.  

    , : 表示列出列舉值。例如：在分域使用5,20，則意味著在5和20分時觸發一次。  

    L : 表示最後，只能出現在星期和每月第幾天域，如果在星期域使用1L,意味著在最後的一個星期日觸發。  

    W : 表示有效工作日(週一到週五),只能出現在每月第幾日域，系統將在離指定日期的最近的有效工作日觸發事件。注意一點，W的最近尋找不會跨過月份  

    LW : 這兩個字元可以連用，表示在某個月最後一個工作日，即最後一個星期五。  

    # : 用於確定每個月第幾個星期幾，只能出現在每月第幾天域。例如在1#3，表示某月的第三個星期一。4#2 第二個星期四

   （1）cron：cron表示式，指定任務在特定時間執行；

    （2）fixedDelay：表示上一次任務執行完成後多久再次執行，引數型別為long，單位ms；

    （3）fixedDelayString：與fixedDelay含義一樣，只是引數型別變為String；

    （4）fixedRate：表示按一定的頻率執行任務，引數型別為long，單位ms；

    （5）fixedRateString: 與fixedRate的含義一樣，只是將引數型別變為String；

    （6）initialDelay：表示延遲多久再第一次執行任務，引數型別為long，單位ms；

    （7）initialDelayString：與initialDelay的含義一樣，只是將引數型別變為String；
    
  example:
    “0 0 * * * *”                      表示每小時0分0秒執行一次

    ” */10 * * * * *”                 表示每10秒執行一次

    “0 0 8-10 * * *”                 表示每天8，9，10點執行

    “0 0/30 8-10 * * *”            表示每天8點到10點，每半小時執行

    “0 0 9-17 * * MON-FRI”     表示每週一至週五，9點到17點的0分0秒執行

    “0 0 0 25 12 ?”                  表示每年聖誕節（12月25日）0時0分0秒執行
    
    表達式參考:
     https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/6009/
     https://gitee.com/jack90john/spring-boot-timmer

@Scheduled(fixedDelay = 5000)        //fixedDelay = 5000表示當前方法執行完畢5000ms後，Spring scheduling會再次呼叫該方法
</code></pre><h3 id=mail>Mail</h3><pre tabindex=0><code>```xml
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;
		&lt;/dependency&gt;
</code></pre><h5 id=properties>properties</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>spring.mail.username</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.password</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.host</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.properties.mail.smtp.ssl.enable</span><span class=o>=</span><span class=s>true  (SSL 安全機制)</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=ref-properties>REF properties</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># =================================</span>
</span></span><span class=line><span class=cl><span class=c1># Mail</span>
</span></span><span class=line><span class=cl><span class=c1># =================================</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.default-encoding</span><span class=o>=</span><span class=s>UTF-8</span>
</span></span><span class=line><span class=cl><span class=c1># Gmail SMTP</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.host</span><span class=o>=</span><span class=s>smtp.gmail.com</span>
</span></span><span class=line><span class=cl><span class=c1># TLS , port 587</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.port</span><span class=o>=</span><span class=s>587</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.username</span><span class=o>=</span><span class=s>my.account@gmail.com</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.password</span><span class=o>=</span><span class=s>my.password</span>
</span></span><span class=line><span class=cl><span class=c1># Other properties</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.properties.mail.smtp.auth</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.properties.mail.smtp.starttls.enable</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>spring.mail.properties.mail.smtp.starttls.required</span><span class=o>=</span><span class=s>true</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=透過config設置>透過config設置</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MailConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>JavaMailSender</span><span class=w> </span><span class=nf>getJavaMailSender</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>JavaMailSenderImpl</span><span class=w> </span><span class=n>mailSender</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JavaMailSenderImpl</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>mailSender</span><span class=p>.</span><span class=na>setHost</span><span class=p>(</span><span class=s>&#34;smtp.gmail.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>mailSender</span><span class=p>.</span><span class=na>setPort</span><span class=p>(</span><span class=n>587</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>mailSender</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;my.gmail@gmail.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>mailSender</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;my.password&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>Properties</span><span class=w> </span><span class=n>props</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mailSender</span><span class=p>.</span><span class=na>getJavaMailProperties</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>props</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;mail.transport.protocol&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;smtp&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>props</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;mail.smtp.auth&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>props</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;mail.smtp.starttls.enable&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>props</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;mail.smtp.starttls.required&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>props</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;mail.debug&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;true&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=k>return</span><span class=w> </span><span class=n>mailSender</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>調用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@AutoWired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>JavaMailSenderImpl</span><span class=w> </span><span class=n>javaMail</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>XXXXX</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SimpleMailMessage</span><span class=w> </span><span class=n>msg</span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>SimpleMailMessage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>msg</span><span class=p>.</span><span class=na>setSubject</span><span class=p>(</span><span class=s>&#34;標題&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>msg</span><span class=p>.</span><span class=na>setText</span><span class=p>(</span><span class=s>&#34;內容&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>msg</span><span class=p>.</span><span class=na>setTo</span><span class=p>(</span><span class=s>&#34;去哪裡@gmail.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>msg</span><span class=p>.</span><span class=na>setFrom</span><span class=p>(</span><span class=s>&#34;從哪裡@gmail.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javaMail</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>msg</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=有兩步驟驗證的話>有兩步驟驗證的話:</h5><pre tabindex=0><code>左側導覽面板上的 [安全性]，按一下底部的 [選取應用程式]，然後選擇您使用的應用程式，或是建立一組應用程式使用用的密碼

選其他 =&gt; 自命名 =&gt;產生16位密碼  =&gt;當成正式密碼 丟在properties中
</code></pre><h5 id=複雜mail>複雜mail</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MimeMessage</span><span class=w> </span><span class=n>mimeMsg</span><span class=o>=</span><span class=n>javaMailSender</span><span class=p>.</span><span class=na>createMimeMessage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MimeMessageHelper</span><span class=w> </span><span class=n>helper</span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>MimeMessageHelper</span><span class=p>(</span><span class=n>mimeMsg</span><span class=w> </span><span class=p>,(</span><span class=n>multipart</span><span class=p>:)</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>helper</span><span class=p>.</span><span class=na>setSubject</span><span class=p>(</span><span class=s>&#34;標題&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>helper</span><span class=p>.</span><span class=na>setText</span><span class=p>(</span><span class=s>&#34;&lt;strong&gt;內容&lt;/strong&gt;&#34;</span><span class=p>,(</span><span class=n>html編譯</span><span class=p>)</span><span class=w> </span><span class=kc>true</span><span class=p>);</span><span class=w>    </span><span class=p>(</span><span class=n>可加html標籤</span><span class=err>，</span><span class=n>後面預設是false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>helper</span><span class=p>.</span><span class=na>setTo</span><span class=p>(</span><span class=s>&#34;去哪裡@gmail.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>helper</span><span class=p>.</span><span class=na>setFrom</span><span class=p>(</span><span class=s>&#34;從哪裡@gmail.com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>helper</span><span class=p>.</span><span class=na>addAttachement</span><span class=p>(</span><span class=s>&#34;檔名&#34;</span><span class=p>,</span><span class=k>new</span><span class=w> </span><span class=n>File</span><span class=p>(</span><span class=s>&#34;檔案位置&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javaMail</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>mimeMsg</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=actuator>Actuator</h3><h5 id=actuator-提供了-13-個接口具體如下表所示-引用自think-powerthink-power>Actuator 提供了 13 個接口，具體如下表所示 (引用自think power)<a href=https://tpu.thinkpower.com.tw/tpu/articleDetails/954>think power</a></h5><table cellpadding=8 border=1><tr><th>路徑</th><th>描述</th></tr><tr><th>/health</th><th>展示系統的各種組件運行狀態、硬碟使用狀況</th></tr><tr><th>/metrics</th><th>統計系統當前的一些即時信息，如：該系統接收了多少個請求、cache命中率、mq中有多少條信息待處理、CPU使用率、內存占用情況等。</th></tr><tr><th>/metrics/{name}</th><th>報告指定名稱的應用進程度量值</th></tr><tr><th>/dump</th><th>當前系統中線程的詳細信息</th></tr><tr><th>/env</th><th>展示系統變量 和 springboot的應用變量</th></tr><tr><th>/env/{name}</th><th>根據名稱獲取特定的環境屬性值</th></tr><tr><th>/trace</th><th>顯示最近的http請求的request、response對（默認最多緩存100條）</th></tr><tr><th>/autoconfig</th><th>展示所有auto-configuration候選者及它們被應用或未被應用的原因</th></tr><tr><th>/info</th><th>顯示應用自定義的信息：如該應用的聯繫人、名稱、版本等</th></tr><tr><th>/configprops</th><th>顯示所有被@ConfigurationProperties mark的Bean的信息列表</th></tr><tr><th>/mappings</th><th>顯示所有@RequestMapping mark 的url list</th></tr><tr><th>/shutdown</th><th>允許以POST方式關閉應用，要求endpoints.shutdown.enabled設置為true</th></tr><tr><th>/beans</th><th>顯示該應用中所有Spring Beans的完整信息，包括依賴了哪些bean、是singleton還是prototype</th></tr></table><h2 id=spring-boot-2參考用表>spring boot 2參考用表</h2><table cellpadding=5 border=1><tr><th>id</th><th>效果</th><th>default value</th></tr><tr><td>auditevents</td><td>顯示當前訊息事件</td><td>Y</td></tr><tr><td>beans</td><td>顯示應用Spring Beans的完整列表</td><td>Y</td></tr><tr><td>caches</td><td>顯示可cache訊息</td><td>Y</td></tr><tr><td>conditions</td><td>顯示autoconfig 的狀態與應用訊息</td><td>Y</td></tr><tr><td>configprops</td><td>顯示所有@ConfigurationProperties 列表</td><td>Y</td></tr><tr><td>env</td><td>顯示ConfigurableEnvironment 中的属性</td><td>Y</td></tr><tr><td>flyway</td><td>顯示Flyway 中data遷移訊息</td><td>Y</td></tr><tr><td>health</td><td>顯示應運的訊息(為認證只顯示status，已認證顯示全部)</td><td>Y</td></tr><tr><td>info</td><td>很直白</td><td>Y</td></tr><tr><td>liquibase</td><td>跟fly依樣，顯示liquibase</td><td>Y</td></tr><tr><td>metrics</td><td>顯示當前metrics訊息</td><td>Y</td></tr><tr><td>mappings</td><td>顯示所有@RequestMapping</td><td>Y</td></tr><tr><td>scheduledtasks</td><td>顯示所有scheduledtasks</td><td>Y</td></tr><tr><td>sessions</td><td>...</td><td>Y</td></tr><tr><td>shutdown</td><td>若是true時，可發/shutdown 的post req去關閉server</td><td style=color:red>N</td></tr><tr><td>threaddump</td><td>執行一個thread的dump</td><td>Y</td></tr><tr><td>httptrace</td><td>顯示最後執行的100的http req</td><td>Y</td></tr><tr><td>heapdump</td><td>return gzip 的dump文件</td><td>Y</td></tr><tr><td>prometheus</td><td>Prometheus的格式顯示metrics訊息</td><td>Y</td></tr></table><p>參考掘金https://juejin.im/post/5d78afa951882505e029c57e</p><h3 id=配置path>配置path</h3><pre tabindex=0><code>  management.endpoints.web.basePath=
</code></pre><h3 id=全部啟用-managementendpointsenabled-by-default>全部啟用 management.endpoints.enabled-by-default</h3><pre tabindex=0><code>management.endpoints.enabled-by-default=true
</code></pre><p>全部停用，只啟用部分</p><pre tabindex=0><code>  management.endpoints.enabled-by-default=false
  management.endpoint.[id].enabled=true
</code></pre><h5 id=開放與封閉>開放與封閉</h5><pre tabindex=0><code>management.endpoints.&lt;web|jmx&gt;.exposure.&lt;include|exclude&gt;

 * 開放所有所有web端點，如果暴露的是一個要用 id 並以逗號隔開 
management.endpoints.web.exposure.include=&#39;*&#39;

排除端點
management.endpoints.web.exposure.exclude=
</code></pre><h5 id=安全性>安全性</h5><pre tabindex=0><code>  可用上面方法  或是 此方法關閉敏感端點 ex: /shutdown 或是使用Spring security 來搭配使用
  management.server.port=-1
</code></pre><h5 id=自訂義-boot-2-開始actuator支援crud模型>自訂義 (boot 2 開始，Actuator支援CRUD模型)</h5><p>@Endpoint 支援JMX和http
@JmxEndpoint 只支援JMX
@WebEndpoint 只支援http</p><p>通過在一個端點類（必須是Spring Bean）上添加上面其中一個來表明該類是一個端點類。
在類的方法使用
@ReadOperation
@WriteOperation
@DeleteOperation，這分別會orm到Http中的GET，POST，DELETE。以下範例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Endpoint</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;features&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>FeaturesEndpoint</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>private</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Feature</span><span class=o>&gt;</span><span class=w> </span><span class=n>features</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ConcurrentHashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@ReadOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Feature</span><span class=o>&gt;</span><span class=w> </span><span class=nf>features</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=n>features</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@ReadOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=n>Feature</span><span class=w> </span><span class=nf>feature</span><span class=p>(</span><span class=nd>@Selector</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=n>features</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@WriteOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configureFeature</span><span class=p>(</span><span class=nd>@Selector</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>Feature</span><span class=w> </span><span class=n>feature</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>features</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>feature</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@DeleteOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteFeature</span><span class=p>(</span><span class=nd>@Selector</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>features</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>Feature</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=kd>private</span><span class=w> </span><span class=n>Boolean</span><span class=w> </span><span class=n>enabled</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=c1>// getters and setters ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=應用延伸>應用延伸</h5><p>可以使用
@EndpointExtension
@EndpointWebExtension
@EndpointJmxExtension
來延伸端點行為</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EndpointWebExtension</span><span class=p>(</span><span class=n>endpoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InfoEndpoint</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>InfoWebEndpointExtension</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>InfoEndpoint</span><span class=w> </span><span class=n>delegate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// standard constructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ReadOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>WebEndpointResponse</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>&gt;</span><span class=w> </span><span class=nf>info</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>delegate</span><span class=p>.</span><span class=na>info</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Integer</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getStatus</span><span class=p>(</span><span class=n>info</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>WebEndpointResponse</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>info</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=nf>getStatus</span><span class=p>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>info</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// return 5xx if this is a snapshot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>200</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><p>啟用端點 env
management.endpoint.env.enabled=true</p></li><li><p>暴露端點 env 配置多個,隔開
management.endpoints.web.exposure.include=env</p></li><li><p>開啟全部
management.endpoint.<em>.enabled=true
management.endpoints.web.exposure.include=</em></p></li></ul><h3 id=使用非同步--待補>使用非同步 (待補&mldr;)</h3><p><code>@EnableAsync</code>
<code>@Async</code></p></div></article><nav class=post-nav><div class=post-nav-links><div class=post-nav-prev><span class=post-nav-label>上一篇</span>
<a href=https://xinqilin.github.io/post/script/awk/ class=post-nav-link>Awk</a></div><div class=post-nav-next><span class=post-nav-label>下一篇</span>
<a href=https://xinqilin.github.io/post/spring/sideprojectconfig/ class=post-nav-link>SideProjectConfig</a></div></div></nav></main><footer class=footer><div class=footer-content><p>&copy; 2025 Bill Lin. All rights reserved.</p><div class=social-links><a href=https://github.com/xinqilin class=social-link target=_blank rel=noopener>github</a></div></div></footer></div></body></html>