<!doctype html><html lang=zh-tw><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Xargs 命令完整指南：Linux 參數處理與並行執行的強大工具 - Bill.Lin's Notes</title><meta name=description content="深入解析 xargs 命令的完整用法，包含參數處理、並行執行、管道組合與實戰應用場景"><link rel=stylesheet href=http://localhost:1313/css/style.min.css><link rel=stylesheet href=http://localhost:1313/css/chroma.min.css><link rel=icon type=image/svg+xml href=/images/Bill-coding.svg><link rel=icon type=image/x-icon href=/images/Bill-coding.ico><meta property="og:title" content="Xargs 命令完整指南：Linux 參數處理與並行執行的強大工具"><meta property="og:description" content="深入解析 xargs 命令的完整用法，包含參數處理、並行執行、管道組合與實戰應用場景"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/post/tools/xargs/"></head><body><div class=container><header class=header><nav class=nav><div class=nav-left><a href=http://localhost:1313/ class=nav-title><img src=/images/Bill-coding.svg alt="Site Icon" class=nav-icon>
Bill.Lin's Notes</a></div><div class=nav-center><a href=http://localhost:1313/ class=avatar-link><div class=avatar-container><div class=avatar-ring></div><img src=/images/Bill-coding.svg alt="Bill's Avatar" class=nav-avatar-center></div></a></div><div class=nav-right><ul class=nav-menu><li class=nav-item><a href=http://localhost:1313/ class=nav-link>Me</a></li><li class=nav-item><a href=/posts/ class="nav-link posts">Posts</a></li><li class=nav-item><a href=/categories/ class="nav-link categories">Categories</a></li><li class=nav-item id=search-container><a href=# id=search-trigger class=nav-link>Search</a>
<input type=text id=search-input placeholder=Search...><div id=search-results-container></div></li></ul></div></nav></header><style>.container{max-width:1100px}#search-container{position:relative}#search-input{position:absolute;top:50%;left:0;transform:translateY(-50%);height:100%;width:0;padding:0;margin:0;opacity:0;visibility:hidden;border:none;border-radius:12px;font-family:inherit;font-size:1em;color:#4a5568;background-color:#fff;outline:none;transition:width .35s ease,opacity .3s ease,padding .35s ease;z-index:10}#search-container.search-active #search-trigger{opacity:0;visibility:hidden}#search-container.search-active #search-input{width:220px;padding:.6rem 1.2rem;opacity:1;visibility:visible;box-shadow:0 4px 20px rgba(0,0,0,.1);border:1px solid #e2e8f0}#search-results-container{display:none;position:absolute;top:calc(100% + 5px);left:0;width:320px;max-height:400px;overflow-y:auto;background-color:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 8px 25px rgba(0,0,0,.15);z-index:1001}.search-result-link{display:block;text-decoration:none;color:inherit;padding:12px 15px;border-bottom:1px solid #eee;transition:background-color .2s ease}.search-result-link:hover{background-color:#f8f9fa}.search-result-link:last-child{border-bottom:none}.search-result-title{font-size:1em;font-weight:600;color:#333;margin:0 0 5px}.search-result-link:hover .search-result-title{color:#61c8e0}.search-result-summary{font-size:.9em;color:#666;margin:0;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}</style><main class=main-content><article class=post><header class=post-header><h1 class=post-title>Xargs 命令完整指南：Linux 參數處理與並行執行的強大工具</h1><div class=post-meta><div class=post-info><time class=post-date>2022年11月02日</time>
<span class=post-author>by Bill.Lin</span>
<span class=reading-time>12 分鐘閱讀</span></div><div class=post-categories><a href=/categories/tools class=category-link>Tools</a></div></div></header><div class=post-content><h2 id=概述>概述</h2><p><code>xargs</code>（eXtended ARGuments）是 Unix/Linux 系統中的強大工具，用於從標準輸入讀取資料並將其作為參數傳遞給其他命令。它解決了命令行參數長度限制的問題，並提供了並行處理能力，是管道操作和批次處理的重要工具。</p><h3 id=核心特徵>核心特徵</h3><ul><li><strong>參數轉換</strong>：將輸入流轉換為命令參數</li><li><strong>批次處理</strong>：支援分批執行大量操作</li><li><strong>並行執行</strong>：可同時執行多個程序提升效率</li><li><strong>安全處理</strong>：正確處理包含空格的檔案名稱</li><li><strong>靈活控制</strong>：豐富的選項控制執行行為</li></ul><h2 id=基本語法>基本語法</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>xargs <span class=o>[</span>選項<span class=o>]</span> <span class=o>[</span>命令 <span class=o>[</span>初始參數<span class=o>]]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=工作原理>工作原理</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基本概念</span>
</span></span><span class=line><span class=cl>command1 <span class=p>|</span> xargs command2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 等同於</span>
</span></span><span class=line><span class=cl>command2 arg1 arg2 arg3 ...
</span></span></code></pre></td></tr></table></div></div><h3 id=簡單範例>簡單範例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 預設行為（使用 echo）</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;a b c d&#34;</span> <span class=p>|</span> xargs              <span class=c1># 輸出: a b c d</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定命令</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;file1 file2 file3&#34;</span> <span class=p>|</span> xargs ls -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 從檔案讀取</span>
</span></span><span class=line><span class=cl>cat filelist.txt <span class=p>|</span> xargs rm -f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 與 find 組合</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.tmp&#34;</span> <span class=p>|</span> xargs rm -f
</span></span></code></pre></td></tr></table></div></div><h2 id=核心選項詳解>核心選項詳解</h2><h3 id=基本控制選項>基本控制選項</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># -t (--verbose) - 顯示執行的命令</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;a b c&#34;</span> <span class=p>|</span> xargs -t rm
</span></span><span class=line><span class=cl><span class=c1># 輸出: rm a b c</span>
</span></span><span class=line><span class=cl><span class=c1># 然後執行 rm a b c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -p (--interactive) - 交互式確認</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;file1 file2&#34;</span> <span class=p>|</span> xargs -p rm
</span></span><span class=line><span class=cl><span class=c1># 輸出: rm file1 file2?...</span>
</span></span><span class=line><span class=cl><span class=c1># 等待使用者輸入 y/n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -r (--no-run-if-empty) - 空輸入時不執行</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&#34;</span> <span class=p>|</span> xargs -r <span class=nb>echo</span> <span class=s2>&#34;執行了&#34;</span>    <span class=c1># 不會執行</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&#34;</span> <span class=p>|</span> xargs <span class=nb>echo</span> <span class=s2>&#34;執行了&#34;</span>       <span class=c1># 會執行</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --help - 顯示幫助資訊</span>
</span></span><span class=line><span class=cl>xargs --help
</span></span></code></pre></td></tr></table></div></div><h3 id=參數分組選項>參數分組選項</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># -n max-args - 限制每次執行的參數數量</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;1 2 3 4 5 6&#34;</span> <span class=p>|</span> xargs -n <span class=m>2</span> <span class=nb>echo</span>
</span></span><span class=line><span class=cl><span class=c1># 輸出:</span>
</span></span><span class=line><span class=cl><span class=c1># 1 2</span>
</span></span><span class=line><span class=cl><span class=c1># 3 4</span>
</span></span><span class=line><span class=cl><span class=c1># 5 6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -L max-lines - 限制每次處理的行數</span>
</span></span><span class=line><span class=cl><span class=nb>printf</span> <span class=s2>&#34;a\nb\nc\nd\n&#34;</span> <span class=p>|</span> xargs -L <span class=m>2</span> <span class=nb>echo</span>
</span></span><span class=line><span class=cl><span class=c1># 輸出:</span>
</span></span><span class=line><span class=cl><span class=c1># a b</span>
</span></span><span class=line><span class=cl><span class=c1># c d</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -s max-chars - 限制命令行長度</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;very long arguments here&#34;</span> <span class=p>|</span> xargs -s <span class=m>20</span> <span class=nb>echo</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=分隔符處理>分隔符處理</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># -d delimiter - 自訂分隔符</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;a,b,c,d&#34;</span> <span class=p>|</span> xargs -d, <span class=nb>echo</span>
</span></span><span class=line><span class=cl><span class=c1># 輸出: a b c d</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -0 (--null) - 使用 null 字元作分隔符</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> -print0 <span class=p>|</span> xargs -0 ls -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 處理包含空格的檔案名</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;file 1.txt\nfile 2.txt&#34;</span> <span class=p>|</span> xargs -d<span class=s1>&#39;\n&#39;</span> ls -l
</span></span></code></pre></td></tr></table></div></div><h3 id=替換字串選項>替換字串選項</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># -I replace-str - 指定替換字串</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;file1 file2 file3&#34;</span> <span class=p>|</span> xargs -I <span class=o>{}</span> cp <span class=o>{}</span> <span class=o>{}</span>.backup
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -i 或 -I{} - 使用 {} 作為替換字串</span>
</span></span><span class=line><span class=cl>ls *.txt <span class=p>|</span> xargs -I<span class=o>{}</span> cp <span class=o>{}</span> backup/<span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 複雜替換範例</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;echo &#34;Processing: {}&#34;; gzip {}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=並行處理選項>並行處理選項</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># -P max-procs - 並行執行</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;1 2 3 4 5&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>3</span> sleep
</span></span><span class=line><span class=cl><span class=c1># 同時執行最多 3 個 sleep 命令</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># -P 0 - 無限制並行</span>
</span></span><span class=line><span class=cl>seq <span class=m>1</span> <span class=m>10</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>0</span> <span class=nb>echo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 實際並行範例</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.jpg&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>4</span> -I<span class=o>{}</span> convert <span class=o>{}</span> <span class=o>{}</span>.thumb.jpg
</span></span></code></pre></td></tr></table></div></div><h2 id=實戰應用場景>實戰應用場景</h2><h3 id=1-檔案管理操作>1. 檔案管理操作</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 批次刪除檔案</span>
</span></span><span class=line><span class=cl>find /tmp -name <span class=s2>&#34;*.tmp&#34;</span> -mtime +7 <span class=p>|</span> xargs rm -f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次複製檔案</span>
</span></span><span class=line><span class=cl>ls *.txt <span class=p>|</span> xargs -I<span class=o>{}</span> cp <span class=o>{}</span> backup/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次移動檔案</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.old&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> mv <span class=o>{}</span> archive/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次重命名</span>
</span></span><span class=line><span class=cl>ls *.jpeg <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;mv &#34;$1&#34; &#34;${1%.jpeg}.jpg&#34;&#39;</span> _ <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 建立多個目錄</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;dir1 dir2 dir3&#34;</span> <span class=p>|</span> xargs mkdir -p
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改檔案權限</span>
</span></span><span class=line><span class=cl>find /var/www -name <span class=s2>&#34;*.php&#34;</span> <span class=p>|</span> xargs chmod <span class=m>644</span>
</span></span><span class=line><span class=cl>find /var/www -type d <span class=p>|</span> xargs chmod <span class=m>755</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次壓縮檔案</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> -size +100M <span class=p>|</span> xargs -I<span class=o>{}</span> gzip <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-文本處理>2. 文本處理</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 批次搜尋文本</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs grep -l <span class=s2>&#34;pattern&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次替換文本</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.conf&#34;</span> <span class=p>|</span> xargs sed -i <span class=s1>&#39;s/old/new/g&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 統計行數</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.py&#34;</span> <span class=p>|</span> xargs wc -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次編碼轉換</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> iconv -f gbk -t utf8 <span class=o>{}</span> -o <span class=o>{}</span>.utf8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次格式化程式碼</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.js&#34;</span> <span class=p>|</span> xargs prettier --write
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次檢查語法</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.sh&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> bash -n <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-系統管理>3. 系統管理</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 批次殺死程序</span>
</span></span><span class=line><span class=cl>ps aux <span class=p>|</span> grep <span class=s2>&#34;process_name&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> xargs <span class=nb>kill</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次服務重啟</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;nginx apache2 mysql&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> systemctl restart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次安裝軟體包</span>
</span></span><span class=line><span class=cl>cat package_list.txt <span class=p>|</span> xargs apt-get install -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 磁碟使用統計</span>
</span></span><span class=line><span class=cl>find /var/log -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs du -sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次下載檔案</span>
</span></span><span class=line><span class=cl>cat urls.txt <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>5</span> wget
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次備份</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;/etc /var/log /home&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> tar -czf <span class=o>{</span>//<span class=o>}</span>.tar.gz <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=4-開發與部署>4. 開發與部署</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 批次編譯</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.c&#34;</span> <span class=p>|</span> xargs gcc -o output
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次測試</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*_test.py&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> python <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次部署</span>
</span></span><span class=line><span class=cl>cat server_list.txt <span class=p>|</span> xargs -I<span class=o>{}</span> scp deploy.sh user@<span class=o>{}</span>:/tmp/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次執行遠程命令</span>
</span></span><span class=line><span class=cl>cat servers.txt <span class=p>|</span> xargs -I<span class=o>{}</span> ssh <span class=o>{}</span> <span class=s2>&#34;uptime&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次 Git 操作</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;.git&#34;</span> -type d <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;cd {} &amp;&amp; git pull&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次建構 Docker 映像</span>
</span></span><span class=line><span class=cl>ls */Dockerfile <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;cd $(dirname {}) &amp;&amp; docker build -t $(basename $(pwd)) .&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=5-監控與日誌>5. 監控與日誌</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 批次監控檔案變化</span>
</span></span><span class=line><span class=cl>find /var/log -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> tail -f <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次日誌分析</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;access.log*&#34;</span> <span class=p>|</span> xargs zcat <span class=p>|</span> grep <span class=s2>&#34;ERROR&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次清理日誌</span>
</span></span><span class=line><span class=cl>find /var/log -name <span class=s2>&#34;*.log&#34;</span> -size +100M <span class=p>|</span> xargs truncate -s <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 系統資訊收集</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;/proc/cpuinfo /proc/meminfo /proc/loadavg&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;echo &#34;=== {} ===&#34;; cat {}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次檢查服務狀態</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;nginx mysql redis&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> systemctl status <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=進階技巧>進階技巧</h2><h3 id=1-複雜命令組合>1. 複雜命令組合</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 多命令執行</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;echo &#34;Processing {}&#34;; wc -l {}; echo &#34;Done&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 條件執行</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;if [ -s &#34;{}&#34; ]; then echo &#34;Non-empty: {}&#34;; fi&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 錯誤處理</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.sh&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;bash -n &#34;{}&#34; || echo &#34;Syntax error in {}&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 結果收集</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.py&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;echo &#34;{}: $(wc -l &lt; &#34;{}&#34;)&#34;&#39;</span> <span class=p>|</span> sort -k2 -nr
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 管道組合</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;cat &#34;{}&#34; | grep ERROR | wc -l&#39;</span> <span class=p>|</span> awk <span class=s1>&#39;{sum+=$1} END {print sum}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-並行處理最佳化>2. 並行處理最佳化</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># CPU 密集型任務</span>
</span></span><span class=line><span class=cl>seq <span class=m>1</span> <span class=m>100</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=k>$(</span>nproc<span class=k>)</span> sh -c <span class=s1>&#39;echo &#34;Processing $1&#34;; sleep 1; echo &#34;Done $1&#34;&#39;</span> _
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># I/O 密集型任務</span>
</span></span><span class=line><span class=cl>cat urls.txt <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>10</span> -I<span class=o>{}</span> sh -c <span class=s1>&#39;echo &#34;Downloading {}&#34;; wget -q {}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 記憶體管理</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.big&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>2</span> -I<span class=o>{}</span> process_large_file <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 並行日誌處理</span>
</span></span><span class=line><span class=cl>find /var/log -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>4</span> -I<span class=o>{}</span> sh -c <span class=s1>&#39;gzip &#34;{}&#34; &amp;&amp; echo &#34;Compressed {}&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 負載均衡</span>
</span></span><span class=line><span class=cl>seq <span class=m>1</span> <span class=m>1000</span> <span class=p>|</span> xargs -n <span class=m>10</span> -P <span class=m>8</span> -I<span class=o>{}</span> process_batch <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-安全性考慮>3. 安全性考慮</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 處理特殊字元</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> -print0 <span class=p>|</span> xargs -0 ls -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 避免命令注入</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;file; rm -rf /&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;ls &#34;$1&#34;&#39;</span> _ <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 參數驗證</span>
</span></span><span class=line><span class=cl>cat files.txt <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;if [ -f &#34;$1&#34; ]; then process &#34;$1&#34;; fi&#39;</span> _ <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 路徑安全</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.conf&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;realpath &#34;$1&#34; | grep &#34;^/safe/path&#34; &amp;&amp; process &#34;$1&#34;&#39;</span> _ <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=4-效能優化>4. 效能優化</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 批次大小優化</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -n <span class=m>100</span> process_files
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 記憶體限制</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -s <span class=m>4096</span> process_with_memory_limit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 並行數調整</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.jpg&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=k>$(</span>nproc<span class=k>)</span> optimize_image
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 緩衝區優化</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.data&#34;</span> <span class=p>|</span> xargs -n <span class=m>50</span> -P <span class=m>4</span> process_data_batch
</span></span></code></pre></td></tr></table></div></div><h2 id=錯誤處理與除錯>錯誤處理與除錯</h2><h3 id=1-常見問題>1. 常見問題</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 問題：參數過長</span>
</span></span><span class=line><span class=cl><span class=c1># 解決：使用 -s 限制或分批處理</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -s <span class=m>1000</span> rm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 問題：檔案名包含空格</span>
</span></span><span class=line><span class=cl><span class=c1># 解決：使用 -0 和 -print0</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> -print0 <span class=p>|</span> xargs -0 rm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 問題：空輸入執行</span>
</span></span><span class=line><span class=cl><span class=c1># 解決：使用 -r 選項</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&#34;</span> <span class=p>|</span> xargs -r <span class=nb>echo</span> <span class=s2>&#34;不會執行&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 問題：並行競爭</span>
</span></span><span class=line><span class=cl><span class=c1># 解決：使用適當的鎖機制</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>4</span> -I<span class=o>{}</span> flock /tmp/lock process <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-除錯技巧>2. 除錯技巧</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 使用 -t 查看執行命令</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -t rm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 -p 交互式確認</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.tmp&#34;</span> <span class=p>|</span> xargs -p rm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 逐步測試</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;test1 test2&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> <span class=nb>echo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 檢查參數</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> <span class=nb>echo</span> <span class=s2>&#34;Will process: {}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 錯誤日誌</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.sh&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;bash -n &#34;{}&#34; 2&gt;&gt;error.log || echo &#34;Error in {}&#34;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-效能監控>3. 效能監控</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 執行時間測量</span>
</span></span><span class=line><span class=cl><span class=nb>time</span> find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs wc -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 並行效能比較</span>
</span></span><span class=line><span class=cl><span class=nb>time</span> seq <span class=m>1</span> <span class=m>100</span> <span class=p>|</span> xargs -n <span class=m>1</span> sleep 0.1          <span class=c1># 串行</span>
</span></span><span class=line><span class=cl><span class=nb>time</span> seq <span class=m>1</span> <span class=m>100</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>10</span> sleep 0.1    <span class=c1># 並行</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 資源使用監控</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.big&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>4</span> -I<span class=o>{}</span> sh -c <span class=s1>&#39;echo &#34;Processing {}&#34;; /usr/bin/time -v process {}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=與其他工具整合>與其他工具整合</h2><h3 id=1-與-find-組合>1. 與 find 組合</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基本組合</span>
</span></span><span class=line><span class=cl>find /path -name <span class=s2>&#34;pattern&#34;</span> <span class=p>|</span> xargs <span class=nb>command</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安全處理</span>
</span></span><span class=line><span class=cl>find /path -name <span class=s2>&#34;pattern&#34;</span> -print0 <span class=p>|</span> xargs -0 <span class=nb>command</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 條件過濾</span>
</span></span><span class=line><span class=cl>find /path -name <span class=s2>&#34;*.txt&#34;</span> -size +1M <span class=p>|</span> xargs -I<span class=o>{}</span> sh -c <span class=s1>&#39;echo &#34;Large file: {}&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 複雜搜尋</span>
</span></span><span class=line><span class=cl>find /path -type f -mtime -7 <span class=se>\(</span> -name <span class=s2>&#34;*.log&#34;</span> -o -name <span class=s2>&#34;*.txt&#34;</span> <span class=se>\)</span> <span class=p>|</span> xargs grep <span class=s2>&#34;pattern&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-與-grep-組合>2. 與 grep 組合</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 檔案內容搜尋</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.py&#34;</span> <span class=p>|</span> xargs grep -l <span class=s2>&#34;import numpy&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 多模式搜尋</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.conf&#34;</span> <span class=p>|</span> xargs grep -E <span class=s2>&#34;(error|warning|critical)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 統計匹配</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs grep <span class=s2>&#34;ERROR&#34;</span> <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 結果處理</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs grep -H <span class=s2>&#34;pattern&#34;</span> <span class=p>|</span> cut -d: -f1 <span class=p>|</span> sort <span class=p>|</span> uniq
</span></span></code></pre></td></tr></table></div></div><h3 id=3-與-ssh-組合>3. 與 ssh 組合</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 遠程並行執行</span>
</span></span><span class=line><span class=cl>cat servers.txt <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>5</span> -I<span class=o>{}</span> ssh <span class=o>{}</span> <span class=s2>&#34;command&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次檔案傳輸</span>
</span></span><span class=line><span class=cl>cat servers.txt <span class=p>|</span> xargs -I<span class=o>{}</span> scp file.txt user@<span class=o>{}</span>:/tmp/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 遠程監控</span>
</span></span><span class=line><span class=cl>cat servers.txt <span class=p>|</span> xargs -I<span class=o>{}</span> ssh <span class=o>{}</span> <span class=s2>&#34;uptime; df -h&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分布式處理</span>
</span></span><span class=line><span class=cl>cat servers.txt <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>10</span> -I<span class=o>{}</span> ssh <span class=o>{}</span> <span class=s2>&#34;process_data input.txt&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=實用腳本範例>實用腳本範例</h2><h3 id=1-批次檔案處理腳本>1. 批次檔案處理腳本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># batch_process.sh - 批次處理檔案</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>SCRIPT_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>cd</span> <span class=s2>&#34;</span><span class=k>$(</span>dirname <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BASH_SOURCE</span><span class=p>[0]</span><span class=si>}</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>pwd</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>INPUT_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=p>./input</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>OUTPUT_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=p>./output</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>MAX_PARALLEL</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>3</span><span class=k>:-</span><span class=nv>4</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 建立輸出目錄</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=s2>&#34;</span><span class=nv>$OUTPUT_DIR</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 批次處理</span>
</span></span><span class=line><span class=cl>find <span class=s2>&#34;</span><span class=nv>$INPUT_DIR</span><span class=s2>&#34;</span> -name <span class=s2>&#34;*.txt&#34;</span> -print0 <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>xargs -0 -n <span class=m>1</span> -P <span class=s2>&#34;</span><span class=nv>$MAX_PARALLEL</span><span class=s2>&#34;</span> -I<span class=o>{}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sh -c <span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    input_file=&#34;$1&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    output_file=&#34;&#39;</span><span class=s2>&#34;</span><span class=nv>$OUTPUT_DIR</span><span class=s2>&#34;</span><span class=s1>&#39;/$(basename &#34;$1&#34; .txt).processed.txt&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    echo &#34;Processing: $input_file&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    
</span></span></span><span class=line><span class=cl><span class=s1>    # 處理邏輯
</span></span></span><span class=line><span class=cl><span class=s1>    sed &#34;s/old/new/g&#34; &#34;$input_file&#34; &gt; &#34;$output_file&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    
</span></span></span><span class=line><span class=cl><span class=s1>    echo &#34;Completed: $output_file&#34;
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span> _ <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;批次處理完成&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-系統清理腳本>2. 系統清理腳本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># system_cleanup.sh - 系統清理腳本</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;/var/log/cleanup.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DRY_RUN</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>false</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>log<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>$(</span>date <span class=s1>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class=k>)</span><span class=s2> - </span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=p>|</span> tee -a <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cleanup_logs<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;開始清理日誌檔案&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$DRY_RUN</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;true&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        find /var/log -name <span class=s2>&#34;*.log&#34;</span> -size +100M <span class=p>|</span> xargs -I<span class=o>{}</span> <span class=nb>echo</span> <span class=s2>&#34;Will compress: {}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        find /var/log -name <span class=s2>&#34;*.log&#34;</span> -size +100M <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        xargs -n <span class=m>1</span> -P <span class=m>4</span> -I<span class=o>{}</span> sh -c <span class=s1>&#39;gzip &#34;$1&#34; &amp;&amp; echo &#34;Compressed: $1&#34;&#39;</span> _ <span class=o>{}</span> <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        tee -a <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cleanup_temp<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;開始清理臨時檔案&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$DRY_RUN</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;true&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        find /tmp -type f -mtime +7 <span class=p>|</span> xargs -I<span class=o>{}</span> <span class=nb>echo</span> <span class=s2>&#34;Will remove: {}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        find /tmp -type f -mtime +7 <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        xargs -r rm -f
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cleanup_cache<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    log <span class=s2>&#34;開始清理快取檔案&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$DRY_RUN</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;true&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        find /var/cache -name <span class=s2>&#34;*.cache&#34;</span> -mtime +30 <span class=p>|</span> xargs -I<span class=o>{}</span> <span class=nb>echo</span> <span class=s2>&#34;Will remove: {}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        find /var/cache -name <span class=s2>&#34;*.cache&#34;</span> -mtime +30 <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        xargs -r rm -f
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主執行</span>
</span></span><span class=line><span class=cl>log <span class=s2>&#34;開始系統清理 (DRY_RUN: </span><span class=nv>$DRY_RUN</span><span class=s2>)&#34;</span>
</span></span><span class=line><span class=cl>cleanup_logs
</span></span><span class=line><span class=cl>cleanup_temp
</span></span><span class=line><span class=cl>cleanup_cache
</span></span><span class=line><span class=cl>log <span class=s2>&#34;系統清理完成&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-並行下載腳本>3. 並行下載腳本</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># parallel_download.sh - 並行下載腳本</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>URL_FILE</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>urls</span><span class=p>.txt</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DOWNLOAD_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>2</span><span class=k>:-</span><span class=p>./downloads</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>MAX_PARALLEL</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>3</span><span class=k>:-</span><span class=nv>5</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>TIMEOUT</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>4</span><span class=k>:-</span><span class=nv>30</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 檢查輸入檔案</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> ! -f <span class=s2>&#34;</span><span class=nv>$URL_FILE</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;錯誤：找不到 URL 檔案 </span><span class=nv>$URL_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 建立下載目錄</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=s2>&#34;</span><span class=nv>$DOWNLOAD_DIR</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 並行下載</span>
</span></span><span class=line><span class=cl>cat <span class=s2>&#34;</span><span class=nv>$URL_FILE</span><span class=s2>&#34;</span> <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>xargs -n <span class=m>1</span> -P <span class=s2>&#34;</span><span class=nv>$MAX_PARALLEL</span><span class=s2>&#34;</span> -I<span class=o>{}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sh -c <span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    url=&#34;$1&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    dir=&#34;$2&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    timeout=&#34;$3&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    
</span></span></span><span class=line><span class=cl><span class=s1>    filename=$(basename &#34;$url&#34;)
</span></span></span><span class=line><span class=cl><span class=s1>    output_path=&#34;$dir/$filename&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    
</span></span></span><span class=line><span class=cl><span class=s1>    echo &#34;開始下載: $url&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    
</span></span></span><span class=line><span class=cl><span class=s1>    if timeout &#34;$timeout&#34; wget -q -O &#34;$output_path&#34; &#34;$url&#34;; then
</span></span></span><span class=line><span class=cl><span class=s1>        echo &#34;下載成功: $filename&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    else
</span></span></span><span class=line><span class=cl><span class=s1>        echo &#34;下載失敗: $url&#34;
</span></span></span><span class=line><span class=cl><span class=s1>        rm -f &#34;$output_path&#34;
</span></span></span><span class=line><span class=cl><span class=s1>    fi
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span> _ <span class=o>{}</span> <span class=s2>&#34;</span><span class=nv>$DOWNLOAD_DIR</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$TIMEOUT</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;下載任務完成&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 統計結果</span>
</span></span><span class=line><span class=cl><span class=nv>total_files</span><span class=o>=</span><span class=k>$(</span>wc -l &lt; <span class=s2>&#34;</span><span class=nv>$URL_FILE</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>downloaded_files</span><span class=o>=</span><span class=k>$(</span>find <span class=s2>&#34;</span><span class=nv>$DOWNLOAD_DIR</span><span class=s2>&#34;</span> -type f <span class=p>|</span> wc -l<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;總計: </span><span class=nv>$total_files</span><span class=s2> 個檔案，成功下載: </span><span class=nv>$downloaded_files</span><span class=s2> 個檔案&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=效能最佳化>效能最佳化</h2><h3 id=1-並行度調整>1. 並行度調整</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># CPU 綁定任務</span>
</span></span><span class=line><span class=cl><span class=nv>CPU_CORES</span><span class=o>=</span><span class=k>$(</span>nproc<span class=k>)</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.c&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=s2>&#34;</span><span class=nv>$CPU_CORES</span><span class=s2>&#34;</span> gcc -c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># I/O 綁定任務</span>
</span></span><span class=line><span class=cl><span class=nv>IO_PARALLEL</span><span class=o>=</span><span class=k>$(($(</span>nproc<span class=k>)</span> <span class=o>*</span> <span class=m>2</span><span class=k>))</span>
</span></span><span class=line><span class=cl>cat urls.txt <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=s2>&#34;</span><span class=nv>$IO_PARALLEL</span><span class=s2>&#34;</span> wget
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 混合負載</span>
</span></span><span class=line><span class=cl><span class=nv>MIXED_PARALLEL</span><span class=o>=</span><span class=k>$(($(</span>nproc<span class=k>)</span> <span class=o>+</span> <span class=m>2</span><span class=k>))</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.log&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=s2>&#34;</span><span class=nv>$MIXED_PARALLEL</span><span class=s2>&#34;</span> process_log
</span></span></code></pre></td></tr></table></div></div><h3 id=2-記憶體管理>2. 記憶體管理</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 限制批次大小</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.big&#34;</span> <span class=p>|</span> xargs -n <span class=m>1</span> process_large_file
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 限制命令行長度</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.txt&#34;</span> <span class=p>|</span> xargs -s <span class=m>4096</span> process_files
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分段處理</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.data&#34;</span> <span class=p>|</span> split -l <span class=m>1000</span> - batch_
</span></span><span class=line><span class=cl><span class=k>for</span> batch in batch_*<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    cat <span class=s2>&#34;</span><span class=nv>$batch</span><span class=s2>&#34;</span> <span class=p>|</span> xargs -n <span class=m>10</span> -P <span class=m>4</span> process_data
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=3-網路優化>3. 網路優化</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 連接池</span>
</span></span><span class=line><span class=cl>cat servers.txt <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>10</span> -I<span class=o>{}</span> ssh -o <span class=nv>ControlMaster</span><span class=o>=</span>auto -o <span class=nv>ControlPath</span><span class=o>=</span>/tmp/ssh-%r@%h:%p <span class=o>{}</span> <span class=s2>&#34;command&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重試機制</span>
</span></span><span class=line><span class=cl>cat urls.txt <span class=p>|</span> xargs -n <span class=m>1</span> -I<span class=o>{}</span> sh -c <span class=s1>&#39;for i in {1..3}; do wget &#34;{}&#34; &amp;&amp; break; sleep 5; done&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 頻寬限制</span>
</span></span><span class=line><span class=cl>cat large_files.txt <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>2</span> -I<span class=o>{}</span> rsync --bwlimit<span class=o>=</span><span class=m>1000</span> <span class=o>{}</span> destination/
</span></span></code></pre></td></tr></table></div></div><h2 id=總結>總結</h2><h3 id=核心優勢>核心優勢</h3><ol><li><strong>參數處理</strong>：解決命令行參數長度限制</li><li><strong>批次操作</strong>：高效處理大量檔案和資料</li><li><strong>並行執行</strong>：充分利用多核心系統資源</li><li><strong>管道友好</strong>：與其他 Unix 工具完美整合</li><li><strong>靈活控制</strong>：豐富的選項滿足各種需求</li></ol><h3 id=最佳實踐>最佳實踐</h3><ol><li><strong>安全第一</strong>：處理包含空格的檔案名使用 <code>-0</code> 和 <code>-print0</code></li><li><strong>適當並行</strong>：根據任務類型調整並行度</li><li><strong>錯誤處理</strong>：使用 <code>-r</code> 避免空輸入執行</li><li><strong>測試先行</strong>：使用 <code>-t</code> 和 <code>-p</code> 選項測試命令</li><li><strong>效能監控</strong>：測量並優化批次大小和並行度</li></ol><h3 id=常用模式記憶>常用模式記憶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 基本模式</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;pattern&#34;</span> <span class=p>|</span> xargs <span class=nb>command</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安全模式</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;pattern&#34;</span> -print0 <span class=p>|</span> xargs -0 <span class=nb>command</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 並行模式</span>
</span></span><span class=line><span class=cl><span class=nb>command</span> <span class=p>|</span> xargs -n <span class=m>1</span> -P <span class=m>4</span> process
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 替換模式</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;files&#34;</span> <span class=p>|</span> xargs -I<span class=o>{}</span> cp <span class=o>{}</span> backup/<span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 交互模式</span>
</span></span><span class=line><span class=cl>find . -name <span class=s2>&#34;*.tmp&#34;</span> <span class=p>|</span> xargs -p rm
</span></span></code></pre></td></tr></table></div></div><p>xargs 是命令行批次處理和並行執行的瑞士軍刀，掌握其核心概念和常用技巧，能夠大幅提升 Linux 系統管理和自動化任務的效率。記住：合理使用並行處理能夠顯著提升效能，但要注意資源管理和錯誤處理。</p><h2 id=參考資料>參考資料</h2><ul><li><a href=https://www.gnu.org/software/findutils/manual/html_node/find_html/xargs-options.html>GNU Findutils Manual - xargs</a></li><li><a href=https://linux.die.net/man/1/xargs>Linux man xargs</a></li><li><a href=https://tldp.org/LDP/abs/html/>Advanced Bash-Scripting Guide</a></li><li><a href=https://www.oreilly.com/library/view/unix-power-tools/0596003307/>Unix Power Tools</a></li></ul></div><footer class=post-footer><div class=post-tags><span class=tags-label>標籤：</span>
<a href=/tags/linux class=tag-link>#Linux</a>
<a href=/tags/xargs class=tag-link>#Xargs</a>
<a href=/tags/command-line class=tag-link>#Command Line</a>
<a href=/tags/parallel-processing class=tag-link>#Parallel Processing</a>
<a href=/tags/pipe class=tag-link>#Pipe</a>
<a href=/tags/shell class=tag-link>#Shell</a>
<a href=/tags/unix class=tag-link>#Unix</a></div></footer></article><nav class=post-nav><div class=post-nav-links><div class=post-nav-prev><span class=post-nav-label>上一篇</span>
<a href=http://localhost:1313/post/tools/find/ class=post-nav-link>Find 命令完整指南：Linux 檔案搜尋與管理的瑞士軍刀</a></div><div class=post-nav-next><span class=post-nav-label>下一篇</span>
<a href=http://localhost:1313/post/backend/ormenumtype/ class=post-nav-link>JPA Enum 型別處理完整指南：映射策略與最佳實踐</a></div></div></nav></main><footer class=footer><div class=footer-content><p>&copy; 2025 Bill Lin. All rights reserved.</p><div class=social-links><a href=https://github.com/xinqilin class=social-link target=_blank rel=noopener>github</a></div></div></footer><script src=/js/search.js></script></div></body></html>