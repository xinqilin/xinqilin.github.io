<!doctype html><html lang=zh-tw><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Docker Compose - Bill.Lin's Notes</title><meta name=description content="技術筆記與開發心得分享"><link rel=stylesheet href=https://xinqilin.github.io/css/style.min.a91b8e061a8c203e746b8ef3a474886aadf09694603e85dd93de8339a38911c9.css integrity="sha256-qRuOBhqMID50a47zpHSIaq3wlpRgPoXdk96DOaOJEck="><link rel=stylesheet href=https://xinqilin.github.io/css/chroma.min.eb43a1bce3cd013a08124fb3fc84c9d072347d0495cd6739132ef2ac0618998f.css integrity="sha256-60OhvOPNAToIEk+z/ITJ0HI0fQSVzWc5Ey7yrAYYmY8="><link rel=icon type=image/svg+xml href=/images/Bill-coding.svg><link rel=icon type=image/x-icon href=/images/Bill-coding.ico><meta property="og:title" content="Docker Compose"><meta property="og:description" content="技術筆記與開發心得分享"><meta property="og:type" content="article"><meta property="og:url" content="https://xinqilin.github.io/post/devops/docker-compose/"></head><body><div class=container><header class=header><nav class=nav><div class=nav-left><a href=https://xinqilin.github.io/ class=nav-title><img src=/images/Bill-coding.svg alt="Site Icon" class=nav-icon>
Bill.Lin's Notes</a></div><div class=nav-center><a href=https://xinqilin.github.io/ class=avatar-link><div class=avatar-container><div class=avatar-ring></div><img src=/images/Bill-coding.svg alt="Bill's Avatar" class=nav-avatar-center></div></a></div><div class=nav-right><ul class=nav-menu><li class=nav-item><a href=https://xinqilin.github.io/ class=nav-link>Me</a></li><li class=nav-item><a href=/posts/ class="nav-link posts">Posts</a></li><li class=nav-item><a href=/categories/ class="nav-link categories">Categories</a></li></ul></div></nav></header><main class=main-content><article class=post><header class=post-header><h1 class=post-title>Docker Compose</h1><div class=post-meta><div class=post-info><time class=post-date>2021年07月26日</time>
<span class=post-author>by Bill.Lin</span>
<span class=reading-time>1 分鐘閱讀</span></div><div class=post-categories><a href=/categories/devops class=category-link>DevOps</a></div></div></header><div class=post-content><h3 id=docker-composeyml>docker-compose.yml</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker-compose --version
</span></span><span class=line><span class=cl>docker-compose -h <span class=c1># 查看help</span>
</span></span><span class=line><span class=cl>docker-compose up
</span></span><span class=line><span class=cl>docker-compose up -d <span class=c1># 背景</span>
</span></span><span class=line><span class=cl>docker-compose down
</span></span><span class=line><span class=cl>docker-compose <span class=nb>exec</span> <span class=o>{</span>自訂義的service id<span class=o>}</span> /bin/bash
</span></span><span class=line><span class=cl>docker-compose ps <span class=c1># 查看目前運行的 status</span>
</span></span><span class=line><span class=cl>docker-compose top <span class=c1># container 進程？</span>
</span></span><span class=line><span class=cl>docker-compose logs <span class=o>{</span>id<span class=o>}</span> <span class=c1># container log</span>
</span></span><span class=line><span class=cl>docker-compose config <span class=c1># 檢查 config</span>
</span></span><span class=line><span class=cl>docker-compose config -q <span class=c1># 檢查 config, 有error 才 alert</span>
</span></span><span class=line><span class=cl>docker-compose restart
</span></span><span class=line><span class=cl>docker-compose start
</span></span><span class=line><span class=cl>docker-compose stop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker-compose config -q <span class=o>&amp;&amp;</span> docker-compose down <span class=o>&amp;&amp;</span>  docker-compose up -d 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 選3之後的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># 自訂服務名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>microService</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>my_image:1.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>ms_01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;8081:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/Users/bill/microService:/app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>my_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 這個service，必須在 depends_on 的服務啟動後再執行, 不保證完全起起來, 只是順序而已</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 可搭配 https://github.com/vishnubob/wait-for-it 這個 shell</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># docker run -d -p 8081:8080 -v /Users/bill/microService:/app --network my_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>redis</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:6.0.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;6379:6379&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/app/redis/redis.conf:/etc/redis/redis.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/app/redis/data:/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>my_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>redis-server /etc/redis/redis.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>mysql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:5.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>MYSQL_ROOT_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;123456&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;no&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>MYSQL_DATABASE</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;my_test_db&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>MYSQL_USER</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;bill&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>MYSQL_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;user_pwd&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;3306:3306&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/app/mysql/db:/var/lib/mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/app/mysql/conf/my.cnf:/etc/my.cnf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/app/mysql/init:/docker-entrypoint-initdb.d</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>my_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span>--<span class=l>default-authentication-plugin=mysql_native_password</span><span class=w> </span><span class=c># 解決外部無法 access</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>my_network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 純記錄 (沒用到)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>my_data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div></div></article><nav class=post-nav><div class=post-nav-links><div class=post-nav-prev><span class=post-nav-label>上一篇</span>
<a href=https://xinqilin.github.io/post/devops/network/ class=post-nav-link>Network</a></div><div class=post-nav-next><span class=post-nav-label>下一篇</span>
<a href=https://xinqilin.github.io/post/tools/curl/ class=post-nav-link>Curl</a></div></div></nav></main><footer class=footer><div class=footer-content><p>&copy; 2025 Bill Lin. All rights reserved.</p><div class=social-links><a href=https://github.com/xinqilin class=social-link target=_blank rel=noopener>github</a></div></div></footer></div></body></html>