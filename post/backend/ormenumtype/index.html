<!doctype html><html lang=zh-tw><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>JPA Enum 型別處理完整指南：映射策略與最佳實踐 - Bill.Lin's Notes</title><meta name=description content="深入探討 JPA 中 Enum 型別的各種映射策略、自訂轉換器、效能優化與最佳實踐"><link rel=stylesheet href=https://xinqilin.github.io/css/style.min.a91b8e061a8c203e746b8ef3a474886aadf09694603e85dd93de8339a38911c9.css integrity="sha256-qRuOBhqMID50a47zpHSIaq3wlpRgPoXdk96DOaOJEck="><link rel=stylesheet href=https://xinqilin.github.io/css/chroma.min.eb43a1bce3cd013a08124fb3fc84c9d072347d0495cd6739132ef2ac0618998f.css integrity="sha256-60OhvOPNAToIEk+z/ITJ0HI0fQSVzWc5Ey7yrAYYmY8="><link rel=icon type=image/svg+xml href=/images/Bill-coding.svg><link rel=icon type=image/x-icon href=/images/Bill-coding.ico><meta property="og:title" content="JPA Enum 型別處理完整指南：映射策略與最佳實踐"><meta property="og:description" content="深入探討 JPA 中 Enum 型別的各種映射策略、自訂轉換器、效能優化與最佳實踐"><meta property="og:type" content="article"><meta property="og:url" content="https://xinqilin.github.io/post/backend/ormenumtype/"></head><body><div class=container><header class=header><nav class=nav><div class=nav-left><a href=https://xinqilin.github.io/ class=nav-title><img src=/images/Bill-coding.svg alt="Site Icon" class=nav-icon>
Bill.Lin's Notes</a></div><div class=nav-center><a href=https://xinqilin.github.io/ class=avatar-link><div class=avatar-container><div class=avatar-ring></div><img src=/images/Bill-coding.svg alt="Bill's Avatar" class=nav-avatar-center></div></a></div><div class=nav-right><ul class=nav-menu><li class=nav-item><a href=https://xinqilin.github.io/ class=nav-link>Me</a></li><li class=nav-item><a href=/posts/ class="nav-link posts">Posts</a></li><li class=nav-item><a href=/categories/ class="nav-link categories">Categories</a></li></ul></div></nav></header><main class=main-content><article class=post><header class=post-header><h1 class=post-title>JPA Enum 型別處理完整指南：映射策略與最佳實踐</h1><div class=post-meta><div class=post-info><time class=post-date>2023年01月05日</time>
<span class=post-author>by Bill.Lin</span>
<span class=reading-time>8 分鐘閱讀</span></div><div class=post-categories><a href=/categories/backend class=category-link>Backend</a></div></div></header><div class=post-content><h2 id=概述>概述</h2><p>在企業級應用程式開發中，Enum（列舉）是表示有限狀態集合的理想選擇，如訂單狀態、使用者角色、審核狀態等。本文深入探討如何在 JPA/Hibernate 中有效處理 Enum 型別，包含各種映射策略、效能考量和實際應用場景。</p><h2 id=基本-enum-映射>基本 Enum 映射</h2><h3 id=1-enumerated-註解>1. @Enumerated 註解</h3><p>JPA 提供 <code>@Enumerated</code> 註解來處理 Enum 映射，支援兩種策略：</p><h4 id=enumtypeordinal數字映射>EnumType.ORDINAL（數字映射）</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 定義狀態列舉</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PENDING</span><span class=p>,</span><span class=w>    </span><span class=c1>// 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CONFIRMED</span><span class=p>,</span><span class=w>  </span><span class=c1>// 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SHIPPED</span><span class=p>,</span><span class=w>    </span><span class=c1>// 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DELIVERED</span><span class=p>,</span><span class=w>  </span><span class=c1>// 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CANCELLED</span><span class=w>   </span><span class=c1>// 4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 實體類使用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Enumerated</span><span class=p>(</span><span class=n>EnumType</span><span class=p>.</span><span class=na>ORDINAL</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 其他屬性...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>資料庫儲存</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=w> </span><span class=n>TINYINT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 其他欄位
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 儲存的值：0=PENDING, 1=CONFIRMED, 2=SHIPPED, 3=DELIVERED, 4=CANCELLED
</span></span></span></code></pre></div><h4 id=enumtypestring字串映射>EnumType.STRING（字串映射）</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Enumerated</span><span class=p>(</span><span class=n>EnumType</span><span class=p>.</span><span class=na>STRING</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>20</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 其他屬性...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>資料庫儲存</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>BIGINT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>status</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;PENDING&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- 其他欄位
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 儲存的值：&#39;PENDING&#39;, &#39;CONFIRMED&#39;, &#39;SHIPPED&#39;, &#39;DELIVERED&#39;, &#39;CANCELLED&#39;
</span></span></span></code></pre></div><h3 id=2-映射策略比較>2. 映射策略比較</h3><table><thead><tr><th>特性</th><th>ORDINAL</th><th>STRING</th></tr></thead><tbody><tr><td><strong>儲存空間</strong></td><td>小（1-4 bytes）</td><td>大（字串長度）</td></tr><tr><td><strong>可讀性</strong></td><td>差（數字）</td><td>好（文字）</td></tr><tr><td><strong>順序變更風險</strong></td><td>高（破壞性）</td><td>無</td></tr><tr><td><strong>新增項目</strong></td><td>只能追加</td><td>任意位置</td></tr><tr><td><strong>資料庫查詢</strong></td><td>快速</td><td>較慢</td></tr><tr><td><strong>除錯友善</strong></td><td>困難</td><td>容易</td></tr></tbody></table><p><strong>建議</strong>：生產環境通常使用 <code>EnumType.STRING</code>，因為其具備更好的可維護性和可讀性。</p><h2 id=進階-enum-處理>進階 Enum 處理</h2><h3 id=1-自訂-enum-值>1. 自訂 Enum 值</h3><p>當需要更具語意的資料庫值時，可以為 Enum 添加自訂屬性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PENDING</span><span class=p>(</span><span class=s>&#34;PND&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;訂單待處理&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CONFIRMED</span><span class=p>(</span><span class=s>&#34;CNF&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;訂單已確認&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SHIPPED</span><span class=p>(</span><span class=s>&#34;SHP&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;商品已出貨&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DELIVERED</span><span class=p>(</span><span class=s>&#34;DLV&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;商品已送達&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CANCELLED</span><span class=p>(</span><span class=s>&#34;CXL&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;訂單已取消&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OrderStatus</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getCode</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getDescription</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 從代碼查找 Enum</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=nf>fromCode</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>values</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>status</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>code</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>code</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>findFirst</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&#34;未知的訂單狀態代碼: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>code</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 取得所有代碼</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getAllCodes</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>values</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>::</span><span class=n>getCode</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=2-自訂-attributeconverter>2. 自訂 AttributeConverter</h3><p>使用 JPA 2.1 的 <code>@Converter</code> 註解來實現自訂轉換：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Converter</span><span class=p>(</span><span class=n>autoApply</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStatusConverter</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>AttributeConverter</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>convertToDatabaseColumn</span><span class=p>(</span><span class=n>OrderStatus</span><span class=w> </span><span class=n>orderStatus</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>orderStatus</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderStatus</span><span class=p>.</span><span class=na>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=nf>convertToEntityAttribute</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>code</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>code</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>fromCode</span><span class=p>(</span><span class=n>code</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>實體類使用</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Convert</span><span class=p>(</span><span class=n>converter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatusConverter</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 其他屬性...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>資料庫儲存結果</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 儲存的值：&#39;PND&#39;, &#39;CNF&#39;, &#39;SHP&#39;, &#39;DLV&#39;, &#39;CXL&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;PND&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=3-通用-enum-轉換器>3. 通用 Enum 轉換器</h3><p>建立通用的 Enum 轉換器基類：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>CodedEnum</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>getCode</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=o>&lt;</span><span class=n>T</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Enum</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>CodedEnum</span><span class=o>&gt;</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=nf>fromCode</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>enumClass</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>enumClass</span><span class=p>.</span><span class=na>getEnumConstants</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>e</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getCode</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>code</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>findFirst</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalArgumentException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;未知的 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>enumClass</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; 代碼: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>code</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 通用轉換器基類</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>abstract</span><span class=w> </span><span class=kd>class</span> <span class=nc>CodedEnumConverter</span><span class=o>&lt;</span><span class=n>T</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Enum</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>CodedEnum</span><span class=o>&gt;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>implements</span><span class=w> </span><span class=n>AttributeConverter</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>enumClass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=nf>CodedEnumConverter</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>enumClass</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>enumClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>enumClass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>convertToDatabaseColumn</span><span class=p>(</span><span class=n>T</span><span class=w> </span><span class=n>attribute</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>attribute</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>attribute</span><span class=p>.</span><span class=na>getCode</span><span class=p>()</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=nf>convertToEntityAttribute</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>dbData</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>dbData</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>CodedEnum</span><span class=p>.</span><span class=na>fromCode</span><span class=p>(</span><span class=n>enumClass</span><span class=p>,</span><span class=w> </span><span class=n>dbData</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>具體實作</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 實作 CodedEnum 介面</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>Priority</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>CodedEnum</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>LOW</span><span class=p>(</span><span class=s>&#34;L&#34;</span><span class=p>),</span><span class=w> </span><span class=n>MEDIUM</span><span class=p>(</span><span class=s>&#34;M&#34;</span><span class=p>),</span><span class=w> </span><span class=n>HIGH</span><span class=p>(</span><span class=s>&#34;H&#34;</span><span class=p>),</span><span class=w> </span><span class=n>URGENT</span><span class=p>(</span><span class=s>&#34;U&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Priority</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getCode</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 具體轉換器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Converter</span><span class=p>(</span><span class=n>autoApply</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PriorityConverter</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>CodedEnumConverter</span><span class=o>&lt;</span><span class=n>Priority</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>PriorityConverter</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>Priority</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=複雜應用場景>複雜應用場景</h2><h3 id=1-多狀態-enum-設計>1. 多狀態 Enum 設計</h3><p>設計包含狀態轉換邏輯的 Enum：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>CodedEnum</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DRAFT</span><span class=p>(</span><span class=s>&#34;DFT&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;草稿&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PENDING</span><span class=p>(</span><span class=s>&#34;PND&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;待處理&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>DRAFT</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CONFIRMED</span><span class=p>(</span><span class=s>&#34;CNF&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已確認&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>PENDING</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PAID</span><span class=p>(</span><span class=s>&#34;PAD&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已付款&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>CONFIRMED</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SHIPPED</span><span class=p>(</span><span class=s>&#34;SHP&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已出貨&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>PAID</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DELIVERED</span><span class=p>(</span><span class=s>&#34;DLV&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已送達&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>SHIPPED</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CANCELLED</span><span class=p>(</span><span class=s>&#34;CXL&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已取消&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>DRAFT</span><span class=p>,</span><span class=w> </span><span class=n>PENDING</span><span class=p>,</span><span class=w> </span><span class=n>CONFIRMED</span><span class=p>,</span><span class=w> </span><span class=n>PAID</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>REFUNDED</span><span class=p>(</span><span class=s>&#34;RFD&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已退款&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>PAID</span><span class=p>,</span><span class=w> </span><span class=n>SHIPPED</span><span class=p>,</span><span class=w> </span><span class=n>DELIVERED</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span><span class=w> </span><span class=n>allowedPreviousStatuses</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OrderStatus</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span><span class=w> </span><span class=n>allowedPreviousStatuses</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>allowedPreviousStatuses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>allowedPreviousStatuses</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getCode</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getDescription</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 檢查狀態轉換是否合法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>canTransitionFrom</span><span class=p>(</span><span class=n>OrderStatus</span><span class=w> </span><span class=n>currentStatus</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>allowedPreviousStatuses</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>currentStatus</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 取得可轉換到的狀態</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getNextPossibleStatuses</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>values</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>status</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>canTransitionFrom</span><span class=p>(</span><span class=k>this</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toSet</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 檢查是否為終結狀態</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isFinalStatus</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>DELIVERED</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=k>this</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>CANCELLED</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=k>this</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>REFUNDED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 檢查是否可取消</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isCancellable</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>CANCELLED</span><span class=p>.</span><span class=na>canTransitionFrom</span><span class=p>(</span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=2-業務邏輯整合>2. 業務邏輯整合</h3><p>在 Service 層中整合狀態轉換邏輯：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatusHistoryService</span><span class=w> </span><span class=n>statusHistoryService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateOrderStatus</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>newStatus</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>reason</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>orderId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>EntityNotFoundException</span><span class=p>(</span><span class=s>&#34;訂單不存在: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>orderId</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>currentStatus</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getStatus</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 驗證狀態轉換</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>newStatus</span><span class=p>.</span><span class=na>canTransitionFrom</span><span class=p>(</span><span class=n>currentStatus</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalStateException</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;無法從 %s 轉換到 %s&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>currentStatus</span><span class=p>.</span><span class=na>getDescription</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>newStatus</span><span class=p>.</span><span class=na>getDescription</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 更新狀態</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>newStatus</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setLastModified</span><span class=p>(</span><span class=n>LocalDateTime</span><span class=p>.</span><span class=na>now</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 記錄狀態變更歷史</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>statusHistoryService</span><span class=p>.</span><span class=na>recordStatusChange</span><span class=p>(</span><span class=n>orderId</span><span class=p>,</span><span class=w> </span><span class=n>currentStatus</span><span class=p>,</span><span class=w> </span><span class=n>newStatus</span><span class=p>,</span><span class=w> </span><span class=n>reason</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 觸發相關業務邏輯</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>handleStatusChange</span><span class=p>(</span><span class=n>order</span><span class=p>,</span><span class=w> </span><span class=n>currentStatus</span><span class=p>,</span><span class=w> </span><span class=n>newStatus</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleStatusChange</span><span class=p>(</span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>from</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>to</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>to</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>CONFIRMED</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 發送確認郵件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>emailService</span><span class=p>.</span><span class=na>sendOrderConfirmation</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>SHIPPED</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 發送出貨通知</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>emailService</span><span class=p>.</span><span class=na>sendShippingNotification</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 減少庫存</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>inventoryService</span><span class=p>.</span><span class=na>decreaseStock</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getItems</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>DELIVERED</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 發送送達通知</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>emailService</span><span class=p>.</span><span class=na>sendDeliveryNotification</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>case</span><span class=w> </span><span class=n>CANCELLED</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 恢復庫存</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>inventoryService</span><span class=p>.</span><span class=na>restoreStock</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getItems</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 處理退款</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>from</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PAID</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>paymentService</span><span class=p>.</span><span class=na>processRefund</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 批量狀態查詢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findOrdersByStatuses</span><span class=p>(</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span><span class=w> </span><span class=n>statuses</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findByStatusIn</span><span class=p>(</span><span class=n>statuses</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 取得可操作的訂單</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findOrdersReadyForShipping</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findByStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PAID</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=3-狀態歷史追蹤>3. 狀態歷史追蹤</h3><p>建立狀態變更歷史表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;order_status_history&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStatusHistory</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;order_id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>orderId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Convert</span><span class=p>(</span><span class=n>converter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatusConverter</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;from_status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>3</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>fromStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Convert</span><span class=p>(</span><span class=n>converter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OrderStatusConverter</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;to_status&#34;</span><span class=p>,</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>toStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;reason&#34;</span><span class=p>,</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>500</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>reason</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;changed_by&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>changedBy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;changed_at&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>changedAt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 建構子、Getter、Setter...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=4-repository-查詢方法>4. Repository 查詢方法</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>OrderRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Order</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 基本狀態查詢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByStatusIn</span><span class=p>(</span><span class=n>Collection</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span><span class=w> </span><span class=n>statuses</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByStatusNot</span><span class=p>(</span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 複合查詢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByStatusAndCreatedAtBetween</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDateTime</span><span class=w> </span><span class=n>end</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 統計查詢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;SELECT o.status, COUNT(o) FROM Order o GROUP BY o.status&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>[]&gt;</span><span class=w> </span><span class=nf>countOrdersByStatus</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 自訂查詢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;SELECT o FROM Order o WHERE o.status IN :statuses AND o.totalAmount &gt; :minAmount&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findHighValueOrdersByStatuses</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;statuses&#34;</span><span class=p>)</span><span class=w> </span><span class=n>Collection</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span><span class=w> </span><span class=n>statuses</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;minAmount&#34;</span><span class=p>)</span><span class=w> </span><span class=n>BigDecimal</span><span class=w> </span><span class=n>minAmount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 原生 SQL 查詢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT * FROM orders WHERE status IN :statusCodes AND DATE(created_at) = CURDATE()&#34;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=n>nativeQuery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findTodayOrdersByStatusCodes</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;statusCodes&#34;</span><span class=p>)</span><span class=w> </span><span class=n>Collection</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>statusCodes</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=效能優化>效能優化</h2><h3 id=1-索引設計>1. 索引設計</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 狀態欄位索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_orders_status</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>orders</span><span class=p>(</span><span class=n>status</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 複合索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_orders_status_created</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>orders</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>created_at</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 部分索引（針對特定狀態）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_orders_active_status</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>orders</span><span class=p>(</span><span class=n>status</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;PND&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;CNF&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;PAD&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;SHP&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=2-查詢優化>2. 查詢優化</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderQueryService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 使用 Specification 進行動態查詢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findOrdersWithCriteria</span><span class=p>(</span><span class=n>OrderSearchCriteria</span><span class=w> </span><span class=n>criteria</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>(</span><span class=n>Specification</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=n>hasStatus</span><span class=p>(</span><span class=n>criteria</span><span class=p>.</span><span class=na>getStatuses</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>createdBetween</span><span class=p>(</span><span class=n>criteria</span><span class=p>.</span><span class=na>getStartDate</span><span class=p>(),</span><span class=w> </span><span class=n>criteria</span><span class=p>.</span><span class=na>getEndDate</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>hasCustomer</span><span class=p>(</span><span class=n>criteria</span><span class=p>.</span><span class=na>getCustomerId</span><span class=p>())),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Specification</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>hasStatus</span><span class=p>(</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=o>&gt;</span><span class=w> </span><span class=n>statuses</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>cb</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>statuses</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>statuses</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>()</span><span class=w> </span><span class=o>?</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>cb</span><span class=p>.</span><span class=na>conjunction</span><span class=p>()</span><span class=w> </span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>root</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>).</span><span class=na>in</span><span class=p>(</span><span class=n>statuses</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 快取常用統計</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Cacheable</span><span class=p>(</span><span class=s>&#34;orderStatusStats&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getOrderStatusStatistics</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>countOrdersByStatus</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>results</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toMap</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>row</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>)</span><span class=w> </span><span class=n>row</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>row</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>(</span><span class=n>Long</span><span class=p>)</span><span class=w> </span><span class=n>row</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=3-快取策略>3. 快取策略</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStatusCacheService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Cache</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>orderCache</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>OrderStatusCacheService</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>orderCache</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Caffeine</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>maximumSize</span><span class=p>(</span><span class=n>1000</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>expireAfterWrite</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofMinutes</span><span class=p>(</span><span class=n>5</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getCachedOrdersByStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderCache</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=na>getCode</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>code</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findByStatus</span><span class=p>(</span><span class=n>status</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@EventListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleOrderStatusChanged</span><span class=p>(</span><span class=n>OrderStatusChangedEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 清除相關快取</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderCache</span><span class=p>.</span><span class=na>invalidate</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getOldStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderCache</span><span class=p>.</span><span class=na>invalidate</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=na>getNewStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=測試策略>測試策略</h2><h3 id=1-單元測試>1. 單元測試</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ExtendWith</span><span class=p>(</span><span class=n>MockitoExtension</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>OrderServiceTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Mock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Mock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderStatusHistoryService</span><span class=w> </span><span class=n>statusHistoryService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@InjectMocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderService</span><span class=w> </span><span class=n>orderService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testValidStatusTransition</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createOrderWithStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>1L</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>order</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderService</span><span class=p>.</span><span class=na>updateOrderStatus</span><span class=p>(</span><span class=n>1L</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CONFIRMED</span><span class=p>,</span><span class=w> </span><span class=s>&#34;客戶確認&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CONFIRMED</span><span class=p>,</span><span class=w> </span><span class=n>order</span><span class=p>.</span><span class=na>getStatus</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>verify</span><span class=p>(</span><span class=n>statusHistoryService</span><span class=p>).</span><span class=na>recordStatusChange</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>eq</span><span class=p>(</span><span class=n>1L</span><span class=p>),</span><span class=w> </span><span class=n>eq</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>),</span><span class=w> </span><span class=n>eq</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CONFIRMED</span><span class=p>),</span><span class=w> </span><span class=n>eq</span><span class=p>(</span><span class=s>&#34;客戶確認&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testInvalidStatusTransition</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createOrderWithStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>when</span><span class=p>(</span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>1L</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>order</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// When &amp; Then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThatThrownBy</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>orderService</span><span class=p>.</span><span class=na>updateOrderStatus</span><span class=p>(</span><span class=n>1L</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>,</span><span class=w> </span><span class=s>&#34;無效轉換&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>isInstanceOf</span><span class=p>(</span><span class=n>IllegalStateException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>hasMessageContaining</span><span class=p>(</span><span class=s>&#34;無法從&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testOrderStatusEnumProperties</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 測試狀態轉換邏輯</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertTrue</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CONFIRMED</span><span class=p>.</span><span class=na>canTransitionFrom</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertFalse</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>.</span><span class=na>canTransitionFrom</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 測試終結狀態</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertTrue</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>.</span><span class=na>isFinalStatus</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertFalse</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>.</span><span class=na>isFinalStatus</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 測試可取消狀態</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertTrue</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PENDING</span><span class=p>.</span><span class=na>isCancellable</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertFalse</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>.</span><span class=na>isCancellable</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=2-整合測試>2. 整合測試</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@TestPropertySource</span><span class=p>(</span><span class=n>properties</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;spring.jpa.hibernate.ddl-auto=create-drop&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>OrderStatusIntegrationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderService</span><span class=w> </span><span class=n>orderService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testCompleteOrderWorkflow</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 建立訂單</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createTestOrder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 確認訂單</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderService</span><span class=p>.</span><span class=na>updateOrderStatus</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CONFIRMED</span><span class=p>,</span><span class=w> </span><span class=s>&#34;自動確認&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 付款</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderService</span><span class=p>.</span><span class=na>updateOrderStatus</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>PAID</span><span class=p>,</span><span class=w> </span><span class=s>&#34;信用卡付款&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 出貨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderService</span><span class=p>.</span><span class=na>updateOrderStatus</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>SHIPPED</span><span class=p>,</span><span class=w> </span><span class=s>&#34;物流出貨&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 送達</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderService</span><span class=p>.</span><span class=na>updateOrderStatus</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>,</span><span class=w> </span><span class=s>&#34;客戶簽收&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 驗證最終狀態</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>finalOrder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>orElseThrow</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>DELIVERED</span><span class=p>,</span><span class=w> </span><span class=n>finalOrder</span><span class=p>.</span><span class=na>getStatus</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testDatabaseEnumPersistence</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 測試 Enum 值正確儲存和讀取</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>createTestOrder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CONFIRMED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>order</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>order</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 清除 JPA 快取</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>entityManager</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 重新讀取</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Order</span><span class=w> </span><span class=n>reloadedOrder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>orElseThrow</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>CONFIRMED</span><span class=p>,</span><span class=w> </span><span class=n>reloadedOrder</span><span class=p>.</span><span class=na>getStatus</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=最佳實踐與建議>最佳實踐與建議</h2><h3 id=1-設計原則>1. 設計原則</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// ✅ 好的實踐：使用有意義的名稱和描述</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>UserRole</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>CodedEnum</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ADMIN</span><span class=p>(</span><span class=s>&#34;ADM&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;系統管理員&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;*&#34;</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MANAGER</span><span class=p>(</span><span class=s>&#34;MGR&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;部門主管&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;USER_MANAGE&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;REPORT_VIEW&#34;</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>USER</span><span class=p>(</span><span class=s>&#34;USR&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;一般使用者&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;PROFILE_EDIT&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>permissions</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 建構子和方法...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ❌ 避免：過於簡單或不清楚的列舉</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>Status</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>A</span><span class=p>,</span><span class=w> </span><span class=n>B</span><span class=p>,</span><span class=w> </span><span class=n>C</span><span class=p>,</span><span class=w> </span><span class=n>D</span><span class=w>  </span><span class=c1>// 不清楚的含義</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=2-版本管理策略>2. 版本管理策略</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 支援向後相容的 Enum 設計</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>CodedEnum</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 新版本可以安全添加新狀態</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PENDING</span><span class=p>(</span><span class=s>&#34;PND&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;待處理&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CONFIRMED</span><span class=p>(</span><span class=s>&#34;CNF&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已確認&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SHIPPED</span><span class=p>(</span><span class=s>&#34;SHP&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已出貨&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DELIVERED</span><span class=p>(</span><span class=s>&#34;DLV&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已送達&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CANCELLED</span><span class=p>(</span><span class=s>&#34;CXL&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已取消&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 新增狀態（向後相容）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PARTIAL_SHIPPED</span><span class=p>(</span><span class=s>&#34;PSH&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;部分出貨&#34;</span><span class=p>),</span><span class=w>  </span><span class=c1>// v2.0 新增</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>RETURNED</span><span class=p>(</span><span class=s>&#34;RET&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;已退貨&#34;</span><span class=p>);</span><span class=w>          </span><span class=c1>// v2.1 新增</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 處理未知狀態的安全機制</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=nf>fromCodeSafely</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatus</span><span class=w> </span><span class=n>defaultValue</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>fromCode</span><span class=p>(</span><span class=n>code</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IllegalArgumentException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>logger</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&#34;遇到未知的訂單狀態代碼: {}, 使用預設值: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>defaultValue</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>defaultValue</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=3-國際化支援>3. 國際化支援</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStatusI18nService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MessageSource</span><span class=w> </span><span class=n>messageSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getLocalizedDescription</span><span class=p>(</span><span class=n>OrderStatus</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>Locale</span><span class=w> </span><span class=n>locale</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;order.status.&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>name</span><span class=p>().</span><span class=na>toLowerCase</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>messageSource</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>status</span><span class=p>.</span><span class=na>getDescription</span><span class=p>(),</span><span class=w> </span><span class=n>locale</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>OrderStatus</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getAllLocalizedStatuses</span><span class=p>(</span><span class=n>Locale</span><span class=w> </span><span class=n>locale</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>OrderStatus</span><span class=p>.</span><span class=na>values</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toMap</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>status</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>status</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>status</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>getLocalizedDescription</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>locale</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=監控與維護>監控與維護</h2><h3 id=1-狀態分佈監控>1. 狀態分佈監控</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStatusMetrics</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>OrderStatusMetrics</span><span class=p>(</span><span class=n>MeterRegistry</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>,</span><span class=w> </span><span class=n>OrderRepository</span><span class=w> </span><span class=n>orderRepository</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>meterRegistry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>meterRegistry</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>orderRepository</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 註冊度量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Gauge</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;orders.by.status&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>description</span><span class=p>(</span><span class=s>&#34;訂單狀態分佈&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;status&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;all&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>OrderStatusMetrics</span><span class=p>::</span><span class=n>getTotalOrderCount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@EventListener</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>handleOrderStatusChanged</span><span class=p>(</span><span class=n>OrderStatusChangedEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 記錄狀態轉換次數</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Counter</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;order.status.transitions&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>description</span><span class=p>(</span><span class=s>&#34;訂單狀態轉換次數&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;from&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getOldStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>tag</span><span class=p>(</span><span class=s>&#34;to&#34;</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>.</span><span class=na>getNewStatus</span><span class=p>().</span><span class=na>getCode</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>increment</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=nf>getTotalOrderCount</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>orderRepository</span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=2-效能監控>2. 效能監控</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Aspect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OrderStatusPerformanceAspect</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Around</span><span class=p>(</span><span class=s>&#34;execution(* com.example.service.OrderService.updateOrderStatus(..))&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>measureStatusUpdate</span><span class=p>(</span><span class=n>ProceedingJoinPoint</span><span class=w> </span><span class=n>joinPoint</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Timer</span><span class=p>.</span><span class=na>Sample</span><span class=w> </span><span class=n>sample</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Timer</span><span class=p>.</span><span class=na>start</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>joinPoint</span><span class=p>.</span><span class=na>proceed</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>sample</span><span class=p>.</span><span class=na>stop</span><span class=p>(</span><span class=n>Timer</span><span class=p>.</span><span class=na>builder</span><span class=p>(</span><span class=s>&#34;order.status.update.duration&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>description</span><span class=p>(</span><span class=s>&#34;訂單狀態更新耗時&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>meterRegistry</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=總結>總結</h2><p>JPA 中的 Enum 處理是企業級應用程式開發的重要技能。透過本文的深入探討，我們了解到：</p><h3 id=核心要點>核心要點</h3><ol><li><strong>選擇適當的映射策略</strong>：生產環境建議使用 <code>EnumType.STRING</code> 或自訂轉換器</li><li><strong>設計可擴展的 Enum</strong>：考慮未來需求，支援狀態轉換邏輯</li><li><strong>效能優化</strong>：合理使用索引、快取和查詢優化</li><li><strong>測試完整性</strong>：涵蓋狀態轉換邏輯和持久化測試</li><li><strong>監控維護</strong>：建立適當的監控機制</li></ol><h3 id=實際應用建議>實際應用建議</h3><ul><li>對於簡單狀態，使用基本的 <code>@Enumerated(EnumType.STRING)</code></li><li>對於複雜業務邏輯，實作 <code>CodedEnum</code> 介面和自訂轉換器</li><li>建立狀態轉換規則和歷史追蹤機制</li><li>考慮國際化和向後相容性</li><li>實施適當的監控和效能優化策略</li></ul><p>正確處理 Enum 型別不僅能提升程式碼的可讀性和維護性，還能確保資料的一致性和業務邏輯的正確執行。</p><h2 id=參考資料>參考資料</h2><ul><li><a href="https://jcp.org/en/jsr/detail?id=338">JPA 2.2 Specification</a></li><li><a href=https://hibernate.org/orm/documentation/>Hibernate ORM Documentation</a></li><li><a href=https://docs.spring.io/spring-data/jpa/docs/current/reference/html/>Spring Data JPA Reference</a></li><li><a href=https://docs.oracle.com/javase/tutorial/java/javaOO/enum.html>Java Enum Best Practices</a></li><li><a href=https://martinfowler.com/eaaCatalog/>Database Design Patterns</a></li></ul></div><footer class=post-footer><div class=post-tags><span class=tags-label>標籤：</span>
<a href=/tags/java class=tag-link>#Java</a>
<a href=/tags/jpa class=tag-link>#JPA</a>
<a href=/tags/hibernate class=tag-link>#Hibernate</a>
<a href=/tags/enum class=tag-link>#Enum</a>
<a href=/tags/orm class=tag-link>#ORM</a>
<a href=/tags/database class=tag-link>#Database</a>
<a href=/tags/spring class=tag-link>#Spring</a>
<a href=/tags/mysql class=tag-link>#MySQL</a></div></footer></article><nav class=post-nav><div class=post-nav-links><div class=post-nav-prev><span class=post-nav-label>上一篇</span>
<a href=https://xinqilin.github.io/post/tools/xargs/ class=post-nav-link>Xargs</a></div><div class=post-nav-next><span class=post-nav-label>下一篇</span>
<a href=https://xinqilin.github.io/post/backend/ftputil/ class=post-nav-link>FTP 工具類實作指南：安全、可靠的檔案傳輸解決方案</a></div></div></nav></main><footer class=footer><div class=footer-content><p>&copy; 2025 Bill Lin. All rights reserved.</p><div class=social-links><a href=https://github.com/xinqilin class=social-link target=_blank rel=noopener>github</a></div></div></footer></div></body></html>